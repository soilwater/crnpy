
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="CRNPy is a Python package for the correction of cosmic-ray neutron data and the estimation of soil moisture.">
      
      
      
        <link rel="canonical" href="https://soilwater.github.io/crnpy/reference/">
      
      
        <link rel="prev" href="../examples/calibration/calibration/">
      
      
      <link rel="icon" href="../img/logo/favicon.png">
      <meta name="generator" content="mkdocs-1.4.3, mkdocs-material-9.1.11">
    
    
      
        <title>Reference - CRNPy Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.85bb2934.min.css">
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Reference - CRNPy Documentation" >
      
        <meta  property="og:description"  content="CRNPy is a Python package for the correction of cosmic-ray neutron data and the estimation of soil moisture." >
      
        <meta  property="og:image"  content="https://soilwater.github.io/crnpy/assets/images/social/reference.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://soilwater.github.io/crnpy/reference/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Reference - CRNPy Documentation" >
      
        <meta  name="twitter:description"  content="CRNPy is a Python package for the correction of cosmic-ray neutron data and the estimation of soil moisture." >
      
        <meta  name="twitter:image"  content="https://soilwater.github.io/crnpy/assets/images/social/reference.png" >
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var key of Object.keys(palette.color))document.body.setAttribute("data-md-color-"+key,palette.color[key])</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CRNPy Documentation" class="md-header__button md-logo" aria-label="CRNPy Documentation" data-md-component="logo">
      
  <img src="../img/logo/crnpy-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CRNPy Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/soilwater/crnpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CRNPy Documentation" class="md-nav__button md-logo" aria-label="CRNPy Documentation" data-md-component="logo">
      
  <img src="../img/logo/crnpy-logo.svg" alt="logo">

    </a>
    CRNPy Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/soilwater/crnpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.4.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../correction_routines/" class="md-nav__link">
        Correction routines
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Examples
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Examples
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/overview/" class="md-nav__link">
        CRNPy Examples Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/stationary/example_RDT_station/" class="md-nav__link">
        Processing and Analyzing RDT stationary detector observations with CRNPy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/rover/Hydroinnova_rover_example/" class="md-nav__link">
        Processing and Analyzing Hydroinnova Rover Data with CRNPy
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../examples/calibration/calibration/" class="md-nav__link">
        CRNP field calibration of N0 device-specific parameter.
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        Reference
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy" class="md-nav__link">
    crnpy.crnpy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.atm_correction" class="md-nav__link">
    atm_correction()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.biomass_to_bwe" class="md-nav__link">
    biomass_to_bwe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.bwe_correction" class="md-nav__link">
    bwe_correction()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.compute_total_raw_counts" class="md-nav__link">
    compute_total_raw_counts()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.count_time" class="md-nav__link">
    count_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.counts_to_vwc" class="md-nav__link">
    counts_to_vwc()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.cutoff_rigidity" class="md-nav__link">
    cutoff_rigidity()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.drop_outliers" class="md-nav__link">
    drop_outliers()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.estimate_abs_humidity" class="md-nav__link">
    estimate_abs_humidity()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.estimate_lattice_water" class="md-nav__link">
    estimate_lattice_water()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.euclidean_distance" class="md-nav__link">
    euclidean_distance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.fill_counts" class="md-nav__link">
    fill_counts()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.fill_missing_atm" class="md-nav__link">
    fill_missing_atm()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.find_neutron_detectors" class="md-nav__link">
    find_neutron_detectors()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.format_dates_df" class="md-nav__link">
    format_dates_df()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.get_incoming_neutron_flux" class="md-nav__link">
    get_incoming_neutron_flux()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.idw" class="md-nav__link">
    idw()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.interpolate_2D" class="md-nav__link">
    interpolate_2D()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.interpolate_incoming_flux" class="md-nav__link">
    interpolate_incoming_flux()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.latlon_to_utm" class="md-nav__link">
    latlon_to_utm()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.normalize_counts" class="md-nav__link">
    normalize_counts()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.nrad_weight" class="md-nav__link">
    nrad_weight()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.road_correction" class="md-nav__link">
    road_correction()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.sensing_depth" class="md-nav__link">
    sensing_depth()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.smooth_1D" class="md-nav__link">
    smooth_1D()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.smooth_2D" class="md-nav__link">
    smooth_2D()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.storage" class="md-nav__link">
    storage()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data" class="md-nav__link">
    crnpy.data
  </a>
  
    <nav class="md-nav" aria-label="crnpy.data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crnpy.data--crnpydata" class="md-nav__link">
    crnpy.data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy" class="md-nav__link">
    crnpy.crnpy
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.atm_correction" class="md-nav__link">
    atm_correction()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.biomass_to_bwe" class="md-nav__link">
    biomass_to_bwe()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.bwe_correction" class="md-nav__link">
    bwe_correction()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.compute_total_raw_counts" class="md-nav__link">
    compute_total_raw_counts()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.count_time" class="md-nav__link">
    count_time()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.counts_to_vwc" class="md-nav__link">
    counts_to_vwc()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.cutoff_rigidity" class="md-nav__link">
    cutoff_rigidity()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.drop_outliers" class="md-nav__link">
    drop_outliers()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.estimate_abs_humidity" class="md-nav__link">
    estimate_abs_humidity()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.estimate_lattice_water" class="md-nav__link">
    estimate_lattice_water()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.euclidean_distance" class="md-nav__link">
    euclidean_distance()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.fill_counts" class="md-nav__link">
    fill_counts()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.fill_missing_atm" class="md-nav__link">
    fill_missing_atm()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.find_neutron_detectors" class="md-nav__link">
    find_neutron_detectors()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.format_dates_df" class="md-nav__link">
    format_dates_df()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.get_incoming_neutron_flux" class="md-nav__link">
    get_incoming_neutron_flux()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.idw" class="md-nav__link">
    idw()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.interpolate_2D" class="md-nav__link">
    interpolate_2D()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.interpolate_incoming_flux" class="md-nav__link">
    interpolate_incoming_flux()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.latlon_to_utm" class="md-nav__link">
    latlon_to_utm()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.normalize_counts" class="md-nav__link">
    normalize_counts()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.nrad_weight" class="md-nav__link">
    nrad_weight()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.road_correction" class="md-nav__link">
    road_correction()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.sensing_depth" class="md-nav__link">
    sensing_depth()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.smooth_1D" class="md-nav__link">
    smooth_1D()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.smooth_2D" class="md-nav__link">
    smooth_2D()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.storage" class="md-nav__link">
    storage()
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data" class="md-nav__link">
    crnpy.data
  </a>
  
    <nav class="md-nav" aria-label="crnpy.data">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#crnpy.data--crnpydata" class="md-nav__link">
    crnpy.data
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="reference">Reference</h1>


<div class="doc doc-object doc-module">


<a id="crnpy.crnpy"></a>
  <div class="doc doc-contents first">
  
      <p><code>crnpy</code> is a Python package for processing cosmic ray neutron data.</p>
<p>Created by Joaquin Peraza and Andres Patrignani.</p>

  

  <div class="doc doc-children">









<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.atm_correction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">atm_correction</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">humidity</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">Pref</span><span class="p">,</span> <span class="n">Aref</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">incoming_neutrons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">incoming_Ref</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Correct neutron counts for atmospheric factors and incoming neutron flux.</p>
<p>This function corrects neutron counts for atmospheric pressure, and absolute humidity using the method described in Zreda et al. (2012) and Anderson et al. (2017). The correction is performed using the following equation:</p>
<p>$$
C_{corrected} = \frac{C_{raw} \cdot f_w}{f_p \cdot f_i}
$$</p>
<ul>
<li>fp: pressure correction factor</li>
<li>fw: abosolute humidity correction factor</li>
<li>fi: incoming neutron flux correction factor</li>
</ul>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>raw_counts</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>Neutron counts to correct.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pressure</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>Atmospheric pressure readings.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>humidity</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>Atmospheric humidity readings in %.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>temp</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>Atmospheric temperature readings in Celsius.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Pref</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Reference atmospheric pressure in millibars (mbar).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Aref</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Reference absolute humidity.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>L</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Atmospheric attenuation coefficient.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>incoming_neutrons</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>Incoming neutron flux. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>incoming_Ref</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Reference incoming neutron flux. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>numpy.<span title="numpy.array">array</span></code>
          </td>
          <td><p>Total neutron counts corrected by atmospheric conditions.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., et al. (2012).
COSMOS: the cosmic-ray soil moisture observing system. Hydrol. Earth Syst. Sci. 16, 4079–4099.
doi: 10.5194/hess-16-4079-2012</p>
<p>Andreasen, M., Jensen, K.H., Desilets, D., Franz, T.E., Zreda, M., Bogena, H.R. and Looms, M.C., 2017.
Status and perspectives on the cosmic‐ray neutron method for soil moisture estimation and other
environmental science applications. Vadose zone journal, 16(8), pp.1-11. doi.org/10.2136/vzj2017.04.0086</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">atm_correction</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">humidity</span><span class="p">,</span> <span class="n">temp</span><span class="p">,</span> <span class="n">Pref</span><span class="p">,</span> <span class="n">Aref</span><span class="p">,</span> <span class="n">L</span><span class="p">,</span> <span class="n">incoming_neutrons</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">incoming_Ref</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Correct neutron counts for atmospheric factors and incoming neutron flux.</span>

<span class="sd">    This function corrects neutron counts for atmospheric pressure, and absolute humidity using the method described in Zreda et al. (2012) and Anderson et al. (2017). The correction is performed using the following equation:</span>

<span class="sd">    $$</span>
<span class="sd">    C_{corrected} = \frac{C_{raw} \cdot f_w}{f_p \cdot f_i}</span>
<span class="sd">    $$</span>

<span class="sd">    - fp: pressure correction factor</span>
<span class="sd">    - fw: abosolute humidity correction factor</span>
<span class="sd">    - fi: incoming neutron flux correction factor</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_counts (list or array): Neutron counts to correct.</span>
<span class="sd">        pressure (list or array): Atmospheric pressure readings.</span>
<span class="sd">        humidity (list or array): Atmospheric humidity readings in %.</span>
<span class="sd">        temp (list or array): Atmospheric temperature readings in Celsius.</span>
<span class="sd">        Pref (float): Reference atmospheric pressure in millibars (mbar).</span>
<span class="sd">        Aref (float): Reference absolute humidity.</span>
<span class="sd">        L (float): Atmospheric attenuation coefficient.</span>
<span class="sd">        incoming_neutrons (list or array): Incoming neutron flux. Default is None.</span>
<span class="sd">        incoming_Ref (float): Reference incoming neutron flux. Default is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (numpy.array): Total neutron counts corrected by atmospheric conditions.</span>

<span class="sd">    References:</span>
<span class="sd">        Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., et al. (2012).</span>
<span class="sd">        COSMOS: the cosmic-ray soil moisture observing system. Hydrol. Earth Syst. Sci. 16, 4079–4099.</span>
<span class="sd">        doi: 10.5194/hess-16-4079-2012</span>

<span class="sd">        Andreasen, M., Jensen, K.H., Desilets, D., Franz, T.E., Zreda, M., Bogena, H.R. and Looms, M.C., 2017.</span>
<span class="sd">        Status and perspectives on the cosmic‐ray neutron method for soil moisture estimation and other</span>
<span class="sd">        environmental science applications. Vadose zone journal, 16(8), pp.1-11. doi.org/10.2136/vzj2017.04.0086</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### Barometric pressure factor</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">Pref</span> <span class="o">-</span> <span class="n">pressure</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span> <span class="c1"># Zreda et al. 2017 Eq 5.</span>

    <span class="c1">### Atmospheric water vapor factor</span>
    <span class="c1"># Saturation vapor pressure</span>
    <span class="n">e_sat</span> <span class="o">=</span> <span class="mf">0.611</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">17.502</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">/</span> <span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="mf">240.97</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span> <span class="c1"># in Pascals Eq. 3.8 p.41 Environmental Biophysics (Campbell and Norman)</span>

    <span class="c1"># Vapor pressure Pascals</span>
    <span class="n">Pw</span> <span class="o">=</span> <span class="n">e_sat</span> <span class="o">*</span> <span class="n">humidity</span><span class="o">/</span><span class="mi">100</span>

    <span class="c1"># Absolute humidity (g/m^3)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mf">2.16679</span> <span class="c1"># g K/J;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">Pw</span> <span class="o">/</span> <span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span>
    <span class="n">fw</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.0054</span><span class="o">*</span><span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">Aref</span><span class="p">)</span> <span class="c1"># Zreda et al. 2017 Eq 6.</span>

    <span class="c1">### Incoming neutron flux factor</span>
    <span class="k">if</span> <span class="n">incoming_neutrons</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fi</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Ignoring incoming neutron flux correction factor (using value fi=1)&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">incoming_Ref</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incoming_neutrons</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
            <span class="n">incoming_Ref</span> <span class="o">=</span> <span class="n">incoming_neutrons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Reference incoming neutron flux not provided. Using first value of incoming neutron flux.&#39;</span><span class="p">)</span>

        <span class="n">fi</span> <span class="o">=</span> <span class="n">incoming_neutrons</span><span class="o">/</span><span class="n">incoming_Ref</span>
        <span class="n">fi</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mf">1.0</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="c1"># Use a value of 1 for days without data</span>

    <span class="c1"># Apply correction factors</span>
    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">((</span><span class="n">raw_counts</span><span class="o">*</span><span class="n">fw</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">fp</span><span class="o">*</span><span class="n">fi</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.biomass_to_bwe" class="doc doc-heading">
<code class="highlight language-python"><span class="n">biomass_to_bwe</span><span class="p">(</span><span class="n">biomass_dry</span><span class="p">,</span> <span class="n">biomass_fresh</span><span class="p">,</span> <span class="n">fWE</span><span class="o">=</span><span class="mf">0.494</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to convert biomass to biomass water equivalent.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biomass_dry</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Above ground dry biomass in kg m-2.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>biomass_fresh</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Above ground fresh biomass in kg m-2.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fWE</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Stoichiometric ratio of H2O to organic carbon molecules in the plant (assuming this is mostly cellulose)
Default is 0.494 (Wahbi &amp; Avery, 2018).</p></td>
          <td>
                <code>0.494</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Biomass water equivalent in kg m-2.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Wahbi, A., Avery, W. (2018). In Situ Destructive Sampling. In:
Cosmic Ray Neutron Sensing: Estimation of Agricultural Crop Biomass Water Equivalent.
Springer, Cham. https://doi.org/10.1007/978-3-319-69539-6_2</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">biomass_to_bwe</span><span class="p">(</span><span class="n">biomass_dry</span><span class="p">,</span> <span class="n">biomass_fresh</span><span class="p">,</span> <span class="n">fWE</span><span class="o">=</span><span class="mf">0.494</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to convert biomass to biomass water equivalent.</span>

<span class="sd">    Args:</span>
<span class="sd">        biomass_dry (array or pd.Series or pd.DataFrame): Above ground dry biomass in kg m-2.</span>
<span class="sd">        biomass_fresh (array or pd.Series or pd.DataFrame): Above ground fresh biomass in kg m-2.</span>
<span class="sd">        fWE (float): Stoichiometric ratio of H2O to organic carbon molecules in the plant (assuming this is mostly cellulose)</span>
<span class="sd">            Default is 0.494 (Wahbi &amp; Avery, 2018).</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Biomass water equivalent in kg m-2.</span>

<span class="sd">    References:</span>
<span class="sd">        Wahbi, A., Avery, W. (2018). In Situ Destructive Sampling. In:</span>
<span class="sd">        Cosmic Ray Neutron Sensing: Estimation of Agricultural Crop Biomass Water Equivalent.</span>
<span class="sd">        Springer, Cham. https://doi.org/10.1007/978-3-319-69539-6_2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">biomass_fresh</span> <span class="o">-</span> <span class="n">biomass_dry</span><span class="p">)</span> <span class="o">+</span> <span class="n">fWE</span> <span class="o">*</span> <span class="n">biomass_dry</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.bwe_correction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">bwe_correction</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">bwe</span><span class="p">,</span> <span class="n">r2_N0</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to correct for biomass effects in neutron counts.
following the approach described in Baatz et al., 2015.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Array of ephithermal neutron counts.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bwe</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Biomass water equivalent kg m-2.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>r2_N0</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Ratio of the neutron counts reduction (counts kg-1) to the neutron calibration constant (N0). Default is 0.05 (Baatz et al., 2015).</p></td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Array of corrected neutron counts for biomass effects.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Baatz, R., H. R. Bogena, H.-J. Hendricks Franssen, J. A. Huisman, C. Montzka, and H. Vereecken (2015),
An empiricalvegetation correction for soil water content quantification using cosmic ray probes,
Water Resour. Res., 51, 2030–2046, doi:10.1002/ 2014WR016443.</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">bwe_correction</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">bwe</span><span class="p">,</span> <span class="n">r2_N0</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to correct for biomass effects in neutron counts.</span>
<span class="sd">    following the approach described in Baatz et al., 2015.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (array or pd.Series or pd.DataFrame): Array of ephithermal neutron counts.</span>
<span class="sd">        bwe (float): Biomass water equivalent kg m-2.</span>
<span class="sd">        r2_N0 (float): Ratio of the neutron counts reduction (counts kg-1) to the neutron calibration constant (N0). Default is 0.05 (Baatz et al., 2015).</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Array of corrected neutron counts for biomass effects.</span>

<span class="sd">    References:</span>
<span class="sd">        Baatz, R., H. R. Bogena, H.-J. Hendricks Franssen, J. A. Huisman, C. Montzka, and H. Vereecken (2015),</span>
<span class="sd">        An empiricalvegetation correction for soil water content quantification using cosmic ray probes,</span>
<span class="sd">        Water Resour. Res., 51, 2030–2046, doi:10.1002/ 2014WR016443.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">counts</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bwe</span><span class="o">*</span><span class="n">r2_N0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.compute_total_raw_counts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">compute_total_raw_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">nan_strategy</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the sum of uncorrected neutron counts for all detectors.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe containing only the columns with neutron counts.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nan_strategy</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Strategy to use for NaN values. Options are 'interpolate', 'average', or None. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe with the sum of uncorrected neutron counts for all detectors.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compute_total_raw_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">nan_strategy</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the sum of uncorrected neutron counts for all detectors.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (pandas.DataFrame): Dataframe containing only the columns with neutron counts.</span>
<span class="sd">        nan_strategy (str): Strategy to use for NaN values. Options are &#39;interpolate&#39;, &#39;average&#39;, or None. Default is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Dataframe with the sum of uncorrected neutron counts for all detectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">counts</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">counts</span><span class="o">.</span><span class="n">isnull</span><span class="p">()</span><span class="o">.</span><span class="n">values</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="k">if</span> <span class="n">nan_strategy</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;NaN values found. Please fill missing values or provide a strategy. See documentation for more information.&#39;</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">nan_strategy</span> <span class="o">==</span> <span class="s1">&#39;interpolate&#39;</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NaN values found. Interpolating missing values using fill_counts().&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Index must be a timestamp to use interpolation strategy.&#39;</span><span class="p">)</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">fill_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span>
        <span class="k">elif</span> <span class="n">nan_strategy</span> <span class="o">==</span> <span class="s1">&#39;average&#39;</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Only one detector found. Cannot use average strategy.&#39;</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;NaN values found. Replacing missing values with average of other detectors before summing.&#39;</span><span class="p">)</span>
            <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid strategy.&#39;</span><span class="p">)</span>

    <span class="c1">#Compute sum of counts</span>
    <span class="n">total_raw_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="c1"># Replace zeros with NaN</span>
    <span class="n">total_raw_counts</span> <span class="o">=</span> <span class="n">total_raw_counts</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">total_raw_counts</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.count_time" class="doc doc-heading">
<code class="highlight language-python"><span class="n">count_time</span><span class="p">(</span><span class="n">df</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Approximate counting time.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe containing only the columns with neutron counts and timestamp in the index.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe with the approximate counting time for each observation.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <p>Using <code>count_time</code> in a console environment:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">count_time</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
<span class="go">0   3600.0</span>
<span class="go">1   3600.0</span>
<span class="go">2   3600.0</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">count_time</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Approximate counting time.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pandas.DataFrame): Dataframe containing only the columns with neutron counts and timestamp in the index.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Dataframe with the approximate counting time for each observation.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Using `count_time` in a console environment:</span>

<span class="sd">        &gt;&gt;&gt; df = pd.DataFrame(...)</span>
<span class="sd">        &gt;&gt;&gt; count_time(df)</span>
<span class="sd">        0   3600.0</span>
<span class="sd">        1   3600.0</span>
<span class="sd">        2   3600.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check that index is a timestamp</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Index must be a timestamp.&#39;</span><span class="p">)</span>

    <span class="c1"># Calculate time difference between rows</span>
    <span class="n">count_time</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">count_time</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.counts_to_vwc" class="doc doc-heading">
<code class="highlight language-python"><span class="n">counts_to_vwc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">Wsoc</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to convert corrected and filtered neutron counts into volumetric water content.</p>
<p>This method implements soil moisture estimation using the non-linear relationship between neutron count and soil volumetric water content following the approach described in Desilets et al., 2010.</p>
<p>$\theta(N) =\frac{a_0}{(\frac{N}{N_0}) - a_1} - a_2 $</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Array of corrected and filtered neutron counts.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>N0</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Device-specific neutron calibration constant.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Wlat</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Lattice water content.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Wsoc</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Soil organic carbon content.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bulk_density</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Soil bulk density.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>a0</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Parameter given in Zreda et al., 2012. Default is 0.0808.</p></td>
          <td>
                <code>0.0808</code>
          </td>
        </tr>
        <tr>
          <td><code>a1</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Parameter given in Zreda et al., 2012. Default is 0.372.</p></td>
          <td>
                <code>0.372</code>
          </td>
        </tr>
        <tr>
          <td><code>a2</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Parameter given in Zreda et al., 2012. Default is 0.115.</p></td>
          <td>
                <code>0.115</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Volumetric water content in m3 m-3.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Desilets, D., M. Zreda, and T.P.A. Ferré. 2010. Nature’s neutron probe:
Land surface hydrology at an elusive scale with cosmic rays. Water Resour. Res. 46:W11505.
doi.org/10.1029/2009WR008726</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">counts_to_vwc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">Wsoc</span> <span class="p">,</span><span class="n">bulk_density</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span><span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span><span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to convert corrected and filtered neutron counts into volumetric water content.</span>

<span class="sd">    This method implements soil moisture estimation using the non-linear relationship between neutron count and soil volumetric water content following the approach described in Desilets et al., 2010.</span>

<span class="sd">    $\theta(N) =\frac{a_0}{(\frac{N}{N_0}) - a_1} - a_2 $</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (array or pd.Series or pd.DataFrame): Array of corrected and filtered neutron counts.</span>
<span class="sd">        N0 (float): Device-specific neutron calibration constant.</span>
<span class="sd">        Wlat (float): Lattice water content.</span>
<span class="sd">        Wsoc (float): Soil organic carbon content.</span>
<span class="sd">        bulk_density (float): Soil bulk density.</span>
<span class="sd">        a0 (float): Parameter given in Zreda et al., 2012. Default is 0.0808.</span>
<span class="sd">        a1 (float): Parameter given in Zreda et al., 2012. Default is 0.372.</span>
<span class="sd">        a2 (float): Parameter given in Zreda et al., 2012. Default is 0.115.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Volumetric water content in m3 m-3.</span>

<span class="sd">    References:</span>
<span class="sd">        Desilets, D., M. Zreda, and T.P.A. Ferré. 2010. Nature’s neutron probe:</span>
<span class="sd">        Land surface hydrology at an elusive scale with cosmic rays. Water Resour. Res. 46:W11505.</span>
<span class="sd">        doi.org/10.1029/2009WR008726</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert neutron counts into vwc</span>
    <span class="n">vwc</span> <span class="o">=</span> <span class="p">(</span><span class="n">a0</span> <span class="o">/</span> <span class="p">(</span><span class="n">counts</span><span class="o">/</span><span class="n">N0</span><span class="o">-</span><span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">-</span> <span class="n">Wlat</span> <span class="o">-</span> <span class="n">Wsoc</span><span class="p">)</span> <span class="o">*</span> <span class="n">bulk_density</span>
    <span class="k">return</span> <span class="n">vwc</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.cutoff_rigidity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cutoff_rigidity</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the approximate cutoff rigidity for any point on Earth according to the
tabulated data of Smart and Shea, 2019. Values are approximations so that users have an idea of
what neutron detectors from the Neutron Monitor Database (NMD).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>lat</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Geographic latitude in decimal degrees. Value in range -90 to 90</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lon</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Geographic longitude in decimal degrees. Values in range from 0 to 360.
Typical negative longitudes in the west hemisphere will fall in the range 180 to 360.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>Cutoff rigidity in GV. Error is about +/- 0.3 GV</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <p>Estimate the cutoff rigidity for Newark, NJ, US</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">zq</span> <span class="o">=</span> <span class="n">cutoff_rigidity</span><span class="p">(</span><span class="mf">39.68</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.75</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">zq</span><span class="p">)</span>
<span class="go">2.52 GV (Value from NMD is 2.40 GV)</span>
</code></pre></div>

<details class="references" open>
  <summary>References</summary>
  <p>Smart, D. &amp; Shea, Matthew. (2001). Geomagnetic Cutoff Rigidity Computer Program:
Theory, Software Description and Example. NASA STI/Recon Technical Report N.</p>
<p>Shea, M. A., &amp; Smart, D. F. (2019, July). Re-examination of the First Five Ground-Level Events.
In International Cosmic Ray Conference (ICRC2019) (Vol. 36, p. 1149).</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cutoff_rigidity</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span><span class="n">lon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to estimate the approximate cutoff rigidity for any point on Earth according to the</span>
<span class="sd">    tabulated data of Smart and Shea, 2019. Values are approximations so that users have an idea of</span>
<span class="sd">    what neutron detectors from the Neutron Monitor Database (NMD).</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (float): Geographic latitude in decimal degrees. Value in range -90 to 90</span>
<span class="sd">        lon (float): Geographic longitude in decimal degrees. Values in range from 0 to 360.</span>
<span class="sd">            Typical negative longitudes in the west hemisphere will fall in the range 180 to 360.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Cutoff rigidity in GV. Error is about +/- 0.3 GV</span>

<span class="sd">    Examples:</span>
<span class="sd">        Estimate the cutoff rigidity for Newark, NJ, US</span>

<span class="sd">        &gt;&gt;&gt; zq = cutoff_rigidity(39.68, -75.75)</span>
<span class="sd">        &gt;&gt;&gt; print(zq)</span>
<span class="sd">        2.52 GV (Value from NMD is 2.40 GV)</span>

<span class="sd">    References:</span>
<span class="sd">        Smart, D. &amp; Shea, Matthew. (2001). Geomagnetic Cutoff Rigidity Computer Program:</span>
<span class="sd">        Theory, Software Description and Example. NASA STI/Recon Technical Report N.</span>

<span class="sd">        Shea, M. A., &amp; Smart, D. F. (2019, July). Re-examination of the First Five Ground-Level Events.</span>
<span class="sd">        In International Cosmic Ray Conference (ICRC2019) (Vol. 36, p. 1149).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xq</span> <span class="o">=</span> <span class="n">lon</span>
    <span class="n">yq</span> <span class="o">=</span> <span class="n">lat</span>

    <span class="k">if</span> <span class="n">xq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">xq</span> <span class="o">=</span> <span class="n">xq</span><span class="o">*-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">180</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">cutoff_rigidity</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span> <span class="p">(</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span> <span class="p">)</span><span class="o">.</span><span class="n">T</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">zq</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">xq</span><span class="p">,</span><span class="n">yq</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">zq</span><span class="p">,</span><span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.drop_outliers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">drop_outliers</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">store_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_counts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_counts</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Computation of a moving modified Z-score based on the median absolute difference.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>raw_counts</code></td>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe containing only the columns with neutron counts.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>window</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Window size for the moving median. Default is 11.</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>store_outliers</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>If True, store the outliers in a new column. Default is False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>min_counts</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Minimum number of counts for a reading to be considered valid. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_counts</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Maximum number of counts for a reading to be considered valid. Default is None.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe without outliers.</p></td>
        </tr>
        <tr>
          <td>
          </td>
          <td><p>or</p></td>
        </tr>
        <tr>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span>, pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe without outliers and dataframe with outliers.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Iglewicz, B. and Hoaglin, D.C., 1993. How to detect and handle outliers (Vol. 16). Asq Press.</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">drop_outliers</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">store_outliers</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">min_counts</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_counts</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Computation of a moving modified Z-score based on the median absolute difference.</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_counts (pandas.DataFrame): Dataframe containing only the columns with neutron counts.</span>
<span class="sd">        window (int): Window size for the moving median. Default is 11.</span>
<span class="sd">        store_outliers (bool): If True, store the outliers in a new column. Default is False.</span>
<span class="sd">        min_counts (int): Minimum number of counts for a reading to be considered valid. Default is None.</span>
<span class="sd">        max_counts (int): Maximum number of counts for a reading to be considered valid. Default is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Dataframe without outliers.</span>
<span class="sd">        or</span>
<span class="sd">        (pandas.DataFrame, pandas.DataFrame): Dataframe without outliers and dataframe with outliers.</span>

<span class="sd">    References:</span>
<span class="sd">        Iglewicz, B. and Hoaglin, D.C., 1993. How to detect and handle outliers (Vol. 16). Asq Press.</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="k">if</span> <span class="n">min_counts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lower_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">raw_counts</span> <span class="o">&lt;</span> <span class="n">min_counts</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">lower_count</span> <span class="o">&gt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span> <span class="o">*</span> <span class="mf">0.25</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: Discarded </span><span class="si">{</span><span class="n">lower_count</span><span class="si">}</span><span class="s2"> counts below </span><span class="si">{</span><span class="n">min_counts</span><span class="si">}</span><span class="s2">. This is more than 25% of the total number of readings. Consider increasing the minimum counts threshold.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Discarded counts below </span><span class="si">{</span><span class="n">min_counts</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">lower_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">raw_counts</span> <span class="o">=</span> <span class="n">raw_counts</span><span class="p">[</span><span class="n">raw_counts</span> <span class="o">&gt;=</span> <span class="n">min_counts</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">max_counts</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">upper_count</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">raw_counts</span> <span class="o">&gt;</span> <span class="n">max_counts</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Discarded counts above </span><span class="si">{</span><span class="n">max_counts</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">upper_count</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="n">raw_counts</span> <span class="o">=</span> <span class="n">raw_counts</span><span class="p">[</span><span class="n">raw_counts</span> <span class="o">&lt;=</span> <span class="n">max_counts</span><span class="p">]</span>

    <span class="c1"># Compute median absolute difference</span>
    <span class="n">median</span> <span class="o">=</span> <span class="n">raw_counts</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
    <span class="n">diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">raw_counts</span> <span class="o">-</span> <span class="n">median</span><span class="p">)</span>
    <span class="n">mad</span> <span class="o">=</span> <span class="n">diff</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

    <span class="c1"># Compute modified Z-score</span>
    <span class="n">modified_z_score</span> <span class="o">=</span> <span class="mf">0.6745</span> <span class="o">*</span> <span class="n">diff</span> <span class="o">/</span> <span class="n">mad</span>
    <span class="n">outliers</span> <span class="o">=</span> <span class="n">raw_counts</span><span class="p">[</span><span class="n">modified_z_score</span> <span class="o">&gt;</span> <span class="mf">3.5</span><span class="p">]</span>
    <span class="c1"># Drop outliers</span>
    <span class="n">raw_counts</span> <span class="o">=</span> <span class="n">raw_counts</span><span class="p">[</span><span class="n">modified_z_score</span> <span class="o">&lt;</span> <span class="mf">3.5</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">store_outliers</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">raw_counts</span><span class="p">,</span> <span class="n">outliers</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Discarded </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span><span class="si">}</span><span class="s2"> outliers using modified Z-score.&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">raw_counts</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.estimate_abs_humidity" class="doc doc-heading">
<code class="highlight language-python"><span class="n">estimate_abs_humidity</span><span class="p">(</span><span class="n">RH</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the actual vapor pressure (e) in g m^-3 using RH (%) and current temperature (c) observations.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>RH</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>relative humidity (%)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>temp</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>temperature (Celsius)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
          </td>
          <td><p>actual vapor pressure (g m^-3)</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">estimate_abs_humidity</span><span class="p">(</span><span class="n">RH</span><span class="p">,</span> <span class="n">temp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the actual vapor pressure (e) in g m^-3 using RH (%) and current temperature (c) observations.</span>

<span class="sd">    Args:</span>
<span class="sd">        RH (float): relative humidity (%)</span>
<span class="sd">        temp (float): temperature (Celsius)</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: actual vapor pressure (g m^-3)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### Atmospheric water vapor factor</span>
    <span class="c1"># Saturation vapor pressure</span>
    <span class="n">e_sat</span> <span class="o">=</span> <span class="mf">0.611</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">17.502</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">temp</span> <span class="o">+</span> <span class="mf">240.97</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># in Pascals Eq. 3.8 p.41 Environmental Biophysics (Campbell and Norman)</span>

    <span class="c1"># Vapor pressure Pascals</span>
    <span class="n">Pw</span> <span class="o">=</span> <span class="n">e_sat</span> <span class="o">*</span> <span class="n">RH</span> <span class="o">/</span> <span class="mi">100</span>

    <span class="c1"># Absolute humidity (g/m^3)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mf">2.16679</span>  <span class="c1"># g K/J;</span>
    <span class="n">abs_h</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">Pw</span> <span class="o">/</span> <span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abs_h</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.estimate_lattice_water" class="doc doc-heading">
<code class="highlight language-python"><span class="n">estimate_lattice_water</span><span class="p">(</span><span class="n">clay_content</span><span class="p">,</span> <span class="n">total_carbon</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Estimate the amount of water in the lattice of clay minerals.</p>
<table>
<thead>
<tr>
<th align="center"><img alt="img1" src="../img/lattice_water_simple.png" /></th>
<th align="center"><img alt="img2" src="../img/lattice_water_multiple.png" /></th>
</tr>
</thead>
<tbody>
<tr>
<td align="center">$\omega_{lat} = 1.241 + 0.069 * clay(\%)$</td>
<td align="center">$\omega_{lat} = -0.028 + 0.077 * clay(\%) + 0.459 * carbon(\%)$</td>
</tr>
<tr>
<td align="center">Linear regression [lattice water (%) as a function of clay (%)] done with data from Soil Water Processes Lab and Dong and Ochsner (2018)</td>
<td align="center">Multiple linear regression [lattice water (%) as a function of clay (%) and soil carbon (%)] done with data from Soil Water Processes Lab.</td>
</tr>
</tbody>
</table>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>clay_content</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Clay content in the soil in percent.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>total_carbon</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Total carbon content in the soil in percent.
If None, the amount of water is estimated based on clay content only.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td><p>Amount of water in the lattice of clay minerals in percent</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Dong, J., &amp; Ochsner, T. E. (2018). Soil texture often exerts a stronger influence than precipitation
 on mesoscale soil moisture patterns. Water Resources Research, 54, 2199– 2211.
 https://doi.org/10.1002/2017WR021692</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span>
<span class="normal">971</span>
<span class="normal">972</span>
<span class="normal">973</span>
<span class="normal">974</span>
<span class="normal">975</span>
<span class="normal">976</span>
<span class="normal">977</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">estimate_lattice_water</span><span class="p">(</span><span class="n">clay_content</span><span class="p">,</span> <span class="n">total_carbon</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate the amount of water in the lattice of clay minerals.</span>

<span class="sd">    ![img1](img/lattice_water_simple.png) | ![img2](img/lattice_water_multiple.png)</span>
<span class="sd">    :-------------------------:|:-------------------------:</span>
<span class="sd">    $\omega_{lat} = 1.241 + 0.069 * clay(\%)$ | $\omega_{lat} = -0.028 + 0.077 * clay(\%) + 0.459 * carbon(\%)$</span>
<span class="sd">    Linear regression [lattice water (%) as a function of clay (%)] done with data from Soil Water Processes Lab and Dong and Ochsner (2018) |  Multiple linear regression [lattice water (%) as a function of clay (%) and soil carbon (%)] done with data from Soil Water Processes Lab.</span>

<span class="sd">    Args:</span>
<span class="sd">        clay_content (float): Clay content in the soil in percent.</span>
<span class="sd">        total_carbon (float, optional): Total carbon content in the soil in percent.</span>
<span class="sd">            If None, the amount of water is estimated based on clay content only.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Amount of water in the lattice of clay minerals in percent</span>

<span class="sd">    References:</span>
<span class="sd">        Dong, J., &amp; Ochsner, T. E. (2018). Soil texture often exerts a stronger influence than precipitation</span>
<span class="sd">         on mesoscale soil moisture patterns. Water Resources Research, 54, 2199– 2211.</span>
<span class="sd">         https://doi.org/10.1002/2017WR021692</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">total_carbon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lattice_water</span> <span class="o">=</span> <span class="mf">1.241</span> <span class="o">+</span> <span class="mf">0.069</span> <span class="o">*</span> <span class="n">clay_content</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lattice_water</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.028</span> <span class="o">+</span> <span class="mf">0.077</span> <span class="o">*</span> <span class="n">clay_content</span> <span class="o">+</span> <span class="mf">0.459</span> <span class="o">*</span> <span class="n">total_carbon</span>
    <span class="k">return</span> <span class="n">lattice_water</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.euclidean_distance" class="doc doc-heading">
<code class="highlight language-python"><span class="n">euclidean_distance</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that computes the Euclidean distance between one point
in space and one or more points.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>px</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>x projected coordinate of the point.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>py</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>y projected coordinate of the point.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list, ndarray, pandas.<span title="pandas.series">series</span></code>
          </td>
          <td><p>vector of x projected coordinates.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list, ndarray, pandas.<span title="pandas.series">series</span></code>
          </td>
          <td><p>vector of y projected coordinates.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ndarray</code>
          </td>
          <td><p>Numpy array of distances from the point (px,py) to all the points in x and y vectors.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1067</span>
<span class="normal">1068</span>
<span class="normal">1069</span>
<span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">euclidean_distance</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that computes the Euclidean distance between one point</span>
<span class="sd">    in space and one or more points.</span>

<span class="sd">    Args:</span>
<span class="sd">        px (float): x projected coordinate of the point.</span>
<span class="sd">        py (float): y projected coordinate of the point.</span>
<span class="sd">        x (list, ndarray, pandas.series): vector of x projected coordinates.</span>
<span class="sd">        y (list, ndarray, pandas.series): vector of y projected coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (ndarray): Numpy array of distances from the point (px,py) to all the points in x and y vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">px</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">py</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.fill_counts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fill_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">count_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expected_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Fill missing neutron counts. Observation periods shorter than threshold are discarded (replaced with NaN).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame with neutron counts, might have count_time column(s).</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>count_time</code></td>
          <td>
                <code>pandas.Series or pandas.DataFrame</code>
          </td>
          <td><p>Counting time in seconds. If a DataFrame is provided, it must have the same number of columns as df.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>expected_time</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Expected counting time in seconds. If not provided, it is calculated as the median of the counting times.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
        <tr>
          <td><code>threshold</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Minimum fraction of the neutron integration time. Default is 0.25.</p></td>
          <td>
                <code>0.25</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame with linearly interpolated neutron counts.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <p>Using <code>fill_counts</code> in a console environment:</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;counts&#39;</span><span class="p">:[</span><span class="mi">100</span><span class="p">,</span><span class="mi">105</span><span class="p">,</span><span class="mi">98</span><span class="p">,</span><span class="mi">102</span><span class="p">],</span> <span class="n">count_time</span><span class="p">:[</span><span class="mi">3600</span><span class="p">,</span><span class="mi">200</span><span class="p">,</span><span class="mi">3600</span><span class="p">,</span><span class="mi">3600</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">fill_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">count_time</span><span class="o">=</span><span class="n">count_time</span><span class="p">,</span> <span class="n">expected_time</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
<span class="go">0   100.0</span>
<span class="go">1   NaN</span>
<span class="go">2   98.0</span>
<span class="go">3   102.0</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fill_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">count_times</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">expected_time</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">threshold</span><span class="o">=</span><span class="mf">0.25</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fill missing neutron counts. Observation periods shorter than threshold are discarded (replaced with NaN).</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (pandas.DataFrame): DataFrame with neutron counts, might have count_time column(s).</span>
<span class="sd">        count_time (pandas.Series or pandas.DataFrame): Counting time in seconds. If a DataFrame is provided, it must have the same number of columns as df.</span>
<span class="sd">        expected_time (int): Expected counting time in seconds. If not provided, it is calculated as the median of the counting times.</span>
<span class="sd">        threshold (float): Minimum fraction of the neutron integration time. Default is 0.25.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): DataFrame with linearly interpolated neutron counts.</span>

<span class="sd">    Examples:</span>
<span class="sd">        Using `fill_counts` in a console environment:</span>

<span class="sd">        &gt;&gt;&gt; counts = pd.DataFrame({&#39;counts&#39;:[100,105,98,102], count_time:[3600,200,3600,3600]})</span>
<span class="sd">        &gt;&gt;&gt; fill_counts(counts, count_time=count_time, expected_time=3600, threshold=0.25)</span>
<span class="sd">        0   100.0</span>
<span class="sd">        1   NaN</span>
<span class="sd">        2   98.0</span>
<span class="sd">        3   102.0</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">counts</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count_times</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No count time columns provided. Using timestamp index to compute count time.&quot;</span><span class="p">)</span>
        <span class="n">count_times</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">!=</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count_times</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Index must be a timestamp or count times must be provided.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">count_times</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Count times length does not match number of readings.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">expected_time</span> <span class="ow">is</span> <span class="kc">False</span><span class="p">:</span>
        <span class="n">expected_time</span> <span class="o">=</span> <span class="n">count_times</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Using median count time as expected count time:&#39;</span><span class="p">,</span> <span class="n">expected_time</span><span class="p">)</span>

    <span class="c1"># Replace values below threshold with NaN</span>
    <span class="n">time_threshold</span> <span class="o">=</span> <span class="nb">round</span><span class="p">(</span><span class="n">expected_time</span> <span class="o">*</span> <span class="n">threshold</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">count_times</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">count_times</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">idx_nan</span> <span class="o">=</span> <span class="n">count_times</span><span class="p">[</span><span class="n">count_times</span> <span class="o">&lt;</span> <span class="n">time_threshold</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
            <span class="n">counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">count_times</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
                <span class="n">idx_nan</span> <span class="o">=</span> <span class="n">count_times</span><span class="p">[</span><span class="n">count_times</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">time_threshold</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
                <span class="n">counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">count_times</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
        <span class="n">idx_nan</span> <span class="o">=</span> <span class="n">count_times</span><span class="p">[</span><span class="n">count_times</span> <span class="o">&lt;</span> <span class="n">time_threshold</span><span class="p">]</span><span class="o">.</span><span class="n">index</span>
        <span class="n">counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">count_times</span><span class="p">)</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
        <span class="n">idx_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">count_times</span> <span class="o">&lt;</span> <span class="n">time_threshold</span><span class="p">)</span>
        <span class="n">counts</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">idx_nan</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Fill missing values with linear interpolation and round to nearest integer</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">counts</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.fill_missing_atm" class="doc doc-heading">
<code class="highlight language-python"><span class="n">fill_missing_atm</span><span class="p">(</span><span class="n">cols_atm</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">24</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Fill missing values in atmospheric variables. Gap filling is performed using a
piecewise cubic Hermite interpolating polynomial (pchip method) that is restricted to intervals
of missing data with a limited number of values and surrounded by valid observations.
There is no interpolation at the end of the time series.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>col_atm</code></td>
          <td>
                <code>pandas.Series or pandas.DataFrame</code>
          </td>
          <td><p>Atmospheric variables to fill.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>limit</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Maximum number of consecutive missing values to interpolate. Default is 24.</p></td>
          <td>
                <code>24</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Atmospheric variables with filled missing values using a piecewise cubic Hermite polynomial.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.interpolate.html</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fill_missing_atm</span><span class="p">(</span><span class="n">cols_atm</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="mi">24</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Fill missing values in atmospheric variables. Gap filling is performed using a</span>
<span class="sd">    piecewise cubic Hermite interpolating polynomial (pchip method) that is restricted to intervals</span>
<span class="sd">    of missing data with a limited number of values and surrounded by valid observations.</span>
<span class="sd">    There is no interpolation at the end of the time series.</span>

<span class="sd">    Args:</span>
<span class="sd">        col_atm (pandas.Series or pandas.DataFrame): Atmospheric variables to fill.</span>
<span class="sd">        limit (int): Maximum number of consecutive missing values to interpolate. Default is 24.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Atmospheric variables with filled missing values using a piecewise cubic Hermite polynomial.</span>

<span class="sd">    References:</span>
<span class="sd">        https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.DataFrame.interpolate.html</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Fill missing values in atmospheric variables</span>
    <span class="k">return</span> <span class="n">cols_atm</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;pchip&#39;</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="n">limit</span><span class="p">,</span> <span class="n">limit_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.find_neutron_detectors" class="doc doc-heading">
<code class="highlight language-python"><span class="n">find_neutron_detectors</span><span class="p">(</span><span class="n">Rc</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Search for potential reference neutron monitoring stations based on cutoff rigidity.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>Rc</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Cutoff rigidity in GV. Values in range 1.0 to 3.0 GV.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>start_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td><p>Start date for the period of interest.   </p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>end_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td><p>End date for the period of interest.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td><p>List of top five stations with closes cutoff rigidity.
User needs to select station according to site altitude.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">crnpy</span> <span class="kn">import</span> <span class="n">crnpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Rc</span> <span class="o">=</span> <span class="mf">2.40</span> <span class="c1"># 2.40 Newark, NJ, US</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crnpy</span><span class="o">.</span><span class="n">find_neutron_detectors</span><span class="p">(</span><span class="n">Rc</span><span class="p">)</span>
<span class="go">Select a station with an altitude similar to that of your location. For more information go to: &#39;https://www.nmdb.eu/nest/help.php#helpstations</span>
</code></pre></div>
    <p>Your cutoff rigidity is 2.4 GV
        STID                          NAME     R  Altitude_m
40   NEWK                        Newark  2.40          50
33   MOSC                        Moscow  2.43         200
27   KIEL                          Kiel  2.36          54
28  KIEL2                        KielRT  2.36          54
31   MCRL  Mobile Cosmic Ray Laboratory  2.46         200
32   MGDN                       Magadan  2.10         220
42   NVBK                   Novosibirsk  2.91         163
26   KGSN                      Kingston  1.88          65
9    CLMX                        Climax  3.00        3400
57   YKTK                       Yakutsk  1.65         105</p>

<details class="references" open>
  <summary>References</summary>
  <p>https://www.nmdb.eu/nest/help.php#helpstations</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_neutron_detectors</span><span class="p">(</span><span class="n">Rc</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for potential reference neutron monitoring stations based on cutoff rigidity.</span>

<span class="sd">    Args:</span>
<span class="sd">        Rc (float): Cutoff rigidity in GV. Values in range 1.0 to 3.0 GV.</span>
<span class="sd">        start_date (datetime): Start date for the period of interest.   </span>
<span class="sd">        end_date (datetime): End date for the period of interest.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): List of top five stations with closes cutoff rigidity.</span>
<span class="sd">            User needs to select station according to site altitude.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from crnpy import crnpy</span>
<span class="sd">        &gt;&gt;&gt; Rc = 2.40 # 2.40 Newark, NJ, US</span>
<span class="sd">        &gt;&gt;&gt; crnpy.find_neutron_detectors(Rc)</span>
<span class="sd">        Select a station with an altitude similar to that of your location. For more information go to: &#39;https://www.nmdb.eu/nest/help.php#helpstations</span>

<span class="sd">        Your cutoff rigidity is 2.4 GV</span>
<span class="sd">                STID                          NAME     R  Altitude_m</span>
<span class="sd">        40   NEWK                        Newark  2.40          50</span>
<span class="sd">        33   MOSC                        Moscow  2.43         200</span>
<span class="sd">        27   KIEL                          Kiel  2.36          54</span>
<span class="sd">        28  KIEL2                        KielRT  2.36          54</span>
<span class="sd">        31   MCRL  Mobile Cosmic Ray Laboratory  2.46         200</span>
<span class="sd">        32   MGDN                       Magadan  2.10         220</span>
<span class="sd">        42   NVBK                   Novosibirsk  2.91         163</span>
<span class="sd">        26   KGSN                      Kingston  1.88          65</span>
<span class="sd">        9    CLMX                        Climax  3.00        3400</span>
<span class="sd">        57   YKTK                       Yakutsk  1.65         105</span>

<span class="sd">    References:</span>
<span class="sd">        https://www.nmdb.eu/nest/help.php#helpstations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load file with list of neutron monitoring stations</span>
    <span class="n">stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">neutron_detectors</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;STID&quot;</span><span class="p">,</span><span class="s2">&quot;NAME&quot;</span><span class="p">,</span><span class="s2">&quot;R&quot;</span><span class="p">,</span><span class="s2">&quot;Altitude_m&quot;</span><span class="p">])</span>

    <span class="c1"># Sort stations by closest cutoff rigidity</span>
    <span class="n">idx_R</span> <span class="o">=</span> <span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Rc</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stations</span><span class="p">[</span><span class="s2">&quot;Period available&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">station</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_R</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;STID&quot;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>
        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="s2">&quot;Period available&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No stations available for the selected period!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stations</span> <span class="o">=</span> <span class="n">stations</span><span class="p">[</span><span class="n">stations</span><span class="p">[</span><span class="s2">&quot;Period available&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
            <span class="n">idx_R</span> <span class="o">=</span> <span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Rc</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">idx_R</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Print results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;&quot;Select a station with an altitude similar to that of your location. For more information go to: &#39;https://www.nmdb.eu/nest/help.php#helpstations&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your cutoff rigidity is </span><span class="si">{</span><span class="n">Rc</span><span class="si">}</span><span class="s2"> GV&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.format_dates_df" class="doc doc-heading">
<code class="highlight language-python"><span class="n">format_dates_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">round_time</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Helper function to change the format and round timestamps.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame with timestamp in the index.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>col</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Column with the timestamp. Default is 'timestamp'.</p></td>
          <td>
                <code>&#39;timestamp&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>format</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Format of the timestamp. Default is '%Y-%m-%d %H:%M:%S'.</p></td>
          <td>
                <code>&#39;%Y-%m-%d %H:%M:%S&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>freq</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Rounding interval. 'H' for hourly, 'M' for minute, or None. Default is 'H'.</p></td>
          <td>
                <code>&#39;H&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>round_time</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Whether to round timestamps to the nearest frequency. Default is True.</p></td>
          <td>
                <code>True</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame with formatted timestamps and rounded time.</p></td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">crnpy</span> <span class="kn">import</span> <span class="n">crnpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:[</span><span class="s1">&#39;2020-01-01 00:00:00&#39;</span><span class="p">,</span><span class="s1">&#39;2020-01-01 00:30:00&#39;</span><span class="p">,</span><span class="s1">&#39;2020-01-01 01:00:00&#39;</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span> <span class="o">=</span> <span class="n">crnpy</span><span class="o">.</span><span class="n">format_dates_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">round_time</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">df</span>
<span class="go">                timestamp</span>
<span class="go">0   2020-01-01 00:00:00</span>
<span class="go">1   2020-01-01 00:00:00</span>
<span class="go">2   2020-01-01 01:00:00</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">format_dates_df</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">col</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="nb">format</span><span class="o">=</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">round_time</span><span class="o">=</span><span class="kc">True</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to change the format and round timestamps.</span>

<span class="sd">     Args:</span>
<span class="sd">         df (pandas.DataFrame): DataFrame with timestamp in the index.</span>
<span class="sd">         col (str, optional): Column with the timestamp. Default is &#39;timestamp&#39;.</span>
<span class="sd">         format (str, optional): Format of the timestamp. Default is &#39;%Y-%m-%d %H:%M:%S&#39;.</span>
<span class="sd">         freq (str, optional): Rounding interval. &#39;H&#39; for hourly, &#39;M&#39; for minute, or None. Default is &#39;H&#39;.</span>
<span class="sd">         round_time (bool, optional): Whether to round timestamps to the nearest frequency. Default is True.</span>

<span class="sd">     Returns:</span>
<span class="sd">         (pandas.DataFrame): DataFrame with formatted timestamps and rounded time.</span>

<span class="sd">     Examples:</span>
<span class="sd">            &gt;&gt;&gt; from crnpy import crnpy</span>
<span class="sd">            &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">            &gt;&gt;&gt; df = pd.DataFrame({&#39;timestamp&#39;:[&#39;2020-01-01 00:00:00&#39;,&#39;2020-01-01 00:30:00&#39;,&#39;2020-01-01 01:00:00&#39;]})</span>
<span class="sd">            &gt;&gt;&gt; df = crnpy.format_dates_df(df, col=&#39;timestamp&#39;, format=&#39;%Y-%m-%d %H:%M:%S&#39;, freq=&#39;H&#39;, round_time=True)</span>
<span class="sd">            &gt;&gt;&gt; df</span>
<span class="sd">                            timestamp</span>
<span class="sd">            0   2020-01-01 00:00:00</span>
<span class="sd">            1   2020-01-01 00:00:00</span>
<span class="sd">            2   2020-01-01 01:00:00</span>
<span class="sd">     &quot;&quot;&quot;</span>

    <span class="c1"># Change format of timestamp if needed</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="nb">format</span><span class="o">=</span><span class="nb">format</span><span class="p">)</span>

    <span class="c1"># Round timestamps to nearest frequency</span>
    <span class="k">if</span> <span class="n">round_time</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>

    <span class="c1"># Fill in rows with missing timestamps</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">date_range</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_range</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding missing date:&#39;</span><span class="p">,</span><span class="n">date</span><span class="p">)</span>
            <span class="n">new_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">col</span><span class="p">:</span><span class="n">date</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="c1"># By default fills columns with np.nan</span>
            <span class="n">source</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span><span class="n">new_line</span><span class="p">])</span>

    <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">col</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="n">col</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.get_incoming_neutron_flux" class="doc doc-heading">
<code class="highlight language-python"><span class="n">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">utc_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">expand_window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to retrieve neutron flux from the Neutron Monitor Database.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>start_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td><p>Start date of the time series.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>end_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td><p>End date of the time series.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>station</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Neutron Monitor station to retrieve data from.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>utc_offset</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>UTC offset in hours. Default is 0.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>expand_window</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Number of hours to expand the time window to retrieve extra data. Default is 0.</p></td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Print information about the request. Default is False.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Neutron flux in counts per hour and timestamps.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Documentation available:https://www.nmdb.eu/nest/help.php#howto</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">utc_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">expand_window</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span>  <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to retrieve neutron flux from the Neutron Monitor Database.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_date (datetime): Start date of the time series.</span>
<span class="sd">        end_date (datetime): End date of the time series.</span>
<span class="sd">        station (str): Neutron Monitor station to retrieve data from.</span>
<span class="sd">        utc_offset (int): UTC offset in hours. Default is 0.</span>
<span class="sd">        expand_window (int): Number of hours to expand the time window to retrieve extra data. Default is 0.</span>
<span class="sd">        verbose (bool): Print information about the request. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Neutron flux in counts per hour and timestamps.</span>

<span class="sd">    References:</span>
<span class="sd">        Documentation available:https://www.nmdb.eu/nest/help.php#howto</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Example: get_incoming_flux(station=&#39;IRKT&#39;,start_date=&#39;2020-04-10 11:00:00&#39;,end_date=&#39;2020-06-18 17:00:00&#39;)</span>
    <span class="c1"># Template url = &#39;http://nest.nmdb.eu/draw_graph.php?formchk=1&amp;stations[]=KERG&amp;output=ascii&amp;tabchoice=revori&amp;dtype=corr_for_efficiency&amp;date_choice=bydate&amp;start_year=2009&amp;start_month=09&amp;start_day=01&amp;start_hour=00&amp;start_min=00&amp;end_year=2009&amp;end_month=09&amp;end_day=05&amp;end_hour=23&amp;end_min=59&amp;yunits=0&#39;</span>


    <span class="c1"># Expand the time window by 1 hour to ensure an extra observation is included in the request.</span>
    <span class="n">start_date</span> <span class="o">-=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">expand_window</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">expand_window</span><span class="p">)</span>


    <span class="c1"># Convert local time to UTC</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">utc_offset</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">utc_offset</span><span class="p">)</span>
    <span class="n">date_format</span> <span class="o">=</span> <span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span>
    <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;http://www.nmdb.eu/nest/draw_graph.php?&#39;</span>
    <span class="n">url_par</span> <span class="o">=</span> <span class="p">[</span> <span class="s1">&#39;formchk=1&#39;</span><span class="p">,</span>
                <span class="s1">&#39;stations[]=&#39;</span> <span class="o">+</span> <span class="n">station</span><span class="p">,</span>
                <span class="s1">&#39;output=ascii&#39;</span><span class="p">,</span>
                <span class="s1">&#39;tabchoice=revori&#39;</span><span class="p">,</span>
                <span class="s1">&#39;dtype=corr_for_efficiency&#39;</span><span class="p">,</span>
                <span class="s1">&#39;tresolution=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span>
                <span class="s1">&#39;date_choice=bydate&#39;</span><span class="p">,</span>
                <span class="s1">&#39;start_year=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
                <span class="s1">&#39;start_month=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">),</span>
                <span class="s1">&#39;start_day=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="p">),</span>
                <span class="s1">&#39;start_hour=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">hour</span><span class="p">),</span>
                <span class="s1">&#39;start_min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">minute</span><span class="p">),</span>
                <span class="s1">&#39;end_year=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
                <span class="s1">&#39;end_month=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="p">),</span>
                <span class="s1">&#39;end_day=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">day</span><span class="p">),</span>
                <span class="s1">&#39;end_hour=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">hour</span><span class="p">),</span>
                <span class="s1">&#39;end_min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">minute</span><span class="p">),</span>
                <span class="s1">&#39;yunits=0&#39;</span><span class="p">]</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url_par</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieving data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="c1"># Subtract 1 hour to restore the last date included in the request.</span>
    <span class="n">end_date</span> <span class="o">-=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1H&#39;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;RCORR_E</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;Total&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span><span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df_flux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span><span class="s1">&#39;counts&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span> <span class="o">&gt;</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error retrieving data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Check if all values from selected detector are NaN. If yes, warn the user</span>
    <span class="k">if</span> <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Data for selected neutron detectors appears to be unavailable for the selected period&#39;</span><span class="p">)</span>

    <span class="c1"># Convert timestamp to datetime and apply UTC offset</span>
    <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
    <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">utc_offset</span><span class="p">)</span>

    <span class="c1"># Print acknowledgement to inform users about restrictions and to acknowledge the NMDB database</span>
    <span class="n">acknowledgement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Data retrieved via NMDB are the property of the individual data providers. These data are free for non commercial</span>
<span class="s2">use to within the restriction imposed by the providers. If you use such data for your research or applications, please acknowledge</span>
<span class="s2">the origin by a sentence like &#39;We acknowledge the NMDB database (www.nmdb.eu) founded under the European Union&#39;s FP7 programme </span>
<span class="s2">(contract no. 213007), and the PIs of individual neutron monitors at: IGY Jungfraujoch </span>
<span class="s2">(Physikalisches Institut, University of Bern, Switzerland)&quot;&quot;&quot;</span>
    <span class="c1">#print(acknowledgement)</span>

    <span class="k">return</span> <span class="n">df_flux</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.idw" class="doc doc-heading">
<code class="highlight language-python"><span class="n">idw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to interpolate data using inverse distance weight.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>UTM x coordinates in meters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>UTM y coordinates in meters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>Values to be interpolated.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>X_pred</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>UTM x coordinates where z values need to be predicted.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Y_pred</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>UTM y coordinates where z values need to be predicted.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>neighborhood</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Only points within this radius in meters are considered for the interpolation.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>p</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Exponent of the inverse distance weight formula. Typically, p=1 or p=2.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array</code>
          </td>
          <td><p>Interpolated values.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p><a href="https://soilwater.github.io/pynotes-agriscience/notebooks/inverse_distance_weighting.html">https://soilwater.github.io/pynotes-agriscience/notebooks/inverse_distance_weighting.html</a></p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span>
<span class="normal">1154</span>
<span class="normal">1155</span>
<span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">idw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to interpolate data using inverse distance weight.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (list or array): UTM x coordinates in meters.</span>
<span class="sd">        y (list or array): UTM y coordinates in meters.</span>
<span class="sd">        z (list or array): Values to be interpolated.</span>
<span class="sd">        X_pred (list or array): UTM x coordinates where z values need to be predicted.</span>
<span class="sd">        Y_pred (list or array): UTM y coordinates where z values need to be predicted.</span>
<span class="sd">        neighborhood (float): Only points within this radius in meters are considered for the interpolation.</span>
<span class="sd">        p (int): Exponent of the inverse distance weight formula. Typically, p=1 or p=2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array): Interpolated values.</span>

<span class="sd">    References:</span>
<span class="sd">        [https://soilwater.github.io/pynotes-agriscience/notebooks/inverse_distance_weighting.html](https://soilwater.github.io/pynotes-agriscience/notebooks/inverse_distance_weighting.html)</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Flatten arrays to handle 1D and 2D arrays with the same code</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">X_pred</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># Save shape</span>
    <span class="n">X_pred</span> <span class="o">=</span> <span class="n">X_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">Y_pred</span> <span class="o">=</span> <span class="n">Y_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Pre-allocate output array</span>
    <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">X_pred</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_pred</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="c1"># Distance between current and observed points</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">X_pred</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">Y_pred</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Select points within neighborhood only for interpolateion</span>
        <span class="n">idx_neighbors</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">neighborhood</span>

        <span class="c1"># Compute interpolated value at point of interest</span>
        <span class="n">Z_pred</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx_neighbors</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">idx_neighbors</span><span class="p">]</span> <span class="o">**</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">idx_neighbors</span><span class="p">]</span> <span class="o">**</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Z_pred</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.interpolate_2D" class="doc doc-heading">
<code class="highlight language-python"><span class="n">interpolate_2D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function for interpolating irregular spatial data into a regular grid.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>UTM x coordinates in meters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>UTM y coordinates in meters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>Values to be interpolated.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dx</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Pixel width in meters.</p></td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>dy</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Pixel height in meters.</p></td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Interpolation method. One of 'cubic', 'linear', 'nearest', or 'idw'.</p></td>
          <td>
                <code>&#39;cubic&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>neighborhood</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Only points within this radius in meters are considered for the interpolation.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>x_pred</code></td>          <td>
                <code>array</code>
          </td>
          <td><p>2D array with x coordinates.</p></td>
        </tr>
        <tr>
<td><code>y_pred</code></td>          <td>
                <code>array</code>
          </td>
          <td><p>2D array with y coordinates.</p></td>
        </tr>
        <tr>
<td><code>z_pred</code></td>          <td>
                <code>array</code>
          </td>
          <td><p>2D array with interpolated values.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p><a href="https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html">https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html</a></p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span>
<span class="normal">1225</span>
<span class="normal">1226</span>
<span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_2D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function for interpolating irregular spatial data into a regular grid.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (list or array): UTM x coordinates in meters.</span>
<span class="sd">        y (list or array): UTM y coordinates in meters.</span>
<span class="sd">        z (list or array): Values to be interpolated.</span>
<span class="sd">        dx (float): Pixel width in meters.</span>
<span class="sd">        dy (float): Pixel height in meters.</span>
<span class="sd">        method (str): Interpolation method. One of &#39;cubic&#39;, &#39;linear&#39;, &#39;nearest&#39;, or &#39;idw&#39;.</span>
<span class="sd">        neighborhood (float): Only points within this radius in meters are considered for the interpolation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        x_pred (array): 2D array with x coordinates.</span>
<span class="sd">        y_pred (array): 2D array with y coordinates.</span>
<span class="sd">        z_pred (array): 2D array with interpolated values.</span>

<span class="sd">    References:</span>
<span class="sd">        [https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html](https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Drop NaN values in x y and z</span>
    <span class="n">idx_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">idx_nan</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">idx_nan</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="o">~</span><span class="n">idx_nan</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">idx_nan</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">, and </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> NaN values were dropped from x, y, and z.&quot;</span><span class="p">)</span>

    <span class="c1"># Create 2D grid for interpolation</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">/</span> <span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">X_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">Nx</span><span class="p">)</span>
    <span class="n">Y_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">Ny</span><span class="p">)</span>
    <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X_vec</span><span class="p">,</span> <span class="n">Y_vec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">]:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;idw&#39;</span><span class="p">:</span>
        <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">idw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">neighborhood</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> does not exist. Provide either &#39;cubic&#39;, &#39;linear&#39;, &#39;nearest&#39;, or &#39;idw&#39;.&quot;</span>

    <span class="k">return</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">Z_pred</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.interpolate_incoming_flux" class="doc doc-heading">
<code class="highlight language-python"><span class="n">interpolate_incoming_flux</span><span class="p">(</span><span class="n">df_flux</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to interpolate incoming neutron flux to match the timestamps of the observations.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df_flux</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe returned by get_incoming_flux method.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamps</code></td>
          <td>
                <code>pd.series or pd.DataFrame or pd.DatetimeIndex</code>
          </td>
          <td><p>Timestamps to interpolate the incoming neutron flux.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe containing interpolated incoming neutron flux.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_incoming_flux</span><span class="p">(</span><span class="n">df_flux</span><span class="p">,</span> <span class="n">timestamps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to interpolate incoming neutron flux to match the timestamps of the observations.</span>

<span class="sd">    Args:</span>
<span class="sd">        df_flux (pd.DataFrame): Dataframe returned by get_incoming_flux method.</span>
<span class="sd">        timestamps (pd.series or pd.DataFrame or pd.DatetimeIndex): Timestamps to interpolate the incoming neutron flux.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pd.DataFrame): Dataframe containing interpolated incoming neutron flux.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check that index is datetime</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">df_flux</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Index of df_flux must be datetime&#39;</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">timestamp</span> <span class="ow">in</span> <span class="n">timestamps</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">timestamp</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df_flux</span><span class="o">.</span><span class="n">index</span><span class="p">:</span>
            <span class="n">df_flux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">timestamp</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">df_flux</span> <span class="o">=</span> <span class="n">df_flux</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="c1"># Interpolate nan values</span>
    <span class="n">df_flux</span> <span class="o">=</span> <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">interpolate</span><span class="p">(</span><span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="n">limit_direction</span><span class="o">=</span><span class="s1">&#39;both&#39;</span><span class="p">)</span>

    <span class="c1"># Retur only the values for the selected timestamps</span>
    <span class="k">return</span> <span class="n">df_flux</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">timestamps</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.latlon_to_utm" class="doc doc-heading">
<code class="highlight language-python"><span class="n">latlon_to_utm</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">utm_zone_number</span><span class="p">,</span> <span class="n">missing_values</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert geographic coordinates (lat, lon) to projected coordinates (utm) using the Military Grid Reference System.</p>
<p>Function only applies to non-polar coordinates.
If further functionality is required, consider using the utm module. See references for more information.</p>
<p><img alt="UTM zones" src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Universal_Transverse_Mercator_zones.svg/1920px-Universal_Transverse_Mercator_zones.svg.png" />
UTM zones on an equirectangular world map with irregular zones in red and New York City's zone highlighted. See <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system#UTM_zones">UTM zones</a> for a full description.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>lat</code></td>
          <td>
                <code>float, array</code>
          </td>
          <td><p>Latitude in decimal degrees.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lon</code></td>
          <td>
                <code>float, array</code>
          </td>
          <td><p>Longitude in decimal degrees.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>utm_zone_number</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Universal Transverse Mercator (UTM) zone.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float, float</code>
          </td>
          <td><p>Tuple of easting and northing coordinates in meters. First element is easting, second is northing.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Code adapted from utm module created by Tobias Bieniek (Github username: Turbo87)
<a href="https://github.com/Turbo87/utm">https://github.com/Turbo87/utm</a></p>
<p><a href="https://www.maptools.com/tutorials/grid_zone_details#">https://www.maptools.com/tutorials/grid_zone_details#</a></p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span>
<span class="normal">1021</span>
<span class="normal">1022</span>
<span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">latlon_to_utm</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">utm_zone_number</span><span class="p">,</span> <span class="n">missing_values</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert geographic coordinates (lat, lon) to projected coordinates (utm) using the Military Grid Reference System.</span>

<span class="sd">    Function only applies to non-polar coordinates.</span>
<span class="sd">    If further functionality is required, consider using the utm module. See references for more information.</span>

<span class="sd">    ![UTM zones](https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Universal_Transverse_Mercator_zones.svg/1920px-Universal_Transverse_Mercator_zones.svg.png)</span>
<span class="sd">    UTM zones on an equirectangular world map with irregular zones in red and New York City&#39;s zone highlighted. See [UTM zones](https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system#UTM_zones) for a full description.</span>


<span class="sd">    Args:</span>
<span class="sd">        lat (float, array): Latitude in decimal degrees.</span>
<span class="sd">        lon (float, array): Longitude in decimal degrees.</span>
<span class="sd">        utm_zone_number (int): Universal Transverse Mercator (UTM) zone.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float, float): Tuple of easting and northing coordinates in meters. First element is easting, second is northing.</span>

<span class="sd">    References:</span>
<span class="sd">         Code adapted from utm module created by Tobias Bieniek (Github username: Turbo87)</span>
<span class="sd">         [https://github.com/Turbo87/utm](https://github.com/Turbo87/utm)</span>

<span class="sd">         [https://www.maptools.com/tutorials/grid_zone_details#](https://www.maptools.com/tutorials/grid_zone_details#)</span>
<span class="sd">    &quot;&quot;&quot;</span>


    <span class="c1"># Define constants</span>
    <span class="n">R</span> <span class="o">=</span> <span class="mi">6_378_137</span>  <span class="c1"># Earth&#39;s radius at the Equator in meters</span>

    <span class="c1"># Convert input data to Numpy arrays</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
            <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="s2">&quot;Input values cannot be converted to Numpy arrays.&quot;</span>

    <span class="c1"># Check latitude range</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">80</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">lat</span> <span class="o">&gt;</span> <span class="mi">84</span><span class="p">):</span>
        <span class="k">raise</span> <span class="s2">&quot;One or more latitude values exceed the range -80 to 84&quot;</span>

    <span class="c1"># Check longitude range</span>
    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">lon</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">180</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">lon</span> <span class="o">&gt;</span> <span class="mi">180</span><span class="p">):</span>
        <span class="k">raise</span> <span class="s2">&quot;One or more longitude values exceed the range -180 to 180&quot;</span>

    <span class="c1"># Constants</span>
    <span class="n">K0</span> <span class="o">=</span> <span class="mf">0.9996</span>
    <span class="n">E</span> <span class="o">=</span> <span class="mf">0.00669438</span>
    <span class="n">E_P2</span> <span class="o">=</span> <span class="n">E</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">E</span><span class="p">)</span>

    <span class="n">M1</span> <span class="o">=</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">E</span> <span class="o">/</span> <span class="mi">4</span> <span class="o">-</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">E</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">64</span> <span class="o">-</span> <span class="mi">5</span> <span class="o">*</span> <span class="n">E</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">256</span><span class="p">)</span>
    <span class="n">M2</span> <span class="o">=</span> <span class="p">(</span><span class="mi">3</span> <span class="o">*</span> <span class="n">E</span> <span class="o">/</span> <span class="mi">8</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">E</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">32</span> <span class="o">+</span> <span class="mi">45</span> <span class="o">*</span> <span class="n">E</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="n">M3</span> <span class="o">=</span> <span class="p">(</span><span class="mi">15</span> <span class="o">*</span> <span class="n">E</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">256</span> <span class="o">+</span> <span class="mi">45</span> <span class="o">*</span> <span class="n">E</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">1024</span><span class="p">)</span>
    <span class="n">M4</span> <span class="o">=</span> <span class="p">(</span><span class="mi">35</span> <span class="o">*</span> <span class="n">E</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">3072</span><span class="p">)</span>

    <span class="c1"># Trigonometric operations</span>
    <span class="n">lat_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="n">lon_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

    <span class="n">lat_sin</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span>
    <span class="n">lat_cos</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">lat_rad</span><span class="p">)</span>
    <span class="n">lat_tan</span> <span class="o">=</span> <span class="n">lat_sin</span> <span class="o">/</span> <span class="n">lat_cos</span>
    <span class="n">lat_tan2</span> <span class="o">=</span> <span class="n">lat_tan</span> <span class="o">*</span> <span class="n">lat_tan</span>
    <span class="n">lat_tan4</span> <span class="o">=</span> <span class="n">lat_tan2</span> <span class="o">*</span> <span class="n">lat_tan2</span>

    <span class="c1"># Find central meridian.</span>
    <span class="n">central_lon</span> <span class="o">=</span> <span class="p">(</span><span class="n">utm_zone_number</span> <span class="o">*</span> <span class="mi">6</span> <span class="o">-</span> <span class="mi">180</span><span class="p">)</span> <span class="o">-</span> <span class="mi">3</span>  <span class="c1"># Zones are every 6 degrees.</span>
    <span class="n">central_lon_rad</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">central_lon</span><span class="p">)</span>

    <span class="n">n</span> <span class="o">=</span> <span class="n">R</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">E</span> <span class="o">*</span> <span class="n">lat_sin</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="n">c</span> <span class="o">=</span> <span class="n">E_P2</span> <span class="o">*</span> <span class="n">lat_cos</span> <span class="o">**</span> <span class="mi">2</span>

    <span class="k">with</span> <span class="n">np</span><span class="o">.</span><span class="n">errstate</span><span class="p">(</span><span class="n">divide</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">,</span> <span class="n">invalid</span><span class="o">=</span><span class="s1">&#39;ignore&#39;</span><span class="p">):</span>
        <span class="n">a</span> <span class="o">=</span> <span class="n">lat_cos</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">remainder</span><span class="p">(((</span><span class="n">lon_rad</span> <span class="o">-</span> <span class="n">central_lon_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">),</span> <span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">))</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="n">m</span> <span class="o">=</span> <span class="n">R</span> <span class="o">*</span> <span class="p">(</span><span class="n">M1</span> <span class="o">*</span> <span class="n">lat_rad</span> <span class="o">-</span> <span class="n">M2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">lat_rad</span><span class="p">)</span> <span class="o">+</span> <span class="n">M3</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">4</span> <span class="o">*</span> <span class="n">lat_rad</span><span class="p">)</span> <span class="o">-</span> <span class="n">M4</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">6</span> <span class="o">*</span> <span class="n">lat_rad</span><span class="p">))</span>

    <span class="n">easting</span> <span class="o">=</span> <span class="n">K0</span> <span class="o">*</span> <span class="n">n</span> <span class="o">*</span> <span class="p">(</span><span class="n">a</span> <span class="o">+</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">6</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">lat_tan2</span> <span class="o">+</span> <span class="n">c</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">5</span> <span class="o">/</span> <span class="mi">120</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mi">5</span> <span class="o">-</span> <span class="mi">18</span> <span class="o">*</span> <span class="n">lat_tan2</span> <span class="o">+</span> <span class="n">lat_tan4</span> <span class="o">+</span> <span class="mi">72</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="mi">58</span> <span class="o">*</span> <span class="n">E_P2</span><span class="p">))</span> <span class="o">+</span> <span class="mi">500_000</span>
    <span class="n">northing</span> <span class="o">=</span> <span class="n">K0</span> <span class="o">*</span> <span class="p">(</span><span class="n">m</span> <span class="o">+</span> <span class="n">n</span> <span class="o">*</span> <span class="n">lat_tan</span> <span class="o">*</span> <span class="p">(</span>
                <span class="n">a</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">/</span> <span class="mi">2</span> <span class="o">+</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">/</span> <span class="mi">24</span> <span class="o">*</span> <span class="p">(</span><span class="mi">5</span> <span class="o">-</span> <span class="n">lat_tan2</span> <span class="o">+</span> <span class="mi">9</span> <span class="o">*</span> <span class="n">c</span> <span class="o">+</span> <span class="mi">4</span> <span class="o">*</span> <span class="n">c</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span> <span class="o">+</span> <span class="n">a</span> <span class="o">**</span> <span class="mi">6</span> <span class="o">/</span> <span class="mi">720</span> <span class="o">*</span> <span class="p">(</span>
                    <span class="mi">61</span> <span class="o">-</span> <span class="mi">58</span> <span class="o">*</span> <span class="n">lat_tan2</span> <span class="o">+</span> <span class="n">lat_tan4</span> <span class="o">+</span> <span class="mi">600</span> <span class="o">*</span> <span class="n">c</span> <span class="o">-</span> <span class="mi">330</span> <span class="o">*</span> <span class="n">E_P2</span><span class="p">)))</span>

    <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">lat</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">):</span>
        <span class="n">northing</span> <span class="o">+=</span> <span class="mi">10_000_000</span>

    <span class="k">return</span> <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.normalize_counts" class="doc doc-heading">
<code class="highlight language-python"><span class="n">normalize_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">count_time</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">count_times</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Normalize neutron counts to the desired counting time.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe containing only the columns with neutron counts.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>count_time</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Count time in seconds for normalization. Default is 3600 seconds.</p></td>
          <td>
                <code>3600</code>
          </td>
        </tr>
        <tr>
          <td><code>count_times</code></td>
          <td>
                <code>pandas.Series or pandas.DataFrame</code>
          </td>
          <td><p>Counting time in seconds. If a DataFrame is provided, it must have the same number of columns as df.</p></td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>pandas.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Normalized neutron counts.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">normalize_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">count_time</span><span class="o">=</span><span class="mi">3600</span><span class="p">,</span> <span class="n">count_times</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Normalize neutron counts to the desired counting time.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (pandas.DataFrame): Dataframe containing only the columns with neutron counts.</span>
<span class="sd">        count_time (int): Count time in seconds for normalization. Default is 3600 seconds.</span>
<span class="sd">        count_times (pandas.Series or pandas.DataFrame): Counting time in seconds. If a DataFrame is provided, it must have the same number of columns as df.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Normalized neutron counts.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">count_times</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="nb">type</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">indexes</span><span class="o">.</span><span class="n">datetimes</span><span class="o">.</span><span class="n">DatetimeIndex</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No count_times columns provided. Using timestamp index to compute count time.&quot;</span><span class="p">)</span>
        <span class="n">count_times</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_series</span><span class="p">()</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">count_times</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Count time must be provided or index must be a timestamp.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">count_times</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Count times length does not match number of readings.&#39;</span><span class="p">)</span>


    <span class="c1">#Normalize counts rounded to integer</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">count_times</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">count_times</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span> <span class="o">==</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">normalized_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">count_times</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">count_time</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">normalized_counts</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">normalized_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">count_times</span> <span class="o">=</span> <span class="n">count_times</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">count_times</span><span class="o">.</span><span class="n">columns</span><span class="p">)):</span>
            <span class="n">normalized_counts</span><span class="p">[</span><span class="n">normalized_counts</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">=</span> <span class="n">normalized_counts</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">]</span><span class="o">.</span><span class="n">div</span><span class="p">(</span><span class="n">count_times</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span><span class="n">i</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">mul</span><span class="p">(</span><span class="n">count_time</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">normalized_counts</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.nrad_weight" class="doc doc-heading">
<code class="highlight language-python"><span class="n">nrad_weight</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">rhob</span><span class="o">=</span><span class="mf">1.4</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to compute distance weights corresponding to each soil sample.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>h</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Air Humidity  from 0.1  to 50 in g/m^3. When h=0, the function will skip the distance weighting.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>theta</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Soil Moisture for each sample (0.02 - 0.50 m^3/m^3)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>distances</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Distances from the location of each sample to the origin (0.5 - 600 m)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>depth</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Depths for each sample (m)</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>rhob</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Bulk density in g/cm^3</p></td>
          <td>
                <code>1.4</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Distance weights for each sample.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Köhli, M., Schrön, M., Zreda, M., Schmidt, U., Dietrich, P., and Zacharias, S. (2015).
Footprint characteristics revised for field-scale soil moisture monitoring with cosmic-ray
neutrons. Water Resour. Res. 51, 5772–5790. doi:10.1002/2015WR017169</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nrad_weight</span><span class="p">(</span><span class="n">h</span><span class="p">,</span><span class="n">theta</span><span class="p">,</span><span class="n">distances</span><span class="p">,</span><span class="n">depth</span><span class="p">,</span><span class="n">rhob</span><span class="o">=</span><span class="mf">1.4</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to compute distance weights corresponding to each soil sample.</span>

<span class="sd">    Args:</span>
<span class="sd">        h (float): Air Humidity  from 0.1  to 50 in g/m^3. When h=0, the function will skip the distance weighting.</span>
<span class="sd">        theta (array or pd.Series or pd.DataFrame): Soil Moisture for each sample (0.02 - 0.50 m^3/m^3)</span>
<span class="sd">        distances (array or pd.Series or pd.DataFrame): Distances from the location of each sample to the origin (0.5 - 600 m)</span>
<span class="sd">        depth (array or pd.Series or pd.DataFrame): Depths for each sample (m)</span>
<span class="sd">        rhob (float): Bulk density in g/cm^3</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Distance weights for each sample.</span>

<span class="sd">    References:</span>
<span class="sd">        Köhli, M., Schrön, M., Zreda, M., Schmidt, U., Dietrich, P., and Zacharias, S. (2015).</span>
<span class="sd">        Footprint characteristics revised for field-scale soil moisture monitoring with cosmic-ray</span>
<span class="sd">        neutrons. Water Resour. Res. 51, 5772–5790. doi:10.1002/2015WR017169</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Table A1. Parameters for Fi and D86</span>
    <span class="n">p10</span> <span class="o">=</span> <span class="mi">8735</span><span class="p">;</span>       <span class="n">p11</span> <span class="o">=</span> <span class="mf">17.1758</span><span class="p">;</span> <span class="n">p12</span> <span class="o">=</span> <span class="mi">11720</span><span class="p">;</span>      <span class="n">p13</span> <span class="o">=</span> <span class="mf">0.00978</span><span class="p">;</span>   <span class="n">p14</span> <span class="o">=</span> <span class="mi">7045</span><span class="p">;</span>      <span class="n">p15</span> <span class="o">=</span> <span class="mf">0.003632</span><span class="p">;</span>
    <span class="n">p20</span> <span class="o">=</span> <span class="mf">2.7925e-2</span><span class="p">;</span>  <span class="n">p21</span> <span class="o">=</span> <span class="mf">5.0399</span><span class="p">;</span>  <span class="n">p22</span> <span class="o">=</span> <span class="mf">2.8544e-2</span><span class="p">;</span>  <span class="n">p23</span> <span class="o">=</span> <span class="mf">0.002455</span><span class="p">;</span>  <span class="n">p24</span> <span class="o">=</span> <span class="mf">6.851e-5</span><span class="p">;</span>  <span class="n">p25</span> <span class="o">=</span> <span class="mf">9.2926</span><span class="p">;</span>
    <span class="n">p30</span> <span class="o">=</span> <span class="mi">247970</span><span class="p">;</span>     <span class="n">p31</span> <span class="o">=</span> <span class="mf">17.63</span><span class="p">;</span>   <span class="n">p32</span> <span class="o">=</span> <span class="mi">374655</span><span class="p">;</span>     <span class="n">p33</span> <span class="o">=</span> <span class="mf">0.00191</span><span class="p">;</span>   <span class="n">p34</span> <span class="o">=</span> <span class="mi">195725</span><span class="p">;</span>
    <span class="n">p40</span> <span class="o">=</span> <span class="mf">5.4818e-2</span><span class="p">;</span>  <span class="n">p41</span> <span class="o">=</span> <span class="mf">15.921</span><span class="p">;</span>  <span class="n">p42</span> <span class="o">=</span> <span class="mf">0.6373</span><span class="p">;</span>     <span class="n">p43</span> <span class="o">=</span> <span class="mf">5.99e-2</span><span class="p">;</span>   <span class="n">p44</span> <span class="o">=</span> <span class="mf">5.425e-4</span><span class="p">;</span>
    <span class="n">p50</span> <span class="o">=</span> <span class="mi">1383702</span><span class="p">;</span>    <span class="n">p51</span> <span class="o">=</span> <span class="mf">4.156</span><span class="p">;</span>   <span class="n">p52</span> <span class="o">=</span> <span class="mi">5325</span><span class="p">;</span>       <span class="n">p53</span> <span class="o">=</span> <span class="mf">0.00238</span><span class="p">;</span>   <span class="n">p54</span> <span class="o">=</span> <span class="mf">0.0156</span><span class="p">;</span>    <span class="n">p55</span> <span class="o">=</span> <span class="mf">0.130</span><span class="p">;</span>     <span class="n">p56</span> <span class="o">=</span> <span class="mi">1521</span><span class="p">;</span>
    <span class="n">p60</span> <span class="o">=</span> <span class="mf">6.031e-5</span><span class="p">;</span>   <span class="n">p61</span> <span class="o">=</span> <span class="mf">98.5</span><span class="p">;</span>    <span class="n">p62</span> <span class="o">=</span> <span class="mf">1.0466e-3</span><span class="p">;</span>
    <span class="n">p70</span> <span class="o">=</span> <span class="mi">11747</span><span class="p">;</span>      <span class="n">p71</span> <span class="o">=</span> <span class="mf">41.66</span><span class="p">;</span>   <span class="n">p72</span> <span class="o">=</span> <span class="mi">4521</span><span class="p">;</span>       <span class="n">p73</span> <span class="o">=</span> <span class="mf">0.01998</span><span class="p">;</span>   <span class="n">p74</span> <span class="o">=</span> <span class="mf">0.00604</span><span class="p">;</span>   <span class="n">p75</span> <span class="o">=</span> <span class="mi">2534</span><span class="p">;</span>      <span class="n">p76</span> <span class="o">=</span> <span class="mf">0.00475</span><span class="p">;</span>
    <span class="n">p80</span> <span class="o">=</span> <span class="mf">1.543e-2</span><span class="p">;</span>   <span class="n">p81</span> <span class="o">=</span> <span class="mf">10.06</span><span class="p">;</span>   <span class="n">p82</span> <span class="o">=</span> <span class="mf">1.807e-2</span><span class="p">;</span>   <span class="n">p83</span> <span class="o">=</span> <span class="mf">0.0011</span><span class="p">;</span>    <span class="n">p84</span> <span class="o">=</span> <span class="mf">8.81e-5</span><span class="p">;</span>   <span class="n">p85</span> <span class="o">=</span> <span class="mf">0.0405</span><span class="p">;</span>    <span class="n">p86</span> <span class="o">=</span> <span class="mf">20.24</span><span class="p">;</span>
    <span class="n">p90</span> <span class="o">=</span> <span class="mf">8.321</span><span class="p">;</span>      <span class="n">p91</span> <span class="o">=</span> <span class="mf">0.14249</span><span class="p">;</span> <span class="n">p92</span> <span class="o">=</span> <span class="mf">0.96655</span><span class="p">;</span>    <span class="n">p93</span> <span class="o">=</span> <span class="mf">26.42</span><span class="p">;</span>     <span class="n">p94</span> <span class="o">=</span> <span class="mf">0.0567</span><span class="p">;</span>


    <span class="c1"># Numerical determination of the penetration depth (86%) (Eq. 8)</span>
    <span class="n">D86</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span><span class="n">rhob</span><span class="o">*</span><span class="p">(</span><span class="n">p90</span><span class="o">+</span><span class="n">p91</span><span class="o">*</span><span class="p">(</span><span class="n">p92</span><span class="o">+</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span><span class="o">*</span><span class="n">distances</span><span class="o">/</span><span class="mi">100</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p93</span><span class="o">+</span><span class="n">theta</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">p94</span><span class="o">+</span><span class="n">theta</span><span class="p">))</span>

    <span class="c1"># Depth weights (Eq. 7)</span>
    <span class="n">Wd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span><span class="o">*</span><span class="n">depth</span><span class="o">/</span><span class="n">D86</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">W</span> <span class="o">=</span> <span class="mi">1</span> <span class="c1"># skip distance weighting</span>

    <span class="k">elif</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">h</span><span class="o">&lt;=</span> <span class="mi">50</span><span class="p">):</span>
        <span class="c1"># Functions for Fi (Appendix A in Köhli et al., 2015)</span>
        <span class="n">F1</span> <span class="o">=</span> <span class="n">p10</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">p13</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p11</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="n">p12</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">p15</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">-</span><span class="n">p14</span><span class="o">*</span><span class="n">theta</span>
        <span class="n">F2</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">p20</span><span class="o">+</span><span class="n">p24</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p21</span><span class="o">*</span><span class="n">theta</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">p25</span><span class="o">*</span><span class="n">theta</span><span class="p">))</span><span class="o">+</span><span class="n">p22</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">h</span><span class="o">*</span><span class="n">p23</span><span class="p">)</span>
        <span class="n">F3</span> <span class="o">=</span> <span class="p">(</span><span class="n">p30</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">p33</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p31</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="n">p32</span><span class="o">-</span><span class="n">p34</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span>
        <span class="n">F4</span> <span class="o">=</span> <span class="n">p40</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p41</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span><span class="o">+</span><span class="n">p42</span><span class="o">-</span><span class="n">p43</span><span class="o">*</span><span class="n">theta</span><span class="o">+</span><span class="n">p44</span><span class="o">*</span><span class="n">h</span>
        <span class="n">F5</span> <span class="o">=</span> <span class="n">p50</span><span class="o">*</span><span class="p">(</span><span class="mf">0.02</span><span class="o">-</span><span class="mi">1</span><span class="o">/</span><span class="n">p55</span><span class="o">/</span><span class="p">(</span><span class="n">h</span><span class="o">-</span><span class="n">p55</span><span class="o">+</span><span class="n">p56</span><span class="o">*</span><span class="n">theta</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="n">p54</span><span class="o">-</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p51</span><span class="o">*</span><span class="p">(</span><span class="n">theta</span><span class="o">-</span><span class="n">p54</span><span class="p">))</span><span class="o">+</span><span class="n">p52</span><span class="o">*</span><span class="p">(</span><span class="mf">0.7</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="n">p53</span><span class="p">)</span>
        <span class="n">F6</span> <span class="o">=</span> <span class="n">p60</span><span class="o">*</span><span class="p">(</span><span class="n">h</span><span class="o">+</span><span class="n">p61</span><span class="p">)</span><span class="o">+</span><span class="n">p62</span><span class="o">*</span><span class="n">theta</span>
        <span class="n">F7</span> <span class="o">=</span> <span class="p">(</span><span class="n">p70</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">p76</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p71</span><span class="o">*</span><span class="n">theta</span><span class="o">*</span><span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">h</span><span class="o">*</span><span class="n">p74</span><span class="p">))</span><span class="o">+</span><span class="n">p72</span><span class="o">-</span><span class="n">p75</span><span class="o">*</span><span class="n">theta</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">h</span><span class="o">*</span><span class="n">p73</span><span class="p">)</span>
        <span class="n">F8</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">p80</span><span class="o">+</span><span class="n">p84</span><span class="o">*</span><span class="n">h</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p81</span><span class="o">*</span><span class="n">theta</span><span class="o">/</span><span class="p">(</span><span class="mi">1</span><span class="o">+</span><span class="n">p85</span><span class="o">*</span><span class="n">h</span><span class="o">+</span><span class="n">p86</span><span class="o">*</span><span class="n">theta</span><span class="p">))</span><span class="o">+</span><span class="n">p82</span><span class="p">)</span><span class="o">*</span><span class="p">(</span><span class="mi">2</span><span class="o">+</span><span class="n">h</span><span class="o">*</span><span class="n">p83</span><span class="p">)</span>

        <span class="c1"># Distance weights (Eq. 3)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)):</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;=</span><span class="mi">50</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mf">0.5</span><span class="p">):</span>
                <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">F1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">+</span><span class="n">F3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">elif</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&gt;</span><span class="mi">50</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">&lt;</span><span class="mi">600</span><span class="p">):</span>
                <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">=</span><span class="n">F5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span><span class="o">+</span><span class="n">F7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input distances are not valid.&#39;</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Air humidity values are out of range.&#39;</span><span class="p">)</span>


    <span class="c1"># Combined and normalized weights</span>
    <span class="n">weights</span> <span class="o">=</span> <span class="n">Wd</span><span class="o">*</span><span class="n">W</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">Wd</span><span class="o">*</span><span class="n">W</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">weights</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.road_correction" class="doc doc-heading">
<code class="highlight language-python"><span class="n">road_correction</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">theta_N</span><span class="p">,</span> <span class="n">road_width</span><span class="p">,</span> <span class="n">road_distance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_road</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">p2</span><span class="o">=</span><span class="mf">1.06</span><span class="p">,</span> <span class="n">p3</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">p4</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span> <span class="n">p6</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">p7</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">p8</span><span class="o">=</span><span class="mf">2.7</span><span class="p">,</span> <span class="n">p9</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to correct for road effects in neutron counts.
following the approach described in Schrön et al., 2018.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Array of ephithermal neutron counts.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>theta_N</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Volumetric water content of the soil estimated from the uncorrected neutron counts.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>road_width</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Width of the road in m.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>road_distance</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Distance of the road from the sensor in m. Default is 0.0.</p></td>
          <td>
                <code>0.0</code>
          </td>
        </tr>
        <tr>
          <td><code>theta_road</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Volumetric water content of the road. Default is 0.12.</p></td>
          <td>
                <code>0.12</code>
          </td>
        </tr>
        <tr>
          <td><code>p0-p9</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Parameters of the correction function. Default values are from Schrön et al., 2018.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Array of corrected neutron counts for road effects.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Schrön,M.,Rosolem,R.,Köhli,M., Piussi,L.,Schröter,I.,Iwema,J.,etal. (2018).Cosmic-ray neutron rover surveys
of field soil moisture and the influence of roads.WaterResources Research,54,6441–6459.
https://doi. org/10.1029/2017WR021719</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">road_correction</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">theta_N</span><span class="p">,</span> <span class="n">road_width</span><span class="p">,</span> <span class="n">road_distance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_road</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">p2</span><span class="o">=</span><span class="mf">1.06</span><span class="p">,</span> <span class="n">p3</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">p4</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span> <span class="n">p6</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">p7</span><span class="o">=</span><span class="mf">1.10</span><span class="p">,</span> <span class="n">p8</span><span class="o">=</span><span class="mf">2.70</span><span class="p">,</span> <span class="n">p9</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to correct for road effects in neutron counts.</span>
<span class="sd">    following the approach described in Schrön et al., 2018.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (array or pd.Series or pd.DataFrame): Array of ephithermal neutron counts.</span>
<span class="sd">        theta_N (float): Volumetric water content of the soil estimated from the uncorrected neutron counts.</span>
<span class="sd">        road_width (float): Width of the road in m.</span>
<span class="sd">        road_distance (float): Distance of the road from the sensor in m. Default is 0.0.</span>
<span class="sd">        theta_road (float): Volumetric water content of the road. Default is 0.12.</span>
<span class="sd">        p0-p9 (float): Parameters of the correction function. Default values are from Schrön et al., 2018.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Array of corrected neutron counts for road effects.</span>

<span class="sd">    References:</span>
<span class="sd">        Schrön,M.,Rosolem,R.,Köhli,M., Piussi,L.,Schröter,I.,Iwema,J.,etal. (2018).Cosmic-ray neutron rover surveys</span>
<span class="sd">        of field soil moisture and the influence of roads.WaterResources Research,54,6441–6459.</span>
<span class="sd">        https://doi. org/10.1029/2017WR021719</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p1</span><span class="o">*</span><span class="n">road_width</span><span class="p">))</span>
    <span class="n">F2</span> <span class="o">=</span> <span class="o">-</span><span class="n">p2</span> <span class="o">-</span> <span class="n">p3</span> <span class="o">*</span> <span class="n">theta_road</span> <span class="o">-</span> <span class="p">((</span><span class="n">p4</span> <span class="o">+</span> <span class="n">theta_road</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta_N</span><span class="p">))</span>
    <span class="n">F3</span> <span class="o">=</span> <span class="n">p6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p7</span> <span class="o">*</span> <span class="p">(</span><span class="n">road_width</span> <span class="o">**</span> <span class="o">-</span><span class="n">p8</span><span class="p">)</span> <span class="o">*</span> <span class="n">road_distance</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p6</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p9</span> <span class="o">*</span> <span class="n">road_distance</span><span class="p">)</span>

    <span class="n">C_roads</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">F1</span> <span class="o">*</span> <span class="n">F2</span> <span class="o">*</span> <span class="n">F3</span>

    <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">/</span> <span class="n">C_roads</span>

    <span class="k">return</span> <span class="n">corrected_counts</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.sensing_depth" class="doc doc-heading">
<code class="highlight language-python"><span class="n">sensing_depth</span><span class="p">(</span><span class="n">vwc</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">p_ref</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Schron_2017&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that computes the estimated sensing depth of the cosmic-ray neutron probe.
The function offers several methods to compute the depth at which 86 % of the neutrons
probes the soil profile.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vwc</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Estimated volumetric water content for each timestamp.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pressure</code></td>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Atmospheric pressure in hPa for each timestamp.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>p_ref</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Reference pressure in hPa.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bulk_density</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Soil bulk density.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Wlat</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Lattice water content.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Method to compute the sensing depth. Options are 'Schron_2017' or 'Franz_2012'.</p></td>
          <td>
                <code>&#39;Schron_2017&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>dist</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>List of radial distances at which to estimate the sensing depth. Only used for the 'Schron_2017' method.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or pd.Series or pd.DataFrame</code>
          </td>
          <td><p>Estimated sensing depth in m.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Franz, T.E., Zreda, M., Ferre, T.P.A., Rosolem, R., Zweck, C., Stillman, S., Zeng, X. and Shuttleworth, W.J., 2012.
Measurement depth of the cosmic ray soil moisture probe affected by hydrogen from various sources.
Water Resources Research, 48(8). doi.org/10.1029/2012WR011871</p>
<p>Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L., et al. (2017).
Improving calibration and validation of cosmic-ray neutron sensors in the light of spatial sensitivity.
Hydrol. Earth Syst. Sci. 21, 5009–5030. doi.org/10.5194/hess-21-5009-2017</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sensing_depth</span><span class="p">(</span><span class="n">vwc</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">p_ref</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">dist</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Schron_2017&#39;</span><span class="p">):</span>
    <span class="c1"># Convert docstring to google format</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that computes the estimated sensing depth of the cosmic-ray neutron probe.</span>
<span class="sd">    The function offers several methods to compute the depth at which 86 % of the neutrons</span>
<span class="sd">    probes the soil profile.</span>

<span class="sd">    Args:</span>
<span class="sd">        vwc (array or pd.Series or pd.DataFrame): Estimated volumetric water content for each timestamp.</span>
<span class="sd">        pressure (array or pd.Series or pd.DataFrame): Atmospheric pressure in hPa for each timestamp.</span>
<span class="sd">        p_ref (float): Reference pressure in hPa.</span>
<span class="sd">        bulk_density (float): Soil bulk density.</span>
<span class="sd">        Wlat (float): Lattice water content.</span>
<span class="sd">        method (str): Method to compute the sensing depth. Options are &#39;Schron_2017&#39; or &#39;Franz_2012&#39;.</span>
<span class="sd">        dist (list or array): List of radial distances at which to estimate the sensing depth. Only used for the &#39;Schron_2017&#39; method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Estimated sensing depth in m.</span>

<span class="sd">    References:</span>
<span class="sd">        Franz, T.E., Zreda, M., Ferre, T.P.A., Rosolem, R., Zweck, C., Stillman, S., Zeng, X. and Shuttleworth, W.J., 2012.</span>
<span class="sd">        Measurement depth of the cosmic ray soil moisture probe affected by hydrogen from various sources.</span>
<span class="sd">        Water Resources Research, 48(8). doi.org/10.1029/2012WR011871</span>

<span class="sd">        Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L., et al. (2017).</span>
<span class="sd">        Improving calibration and validation of cosmic-ray neutron sensors in the light of spatial sensitivity.</span>
<span class="sd">        Hydrol. Earth Syst. Sci. 21, 5009–5030. doi.org/10.5194/hess-21-5009-2017</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Determine sensing depth (D86)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Schron_2017&#39;</span><span class="p">:</span>

        <span class="c1"># See Appendix A of Schrön et al. (2017)</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="mf">0.4922</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.86</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">pressure</span> <span class="o">/</span> <span class="n">p_ref</span><span class="p">));</span>
        <span class="n">Fveg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dist</span><span class="p">:</span>
            <span class="c1"># Compute r_star</span>
            <span class="n">r_start</span> <span class="o">=</span> <span class="n">d</span><span class="o">/</span><span class="n">Fp</span>

            <span class="c1"># Compute soil depth that accounts for 86% of the neutron flux</span>
            <span class="n">D86</span> <span class="o">=</span> <span class="mi">1</span><span class="o">/</span> <span class="n">bulk_density</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.321</span><span class="o">+</span><span class="mf">0.14249</span><span class="o">*</span><span class="p">(</span><span class="mf">0.96655</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span><span class="o">*</span><span class="n">r_start</span><span class="p">))</span><span class="o">*</span><span class="p">(</span><span class="mi">20</span><span class="o">+</span><span class="p">(</span><span class="n">Wlat</span><span class="o">+</span><span class="n">vwc</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.0429</span><span class="o">+</span><span class="p">(</span><span class="n">Wlat</span><span class="o">+</span><span class="n">vwc</span><span class="p">)))</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">D86</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Franz_2012&#39;</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[</span><span class="mf">5.8</span><span class="o">/</span><span class="p">(</span><span class="n">bulk_density</span><span class="o">*</span><span class="n">Wlat</span><span class="o">+</span><span class="n">vwc</span><span class="o">+</span><span class="mf">0.0829</span><span class="p">)]</span>

    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.smooth_1D" class="doc doc-heading">
<code class="highlight language-python"><span class="n">smooth_1D</span><span class="p">(</span><span class="n">corrected_counts</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;moving_median&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Use a Savitzky-Golay filter to smooth the signal of corrected neutron counts or another one-dimensional array (e.g. computed volumetric water content).</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>corrected_counts</code></td>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>Dataframe containing the corrected neutron counts.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>window</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Window size for the Savitzky-Golay filter. Default is 5.</p></td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>Method to use for smoothing the data. Default is 'moving_median'.
Options are 'moving_average', 'moving_median' and 'savitzky_golay'.</p></td>
          <td>
                <code>&#39;moving_median&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>order</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Order of the Savitzky-Golay filter. Default is 3.</p></td>
          <td>
                <code>3</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas">pd</span>.<span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td><p>DataFrame with smoothed neutron counts.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.
Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.
doi.org/10.3389/frwa.2020.00009</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">smooth_1D</span><span class="p">(</span><span class="n">corrected_counts</span><span class="p">,</span><span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span><span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;moving_median&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use a Savitzky-Golay filter to smooth the signal of corrected neutron counts or another one-dimensional array (e.g. computed volumetric water content).</span>

<span class="sd">    Args:</span>
<span class="sd">        corrected_counts (pd.DataFrame): Dataframe containing the corrected neutron counts.</span>
<span class="sd">        window (int): Window size for the Savitzky-Golay filter. Default is 5.</span>
<span class="sd">        method (str): Method to use for smoothing the data. Default is &#39;moving_median&#39;.</span>
<span class="sd">            Options are &#39;moving_average&#39;, &#39;moving_median&#39; and &#39;savitzky_golay&#39;.</span>
<span class="sd">        order (int): Order of the Savitzky-Golay filter. Default is 3.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pd.DataFrame): DataFrame with smoothed neutron counts.</span>

<span class="sd">    References:</span>
<span class="sd">        Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.</span>
<span class="sd">        Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.</span>
<span class="sd">        doi.org/10.3389/frwa.2020.00009</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;moving_average&#39;</span><span class="p">:</span>
        <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">corrected_counts</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;moving_median&#39;</span><span class="p">:</span>
        <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">corrected_counts</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;savitzky_golay&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">corrected_counts</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dataframe contains NaN values. Please remove NaN values before smoothing the data.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">corrected_counts</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">corrected_counts</span><span class="p">,</span><span class="n">window</span><span class="p">,</span><span class="n">order</span><span class="p">))</span>
            <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">corrected_counts</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">corrected_counts</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">corrected_counts</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">corrected_counts</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">savgol_filter</span><span class="p">(</span><span class="n">corrected_counts</span><span class="p">[</span><span class="n">col</span><span class="p">],</span><span class="n">window</span><span class="p">,</span><span class="n">order</span><span class="p">))</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Invalid method. Please select a valid filtering method., options are: moving_average, moving_median, savitzky_golay&#39;</span><span class="p">)</span>
    <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">corrected_counts</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">bfill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">corrected_counts</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.smooth_2D" class="doc doc-heading">
<code class="highlight language-python"><span class="n">smooth_2D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_neighbours</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">rnd</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Moving buffer filter to smooth georeferenced two-dimensional data.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>UTM x coordinates in meters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>UTM y coordinates in meters.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>Values to be smoothed.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>buffer</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Radial buffer distance in meters.</p></td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>min_neighbours</code></td>
          <td>
                <code>int</code>
          </td>
          <td><p>Minimum number of neighbours to consider for the smoothing.</p></td>
          <td>
                <code>3</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td><p>One of 'mean' or 'median'.</p></td>
          <td>
                <code>&#39;mean&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>rnd</code></td>
          <td>
                <code>bool</code>
          </td>
          <td><p>Boolean to round the final result. Useful in case of z representing neutron counts.</p></td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array</code>
          </td>
          <td><p>Smoothed version of z with the same dimension as z.</p></td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span>
<span class="normal">1113</span>
<span class="normal">1114</span>
<span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">smooth_2D</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_neighbours</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">rnd</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Moving buffer filter to smooth georeferenced two-dimensional data.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (list or array): UTM x coordinates in meters.</span>
<span class="sd">        y (list or array): UTM y coordinates in meters.</span>
<span class="sd">        z (list or array): Values to be smoothed.</span>
<span class="sd">        buffer (float): Radial buffer distance in meters.</span>
<span class="sd">        min_neighbours (int): Minimum number of neighbours to consider for the smoothing.</span>
<span class="sd">        method (str): One of &#39;mean&#39; or &#39;median&#39;.</span>
<span class="sd">        rnd (bool): Boolean to round the final result. Useful in case of z representing neutron counts.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array): Smoothed version of z with the same dimension as z.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert input data to Numpy arrays</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="s2">&quot;Input values cannot be converted to Numpy arrays.&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;The number of x and y must be equal. Input x has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2"> values and y has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2"> values.&quot;</span>

    <span class="c1"># Compute distances</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">z_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">px</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">distances</span> <span class="o">=</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">idx_within_buffer</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">&lt;=</span> <span class="n">buffer</span>


        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
            <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">idx_within_buffer</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">min_neighbours</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx_within_buffer</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx_within_buffer</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> does not exist. Provide either &#39;mean&#39; or &#39;median&#39;.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="c1"># If there are not enough neighbours, keep the original value</span>

        <span class="c1"># Append smoothed value to array</span>
        <span class="n">z_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_smooth</span><span class="p">,</span> <span class="n">z_new_val</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rnd</span><span class="p">:</span>
        <span class="n">z_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">z_smooth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">z_smooth</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h2 id="crnpy.crnpy.storage" class="doc doc-heading">
<code class="highlight language-python"><span class="n">storage</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">Z_surface</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span> <span class="n">Z_subsurface</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Exponential filter to estimate soil moisture in the rootzone from surface observtions.</p>

  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sm</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td><p>Soil moisture in mm of water.</p></td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Characteristic time length in the same units as the measurement interval.</p></td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>Z_surface</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Depth of surface layer in mm. This should be an intermediate value according to the
sensing depth computed using the D86 method.</p></td>
          <td>
                <code>150</code>
          </td>
        </tr>
        <tr>
          <td><code>Z_subsurface</code></td>
          <td>
                <code>float</code>
          </td>
          <td><p>Depth of subsurface layer in mm.</p></td>
          <td>
                <code>1000</code>
          </td>
        </tr>
    </tbody>
  </table>

  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>tuple</code>
          </td>
          <td><p>tuple containing:
- <strong>Surface soil water storage</strong> (<em>array</em>): Surface soil water storage in mm of water.
- <strong>Subsurface soil water storage</strong> (<em>array</em>): Subsurface soil water storage in mm of water.</p></td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Albergel, C., Rüdiger, C., Pellarin, T., Calvet, J.C., Fritz, N., Froissard, F., Suquia, D., Petitpa, A., Piguet, B. and Martin, E., 2008.
From near-surface to root-zone soil moisture using an exponential filter: an assessment of the method based on in-situ observations and model
simulations. Hydrology and Earth System Sciences, 12(6), pp.1323-1337.</p>
<p>Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.
Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.</p>
<p>Rossini, P. and Patrignani, A., 2021. Predicting rootzone soil moisture from surface observations in cropland using an exponential filter.
Soil Science Society of America Journal.</p>
</details>
      <details class="quote">
        <summary>Source code in <code>C:\Users\jperaza\AppData\Local\anaconda3\envs\crnpy\lib\site-packages\crnpy\crnpy.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">storage</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span><span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">Z_surface</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span><span class="n">Z_subsurface</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exponential filter to estimate soil moisture in the rootzone from surface observtions.</span>

<span class="sd">    Args:</span>
<span class="sd">        sm (list or array): Soil moisture in mm of water.</span>
<span class="sd">        T (float): Characteristic time length in the same units as the measurement interval.</span>
<span class="sd">        Z_surface (float): Depth of surface layer in mm. This should be an intermediate value according to the</span>
<span class="sd">            sensing depth computed using the D86 method.</span>
<span class="sd">        Z_subsurface (float): Depth of subsurface layer in mm.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (tuple): tuple containing:</span>
<span class="sd">            - **Surface soil water storage** (*array*): Surface soil water storage in mm of water.</span>
<span class="sd">            - **Subsurface soil water storage** (*array*): Subsurface soil water storage in mm of water.</span>

<span class="sd">    References:</span>
<span class="sd">        Albergel, C., Rüdiger, C., Pellarin, T., Calvet, J.C., Fritz, N., Froissard, F., Suquia, D., Petitpa, A., Piguet, B. and Martin, E., 2008.</span>
<span class="sd">        From near-surface to root-zone soil moisture using an exponential filter: an assessment of the method based on in-situ observations and model</span>
<span class="sd">        simulations. Hydrology and Earth System Sciences, 12(6), pp.1323-1337.</span>

<span class="sd">        Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.</span>
<span class="sd">        Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.</span>

<span class="sd">        Rossini, P. and Patrignani, A., 2021. Predicting rootzone soil moisture from surface observations in cropland using an exponential filter.</span>
<span class="sd">        Soil Science Society of America Journal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Parameters</span>
    <span class="n">t_delta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">sm_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
    <span class="n">sm_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">sm</span><span class="o">-</span><span class="n">sm_min</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">sm_max</span><span class="o">-</span><span class="n">sm_min</span><span class="p">)</span>

    <span class="c1"># Pre-allocate soil water index array</span>
    <span class="n">SWI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Initial conditions</span>
    <span class="n">SWI</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Values from 2 to N</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">SWI</span><span class="p">)):</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]):</span>
            <span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_delta</span><span class="o">/</span><span class="n">T</span><span class="p">))</span>
            <span class="n">SWI</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">SWI</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">SWI</span><span class="p">[</span><span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>

    <span class="c1"># Surface storage</span>
    <span class="n">storage_surface</span> <span class="o">=</span> <span class="n">sm</span><span class="o">*</span><span class="n">Z_surface</span>

    <span class="c1"># Rootzone storage</span>
    <span class="n">storage_subsurface</span> <span class="o">=</span> <span class="p">(</span><span class="n">SWI</span><span class="o">*</span><span class="p">(</span><span class="n">sm_max</span><span class="o">-</span><span class="n">sm_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">sm_min</span><span class="p">)</span><span class="o">*</span><span class="n">Z_subsurface</span>

    <span class="k">return</span> <span class="n">storage_surface</span><span class="p">,</span> <span class="n">storage_subsurface</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">


<a id="crnpy.data"></a>
  <div class="doc doc-contents first">
  
      <h3 id="crnpy.data--crnpydata">crnpy.data</h3>
<p>Data module for crnpy.</p>
<p>This module contains data for the crnpy package.</p>

  <p><strong>Attributes:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>cutoff_rigidity</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Cutoff rigidity values for the whole world. See <a class="autorefs autorefs-internal" href="#crnpy.crnpy.cutoff_rigidity">crnpy.crnpy.cutoff_rigidity</a></p></td>
        </tr>
        <tr>
          <td><code>neutron_detectors</code></td>
          <td>
                <code>list</code>
          </td>
          <td><p>Neutron detector locations. See <a class="autorefs autorefs-internal" href="#crnpy.crnpy.find_neutron_detectors">crnpy.crnpy.find_neutron_detectors</a></p></td>
        </tr>
    </tbody>
  </table>

  

  <div class="doc doc-children">











  </div>

  </div>

</div>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.fac441b0.min.js"></script>
      
        <script src="../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  </body>
</html>