
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="CRNPy is a Python package for the estimation and processing of soil moisture data from cosmic-ray neutron counts.">
      
      
      
        <link rel="canonical" href="https://soilwater.github.io/crnpy/reference/">
      
      
        <link rel="prev" href="../examples/calibration/calibration/">
      
      
      
      <link rel="icon" href="../img/logo/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>Reference - CRNPy Documentation</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.50c56a3b.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
      <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
      
        <meta  property="og:type"  content="website" >
      
        <meta  property="og:title"  content="Reference - CRNPy Documentation" >
      
        <meta  property="og:description"  content="CRNPy is a Python package for the estimation and processing of soil moisture data from cosmic-ray neutron counts." >
      
        <meta  property="og:image"  content="https://soilwater.github.io/crnpy/assets/images/social/reference.png" >
      
        <meta  property="og:image:type"  content="image/png" >
      
        <meta  property="og:image:width"  content="1200" >
      
        <meta  property="og:image:height"  content="630" >
      
        <meta  property="og:url"  content="https://soilwater.github.io/crnpy/reference/" >
      
        <meta  name="twitter:card"  content="summary_large_image" >
      
        <meta  name="twitter:title"  content="Reference - CRNPy Documentation" >
      
        <meta  name="twitter:description"  content="CRNPy is a Python package for the estimation and processing of soil moisture data from cosmic-ray neutron counts." >
      
        <meta  name="twitter:image"  content="https://soilwater.github.io/crnpy/assets/images/social/reference.png" >
      
    
    
   <link href="../assets/stylesheets/glightbox.min.css" rel="stylesheet"/><style>
        html.glightbox-open { overflow: initial; height: 100%; }
        .gslide-title { margin-top: 0px; user-select: text; }
        .gslide-desc { color: #666; user-select: text; }
        .gslide-image img { background: white; }
        
            .gscrollbar-fixer { padding-right: 15px; }
            .gdesc-inner { font-size: 0.75rem; }
            body[data-md-color-scheme="slate"] .gdesc-inner { background: var(--md-default-bg-color);}
            body[data-md-color-scheme="slate"] .gslide-title { color: var(--md-default-fg-color);}
            body[data-md-color-scheme="slate"] .gslide-desc { color: var(--md-default-fg-color);}
            </style> <script src="../assets/javascripts/glightbox.min.js"></script></head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#reference" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="CRNPy Documentation" class="md-header__button md-logo" aria-label="CRNPy Documentation" data-md-component="logo">
      
  <img src="../img/logo/crnpy-logo.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            CRNPy Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Reference
            
          </span>
        </div>
      </div>
    </div>
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/soilwater/crnpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="CRNPy Documentation" class="md-nav__button md-logo" aria-label="CRNPy Documentation" data-md-component="logo">
      
  <img src="../img/logo/crnpy-logo.svg" alt="logo">

    </a>
    CRNPy Documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/soilwater/crnpy" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    GitHub
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Home
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../sensor_description/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Sensor description
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../correction_routines/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Correction routines
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Examples
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Examples
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/stationary/example_RDT_station/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Processing and analyzing data from a stationary detector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/rover/Hydroinnova_rover_example/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Processing and analyzing data from a roving detector
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../examples/calibration/calibration/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Device-specific field calibration
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    Reference
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy" class="md-nav__link">
    <span class="md-ellipsis">
      crnpy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.abs_humidity" class="md-nav__link">
    <span class="md-ellipsis">
      abs_humidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.atmospheric_depth" class="md-nav__link">
    <span class="md-ellipsis">
      atmospheric_depth()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.biomass_to_bwe" class="md-nav__link">
    <span class="md-ellipsis">
      biomass_to_bwe()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_bwe" class="md-nav__link">
    <span class="md-ellipsis">
      correction_bwe()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_humidity" class="md-nav__link">
    <span class="md-ellipsis">
      correction_humidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_incoming_flux" class="md-nav__link">
    <span class="md-ellipsis">
      correction_incoming_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      correction_pressure()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_road" class="md-nav__link">
    <span class="md-ellipsis">
      correction_road()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.counts_to_vwc" class="md-nav__link">
    <span class="md-ellipsis">
      counts_to_vwc()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.cutoff_rigidity" class="md-nav__link">
    <span class="md-ellipsis">
      cutoff_rigidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.euclidean_distance" class="md-nav__link">
    <span class="md-ellipsis">
      euclidean_distance()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.exp_filter" class="md-nav__link">
    <span class="md-ellipsis">
      exp_filter()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.fill_missing_timestamps" class="md-nav__link">
    <span class="md-ellipsis">
      fill_missing_timestamps()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.find_neutron_monitor" class="md-nav__link">
    <span class="md-ellipsis">
      find_neutron_monitor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.get_incoming_neutron_flux" class="md-nav__link">
    <span class="md-ellipsis">
      get_incoming_neutron_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.get_reference_neutron_flux" class="md-nav__link">
    <span class="md-ellipsis">
      get_reference_neutron_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.idw" class="md-nav__link">
    <span class="md-ellipsis">
      idw()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.interpolate_2d" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_2d()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.interpolate_incoming_flux" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_incoming_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.is_outlier" class="md-nav__link">
    <span class="md-ellipsis">
      is_outlier()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.latlon_to_utm" class="md-nav__link">
    <span class="md-ellipsis">
      latlon_to_utm()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.lattice_water" class="md-nav__link">
    <span class="md-ellipsis">
      lattice_water()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.location_factor" class="md-nav__link">
    <span class="md-ellipsis">
      location_factor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.nrad_weight" class="md-nav__link">
    <span class="md-ellipsis">
      nrad_weight()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.remove_incomplete_intervals" class="md-nav__link">
    <span class="md-ellipsis">
      remove_incomplete_intervals()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.rover_centered_coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      rover_centered_coordinates()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.sensing_depth" class="md-nav__link">
    <span class="md-ellipsis">
      sensing_depth()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.smooth_1d" class="md-nav__link">
    <span class="md-ellipsis">
      smooth_1d()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.spatial_average" class="md-nav__link">
    <span class="md-ellipsis">
      spatial_average()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.total_raw_counts" class="md-nav__link">
    <span class="md-ellipsis">
      total_raw_counts()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.uncertainty_counts" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty_counts()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.uncertainty_vwc" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty_vwc()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data" class="md-nav__link">
    <span class="md-ellipsis">
      data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.abs_humidity" class="md-nav__link">
    <span class="md-ellipsis">
      abs_humidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.atmospheric_depth" class="md-nav__link">
    <span class="md-ellipsis">
      atmospheric_depth()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.biomass_to_bwe" class="md-nav__link">
    <span class="md-ellipsis">
      biomass_to_bwe()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_bwe" class="md-nav__link">
    <span class="md-ellipsis">
      correction_bwe()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_humidity" class="md-nav__link">
    <span class="md-ellipsis">
      correction_humidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_incoming_flux" class="md-nav__link">
    <span class="md-ellipsis">
      correction_incoming_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      correction_pressure()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_road" class="md-nav__link">
    <span class="md-ellipsis">
      correction_road()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.counts_to_vwc" class="md-nav__link">
    <span class="md-ellipsis">
      counts_to_vwc()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.cutoff_rigidity" class="md-nav__link">
    <span class="md-ellipsis">
      cutoff_rigidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.euclidean_distance" class="md-nav__link">
    <span class="md-ellipsis">
      euclidean_distance()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.exp_filter" class="md-nav__link">
    <span class="md-ellipsis">
      exp_filter()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.fill_missing_timestamps" class="md-nav__link">
    <span class="md-ellipsis">
      fill_missing_timestamps()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.find_neutron_monitor" class="md-nav__link">
    <span class="md-ellipsis">
      find_neutron_monitor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.get_incoming_neutron_flux" class="md-nav__link">
    <span class="md-ellipsis">
      get_incoming_neutron_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.get_reference_neutron_flux" class="md-nav__link">
    <span class="md-ellipsis">
      get_reference_neutron_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.idw" class="md-nav__link">
    <span class="md-ellipsis">
      idw()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.interpolate_2d" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_2d()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.interpolate_incoming_flux" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_incoming_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.is_outlier" class="md-nav__link">
    <span class="md-ellipsis">
      is_outlier()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.latlon_to_utm" class="md-nav__link">
    <span class="md-ellipsis">
      latlon_to_utm()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.lattice_water" class="md-nav__link">
    <span class="md-ellipsis">
      lattice_water()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.location_factor" class="md-nav__link">
    <span class="md-ellipsis">
      location_factor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.nrad_weight" class="md-nav__link">
    <span class="md-ellipsis">
      nrad_weight()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.remove_incomplete_intervals" class="md-nav__link">
    <span class="md-ellipsis">
      remove_incomplete_intervals()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.rover_centered_coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      rover_centered_coordinates()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.sensing_depth" class="md-nav__link">
    <span class="md-ellipsis">
      sensing_depth()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.smooth_1d" class="md-nav__link">
    <span class="md-ellipsis">
      smooth_1d()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.spatial_average" class="md-nav__link">
    <span class="md-ellipsis">
      spatial_average()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.total_raw_counts" class="md-nav__link">
    <span class="md-ellipsis">
      total_raw_counts()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.uncertainty_counts" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty_counts()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.uncertainty_vwc" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty_vwc()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy" class="md-nav__link">
    <span class="md-ellipsis">
      crnpy
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.abs_humidity" class="md-nav__link">
    <span class="md-ellipsis">
      abs_humidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.atmospheric_depth" class="md-nav__link">
    <span class="md-ellipsis">
      atmospheric_depth()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.biomass_to_bwe" class="md-nav__link">
    <span class="md-ellipsis">
      biomass_to_bwe()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_bwe" class="md-nav__link">
    <span class="md-ellipsis">
      correction_bwe()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_humidity" class="md-nav__link">
    <span class="md-ellipsis">
      correction_humidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_incoming_flux" class="md-nav__link">
    <span class="md-ellipsis">
      correction_incoming_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      correction_pressure()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.correction_road" class="md-nav__link">
    <span class="md-ellipsis">
      correction_road()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.counts_to_vwc" class="md-nav__link">
    <span class="md-ellipsis">
      counts_to_vwc()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.cutoff_rigidity" class="md-nav__link">
    <span class="md-ellipsis">
      cutoff_rigidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.euclidean_distance" class="md-nav__link">
    <span class="md-ellipsis">
      euclidean_distance()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.exp_filter" class="md-nav__link">
    <span class="md-ellipsis">
      exp_filter()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.fill_missing_timestamps" class="md-nav__link">
    <span class="md-ellipsis">
      fill_missing_timestamps()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.find_neutron_monitor" class="md-nav__link">
    <span class="md-ellipsis">
      find_neutron_monitor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.get_incoming_neutron_flux" class="md-nav__link">
    <span class="md-ellipsis">
      get_incoming_neutron_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.get_reference_neutron_flux" class="md-nav__link">
    <span class="md-ellipsis">
      get_reference_neutron_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.idw" class="md-nav__link">
    <span class="md-ellipsis">
      idw()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.interpolate_2d" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_2d()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.interpolate_incoming_flux" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_incoming_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.is_outlier" class="md-nav__link">
    <span class="md-ellipsis">
      is_outlier()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.latlon_to_utm" class="md-nav__link">
    <span class="md-ellipsis">
      latlon_to_utm()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.lattice_water" class="md-nav__link">
    <span class="md-ellipsis">
      lattice_water()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.location_factor" class="md-nav__link">
    <span class="md-ellipsis">
      location_factor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.nrad_weight" class="md-nav__link">
    <span class="md-ellipsis">
      nrad_weight()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.remove_incomplete_intervals" class="md-nav__link">
    <span class="md-ellipsis">
      remove_incomplete_intervals()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.rover_centered_coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      rover_centered_coordinates()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.sensing_depth" class="md-nav__link">
    <span class="md-ellipsis">
      sensing_depth()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.smooth_1d" class="md-nav__link">
    <span class="md-ellipsis">
      smooth_1d()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.spatial_average" class="md-nav__link">
    <span class="md-ellipsis">
      spatial_average()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.total_raw_counts" class="md-nav__link">
    <span class="md-ellipsis">
      total_raw_counts()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.uncertainty_counts" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty_counts()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.crnpy.uncertainty_vwc" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty_vwc()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data" class="md-nav__link">
    <span class="md-ellipsis">
      data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.abs_humidity" class="md-nav__link">
    <span class="md-ellipsis">
      abs_humidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.atmospheric_depth" class="md-nav__link">
    <span class="md-ellipsis">
      atmospheric_depth()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.biomass_to_bwe" class="md-nav__link">
    <span class="md-ellipsis">
      biomass_to_bwe()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_bwe" class="md-nav__link">
    <span class="md-ellipsis">
      correction_bwe()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_humidity" class="md-nav__link">
    <span class="md-ellipsis">
      correction_humidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_incoming_flux" class="md-nav__link">
    <span class="md-ellipsis">
      correction_incoming_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_pressure" class="md-nav__link">
    <span class="md-ellipsis">
      correction_pressure()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.correction_road" class="md-nav__link">
    <span class="md-ellipsis">
      correction_road()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.counts_to_vwc" class="md-nav__link">
    <span class="md-ellipsis">
      counts_to_vwc()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.cutoff_rigidity" class="md-nav__link">
    <span class="md-ellipsis">
      cutoff_rigidity()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.euclidean_distance" class="md-nav__link">
    <span class="md-ellipsis">
      euclidean_distance()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.exp_filter" class="md-nav__link">
    <span class="md-ellipsis">
      exp_filter()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.fill_missing_timestamps" class="md-nav__link">
    <span class="md-ellipsis">
      fill_missing_timestamps()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.find_neutron_monitor" class="md-nav__link">
    <span class="md-ellipsis">
      find_neutron_monitor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.get_incoming_neutron_flux" class="md-nav__link">
    <span class="md-ellipsis">
      get_incoming_neutron_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.get_reference_neutron_flux" class="md-nav__link">
    <span class="md-ellipsis">
      get_reference_neutron_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.idw" class="md-nav__link">
    <span class="md-ellipsis">
      idw()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.interpolate_2d" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_2d()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.interpolate_incoming_flux" class="md-nav__link">
    <span class="md-ellipsis">
      interpolate_incoming_flux()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.is_outlier" class="md-nav__link">
    <span class="md-ellipsis">
      is_outlier()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.latlon_to_utm" class="md-nav__link">
    <span class="md-ellipsis">
      latlon_to_utm()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.lattice_water" class="md-nav__link">
    <span class="md-ellipsis">
      lattice_water()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.location_factor" class="md-nav__link">
    <span class="md-ellipsis">
      location_factor()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.nrad_weight" class="md-nav__link">
    <span class="md-ellipsis">
      nrad_weight()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.remove_incomplete_intervals" class="md-nav__link">
    <span class="md-ellipsis">
      remove_incomplete_intervals()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.rover_centered_coordinates" class="md-nav__link">
    <span class="md-ellipsis">
      rover_centered_coordinates()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.sensing_depth" class="md-nav__link">
    <span class="md-ellipsis">
      sensing_depth()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.smooth_1d" class="md-nav__link">
    <span class="md-ellipsis">
      smooth_1d()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.spatial_average" class="md-nav__link">
    <span class="md-ellipsis">
      spatial_average()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.total_raw_counts" class="md-nav__link">
    <span class="md-ellipsis">
      total_raw_counts()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.uncertainty_counts" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty_counts()
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#crnpy.data.uncertainty_vwc" class="md-nav__link">
    <span class="md-ellipsis">
      uncertainty_vwc()
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                



                  

  
  


<h1 id="reference">Reference</h1>


<div class="doc doc-object doc-module">



<a id="crnpy.crnpy"></a>
  <div class="doc doc-contents first">
  
      <p><code>crnpy</code> is a Python package for processing cosmic ray neutron data.</p>
<p>Created by Joaquin Peraza and Andres Patrignani.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.abs_humidity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">abs_humidity</span><span class="p">(</span><span class="n">relative_humidity</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the actual vapor pressure (e) in g m^-3 using RH (%) and current temperature (c) observations.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>relative_humidity</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>relative humidity (%)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>temp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>temperature (Celsius)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>actual vapor pressure (g m^-3)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">abs_humidity</span><span class="p">(</span><span class="n">relative_humidity</span><span class="p">,</span> <span class="n">temp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the actual vapor pressure (e) in g m^-3 using RH (%) and current temperature (c) observations.</span>

<span class="sd">    Args:</span>
<span class="sd">        relative_humidity (float): relative humidity (%)</span>
<span class="sd">        temp (float): temperature (Celsius)</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: actual vapor pressure (g m^-3)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### Atmospheric water vapor factor</span>
    <span class="c1"># Saturation vapor pressure</span>
    <span class="n">e_sat</span> <span class="o">=</span> <span class="mf">0.611</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">17.502</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">temp</span> <span class="o">+</span> <span class="mf">240.97</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># in Pascals Eq. 3.8 p.41 Environmental Biophysics (Campbell and Norman)</span>

    <span class="c1"># Vapor pressure Pascals</span>
    <span class="n">Pw</span> <span class="o">=</span> <span class="n">e_sat</span> <span class="o">*</span> <span class="n">relative_humidity</span> <span class="o">/</span> <span class="mi">100</span>

    <span class="c1"># Absolute humidity (g/m^3)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mf">2.16679</span>  <span class="c1"># g K/J;</span>
    <span class="n">abs_h</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">Pw</span> <span class="o">/</span> <span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abs_h</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.atmospheric_depth" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">atmospheric_depth</span><span class="p">(</span><span class="n">elevation</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the atmospheric depth for any point on Earth according to McJannet and Desilets, 2023</p>
<p>This function is required in the calculation of the location-dependent reference correction proposed by McJannet and Desilets, 2023.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>elevation</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Elevation in meters above sea level.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>latitude</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Geographic latitude in decimal degrees. Value in range -90 to 90</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth in g/cm2</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Atmosphere, U. S. (1976). US standard atmosphere. National Oceanic and Atmospheric Administration.</p>
<p>McJannet, D. L., &amp; Desilets, D. (2023). Incoming Neutron Flux Corrections for Cosmic‐Ray Soil and Snow Sensors Using the Global Neutron Monitor Network. Water Resources Research, 59(4), e2022WR033889.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">atmospheric_depth</span><span class="p">(</span><span class="n">elevation</span><span class="p">,</span> <span class="n">latitude</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to estimate the atmospheric depth for any point on Earth according to McJannet and Desilets, 2023</span>

<span class="sd">    This function is required in the calculation of the location-dependent reference correction proposed by McJannet and Desilets, 2023.</span>

<span class="sd">    Args:</span>
<span class="sd">        elevation (float): Elevation in meters above sea level.</span>
<span class="sd">        latitude (float): Geographic latitude in decimal degrees. Value in range -90 to 90</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Atmospheric depth in g/cm2</span>

<span class="sd">    References:</span>
<span class="sd">        Atmosphere, U. S. (1976). US standard atmosphere. National Oceanic and Atmospheric Administration.</span>

<span class="sd">        McJannet, D. L., &amp; Desilets, D. (2023). Incoming Neutron Flux Corrections for Cosmic‐Ray Soil and Snow Sensors Using the Global Neutron Monitor Network. Water Resources Research, 59(4), e2022WR033889.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">density_of_rock</span> <span class="o">=</span> <span class="mi">2670</span>  <span class="c1"># Density of rock in kg/m3</span>
    <span class="n">air_pressure_sea_level</span> <span class="o">=</span> <span class="mf">1013.25</span>  <span class="c1"># Air pressure at sea level in hPa</span>
    <span class="n">air_molar_mass</span> <span class="o">=</span> <span class="mf">0.0289644</span>  <span class="c1"># Air molar mass in kg/mol</span>
    <span class="n">universal_gas_constant</span> <span class="o">=</span> <span class="mf">8.31432</span>  <span class="c1"># Universal gas constant in J/(mol*K)</span>
    <span class="n">reference_temperature</span> <span class="o">=</span> <span class="mf">288.15</span>  <span class="c1"># Reference temperature Kelvin</span>
    <span class="n">temperature_lapse_rate</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0065</span>  <span class="c1"># Temperature lapse rate in K/m</span>

    <span class="c1"># Gravity at sea-level calculation</span>
    <span class="n">gravity_sea_level</span> <span class="o">=</span> <span class="mf">9.780327</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.0053024</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.0000058</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Free air correction</span>
    <span class="n">free_air</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.086</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="n">elevation</span>
    <span class="c1"># Bouguer correction</span>
    <span class="n">bouguer_corr</span> <span class="o">=</span> <span class="mf">4.193</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">10</span> <span class="o">*</span> <span class="n">density_of_rock</span> <span class="o">*</span> <span class="n">elevation</span>
    <span class="c1"># Total gravity</span>
    <span class="n">gravity</span> <span class="o">=</span> <span class="n">gravity_sea_level</span> <span class="o">+</span> <span class="n">free_air</span> <span class="o">+</span> <span class="n">bouguer_corr</span>

    <span class="c1"># Air pressure calculation</span>
    <span class="n">reference_air_pressure</span> <span class="o">=</span> <span class="n">air_pressure_sea_level</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mi">1</span> <span class="o">+</span> <span class="n">temperature_lapse_rate</span> <span class="o">/</span> <span class="n">reference_temperature</span> <span class="o">*</span> <span class="n">elevation</span><span class="p">)</span> <span class="o">**</span> <span class="p">((</span><span class="o">-</span><span class="n">gravity</span> <span class="o">*</span> <span class="n">air_molar_mass</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">universal_gas_constant</span> <span class="o">*</span> <span class="n">temperature_lapse_rate</span><span class="p">))</span>

    <span class="c1"># Atmospheric depth calculation</span>
    <span class="n">atmospheric_depth</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">reference_air_pressure</span><span class="p">)</span> <span class="o">/</span> <span class="n">gravity</span>
    <span class="k">return</span> <span class="n">atmospheric_depth</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.biomass_to_bwe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">biomass_to_bwe</span><span class="p">(</span><span class="n">biomass_dry</span><span class="p">,</span> <span class="n">biomass_fresh</span><span class="p">,</span> <span class="n">fWE</span><span class="o">=</span><span class="mf">0.494</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to convert biomass to biomass water equivalent.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biomass_dry</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Above ground dry biomass in kg m-2.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>biomass_fresh</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Above ground fresh biomass in kg m-2.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fWE</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Stoichiometric ratio of H2O to organic carbon molecules in the plant (assuming this is mostly cellulose)
Default is 0.494 (Wahbi &amp; Avery, 2018).</p>
            </div>
          </td>
          <td>
                <code>0.494</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Biomass water equivalent in kg m-2.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Wahbi, A., Avery, W. (2018). In Situ Destructive Sampling. In:
Cosmic Ray Neutron Sensing: Estimation of Agricultural Crop Biomass Water Equivalent.
Springer, Cham. https://doi.org/10.1007/978-3-319-69539-6_2</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">biomass_to_bwe</span><span class="p">(</span><span class="n">biomass_dry</span><span class="p">,</span> <span class="n">biomass_fresh</span><span class="p">,</span> <span class="n">fWE</span><span class="o">=</span><span class="mf">0.494</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to convert biomass to biomass water equivalent.</span>

<span class="sd">    Args:</span>
<span class="sd">        biomass_dry (array or pd.Series or pd.DataFrame): Above ground dry biomass in kg m-2.</span>
<span class="sd">        biomass_fresh (array or pd.Series or pd.DataFrame): Above ground fresh biomass in kg m-2.</span>
<span class="sd">        fWE (float): Stoichiometric ratio of H2O to organic carbon molecules in the plant (assuming this is mostly cellulose)</span>
<span class="sd">            Default is 0.494 (Wahbi &amp; Avery, 2018).</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Biomass water equivalent in kg m-2.</span>

<span class="sd">    References:</span>
<span class="sd">        Wahbi, A., Avery, W. (2018). In Situ Destructive Sampling. In:</span>
<span class="sd">        Cosmic Ray Neutron Sensing: Estimation of Agricultural Crop Biomass Water Equivalent.</span>
<span class="sd">        Springer, Cham. https://doi.org/10.1007/978-3-319-69539-6_2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">biomass_fresh</span> <span class="o">-</span> <span class="n">biomass_dry</span><span class="p">)</span> <span class="o">+</span> <span class="n">fWE</span> <span class="o">*</span> <span class="n">biomass_dry</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.correction_bwe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_bwe</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">bwe</span><span class="p">,</span> <span class="n">r2_N0</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to correct for biomass effects in neutron counts.
following the approach described in Baatz et al., 2015.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of ephithermal neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bwe</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Biomass water equivalent kg m-2.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>r2_N0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Ratio of neutron counts with biomass to neutron counts without biomass. Default is 0.05.</p>
            </div>
          </td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of corrected neutron counts for biomass effects.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Baatz, R., H. R. Bogena, H.-J. Hendricks Franssen, J. A. Huisman, C. Montzka, and H. Vereecken (2015),
An empiricalvegetation correction for soil water content quantification using cosmic ray probes,
Water Resour. Res., 51, 2030–2046, doi:10.1002/ 2014WR016443.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_bwe</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">bwe</span><span class="p">,</span> <span class="n">r2_N0</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to correct for biomass effects in neutron counts.</span>
<span class="sd">    following the approach described in Baatz et al., 2015.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (array or pd.Series or pd.DataFrame): Array of ephithermal neutron counts.</span>
<span class="sd">        bwe (float): Biomass water equivalent kg m-2.</span>
<span class="sd">        r2_N0 (float): Ratio of neutron counts with biomass to neutron counts without biomass. Default is 0.05.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Array of corrected neutron counts for biomass effects.</span>

<span class="sd">    References:</span>
<span class="sd">        Baatz, R., H. R. Bogena, H.-J. Hendricks Franssen, J. A. Huisman, C. Montzka, and H. Vereecken (2015),</span>
<span class="sd">        An empiricalvegetation correction for soil water content quantification using cosmic ray probes,</span>
<span class="sd">        Water Resour. Res., 51, 2030–2046, doi:10.1002/ 2014WR016443.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">counts</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bwe</span> <span class="o">*</span> <span class="n">r2_N0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.correction_humidity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_humidity</span><span class="p">(</span><span class="n">abs_humidity</span><span class="p">,</span> <span class="n">Aref</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Correction factor for absolute humidity.</p>
<p>This function corrects neutron counts for absolute humidity using the method described in Rosolem et al. (2013) and Anderson et al. (2017). The correction is performed using the following equation:</p>
<p>$$
C_{corrected} = C_{raw} \cdot f_w
$$</p>
<p>where:</p>
<ul>
<li>Ccorrected: corrected neutron counts</li>
<li>Craw: raw neutron counts</li>
<li>fw: absolute humidity correction factor</li>
</ul>
<p>$$
f_w = 1 + 0.0054(A - A_{ref})
$$</p>
<p>where:</p>
<ul>
<li>A: absolute humidity</li>
<li>Aref: reference absolute humidity</li>
</ul>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>abs_humidity</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Relative humidity readings.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Aref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference absolute humidity (g/m^3). The day of the instrument calibration is recommended.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>fw correction factor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Rosolem, R., W. J. Shuttleworth, M. Zreda, T. E. Franz, X. Zeng, and S. A. Kurc, 2013: The Effect of Atmospheric Water Vapor on Neutron Count in the Cosmic-Ray Soil Moisture Observing System. J. Hydrometeor., 14, 1659–1671, https://doi.org/10.1175/JHM-D-12-0120.1.</p>
<p>M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_humidity</span><span class="p">(</span><span class="n">abs_humidity</span><span class="p">,</span> <span class="n">Aref</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Correction factor for absolute humidity.</span>

<span class="sd">    This function corrects neutron counts for absolute humidity using the method described in Rosolem et al. (2013) and Anderson et al. (2017). The correction is performed using the following equation:</span>

<span class="sd">    $$</span>
<span class="sd">    C_{corrected} = C_{raw} \cdot f_w</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - Ccorrected: corrected neutron counts</span>
<span class="sd">    - Craw: raw neutron counts</span>
<span class="sd">    - fw: absolute humidity correction factor</span>

<span class="sd">    $$</span>
<span class="sd">    f_w = 1 + 0.0054(A - A_{ref})</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - A: absolute humidity</span>
<span class="sd">    - Aref: reference absolute humidity</span>

<span class="sd">    Args:</span>
<span class="sd">        abs_humidity (list or array): Relative humidity readings.</span>
<span class="sd">        Aref (float): Reference absolute humidity (g/m^3). The day of the instrument calibration is recommended.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): fw correction factor.</span>

<span class="sd">    References:</span>
<span class="sd">        Rosolem, R., W. J. Shuttleworth, M. Zreda, T. E. Franz, X. Zeng, and S. A. Kurc, 2013: The Effect of Atmospheric Water Vapor on Neutron Count in the Cosmic-Ray Soil Moisture Observing System. J. Hydrometeor., 14, 1659–1671, https://doi.org/10.1175/JHM-D-12-0120.1.</span>

<span class="sd">        M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">abs_humidity</span>
    <span class="n">fw</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.0054</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">Aref</span><span class="p">)</span>  <span class="c1"># Zreda et al. 2017 Eq 6.</span>
    <span class="k">return</span> <span class="n">fw</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.correction_incoming_flux" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_incoming_flux</span><span class="p">(</span><span class="n">incoming_neutrons</span><span class="p">,</span> <span class="n">incoming_Ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_na</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_site</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">site_atmdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_atmdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Correction factor for incoming neutron flux.</p>
<p>This function corrects neutron counts for incoming neutron flux using the method described in Anderson et al. (2017). The correction is performed using the following equation:</p>
<p>$$
C_{corrected} = \frac{C_{raw}}{f_i}
$$</p>
<p>where:</p>
<ul>
<li>Ccorrected: corrected neutron counts</li>
<li>Craw: raw neutron counts</li>
<li>fi: incoming neutron flux correction factor</li>
</ul>
<p>$$
f_i = \frac{I}{I_{ref}}
$$</p>
<p>where:</p>
<ul>
<li>I: incoming neutron flux</li>
<li>Iref: reference incoming neutron flux</li>
</ul>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>incoming_neutrons</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Incoming neutron flux readings.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>incoming_Ref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference incoming neutron flux. Baseline incoming neutron flux.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fill_na</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Value to fill missing data. If None, missing data remains as NaN.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>Rc_method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional to correct for differences in cutoff rigidity between the site and the reference station. Possible values are 'McJannetandDesilets2023' or 'Hawdonetal2014'. If None, no correction is performed.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>Rc_site</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity at the monitoring site.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>site_atmdepth</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth at the monitoring site.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>Rc_ref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity at the reference station.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ref_atmdepth</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth at the reference station.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>fi correction factor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Hawdon, A., D. McJannet, and J. Wallace (2014), Calibration and correction procedures for cosmic-ray neutron soil moisture probes located across Australia, Water Resour. Res., 50, 5029–5043, doi:10.1002/2013WR015138.</p>
<p>M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</p>
<p>McJannet, D. L., &amp; Desilets, D. (2023). Incoming neutron flux corrections for cosmic-ray soil and snow sensors using the global neutron monitor network. Water Resources Research, 59, e2022WR033889. https://doi.org/10.1029/2022WR033889</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_incoming_flux</span><span class="p">(</span><span class="n">incoming_neutrons</span><span class="p">,</span> <span class="n">incoming_Ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_na</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_site</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">site_atmdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_atmdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Correction factor for incoming neutron flux.</span>

<span class="sd">    This function corrects neutron counts for incoming neutron flux using the method described in Anderson et al. (2017). The correction is performed using the following equation:</span>

<span class="sd">    $$</span>
<span class="sd">    C_{corrected} = \frac{C_{raw}}{f_i}</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - Ccorrected: corrected neutron counts</span>
<span class="sd">    - Craw: raw neutron counts</span>
<span class="sd">    - fi: incoming neutron flux correction factor</span>

<span class="sd">    $$</span>
<span class="sd">    f_i = \frac{I}{I_{ref}}</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - I: incoming neutron flux</span>
<span class="sd">    - Iref: reference incoming neutron flux</span>

<span class="sd">    Args:</span>
<span class="sd">        incoming_neutrons (list or array): Incoming neutron flux readings.</span>
<span class="sd">        incoming_Ref (float): Reference incoming neutron flux. Baseline incoming neutron flux.</span>
<span class="sd">        fill_na (float): Value to fill missing data. If None, missing data remains as NaN.</span>
<span class="sd">        Rc_method (str): Optional to correct for differences in cutoff rigidity between the site and the reference station. Possible values are &#39;McJannetandDesilets2023&#39; or &#39;Hawdonetal2014&#39;. If None, no correction is performed.</span>
<span class="sd">        Rc_site (float): Cutoff rigidity at the monitoring site.</span>
<span class="sd">        site_atmdepth (float): Atmospheric depth at the monitoring site.</span>
<span class="sd">        Rc_ref (float): Cutoff rigidity at the reference station.</span>
<span class="sd">        ref_atmdepth (float): Atmospheric depth at the reference station.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): fi correction factor.</span>

<span class="sd">    References:</span>
<span class="sd">        Hawdon, A., D. McJannet, and J. Wallace (2014), Calibration and correction procedures for cosmic-ray neutron soil moisture probes located across Australia, Water Resour. Res., 50, 5029–5043, doi:10.1002/2013WR015138.</span>

<span class="sd">        M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</span>

<span class="sd">        McJannet, D. L., &amp; Desilets, D. (2023). Incoming neutron flux corrections for cosmic-ray soil and snow sensors using the global neutron monitor network. Water Resources Research, 59, e2022WR033889. https://doi.org/10.1029/2022WR033889</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">incoming_Ref</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incoming_neutrons</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="n">incoming_Ref</span> <span class="o">=</span> <span class="n">incoming_neutrons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Reference incoming neutron flux not provided. Using first value of incoming neutron flux.&#39;</span><span class="p">)</span>
    <span class="n">fi</span> <span class="o">=</span> <span class="n">incoming_neutrons</span> <span class="o">/</span> <span class="n">incoming_Ref</span>

    <span class="k">if</span> <span class="n">Rc_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Rc_ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Reference cutoff rigidity not provided.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Rc_site</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Site cutoff rigidity not provided.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Rc_method</span> <span class="o">==</span> <span class="s1">&#39;McJannetandDesilets2023&#39;</span><span class="p">:</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="n">location_factor</span><span class="p">(</span><span class="n">site_atmdepth</span><span class="p">,</span> <span class="n">Rc_site</span><span class="p">,</span> <span class="n">ref_atmdepth</span><span class="p">,</span> <span class="n">Rc_ref</span><span class="p">)</span>
            <span class="n">fi</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">tau</span> <span class="o">*</span> <span class="n">fi</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tau</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">Rc_method</span> <span class="o">==</span> <span class="s1">&#39;Hawdonetal2014&#39;</span><span class="p">:</span>
            <span class="n">Rc_corr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.075</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rc_site</span> <span class="o">-</span> <span class="n">Rc_ref</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="n">fi</span> <span class="o">=</span> <span class="p">(</span><span class="n">fi</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rc_corr</span> <span class="o">+</span> <span class="mf">1.0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Cutoff rigidity method not found. Valid options are: McJannetandDesilets2023, Hawdonetal2014.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fill_na</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fi</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">fill_na</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Use a value of 1 for days without data</span>

    <span class="k">return</span> <span class="n">fi</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.correction_pressure" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_pressure</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="n">Pref</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Correction factor for atmospheric pressure.</p>
<p>This function corrects neutron counts for atmospheric pressure using the method described in Andreasen et al. (2017).
The correction is performed using the following equation:</p>
<p>$$
C_{corrected} = \frac{C_{raw}}{fp}
$$</p>
<p>where:</p>
<ul>
<li>Ccorrected: corrected neutron counts</li>
<li>Craw: raw neutron counts</li>
<li>fp: pressure correction factor</li>
</ul>
<p>$$
fp = e^{\frac{P_{ref} - P}{L}}
$$</p>
<p>where:</p>
<ul>
<li>P: atmospheric pressure</li>
<li>Pref: reference atmospheric pressure</li>
<li>L: Atmospheric attenuation coefficient.</li>
</ul>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pressure</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric pressure readings. Long-term average pressure is recommended.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Pref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference atmospheric pressure.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>L</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric attenuation coefficient.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>fp pressure correction factor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., and Rosolem, R.: COSMOS: the COsmic-ray Soil Moisture Observing System, Hydrol. Earth Syst. Sci., 16, 4079–4099, https://doi.org/10.5194/hess-16-4079-2012, 2012.</p>
<p>M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_pressure</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="n">Pref</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Correction factor for atmospheric pressure.</span>

<span class="sd">    This function corrects neutron counts for atmospheric pressure using the method described in Andreasen et al. (2017).</span>
<span class="sd">    The correction is performed using the following equation:</span>

<span class="sd">    $$</span>
<span class="sd">    C_{corrected} = \frac{C_{raw}}{fp}</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - Ccorrected: corrected neutron counts</span>
<span class="sd">    - Craw: raw neutron counts</span>
<span class="sd">    - fp: pressure correction factor</span>

<span class="sd">    $$</span>
<span class="sd">    fp = e^{\frac{P_{ref} - P}{L}}</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - P: atmospheric pressure</span>
<span class="sd">    - Pref: reference atmospheric pressure</span>
<span class="sd">    - L: Atmospheric attenuation coefficient.</span>


<span class="sd">    Args:</span>
<span class="sd">        pressure (list or array): Atmospheric pressure readings. Long-term average pressure is recommended.</span>
<span class="sd">        Pref (float): Reference atmospheric pressure.</span>
<span class="sd">        L (float): Atmospheric attenuation coefficient.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): fp pressure correction factor.</span>

<span class="sd">    References:</span>
<span class="sd">        Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., and Rosolem, R.: COSMOS: the COsmic-ray Soil Moisture Observing System, Hydrol. Earth Syst. Sci., 16, 4079–4099, https://doi.org/10.5194/hess-16-4079-2012, 2012.</span>

<span class="sd">        M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Compute pressure correction factor</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">Pref</span> <span class="o">-</span> <span class="n">pressure</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span>  <span class="c1"># Zreda et al. 2017 Eq 5.</span>

    <span class="k">return</span> <span class="n">fp</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.correction_road" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_road</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">theta_N</span><span class="p">,</span> <span class="n">road_width</span><span class="p">,</span> <span class="n">road_distance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_road</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">p2</span><span class="o">=</span><span class="mf">1.06</span><span class="p">,</span> <span class="n">p3</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">p4</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span> <span class="n">p6</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">p7</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">p8</span><span class="o">=</span><span class="mf">2.7</span><span class="p">,</span> <span class="n">p9</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to correct for road effects in neutron counts.
following the approach described in Schrön et al., 2018.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of ephithermal neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>theta_N</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Volumetric water content of the soil estimated from the uncorrected neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>road_width</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Width of the road in m.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>road_distance</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Distance of the road from the sensor in m. Default is 0.0.</p>
            </div>
          </td>
          <td>
                <code>0.0</code>
          </td>
        </tr>
        <tr>
          <td><code>theta_road</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Volumetric water content of the road. Default is 0.12.</p>
            </div>
          </td>
          <td>
                <code>0.12</code>
          </td>
        </tr>
        <tr>
          <td><code>p0-p9</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameters of the correction function. Default values are from Schrön et al., 2018.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of corrected neutron counts for road effects.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Schrön,M.,Rosolem,R.,Köhli,M., Piussi,L.,Schröter,I.,Iwema,J.,etal. (2018).Cosmic-ray neutron rover surveys
of field soil moisture and the influence of roads.WaterResources Research,54,6441–6459.
https://doi. org/10.1029/2017WR021719</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_road</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">theta_N</span><span class="p">,</span> <span class="n">road_width</span><span class="p">,</span> <span class="n">road_distance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_road</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">p2</span><span class="o">=</span><span class="mf">1.06</span><span class="p">,</span> <span class="n">p3</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">p4</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span> <span class="n">p6</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">p7</span><span class="o">=</span><span class="mf">1.10</span><span class="p">,</span> <span class="n">p8</span><span class="o">=</span><span class="mf">2.70</span><span class="p">,</span> <span class="n">p9</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to correct for road effects in neutron counts.</span>
<span class="sd">    following the approach described in Schrön et al., 2018.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (array or pd.Series or pd.DataFrame): Array of ephithermal neutron counts.</span>
<span class="sd">        theta_N (float): Volumetric water content of the soil estimated from the uncorrected neutron counts.</span>
<span class="sd">        road_width (float): Width of the road in m.</span>
<span class="sd">        road_distance (float): Distance of the road from the sensor in m. Default is 0.0.</span>
<span class="sd">        theta_road (float): Volumetric water content of the road. Default is 0.12.</span>
<span class="sd">        p0-p9 (float): Parameters of the correction function. Default values are from Schrön et al., 2018.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Array of corrected neutron counts for road effects.</span>

<span class="sd">    References:</span>
<span class="sd">        Schrön,M.,Rosolem,R.,Köhli,M., Piussi,L.,Schröter,I.,Iwema,J.,etal. (2018).Cosmic-ray neutron rover surveys</span>
<span class="sd">        of field soil moisture and the influence of roads.WaterResources Research,54,6441–6459.</span>
<span class="sd">        https://doi. org/10.1029/2017WR021719</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p1</span> <span class="o">*</span> <span class="n">road_width</span><span class="p">))</span>
    <span class="n">F2</span> <span class="o">=</span> <span class="o">-</span><span class="n">p2</span> <span class="o">-</span> <span class="n">p3</span> <span class="o">*</span> <span class="n">theta_road</span> <span class="o">-</span> <span class="p">((</span><span class="n">p4</span> <span class="o">+</span> <span class="n">theta_road</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta_N</span><span class="p">))</span>
    <span class="n">F3</span> <span class="o">=</span> <span class="n">p6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p7</span> <span class="o">*</span> <span class="p">(</span><span class="n">road_width</span> <span class="o">**</span> <span class="o">-</span><span class="n">p8</span><span class="p">)</span> <span class="o">*</span> <span class="n">road_distance</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p6</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p9</span> <span class="o">*</span> <span class="n">road_distance</span><span class="p">)</span>

    <span class="n">C_roads</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">F1</span> <span class="o">*</span> <span class="n">F2</span> <span class="o">*</span> <span class="n">F3</span>

    <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">/</span> <span class="n">C_roads</span>

    <span class="k">return</span> <span class="n">corrected_counts</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.counts_to_vwc" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">counts_to_vwc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">Wsoc</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to convert corrected and filtered neutron counts into volumetric water content.</p>
<p>This method implements soil moisture estimation using the non-linear relationship between neutron count and soil volumetric water content following the approach described in Desilets et al., 2010.</p>
<p>$\theta(N) =\frac{a_0}{(\frac{N}{N_0}) - a_1} - a_2 $</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of corrected and filtered neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>N0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Device-specific neutron calibration constant.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Wlat</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Lattice water content.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Wsoc</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil organic carbon content.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bulk_density</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil bulk density.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>a0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameter given in Zreda et al., 2012. Default is 0.0808.</p>
            </div>
          </td>
          <td>
                <code>0.0808</code>
          </td>
        </tr>
        <tr>
          <td><code>a1</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameter given in Zreda et al., 2012. Default is 0.372.</p>
            </div>
          </td>
          <td>
                <code>0.372</code>
          </td>
        </tr>
        <tr>
          <td><code>a2</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameter given in Zreda et al., 2012. Default is 0.115.</p>
            </div>
          </td>
          <td>
                <code>0.115</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Volumetric water content in m3 m-3.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Desilets, D., M. Zreda, and T.P.A. Ferré. 2010. Nature’s neutron probe:
Land surface hydrology at an elusive scale with cosmic rays. Water Resour. Res. 46:W11505.
doi.org/10.1029/2009WR008726</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">counts_to_vwc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">Wsoc</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to convert corrected and filtered neutron counts into volumetric water content.</span>

<span class="sd">    This method implements soil moisture estimation using the non-linear relationship between neutron count and soil volumetric water content following the approach described in Desilets et al., 2010.</span>

<span class="sd">    $\theta(N) =\frac{a_0}{(\frac{N}{N_0}) - a_1} - a_2 $</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (array or pd.Series or pd.DataFrame): Array of corrected and filtered neutron counts.</span>
<span class="sd">        N0 (float): Device-specific neutron calibration constant.</span>
<span class="sd">        Wlat (float): Lattice water content.</span>
<span class="sd">        Wsoc (float): Soil organic carbon content.</span>
<span class="sd">        bulk_density (float): Soil bulk density.</span>
<span class="sd">        a0 (float): Parameter given in Zreda et al., 2012. Default is 0.0808.</span>
<span class="sd">        a1 (float): Parameter given in Zreda et al., 2012. Default is 0.372.</span>
<span class="sd">        a2 (float): Parameter given in Zreda et al., 2012. Default is 0.115.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Volumetric water content in m3 m-3.</span>

<span class="sd">    References:</span>
<span class="sd">        Desilets, D., M. Zreda, and T.P.A. Ferré. 2010. Nature’s neutron probe:</span>
<span class="sd">        Land surface hydrology at an elusive scale with cosmic rays. Water Resour. Res. 46:W11505.</span>
<span class="sd">        doi.org/10.1029/2009WR008726</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert neutron counts into vwc</span>
    <span class="n">vwc</span> <span class="o">=</span> <span class="p">(</span><span class="n">a0</span> <span class="o">/</span> <span class="p">(</span><span class="n">counts</span> <span class="o">/</span> <span class="n">N0</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">-</span> <span class="n">Wlat</span> <span class="o">-</span> <span class="n">Wsoc</span><span class="p">)</span> <span class="o">*</span> <span class="n">bulk_density</span>
    <span class="k">return</span> <span class="n">vwc</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.cutoff_rigidity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">cutoff_rigidity</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the approximate cutoff rigidity for any point on Earth according to the
tabulated data of Smart and Shea, 2019. The returned value can be used to select the appropriate
neutron monitor station to estimate the cosmic-ray neutron intensity at the location of interest.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>lat</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Geographic latitude in decimal degrees. Value in range -90 to 90</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lon</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Geographic longitude in decimal degrees. Values in range from 0 to 360.
Typical negative longitudes in the west hemisphere will fall in the range 180 to 360.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity in GV. Error is about +/- 0.3 GV</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <p>Estimate the cutoff rigidity for Newark, NJ, US</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">zq</span> <span class="o">=</span> <span class="n">cutoff_rigidity</span><span class="p">(</span><span class="mf">39.68</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.75</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">zq</span><span class="p">)</span>
<span class="go">2.52 GV (Value from NMD is 2.40 GV)</span>
</code></pre></div>

<details class="references" open>
  <summary>References</summary>
  <p>Hawdon, A., McJannet, D., &amp; Wallace, J. (2014). Calibration and correction procedures
for cosmic‐ray neutron soil moisture probes located across Australia. Water Resources Research,
50(6), 5029-5043.</p>
<p>Smart, D. &amp; Shea, Matthew. (2001). Geomagnetic Cutoff Rigidity Computer Program:
Theory, Software Description and Example. NASA STI/Recon Technical Report N.</p>
<p>Shea, M. A., &amp; Smart, D. F. (2019, July). Re-examination of the First Five Ground-Level Events.
In International Cosmic Ray Conference (ICRC2019) (Vol. 36, p. 1149).</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cutoff_rigidity</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to estimate the approximate cutoff rigidity for any point on Earth according to the</span>
<span class="sd">    tabulated data of Smart and Shea, 2019. The returned value can be used to select the appropriate</span>
<span class="sd">    neutron monitor station to estimate the cosmic-ray neutron intensity at the location of interest.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (float): Geographic latitude in decimal degrees. Value in range -90 to 90</span>
<span class="sd">        lon (float): Geographic longitude in decimal degrees. Values in range from 0 to 360.</span>
<span class="sd">            Typical negative longitudes in the west hemisphere will fall in the range 180 to 360.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Cutoff rigidity in GV. Error is about +/- 0.3 GV</span>

<span class="sd">    Examples:</span>
<span class="sd">        Estimate the cutoff rigidity for Newark, NJ, US</span>

<span class="sd">        &gt;&gt;&gt; zq = cutoff_rigidity(39.68, -75.75)</span>
<span class="sd">        &gt;&gt;&gt; print(zq)</span>
<span class="sd">        2.52 GV (Value from NMD is 2.40 GV)</span>

<span class="sd">    References:</span>
<span class="sd">        Hawdon, A., McJannet, D., &amp; Wallace, J. (2014). Calibration and correction procedures</span>
<span class="sd">        for cosmic‐ray neutron soil moisture probes located across Australia. Water Resources Research,</span>
<span class="sd">        50(6), 5029-5043.</span>

<span class="sd">        Smart, D. &amp; Shea, Matthew. (2001). Geomagnetic Cutoff Rigidity Computer Program:</span>
<span class="sd">        Theory, Software Description and Example. NASA STI/Recon Technical Report N.</span>

<span class="sd">        Shea, M. A., &amp; Smart, D. F. (2019, July). Re-examination of the First Five Ground-Level Events.</span>
<span class="sd">        In International Cosmic Ray Conference (ICRC2019) (Vol. 36, p. 1149).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xq</span> <span class="o">=</span> <span class="n">lon</span>
    <span class="n">yq</span> <span class="o">=</span> <span class="n">lat</span>

    <span class="k">if</span> <span class="n">xq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">xq</span> <span class="o">=</span> <span class="n">xq</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">180</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">cutoff_rigidity</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">zq</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">xq</span><span class="p">,</span> <span class="n">yq</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">zq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.euclidean_distance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">euclidean_distance</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that computes the Euclidean distance between one point
in space and one or more points.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>px</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>x projected coordinate of the point.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>py</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>y projected coordinate of the point.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>(list, ndarray, <span title="pandas.series">series</span>)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>vector of x projected coordinates.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>(list, ndarray, <span title="pandas.series">series</span>)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>vector of y projected coordinates.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ndarray</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Numpy array of distances from the point (px,py) to all the points in x and y vectors.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">euclidean_distance</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that computes the Euclidean distance between one point</span>
<span class="sd">    in space and one or more points.</span>

<span class="sd">    Args:</span>
<span class="sd">        px (float): x projected coordinate of the point.</span>
<span class="sd">        py (float): y projected coordinate of the point.</span>
<span class="sd">        x (list, ndarray, pandas.series): vector of x projected coordinates.</span>
<span class="sd">        y (list, ndarray, pandas.series): vector of y projected coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (ndarray): Numpy array of distances from the point (px,py) to all the points in x and y vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">px</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">py</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.exp_filter" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exp_filter</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Exponential filter to estimate soil moisture in the rootzone from surface observtions.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sm</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil moisture in mm of water for the top layer of the soil profile.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Characteristic time length in the same units as the measurement interval.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>sm_subsurface</code></td>          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subsurface soil moisture in the same units as the input.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Albergel, C., Rüdiger, C., Pellarin, T., Calvet, J.C., Fritz, N., Froissard, F., Suquia, D., Petitpa, A., Piguet, B. and Martin, E., 2008.
From near-surface to root-zone soil moisture using an exponential filter: an assessment of the method based on in-situ observations and model
simulations. Hydrology and Earth System Sciences, 12(6), pp.1323-1337.</p>
<p>Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.
Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.</p>
<p>Rossini, P. and Patrignani, A., 2021. Predicting rootzone soil moisture from surface observations in cropland using an exponential filter.
Soil Science Society of America Journal.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">exp_filter</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exponential filter to estimate soil moisture in the rootzone from surface observtions.</span>

<span class="sd">    Args:</span>
<span class="sd">        sm (list or array): Soil moisture in mm of water for the top layer of the soil profile.</span>
<span class="sd">        T (float): Characteristic time length in the same units as the measurement interval.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sm_subsurface (list or array): Subsurface soil moisture in the same units as the input.</span>

<span class="sd">    References:</span>
<span class="sd">        Albergel, C., Rüdiger, C., Pellarin, T., Calvet, J.C., Fritz, N., Froissard, F., Suquia, D., Petitpa, A., Piguet, B. and Martin, E., 2008.</span>
<span class="sd">        From near-surface to root-zone soil moisture using an exponential filter: an assessment of the method based on in-situ observations and model</span>
<span class="sd">        simulations. Hydrology and Earth System Sciences, 12(6), pp.1323-1337.</span>

<span class="sd">        Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.</span>
<span class="sd">        Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.</span>

<span class="sd">        Rossini, P. and Patrignani, A., 2021. Predicting rootzone soil moisture from surface observations in cropland using an exponential filter.</span>
<span class="sd">        Soil Science Society of America Journal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Parameters</span>
    <span class="n">t_delta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">sm_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
    <span class="n">sm_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">sm</span> <span class="o">-</span> <span class="n">sm_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sm_max</span> <span class="o">-</span> <span class="n">sm_min</span><span class="p">)</span>

    <span class="c1"># Pre-allocate soil water index array and recursive constant K</span>
    <span class="n">SWI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Initial conditions</span>
    <span class="n">SWI</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Values from 2 to N</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">SWI</span><span class="p">)):</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_delta</span> <span class="o">/</span> <span class="n">T</span><span class="p">))</span>
            <span class="n">SWI</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">SWI</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">SWI</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>

    <span class="c1"># Rootzone storage</span>
    <span class="n">sm_subsurface</span> <span class="o">=</span> <span class="n">SWI</span> <span class="o">*</span> <span class="p">(</span><span class="n">sm_max</span> <span class="o">-</span> <span class="n">sm_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">sm_min</span>

    <span class="k">return</span> <span class="n">sm_subsurface</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.fill_missing_timestamps" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fill_missing_timestamps</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">round_timestamp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Helper function to fill rows with missing timestamps in datetime record. Rows are filled with NaN values.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pandas DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamp_col</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Column with the timestamp. Must be in datetime format. Default column name is 'timestamp'.</p>
            </div>
          </td>
          <td>
                <code>&#39;timestamp&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>freq</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Timestamp frequency. 'H' for hourly, 'M' for minute, or None. Can also use '3H' for a 3 hour frequency. Default is 'H'.</p>
            </div>
          </td>
          <td>
                <code>&#39;H&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>round_timestamp</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to round timestamps to the nearest frequency. Default is True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Prints the missing timestamps added to the DatFrame.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>DataFrame with filled missing timestamps.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fill_missing_timestamps</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">round_timestamp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to fill rows with missing timestamps in datetime record. Rows are filled with NaN values.</span>

<span class="sd">     Args:</span>
<span class="sd">         df (pandas.DataFrame): Pandas DataFrame.</span>
<span class="sd">         timestamp_col (str, optional): Column with the timestamp. Must be in datetime format. Default column name is &#39;timestamp&#39;.</span>
<span class="sd">         freq (str, optional): Timestamp frequency. &#39;H&#39; for hourly, &#39;M&#39; for minute, or None. Can also use &#39;3H&#39; for a 3 hour frequency. Default is &#39;H&#39;.</span>
<span class="sd">         round_timestamp (bool, optional): Whether to round timestamps to the nearest frequency. Default is True.</span>
<span class="sd">         verbose (bool, optional): Prints the missing timestamps added to the DatFrame.</span>

<span class="sd">     Returns:</span>
<span class="sd">         (pandas.DataFrame): DataFrame with filled missing timestamps.</span>

<span class="sd">     &quot;&quot;&quot;</span>

    <span class="c1"># Check format of timestamp column</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;timestamp_col must be datetime64. Use `pd.to_datetime()` to fix this issue.&#39;</span><span class="p">)</span>

    <span class="c1"># Round timestamps to nearest frequency. This steps must preced the filling of rows.</span>
    <span class="k">if</span> <span class="n">round_timestamp</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>

    <span class="c1"># Fill in rows with missing timestamps</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">date_range</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_range</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding missing date:&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="n">new_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">timestamp_col</span><span class="p">:</span> <span class="n">date</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># By default fills columns with np.nan</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">new_line</span><span class="p">])</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">timestamp_col</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Notify user about the number of rows that have been removed</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added a total of </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2"> missing timestamps.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.find_neutron_monitor" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">find_neutron_monitor</span><span class="p">(</span><span class="n">Rc</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Search for potential reference neutron monitoring stations based on cutoff rigidity.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>Rc</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity in GV. Values in range 1.0 to 3.0 GV.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>start_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Start date for the period of interest.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>end_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>End date for the period of interest.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, print a expanded output of the incoming neutron flux data.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of top five stations with closes cutoff rigidity.
User needs to select station according to site altitude.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">crnpy</span> <span class="kn">import</span> <span class="n">crnpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Rc</span> <span class="o">=</span> <span class="mf">2.40</span> <span class="c1"># 2.40 Newark, NJ, US</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crnpy</span><span class="o">.</span><span class="n">find_neutron_monitor</span><span class="p">(</span><span class="n">Rc</span><span class="p">)</span>
<span class="go">Select a station with an altitude similar to that of your location. For more information go to: &#39;https://www.nmdb.eu/nest/help.php#helpstations</span>
</code></pre></div>
    <p>Your cutoff rigidity is 2.4 GV
        STID                          NAME     R  Altitude_m
40   NEWK                        Newark  2.40          50
33   MOSC                        Moscow  2.43         200
27   KIEL                          Kiel  2.36          54
28  KIEL2                        KielRT  2.36          54
31   MCRL  Mobile Cosmic Ray Laboratory  2.46         200
32   MGDN                       Magadan  2.10         220
42   NVBK                   Novosibirsk  2.91         163
26   KGSN                      Kingston  1.88          65
9    CLMX                        Climax  3.00        3400
57   YKTK                       Yakutsk  1.65         105</p>

<details class="references" open>
  <summary>References</summary>
  <p>https://www.nmdb.eu/nest/help.php#helpstations</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_neutron_monitor</span><span class="p">(</span><span class="n">Rc</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for potential reference neutron monitoring stations based on cutoff rigidity.</span>

<span class="sd">    Args:</span>
<span class="sd">        Rc (float): Cutoff rigidity in GV. Values in range 1.0 to 3.0 GV.</span>
<span class="sd">        start_date (datetime): Start date for the period of interest.</span>
<span class="sd">        end_date (datetime): End date for the period of interest.</span>
<span class="sd">        verbose (bool): If True, print a expanded output of the incoming neutron flux data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): List of top five stations with closes cutoff rigidity.</span>
<span class="sd">            User needs to select station according to site altitude.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from crnpy import crnpy</span>
<span class="sd">        &gt;&gt;&gt; Rc = 2.40 # 2.40 Newark, NJ, US</span>
<span class="sd">        &gt;&gt;&gt; crnpy.find_neutron_monitor(Rc)</span>
<span class="sd">        Select a station with an altitude similar to that of your location. For more information go to: &#39;https://www.nmdb.eu/nest/help.php#helpstations</span>

<span class="sd">        Your cutoff rigidity is 2.4 GV</span>
<span class="sd">                STID                          NAME     R  Altitude_m</span>
<span class="sd">        40   NEWK                        Newark  2.40          50</span>
<span class="sd">        33   MOSC                        Moscow  2.43         200</span>
<span class="sd">        27   KIEL                          Kiel  2.36          54</span>
<span class="sd">        28  KIEL2                        KielRT  2.36          54</span>
<span class="sd">        31   MCRL  Mobile Cosmic Ray Laboratory  2.46         200</span>
<span class="sd">        32   MGDN                       Magadan  2.10         220</span>
<span class="sd">        42   NVBK                   Novosibirsk  2.91         163</span>
<span class="sd">        26   KGSN                      Kingston  1.88          65</span>
<span class="sd">        9    CLMX                        Climax  3.00        3400</span>
<span class="sd">        57   YKTK                       Yakutsk  1.65         105</span>

<span class="sd">    References:</span>
<span class="sd">        https://www.nmdb.eu/nest/help.php#helpstations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load file with list of neutron monitoring stations</span>
    <span class="n">stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">neutron_detectors</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;STID&quot;</span><span class="p">,</span> <span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;Altitude_m&quot;</span><span class="p">])</span>

    <span class="c1"># Sort stations by closest cutoff rigidity</span>
    <span class="n">idx_R</span> <span class="o">=</span> <span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Rc</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stations</span><span class="p">[</span><span class="s2">&quot;Period available&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">station</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_R</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;STID&quot;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="s2">&quot;Period available&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No stations available for the selected period!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stations</span> <span class="o">=</span> <span class="n">stations</span><span class="p">[</span><span class="n">stations</span><span class="p">[</span><span class="s2">&quot;Period available&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
            <span class="n">idx_R</span> <span class="o">=</span> <span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Rc</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">idx_R</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Print results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select a station with an altitude similar to that of your location. For more information go to: &#39;https://www.nmdb.eu/nest/help.php#helpstations&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your cutoff rigidity is </span><span class="si">{</span><span class="n">Rc</span><span class="si">}</span><span class="s2"> GV&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.get_incoming_neutron_flux" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">utc_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">expand_window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to retrieve neutron flux from the Neutron Monitor Database.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>start_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Start date of the time series.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>end_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>End date of the time series.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>station</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Neutron Monitor station to retrieve data from.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>utc_offset</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTC offset in hours. Default is 0.</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>expand_window</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of hours to expand the time window to retrieve extra data. Default is 0.</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Print information about the request. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Neutron flux in counts per hour and timestamps.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Documentation available:https://www.nmdb.eu/nest/help.php#howto</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">utc_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">expand_window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to retrieve neutron flux from the Neutron Monitor Database.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_date (datetime): Start date of the time series.</span>
<span class="sd">        end_date (datetime): End date of the time series.</span>
<span class="sd">        station (str): Neutron Monitor station to retrieve data from.</span>
<span class="sd">        utc_offset (int): UTC offset in hours. Default is 0.</span>
<span class="sd">        expand_window (int): Number of hours to expand the time window to retrieve extra data. Default is 0.</span>
<span class="sd">        verbose (bool): Print information about the request. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Neutron flux in counts per hour and timestamps.</span>

<span class="sd">    References:</span>
<span class="sd">        Documentation available:https://www.nmdb.eu/nest/help.php#howto</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Example: get_incoming_neutron_flux(station=&#39;IRKT&#39;,start_date=&#39;2020-04-10 11:00:00&#39;,end_date=&#39;2020-06-18 17:00:00&#39;)</span>
    <span class="c1"># Template url = &#39;http://nest.nmdb.eu/draw_graph.php?formchk=1&amp;stations[]=KERG&amp;output=ascii&amp;tabchoice=revori&amp;dtype=corr_for_efficiency&amp;date_choice=bydate&amp;start_year=2009&amp;start_month=09&amp;start_day=01&amp;start_hour=00&amp;start_min=00&amp;end_year=2009&amp;end_month=09&amp;end_day=05&amp;end_hour=23&amp;end_min=59&amp;yunits=0&#39;</span>

    <span class="c1"># Expand the time window by 1 hour to ensure an extra observation is included in the request.</span>
    <span class="n">start_date</span> <span class="o">-=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">expand_window</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">expand_window</span><span class="p">)</span>

    <span class="c1"># Convert local time to UTC</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">utc_offset</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">utc_offset</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;http://www.nmdb.eu/nest/draw_graph.php?&#39;</span>
    <span class="n">url_par</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;formchk=1&#39;</span><span class="p">,</span>
               <span class="s1">&#39;stations[]=&#39;</span> <span class="o">+</span> <span class="n">station</span><span class="p">,</span>
               <span class="s1">&#39;output=ascii&#39;</span><span class="p">,</span>
               <span class="s1">&#39;tabchoice=revori&#39;</span><span class="p">,</span>
               <span class="s1">&#39;dtype=corr_for_efficiency&#39;</span><span class="p">,</span>
               <span class="s1">&#39;tresolution=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span>
               <span class="s1">&#39;date_choice=bydate&#39;</span><span class="p">,</span>
               <span class="s1">&#39;start_year=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
               <span class="s1">&#39;start_month=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">),</span>
               <span class="s1">&#39;start_day=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="p">),</span>
               <span class="s1">&#39;start_hour=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">hour</span><span class="p">),</span>
               <span class="s1">&#39;start_min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">minute</span><span class="p">),</span>
               <span class="s1">&#39;end_year=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
               <span class="s1">&#39;end_month=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="p">),</span>
               <span class="s1">&#39;end_day=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">day</span><span class="p">),</span>
               <span class="s1">&#39;end_hour=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">hour</span><span class="p">),</span>
               <span class="s1">&#39;end_min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">minute</span><span class="p">),</span>
               <span class="s1">&#39;yunits=0&#39;</span><span class="p">]</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url_par</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieving data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="c1"># Subtract 1 hour to restore the last date included in the request.</span>
    <span class="n">end_date</span> <span class="o">-=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1H&#39;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;RCORR_E</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;Total&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df_flux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;counts&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error retrieving data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Check if all values from selected detector are NaN. If yes, warn the user</span>
    <span class="k">if</span> <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Data for selected neutron detectors appears to be unavailable for the selected period&#39;</span><span class="p">)</span>

    <span class="c1"># Convert timestamp to datetime and apply UTC offset</span>
    <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
    <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">utc_offset</span><span class="p">)</span>

    <span class="c1"># Print acknowledgement to inform users about restrictions and to acknowledge the NMDB database</span>
    <span class="n">acknowledgement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Data retrieved via NMDB are the property of the individual data providers. These data are free for non commercial</span>
<span class="s2">use to within the restriction imposed by the providers. If you use such data for your research or applications, please acknowledge</span>
<span class="s2">the origin by a sentence like &#39;We acknowledge the NMDB database (www.nmdb.eu) founded under the European Union&#39;s FP7 programme </span>
<span class="s2">(contract no. 213007), and the PIs of individual neutron monitors at: IGY Jungfraujoch </span>
<span class="s2">(Physikalisches Institut, University of Bern, Switzerland)&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">df_flux</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.get_reference_neutron_flux" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_reference_neutron_flux</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2011-05-01&#39;</span><span class="p">))</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to retrieve reference neutron flux from the Neutron Monitor Database. Default date is 2011-05-01, following previous studies (Zreda et a., 2012, Hawdon et al., 2014, Bogena et al., 2022).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>station</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Neutron Monitor station to retrieve data from.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Date of the reference neutron flux. Default is 2011-05-01.</p>
            </div>
          </td>
          <td>
                <code><span title="pandas.to_datetime">to_datetime</span>(&#39;2011-05-01&#39;)</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference neutron flux in counts per hour.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., &amp; Rosolem, R. (2012). COSMOS: The cosmic-ray soil moisture observing system. Hydrology and Earth System Sciences, 16(11), 4079-4099.</p>
<p>Hawdon, A., McJannet, D., &amp; Wallace, J. (2014). Calibration and correction procedures for cosmic‐ray neutron soil moisture probes located across Australia. Water Resources Research, 50(6), 5029-5043.</p>
<p>Bogena, H. R., Schrön, M., Jakobi, J., Ney, P., Zacharias, S., Andreasen, M., ... &amp; Vereecken, H. (2022). COSMOS-Europe: a European network of cosmic-ray neutron soil moisture sensors. Earth System Science Data, 14(3), 1125-1151.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_reference_neutron_flux</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2011-05-01&quot;</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to retrieve reference neutron flux from the Neutron Monitor Database. Default date is 2011-05-01, following previous studies (Zreda et a., 2012, Hawdon et al., 2014, Bogena et al., 2022).</span>

<span class="sd">    Args:</span>
<span class="sd">        station (str): Neutron Monitor station to retrieve data from.</span>
<span class="sd">        date (datetime): Date of the reference neutron flux. Default is 2011-05-01.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Reference neutron flux in counts per hour.</span>

<span class="sd">    References:</span>
<span class="sd">        Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., &amp; Rosolem, R. (2012). COSMOS: The cosmic-ray soil moisture observing system. Hydrology and Earth System Sciences, 16(11), 4079-4099.</span>

<span class="sd">        Hawdon, A., McJannet, D., &amp; Wallace, J. (2014). Calibration and correction procedures for cosmic‐ray neutron soil moisture probes located across Australia. Water Resources Research, 50(6), 5029-5043.</span>

<span class="sd">        Bogena, H. R., Schrön, M., Jakobi, J., Ney, P., Zacharias, S., Andreasen, M., ... &amp; Vereecken, H. (2022). COSMOS-Europe: a European network of cosmic-ray neutron soil moisture sensors. Earth System Science Data, 14(3), 1125-1151.</span>

<span class="sd">&quot;&quot;&quot;</span>

    <span class="c1"># Get flux for 2011-05-01</span>
    <span class="n">df_flux</span> <span class="o">=</span> <span class="n">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">),</span> <span class="n">station</span><span class="o">=</span><span class="n">station</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">df_flux</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference neutron flux for </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2"> not available. Returning NaN.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.idw" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">idw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to interpolate data using inverse distance weight.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM x coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM y coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Values to be interpolated.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>X_pred</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM x coordinates where z values need to be predicted.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Y_pred</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM y coordinates where z values need to be predicted.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>neighborhood</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Only points within this radius in meters are considered for the interpolation.</p>
            </div>
          </td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>p</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Exponent of the inverse distance weight formula. Typically, p=1 or p=2.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Interpolated values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p><a href="https://en.wikipedia.org/wiki/Inverse_distance_weighting">https://en.wikipedia.org/wiki/Inverse_distance_weighting</a></p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">idw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to interpolate data using inverse distance weight.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (list or array): UTM x coordinates in meters.</span>
<span class="sd">        y (list or array): UTM y coordinates in meters.</span>
<span class="sd">        z (list or array): Values to be interpolated.</span>
<span class="sd">        X_pred (list or array): UTM x coordinates where z values need to be predicted.</span>
<span class="sd">        Y_pred (list or array): UTM y coordinates where z values need to be predicted.</span>
<span class="sd">        neighborhood (float): Only points within this radius in meters are considered for the interpolation.</span>
<span class="sd">        p (int): Exponent of the inverse distance weight formula. Typically, p=1 or p=2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array): Interpolated values.</span>

<span class="sd">    References:</span>
<span class="sd">        [https://en.wikipedia.org/wiki/Inverse_distance_weighting](https://en.wikipedia.org/wiki/Inverse_distance_weighting)</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Flatten arrays to handle 1D and 2D arrays with the same code</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">X_pred</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># Save shape</span>
    <span class="n">X_pred</span> <span class="o">=</span> <span class="n">X_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">Y_pred</span> <span class="o">=</span> <span class="n">Y_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Pre-allocate output array</span>
    <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">X_pred</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_pred</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="c1"># Distance between current and observed points</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">X_pred</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">Y_pred</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Select points within neighborhood only for interpolation</span>
        <span class="n">idx_neighbors</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">neighborhood</span>

        <span class="c1"># Compute interpolated value at point of interest</span>
        <span class="n">Z_pred</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx_neighbors</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">idx_neighbors</span><span class="p">]</span> <span class="o">**</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">idx_neighbors</span><span class="p">]</span> <span class="o">**</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Z_pred</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.interpolate_2d" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">interpolate_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function for interpolating irregular spatial data into a regular grid.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM x coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM y coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Values to be interpolated.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dx</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pixel width in meters.</p>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>dy</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pixel height in meters.</p>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Interpolation method. One of 'cubic', 'linear', 'nearest', or 'idw'.</p>
            </div>
          </td>
          <td>
                <code>&#39;cubic&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>neighborhood</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Only points within this radius in meters are considered for the interpolation.</p>
            </div>
          </td>
          <td>
                <code>1000</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>x_pred</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>2D array with x coordinates.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y_pred</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>2D array with y coordinates.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>z_pred</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>2D array with interpolated values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p><a href="https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html">https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html</a></p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function for interpolating irregular spatial data into a regular grid.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (list or array): UTM x coordinates in meters.</span>
<span class="sd">        y (list or array): UTM y coordinates in meters.</span>
<span class="sd">        z (list or array): Values to be interpolated.</span>
<span class="sd">        dx (float): Pixel width in meters.</span>
<span class="sd">        dy (float): Pixel height in meters.</span>
<span class="sd">        method (str): Interpolation method. One of &#39;cubic&#39;, &#39;linear&#39;, &#39;nearest&#39;, or &#39;idw&#39;.</span>
<span class="sd">        neighborhood (float): Only points within this radius in meters are considered for the interpolation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        x_pred (array): 2D array with x coordinates.</span>
<span class="sd">        y_pred (array): 2D array with y coordinates.</span>
<span class="sd">        z_pred (array): 2D array with interpolated values.</span>

<span class="sd">    References:</span>
<span class="sd">        [https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html](https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Drop NaN values in x y and z</span>
    <span class="n">idx_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">idx_nan</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">idx_nan</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="o">~</span><span class="n">idx_nan</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">idx_nan</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">, and </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> NaN values were dropped from x, y, and z.&quot;</span><span class="p">)</span>

    <span class="c1"># Create 2D grid for interpolation</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">/</span> <span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">X_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">Nx</span><span class="p">)</span>
    <span class="n">Y_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">Ny</span><span class="p">)</span>
    <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X_vec</span><span class="p">,</span> <span class="n">Y_vec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">]:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;idw&#39;</span><span class="p">:</span>
        <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">idw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">neighborhood</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> does not exist. Provide either &#39;cubic&#39;, &#39;linear&#39;, &#39;nearest&#39;, or &#39;idw&#39;.&quot;</span>

    <span class="k">return</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">Z_pred</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.interpolate_incoming_flux" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">interpolate_incoming_flux</span><span class="p">(</span><span class="n">nmdb_timestamps</span><span class="p">,</span> <span class="n">nmdb_counts</span><span class="p">,</span> <span class="n">crnp_timestamps</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to interpolate incoming neutron flux to match the timestamps of the observations.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nmdb_timestamps</code></td>
          <td>
                <code><span title="pandas.Series">Series</span> or <span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Series or array of timestamps in datetime format from the NMDB</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nmdb_counts</code></td>
          <td>
                <code><span title="pandas.Series">Series</span> or <span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Series or array of incoming neutron flux counts from the NMDB</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>crnp_timestamps</code></td>
          <td>
                <code><span title="pandas.Series">Series</span> or <span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Series or array of timestamps in datetime format from the CRNP device</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Series containing interpolated incoming neutron flux. Length of Series is the same as crnp_timestamps</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_incoming_flux</span><span class="p">(</span><span class="n">nmdb_timestamps</span><span class="p">,</span> <span class="n">nmdb_counts</span><span class="p">,</span> <span class="n">crnp_timestamps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to interpolate incoming neutron flux to match the timestamps of the observations.</span>

<span class="sd">    Args:</span>
<span class="sd">        nmdb_timestamps (pd.Series or np.array): Series or array of timestamps in datetime format from the NMDB</span>
<span class="sd">        nmdb_counts (pd.Series or np.array): Series or array of incoming neutron flux counts from the NMDB</span>
<span class="sd">        crnp_timestamps (pd.Series or np.array): Series or array of timestamps in datetime format from the CRNP device</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pd.Series): Series containing interpolated incoming neutron flux. Length of Series is the same as crnp_timestamps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a DataFrame from nmdb timestamps and counts</span>
    <span class="n">df_nmdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">nmdb_timestamps</span><span class="p">,</span> <span class="s1">&#39;counts&#39;</span><span class="p">:</span> <span class="n">nmdb_counts</span><span class="p">})</span>

    <span class="c1"># Set the Timestamp column as the index</span>
    <span class="n">df_nmdb</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Reindex the DataFrame to the timestamps from the CRNP device using the nearest method</span>
    <span class="c1"># This will match each CRNP timestamp with the nearest NMDB timestamp</span>
    <span class="n">interpolated_flux</span> <span class="o">=</span> <span class="n">df_nmdb</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">crnp_timestamps</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1">#drop NaN values</span>
    <span class="n">interpolated_flux</span> <span class="o">=</span> <span class="n">interpolated_flux</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">interpolated_flux</span><span class="p">)]</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">interpolated_flux</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">crnp_timestamps</span><span class="p">),</span> <span class="s2">&quot;Length of interpolated flux does not match length of CRNP timestamps&quot;</span>

    <span class="k">return</span> <span class="n">interpolated_flux</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.is_outlier" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">is_outlier</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that tests whether values are outliers using a modified moving z-score based on the median absolute difference.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Variable containing only the columns with neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Outlier detection method. One of: range, iqr, moviqr, zscore, movzscore, modified_zscore, and scaled_mad</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>window</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Window size for the moving central tendency. Default is 11.</p>
            </div>
          </td>
          <td>
                <code>11</code>
          </td>
        </tr>
        <tr>
          <td><code>min_val</code></td>
          <td>
                <code>int or float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Minimum value for a reading to be considered valid. Default is None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_val(int</code></td>
          <td>
                <code>or float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Maximum value for a reading to be considered valid. Default is None.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Boolean indicating outliers.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Iglewicz, B. and Hoaglin, D.C., 1993. How to detect and handle outliers (Vol. 16). Asq Press.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_outlier</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that tests whether values are outliers using a modified moving z-score based on the median absolute difference.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (pd.DataFrame or pd.Series): Variable containing only the columns with neutron counts.</span>
<span class="sd">        method (str): Outlier detection method. One of: range, iqr, moviqr, zscore, movzscore, modified_zscore, and scaled_mad</span>
<span class="sd">        window (int, optional): Window size for the moving central tendency. Default is 11.</span>
<span class="sd">        min_val (int or float): Minimum value for a reading to be considered valid. Default is None.</span>
<span class="sd">        max_val(int or float): Maximum value for a reading to be considered valid. Default is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Boolean indicating outliers.</span>

<span class="sd">    References:</span>
<span class="sd">        Iglewicz, B. and Hoaglin, D.C., 1993. How to detect and handle outliers (Vol. 16). Asq Press.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;x must of type pandas.Series&#39;</span><span class="p">)</span>

    <span class="c1"># Separate this method to allow usage together with other methods below</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_val</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
        <span class="n">idx_range_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">min_val</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">idx_range_outliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Apply other methods in addition to a range check</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;iqr&#39;</span><span class="p">:</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
        <span class="n">high_fence</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span><span class="p">)</span>
        <span class="n">low_fence</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span><span class="p">)</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">low_fence</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">high_fence</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;moviqr&#39;</span><span class="p">:</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span><span class="p">)</span>  <span class="c1"># Upper boundary</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span><span class="p">)</span>  <span class="c1"># Lower boundary</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">lb</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">ub</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;zscore&#39;</span><span class="p">:</span>
        <span class="n">zscore</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">zscore</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">zscore</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;movzscore&#39;</span><span class="p">:</span>
        <span class="n">movmean</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">movstd</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">movzscore</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">movmean</span><span class="p">)</span> <span class="o">/</span> <span class="n">movstd</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">movzscore</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">movzscore</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;modified_zscore&#39;</span><span class="p">:</span>
        <span class="c1"># Compute median absolute difference</span>
        <span class="n">movmedian</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
        <span class="n">abs_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">movmedian</span><span class="p">)</span>
        <span class="n">mad</span> <span class="o">=</span> <span class="n">abs_diff</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

        <span class="c1"># Compute modified z-score</span>
        <span class="n">modified_z_score</span> <span class="o">=</span> <span class="mf">0.6745</span> <span class="o">*</span> <span class="n">abs_diff</span> <span class="o">/</span> <span class="n">mad</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">modified_z_score</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">3.5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">modified_z_score</span> <span class="o">&gt;</span> <span class="mf">3.5</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;scaled_mad&#39;</span><span class="p">:</span>
        <span class="c1"># Returns true for elements more than three scaled MAD from the median. </span>
        <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">erfcinv</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">mad</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">median</span><span class="p">))</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">median</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mad</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Outlier detection method not found.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">idx_outliers</span> <span class="o">|</span> <span class="n">idx_range_outliers</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.latlon_to_utm" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">latlon_to_utm</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">utm_zone_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">utm_zone_letter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert geographic coordinates (lat, lon) to projected coordinates (utm) using the Military Grid Reference System.</p>
<p>Function only applies to non-polar coordinates.
If further functionality is required, consider using the utm module. See references for more information.</p>
<p><a class="glightbox" href="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Universal_Transverse_Mercator_zones.svg/1920px-Universal_Transverse_Mercator_zones.svg.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="UTM zones" src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Universal_Transverse_Mercator_zones.svg/1920px-Universal_Transverse_Mercator_zones.svg.png" /></a>
UTM zones on an equirectangular world map with irregular zones in red and New York City's zone highlighted. See <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system#UTM_zones">UTM zones</a> for a full description.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>lat</code></td>
          <td>
                <code>(float, array)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Latitude in decimal degrees.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lon</code></td>
          <td>
                <code>(float, array)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Longitude in decimal degrees.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>utm_zone_number</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM zone number. If None, the zone number is automatically calculated.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>utm_zone_letter</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM zone letter. If None, the zone letter is automatically calculated.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>(float, float, int, str)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tuple of easting, northing, zone number and zone letter. First element is easting, second is northing, third is zone number and fourth is zone letter.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Code adapted from utm module created by Tobias Bieniek (Github username: Turbo87)
<a href="https://github.com/Turbo87/utm">https://github.com/Turbo87/utm</a></p>
<p><a href="https://www.maptools.com/tutorials/grid_zone_details#">https://www.maptools.com/tutorials/grid_zone_details#</a></p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">latlon_to_utm</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">utm_zone_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">utm_zone_letter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert geographic coordinates (lat, lon) to projected coordinates (utm) using the Military Grid Reference System.</span>

<span class="sd">    Function only applies to non-polar coordinates.</span>
<span class="sd">    If further functionality is required, consider using the utm module. See references for more information.</span>

<span class="sd">    ![UTM zones](https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Universal_Transverse_Mercator_zones.svg/1920px-Universal_Transverse_Mercator_zones.svg.png)</span>
<span class="sd">    UTM zones on an equirectangular world map with irregular zones in red and New York City&#39;s zone highlighted. See [UTM zones](https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system#UTM_zones) for a full description.</span>


<span class="sd">    Args:</span>
<span class="sd">        lat (float, array): Latitude in decimal degrees.</span>
<span class="sd">        lon (float, array): Longitude in decimal degrees.</span>
<span class="sd">        utm_zone_number (int): UTM zone number. If None, the zone number is automatically calculated.</span>
<span class="sd">        utm_zone_letter (str): UTM zone letter. If None, the zone letter is automatically calculated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float, float, int, str): Tuple of easting, northing, zone number and zone letter. First element is easting, second is northing, third is zone number and fourth is zone letter.</span>

<span class="sd">    References:</span>
<span class="sd">         Code adapted from utm module created by Tobias Bieniek (Github username: Turbo87)</span>
<span class="sd">         [https://github.com/Turbo87/utm](https://github.com/Turbo87/utm)</span>

<span class="sd">         [https://www.maptools.com/tutorials/grid_zone_details#](https://www.maptools.com/tutorials/grid_zone_details#)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># utm module requires numpy arrays</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">utm_zone_number</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">utm_zone_letter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">zone_number</span><span class="p">,</span> <span class="n">zone_letter</span> <span class="o">=</span> <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">zone_number</span><span class="p">,</span> <span class="n">zone_letter</span> <span class="o">=</span> <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">utm_zone_number</span><span class="p">,</span> <span class="n">utm_zone_letter</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">zone_number</span><span class="p">,</span> <span class="n">zone_letter</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.lattice_water" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">lattice_water</span><span class="p">(</span><span class="n">clay_content</span><span class="p">,</span> <span class="n">total_carbon</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Estimate the amount of water in the lattice of clay minerals.</p>
<table>
<thead>
<tr>
<th style="text-align: center;"><a class="glightbox" href="../img/lattice_water_simple.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="img1" src="../img/lattice_water_simple.png" /></a></th>
<th style="text-align: center;"><a class="glightbox" href="../img/lattice_water_multiple.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="img2" src="../img/lattice_water_multiple.png" /></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">$\omega_{lat} = 0.097 * clay(\%)$</td>
<td style="text-align: center;">$\omega_{lat} = -0.028 + 0.077 * clay(\%) + 0.459 * carbon(\%)$</td>
</tr>
<tr>
<td style="text-align: center;">Linear regression [lattice water (%) as a function of clay (%)] done with data from Kansas Sate University - Soil Water Processes Lab.</td>
<td style="text-align: center;">Multiple linear regression [lattice water (%) as a function of clay (%) and soil carbon (%)] done with data from Soil Water Processes Lab.</td>
</tr>
</tbody>
</table>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>clay_content</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Clay content in the soil in percent.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>total_carbon</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Total carbon content in the soil in percent.
If None, the amount of water is estimated based on clay content only.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Amount of water in the lattice of clay minerals in percent</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">lattice_water</span><span class="p">(</span><span class="n">clay_content</span><span class="p">,</span> <span class="n">total_carbon</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate the amount of water in the lattice of clay minerals.</span>

<span class="sd">    ![img1](img/lattice_water_simple.png) | ![img2](img/lattice_water_multiple.png)</span>
<span class="sd">    :-------------------------:|:-------------------------:</span>
<span class="sd">    $\omega_{lat} = 0.097 * clay(\%)$ | $\omega_{lat} = -0.028 + 0.077 * clay(\%) + 0.459 * carbon(\%)$</span>
<span class="sd">    Linear regression [lattice water (%) as a function of clay (%)] done with data from Kansas Sate University - Soil Water Processes Lab. |  Multiple linear regression [lattice water (%) as a function of clay (%) and soil carbon (%)] done with data from Soil Water Processes Lab.</span>

<span class="sd">    Args:</span>
<span class="sd">        clay_content (float): Clay content in the soil in percent.</span>
<span class="sd">        total_carbon (float, optional): Total carbon content in the soil in percent.</span>
<span class="sd">            If None, the amount of water is estimated based on clay content only.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Amount of water in the lattice of clay minerals in percent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">total_carbon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lattice_water</span> <span class="o">=</span> <span class="mf">0.097</span> <span class="o">*</span> <span class="n">clay_content</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lattice_water</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.028</span> <span class="o">+</span> <span class="mf">0.077</span> <span class="o">*</span> <span class="n">clay_content</span> <span class="o">+</span> <span class="mf">0.459</span> <span class="o">*</span> <span class="n">total_carbon</span>
    <span class="k">return</span> <span class="n">lattice_water</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.location_factor" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">location_factor</span><span class="p">(</span><span class="n">site_atmospheric_depth</span><span class="p">,</span> <span class="n">site_Rc</span><span class="p">,</span> <span class="n">reference_atmospheric_depth</span><span class="p">,</span> <span class="n">reference_Rc</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the location factor between two sites according to McJannet and Desilets, 2023.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>site_atmospheric_depth</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth at the site in g/cm2. Can be estimated using the function <code>atmospheric_depth()</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>site_Rc</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity at the site in GV. Can be estimated using the function <code>cutoff_rigidity()</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference_atmospheric_depth</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth at the reference location in g/cm2.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference_Rc</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity at the reference location in GV.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Location-dependent correction factor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>McJannet, D. L., &amp; Desilets, D. (2023). Incoming Neutron Flux Corrections for Cosmic‐Ray Soil and Snow Sensors Using the Global Neutron Monitor Network. Water Resources Research, 59(4), e2022WR033889.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">location_factor</span><span class="p">(</span><span class="n">site_atmospheric_depth</span><span class="p">,</span> <span class="n">site_Rc</span><span class="p">,</span> <span class="n">reference_atmospheric_depth</span><span class="p">,</span> <span class="n">reference_Rc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to estimate the location factor between two sites according to McJannet and Desilets, 2023.</span>


<span class="sd">    Args:</span>
<span class="sd">        site_atmospheric_depth (float): Atmospheric depth at the site in g/cm2. Can be estimated using the function `atmospheric_depth()`</span>
<span class="sd">        site_Rc (float): Cutoff rigidity at the site in GV. Can be estimated using the function `cutoff_rigidity()`</span>
<span class="sd">        reference_atmospheric_depth (float): Atmospheric depth at the reference location in g/cm2.</span>
<span class="sd">        reference_Rc (float): Cutoff rigidity at the reference location in GV.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Location-dependent correction factor.</span>

<span class="sd">    References:</span>
<span class="sd">        McJannet, D. L., &amp; Desilets, D. (2023). Incoming Neutron Flux Corrections for Cosmic‐Ray Soil and Snow Sensors Using the Global Neutron Monitor Network. Water Resources Research, 59(4), e2022WR033889.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Renamed variables based on the provided table</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0009</span>  <span class="c1"># from C39</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="mf">1.7699</span>  <span class="c1"># from C40</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="mf">0.0064</span>  <span class="c1"># from C41</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="mf">1.8855</span>  <span class="c1"># from C42</span>
    <span class="n">c4</span> <span class="o">=</span> <span class="mf">0.000013</span>  <span class="c1"># from C43</span>
    <span class="n">c5</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.2237</span>  <span class="c1"># from C44</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># from C45</span>

    <span class="c1"># Translated formula with renamed variables from McJannet and Desilets, 2023</span>
    <span class="n">tau_new</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="p">(</span><span class="n">c0</span> <span class="o">*</span> <span class="n">reference_atmospheric_depth</span> <span class="o">+</span> <span class="n">c1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
        <span class="o">-</span><span class="p">(</span><span class="n">c2</span> <span class="o">*</span> <span class="n">reference_atmospheric_depth</span> <span class="o">+</span> <span class="n">c3</span><span class="p">)</span> <span class="o">*</span> <span class="n">reference_Rc</span> <span class="o">**</span> <span class="p">(</span><span class="n">c4</span> <span class="o">*</span> <span class="n">reference_atmospheric_depth</span> <span class="o">+</span> <span class="n">c5</span><span class="p">)))</span>

    <span class="n">norm_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">tau_new</span>

    <span class="c1"># Calculate the result using the provided parameters</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">norm_factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">c0</span> <span class="o">*</span> <span class="n">site_atmospheric_depth</span> <span class="o">+</span> <span class="n">c1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">c2</span> <span class="o">*</span> <span class="n">site_atmospheric_depth</span> <span class="o">+</span> <span class="n">c3</span><span class="p">)</span> <span class="o">*</span> <span class="n">site_Rc</span> <span class="o">**</span> <span class="p">(</span><span class="n">c4</span> <span class="o">*</span> <span class="n">site_atmospheric_depth</span> <span class="o">+</span> <span class="n">c5</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">tau</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.nrad_weight" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">nrad_weight</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">rhob</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Kohli_2015&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Hveg</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to compute distance weights corresponding to each soil sample.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>h</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Air Humidity  from 0.1  to 50 in g/m^3. When h=0, the function will skip the distance weighting.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>theta</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil Moisture for each sample (0.02 - 0.50 m^3/m^3)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>distances</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Distances from the location of each sample to the origin (0.5 - 600 m)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>depth</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Depths for each sample (m)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>rhob</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Bulk density in g/cm^3</p>
            </div>
          </td>
          <td>
                <code>1.4</code>
          </td>
        </tr>
        <tr>
          <td><code>p</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric pressure in hPa. Required for the 'Schron_2017' method.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>Hveg</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Vegetation height in m. Required for the 'Schron_2017' method.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Method to compute the distance weights. Options are 'Kohli_2015' or 'Schron_2017'.</p>
            </div>
          </td>
          <td>
                <code>&#39;Kohli_2015&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Distance weights for each sample.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Köhli, M., Schrön, M., Zreda, M., Schmidt, U., Dietrich, P., and Zacharias, S. (2015).
Footprint characteristics revised for field-scale soil moisture monitoring with cosmic-ray
neutrons. Water Resour. Res. 51, 5772–5790. doi:10.1002/2015WR017169</p>
<p>Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L.,
Martini, E., Baroni, G., Rosolem, R., Weimar, J., Mai, J., Cuntz, M., Rebmann, C.,
Oswald, S. E., Dietrich, P., Schmidt, U., and Zacharias, S.: Improving calibration and
validation of cosmic-ray neutron sensors in the light of spatial sensitivity,
Hydrol. Earth Syst. Sci., 21, 5009–5030, https://doi.org/10.5194/hess-21-5009-2017, 2017.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nrad_weight</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">rhob</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Kohli_2015&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Hveg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to compute distance weights corresponding to each soil sample.</span>

<span class="sd">    Args:</span>
<span class="sd">        h (np.array or pd.Series): Air Humidity  from 0.1  to 50 in g/m^3. When h=0, the function will skip the distance weighting.</span>
<span class="sd">        theta (np.array or pd.Series): Soil Moisture for each sample (0.02 - 0.50 m^3/m^3)</span>
<span class="sd">        distances (np.array or pd.Series): Distances from the location of each sample to the origin (0.5 - 600 m)</span>
<span class="sd">        depth (np.array or pd.Series): Depths for each sample (m)</span>
<span class="sd">        rhob (np.array or pd.Series): Bulk density in g/cm^3</span>
<span class="sd">        p (np.array or pd.Series): Atmospheric pressure in hPa. Required for the &#39;Schron_2017&#39; method.</span>
<span class="sd">        Hveg (np.array or pd.Series): Vegetation height in m. Required for the &#39;Schron_2017&#39; method.</span>
<span class="sd">        method (str): Method to compute the distance weights. Options are &#39;Kohli_2015&#39; or &#39;Schron_2017&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Distance weights for each sample.</span>

<span class="sd">    References:</span>
<span class="sd">        Köhli, M., Schrön, M., Zreda, M., Schmidt, U., Dietrich, P., and Zacharias, S. (2015).</span>
<span class="sd">        Footprint characteristics revised for field-scale soil moisture monitoring with cosmic-ray</span>
<span class="sd">        neutrons. Water Resour. Res. 51, 5772–5790. doi:10.1002/2015WR017169</span>

<span class="sd">        Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L.,</span>
<span class="sd">        Martini, E., Baroni, G., Rosolem, R., Weimar, J., Mai, J., Cuntz, M., Rebmann, C.,</span>
<span class="sd">        Oswald, S. E., Dietrich, P., Schmidt, U., and Zacharias, S.: Improving calibration and</span>
<span class="sd">        validation of cosmic-ray neutron sensors in the light of spatial sensitivity,</span>
<span class="sd">        Hydrol. Earth Syst. Sci., 21, 5009–5030, https://doi.org/10.5194/hess-21-5009-2017, 2017.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Kohli_2015&#39;</span><span class="p">:</span>
        <span class="c1"># Table A1. Parameters for Fi and D86</span>
        <span class="n">p10</span> <span class="o">=</span> <span class="mi">8735</span><span class="p">;</span>
        <span class="n">p11</span> <span class="o">=</span> <span class="mf">17.1758</span><span class="p">;</span>
        <span class="n">p12</span> <span class="o">=</span> <span class="mi">11720</span><span class="p">;</span>
        <span class="n">p13</span> <span class="o">=</span> <span class="mf">0.00978</span><span class="p">;</span>
        <span class="n">p14</span> <span class="o">=</span> <span class="mi">7045</span><span class="p">;</span>
        <span class="n">p15</span> <span class="o">=</span> <span class="mf">0.003632</span><span class="p">;</span>
        <span class="n">p20</span> <span class="o">=</span> <span class="mf">2.7925e-2</span><span class="p">;</span>
        <span class="n">p21</span> <span class="o">=</span> <span class="mf">5.0399</span><span class="p">;</span>
        <span class="n">p22</span> <span class="o">=</span> <span class="mf">2.8544e-2</span><span class="p">;</span>
        <span class="n">p23</span> <span class="o">=</span> <span class="mf">0.002455</span><span class="p">;</span>
        <span class="n">p24</span> <span class="o">=</span> <span class="mf">6.851e-5</span><span class="p">;</span>
        <span class="n">p25</span> <span class="o">=</span> <span class="mf">9.2926</span><span class="p">;</span>
        <span class="n">p30</span> <span class="o">=</span> <span class="mi">247970</span><span class="p">;</span>
        <span class="n">p31</span> <span class="o">=</span> <span class="mf">17.63</span><span class="p">;</span>
        <span class="n">p32</span> <span class="o">=</span> <span class="mi">374655</span><span class="p">;</span>
        <span class="n">p33</span> <span class="o">=</span> <span class="mf">0.00191</span><span class="p">;</span>
        <span class="n">p34</span> <span class="o">=</span> <span class="mi">195725</span><span class="p">;</span>
        <span class="n">p40</span> <span class="o">=</span> <span class="mf">5.4818e-2</span><span class="p">;</span>
        <span class="n">p41</span> <span class="o">=</span> <span class="mf">15.921</span><span class="p">;</span>
        <span class="n">p42</span> <span class="o">=</span> <span class="mf">0.6373</span><span class="p">;</span>
        <span class="n">p43</span> <span class="o">=</span> <span class="mf">5.99e-2</span><span class="p">;</span>
        <span class="n">p44</span> <span class="o">=</span> <span class="mf">5.425e-4</span><span class="p">;</span>
        <span class="n">p50</span> <span class="o">=</span> <span class="mi">1383702</span><span class="p">;</span>
        <span class="n">p51</span> <span class="o">=</span> <span class="mf">4.156</span><span class="p">;</span>
        <span class="n">p52</span> <span class="o">=</span> <span class="mi">5325</span><span class="p">;</span>
        <span class="n">p53</span> <span class="o">=</span> <span class="mf">0.00238</span><span class="p">;</span>
        <span class="n">p54</span> <span class="o">=</span> <span class="mf">0.0156</span><span class="p">;</span>
        <span class="n">p55</span> <span class="o">=</span> <span class="mf">0.130</span><span class="p">;</span>
        <span class="n">p56</span> <span class="o">=</span> <span class="mi">1521</span><span class="p">;</span>
        <span class="n">p60</span> <span class="o">=</span> <span class="mf">6.031e-5</span><span class="p">;</span>
        <span class="n">p61</span> <span class="o">=</span> <span class="mf">98.5</span><span class="p">;</span>
        <span class="n">p62</span> <span class="o">=</span> <span class="mf">1.0466e-3</span><span class="p">;</span>
        <span class="n">p70</span> <span class="o">=</span> <span class="mi">11747</span><span class="p">;</span>
        <span class="n">p71</span> <span class="o">=</span> <span class="mf">41.66</span><span class="p">;</span>
        <span class="n">p72</span> <span class="o">=</span> <span class="mi">4521</span><span class="p">;</span>
        <span class="n">p73</span> <span class="o">=</span> <span class="mf">0.01998</span><span class="p">;</span>
        <span class="n">p74</span> <span class="o">=</span> <span class="mf">0.00604</span><span class="p">;</span>
        <span class="n">p75</span> <span class="o">=</span> <span class="mi">2534</span><span class="p">;</span>
        <span class="n">p76</span> <span class="o">=</span> <span class="mf">0.00475</span><span class="p">;</span>
        <span class="n">p80</span> <span class="o">=</span> <span class="mf">1.543e-2</span><span class="p">;</span>
        <span class="n">p81</span> <span class="o">=</span> <span class="mf">10.06</span><span class="p">;</span>
        <span class="n">p82</span> <span class="o">=</span> <span class="mf">1.807e-2</span><span class="p">;</span>
        <span class="n">p83</span> <span class="o">=</span> <span class="mf">0.0011</span><span class="p">;</span>
        <span class="n">p84</span> <span class="o">=</span> <span class="mf">8.81e-5</span><span class="p">;</span>
        <span class="n">p85</span> <span class="o">=</span> <span class="mf">0.0405</span><span class="p">;</span>
        <span class="n">p86</span> <span class="o">=</span> <span class="mf">20.24</span><span class="p">;</span>
        <span class="n">p90</span> <span class="o">=</span> <span class="mf">8.321</span><span class="p">;</span>
        <span class="n">p91</span> <span class="o">=</span> <span class="mf">0.14249</span><span class="p">;</span>
        <span class="n">p92</span> <span class="o">=</span> <span class="mf">0.96655</span><span class="p">;</span>
        <span class="n">p93</span> <span class="o">=</span> <span class="mf">26.42</span><span class="p">;</span>
        <span class="n">p94</span> <span class="o">=</span> <span class="mf">0.0567</span><span class="p">;</span>

        <span class="c1"># Numerical determination of the penetration depth (86%) (Eq. 8)</span>
        <span class="n">D86</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rhob</span> <span class="o">*</span> <span class="p">(</span><span class="n">p90</span> <span class="o">+</span> <span class="n">p91</span> <span class="o">*</span> <span class="p">(</span><span class="n">p92</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">distances</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">p93</span> <span class="o">+</span> <span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p94</span> <span class="o">+</span> <span class="n">theta</span><span class="p">))</span>

        <span class="c1"># Depth weights (Eq. 7)</span>
        <span class="n">Wd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">depth</span> <span class="o">/</span> <span class="n">D86</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># skip distance weighting</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">):</span>
            <span class="c1"># Functions for Fi (Appendix A in Köhli et al., 2015)</span>
            <span class="n">F1</span> <span class="o">=</span> <span class="n">p10</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p13</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p11</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">p12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p15</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="n">p14</span> <span class="o">*</span> <span class="n">theta</span>
            <span class="n">F2</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">p20</span> <span class="o">+</span> <span class="n">p24</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p21</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p25</span> <span class="o">*</span> <span class="n">theta</span><span class="p">))</span> <span class="o">+</span> <span class="n">p22</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p23</span><span class="p">)</span>
            <span class="n">F3</span> <span class="o">=</span> <span class="p">(</span><span class="n">p30</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p33</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p31</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span> <span class="o">-</span> <span class="n">p34</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span>
            <span class="n">F4</span> <span class="o">=</span> <span class="n">p40</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p41</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">p42</span> <span class="o">-</span> <span class="n">p43</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">p44</span> <span class="o">*</span> <span class="n">h</span>
            <span class="n">F5</span> <span class="o">=</span> <span class="n">p50</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.02</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">p55</span> <span class="o">/</span> <span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">p55</span> <span class="o">+</span> <span class="n">p56</span> <span class="o">*</span> <span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">p54</span> <span class="o">-</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                <span class="o">-</span><span class="n">p51</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">p54</span><span class="p">))</span> <span class="o">+</span> <span class="n">p52</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.7</span> <span class="o">-</span> <span class="n">h</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">*</span> <span class="n">p53</span><span class="p">)</span>
            <span class="n">F6</span> <span class="o">=</span> <span class="n">p60</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">p61</span><span class="p">)</span> <span class="o">+</span> <span class="n">p62</span> <span class="o">*</span> <span class="n">theta</span>
            <span class="n">F7</span> <span class="o">=</span> <span class="p">(</span><span class="n">p70</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p76</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p71</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p74</span><span class="p">))</span> <span class="o">+</span> <span class="n">p72</span> <span class="o">-</span> <span class="n">p75</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p73</span><span class="p">)</span>
            <span class="n">F8</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">p80</span> <span class="o">+</span> <span class="n">p84</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p81</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p85</span> <span class="o">*</span> <span class="n">h</span> <span class="o">+</span> <span class="n">p86</span> <span class="o">*</span> <span class="n">theta</span><span class="p">))</span> <span class="o">+</span> <span class="n">p82</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p83</span><span class="p">)</span>

            <span class="c1"># Distance weights (Eq. 3)</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
                    <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">F1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">F3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="k">elif</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">):</span>
                    <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">F5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">F7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input distances are not valid.&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Air humidity values are out of range.&#39;</span><span class="p">)</span>

        <span class="c1"># Combined and normalized weights</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">Wd</span> <span class="o">*</span> <span class="n">W</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">Wd</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">weights</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Schron_2017&#39;</span><span class="p">:</span>
        <span class="c1"># Horizontal distance weights According to Eq. 6 and Table A1 in Schrön et al. (2017)</span>
        <span class="c1"># Method for calculating the horizontal distance weights from 0 to 1m</span>
        <span class="k">def</span> <span class="nf">WrX</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">x00</span> <span class="o">=</span> <span class="mf">3.7</span>
            <span class="n">a00</span> <span class="o">=</span> <span class="mi">8735</span><span class="p">;</span>
            <span class="n">a01</span> <span class="o">=</span> <span class="mf">22.689</span><span class="p">;</span>
            <span class="n">a02</span> <span class="o">=</span> <span class="mi">11720</span><span class="p">;</span>
            <span class="n">a03</span> <span class="o">=</span> <span class="mf">0.00978</span><span class="p">;</span>
            <span class="n">a04</span> <span class="o">=</span> <span class="mi">9306</span><span class="p">;</span>
            <span class="n">a05</span> <span class="o">=</span> <span class="mf">0.003632</span>
            <span class="n">a10</span> <span class="o">=</span> <span class="mf">2.7925e-2</span><span class="p">;</span>
            <span class="n">a11</span> <span class="o">=</span> <span class="mf">6.6577</span><span class="p">;</span>
            <span class="n">a12</span> <span class="o">=</span> <span class="mf">0.028544</span><span class="p">;</span>
            <span class="n">a13</span> <span class="o">=</span> <span class="mf">0.002455</span><span class="p">;</span>
            <span class="n">a14</span> <span class="o">=</span> <span class="mf">6.851e-5</span><span class="p">;</span>
            <span class="n">a15</span> <span class="o">=</span> <span class="mf">12.2755</span>
            <span class="n">a20</span> <span class="o">=</span> <span class="mi">247970</span><span class="p">;</span>
            <span class="n">a21</span> <span class="o">=</span> <span class="mf">23.289</span><span class="p">;</span>
            <span class="n">a22</span> <span class="o">=</span> <span class="mi">374655</span><span class="p">;</span>
            <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.00191</span><span class="p">;</span>
            <span class="n">a24</span> <span class="o">=</span> <span class="mi">258552</span>
            <span class="n">a30</span> <span class="o">=</span> <span class="mf">5.4818e-2</span><span class="p">;</span>
            <span class="n">a31</span> <span class="o">=</span> <span class="mf">21.032</span><span class="p">;</span>
            <span class="n">a32</span> <span class="o">=</span> <span class="mf">0.6373</span><span class="p">;</span>
            <span class="n">a33</span> <span class="o">=</span> <span class="mf">0.0791</span><span class="p">;</span>
            <span class="n">a34</span> <span class="o">=</span> <span class="mf">5.425e-4</span>

            <span class="n">x0</span> <span class="o">=</span> <span class="n">x00</span>
            <span class="n">A0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a00</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a03</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a01</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a02</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">a04</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">A1</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">a10</span> <span class="o">+</span> <span class="n">a14</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a11</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a15</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="n">a12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">a13</span><span class="p">)</span>
            <span class="n">A2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a20</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a23</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a21</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a22</span> <span class="o">-</span> <span class="n">a24</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="n">a30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a31</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a32</span> <span class="o">-</span> <span class="n">a33</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a34</span> <span class="o">*</span> <span class="n">x</span>

            <span class="k">return</span> <span class="p">((</span><span class="n">A0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">A1</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">A3</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x0</span> <span class="o">*</span> <span class="n">r</span><span class="p">)))</span>

        <span class="c1"># Method for calculating the horizontal distance weights from 1 to 50m</span>
        <span class="k">def</span> <span class="nf">WrA</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">a00</span> <span class="o">=</span> <span class="mi">8735</span><span class="p">;</span>
            <span class="n">a01</span> <span class="o">=</span> <span class="mf">22.689</span><span class="p">;</span>
            <span class="n">a02</span> <span class="o">=</span> <span class="mi">11720</span><span class="p">;</span>
            <span class="n">a03</span> <span class="o">=</span> <span class="mf">0.00978</span><span class="p">;</span>
            <span class="n">a04</span> <span class="o">=</span> <span class="mi">9306</span><span class="p">;</span>
            <span class="n">a05</span> <span class="o">=</span> <span class="mf">0.003632</span>
            <span class="n">a10</span> <span class="o">=</span> <span class="mf">2.7925e-2</span><span class="p">;</span>
            <span class="n">a11</span> <span class="o">=</span> <span class="mf">6.6577</span><span class="p">;</span>
            <span class="n">a12</span> <span class="o">=</span> <span class="mf">0.028544</span><span class="p">;</span>
            <span class="n">a13</span> <span class="o">=</span> <span class="mf">0.002455</span><span class="p">;</span>
            <span class="n">a14</span> <span class="o">=</span> <span class="mf">6.851e-5</span><span class="p">;</span>
            <span class="n">a15</span> <span class="o">=</span> <span class="mf">12.2755</span>
            <span class="n">a20</span> <span class="o">=</span> <span class="mi">247970</span><span class="p">;</span>
            <span class="n">a21</span> <span class="o">=</span> <span class="mf">23.289</span><span class="p">;</span>
            <span class="n">a22</span> <span class="o">=</span> <span class="mi">374655</span><span class="p">;</span>
            <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.00191</span><span class="p">;</span>
            <span class="n">a24</span> <span class="o">=</span> <span class="mi">258552</span>
            <span class="n">a30</span> <span class="o">=</span> <span class="mf">5.4818e-2</span><span class="p">;</span>
            <span class="n">a31</span> <span class="o">=</span> <span class="mf">21.032</span><span class="p">;</span>
            <span class="n">a32</span> <span class="o">=</span> <span class="mf">0.6373</span><span class="p">;</span>
            <span class="n">a33</span> <span class="o">=</span> <span class="mf">0.0791</span><span class="p">;</span>
            <span class="n">a34</span> <span class="o">=</span> <span class="mf">5.425e-4</span>

            <span class="n">A0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a00</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a03</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a01</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a02</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">a04</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">A1</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">a10</span> <span class="o">+</span> <span class="n">a14</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a11</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a15</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="n">a12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">a13</span><span class="p">)</span>
            <span class="n">A2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a20</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a23</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a21</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a22</span> <span class="o">-</span> <span class="n">a24</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="n">a30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a31</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a32</span> <span class="o">-</span> <span class="n">a33</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a34</span> <span class="o">*</span> <span class="n">x</span>

            <span class="k">return</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">A1</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">A3</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

        <span class="c1"># Method for calculating the horizontal distance weights from 50 to 600m</span>
        <span class="k">def</span> <span class="nf">WrB</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">b00</span> <span class="o">=</span> <span class="mi">39006</span><span class="p">;</span>
            <span class="n">b01</span> <span class="o">=</span> <span class="mi">15002337</span><span class="p">;</span>
            <span class="n">b02</span> <span class="o">=</span> <span class="mf">2009.24</span><span class="p">;</span>
            <span class="n">b03</span> <span class="o">=</span> <span class="mf">0.01181</span><span class="p">;</span>
            <span class="n">b04</span> <span class="o">=</span> <span class="mf">3.146</span><span class="p">;</span>
            <span class="n">b05</span> <span class="o">=</span> <span class="mf">16.7417</span><span class="p">;</span>
            <span class="n">b06</span> <span class="o">=</span> <span class="mi">3727</span>
            <span class="n">b10</span> <span class="o">=</span> <span class="mf">6.031e-5</span><span class="p">;</span>
            <span class="n">b11</span> <span class="o">=</span> <span class="mf">98.5</span><span class="p">;</span>
            <span class="n">b12</span> <span class="o">=</span> <span class="mf">0.0013826</span>
            <span class="n">b20</span> <span class="o">=</span> <span class="mi">11747</span><span class="p">;</span>
            <span class="n">b21</span> <span class="o">=</span> <span class="mf">55.033</span><span class="p">;</span>
            <span class="n">b22</span> <span class="o">=</span> <span class="mi">4521</span><span class="p">;</span>
            <span class="n">b23</span> <span class="o">=</span> <span class="mf">0.01998</span><span class="p">;</span>
            <span class="n">b24</span> <span class="o">=</span> <span class="mf">0.00604</span><span class="p">;</span>
            <span class="n">b25</span> <span class="o">=</span> <span class="mf">3347.4</span><span class="p">;</span>
            <span class="n">b26</span> <span class="o">=</span> <span class="mf">0.00475</span>
            <span class="n">b30</span> <span class="o">=</span> <span class="mf">1.543e-2</span><span class="p">;</span>
            <span class="n">b31</span> <span class="o">=</span> <span class="mf">13.29</span><span class="p">;</span>
            <span class="n">b32</span> <span class="o">=</span> <span class="mf">1.807e-2</span><span class="p">;</span>
            <span class="n">b33</span> <span class="o">=</span> <span class="mf">0.0011</span><span class="p">;</span>
            <span class="n">b34</span> <span class="o">=</span> <span class="mf">8.81e-5</span><span class="p">;</span>
            <span class="n">b35</span> <span class="o">=</span> <span class="mf">0.0405</span><span class="p">;</span>
            <span class="n">b36</span> <span class="o">=</span> <span class="mf">26.74</span>

            <span class="n">B0</span> <span class="o">=</span> <span class="p">(</span><span class="n">b00</span> <span class="o">-</span> <span class="n">b01</span> <span class="o">/</span> <span class="p">(</span><span class="n">b02</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">0.13</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">b03</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b04</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">b05</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">b06</span>
            <span class="n">B1</span> <span class="o">=</span> <span class="n">b10</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">b11</span><span class="p">)</span> <span class="o">+</span> <span class="n">b12</span> <span class="o">*</span> <span class="n">y</span>
            <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span><span class="n">b20</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">b26</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b21</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="n">b24</span><span class="p">))</span> <span class="o">+</span> <span class="n">b22</span> <span class="o">-</span> <span class="n">b25</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">b23</span><span class="p">)</span>
            <span class="n">B3</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">b30</span> <span class="o">+</span> <span class="n">b34</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b31</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">b35</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">b36</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="n">b32</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">b33</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B1</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">B2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B3</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">rscaled</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">Hveg</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="mf">0.4922</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.86</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p</span> <span class="o">/</span> <span class="mf">1013.25</span><span class="p">))</span>
            <span class="n">Fveg</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">0.17</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.41</span> <span class="o">*</span> <span class="n">Hveg</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">9.25</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">r</span> <span class="o">/</span> <span class="n">Fp</span> <span class="o">/</span> <span class="n">Fveg</span>

        <span class="c1"># Rename variables to be consistent with the revised paper</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">distances</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="n">rhob</span>

        <span class="k">if</span> <span class="n">Hveg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">rscaled</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">Hveg</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">Wr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

        <span class="c1"># See Eq. 6 in Schron et al. (2017)</span>
        <span class="n">r0_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">r1_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">r2_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">)</span>
        <span class="n">Wr</span><span class="p">[</span><span class="n">r0_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">WrX</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">r0_idx</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">r0_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">r0_idx</span><span class="p">])</span>
        <span class="n">Wr</span><span class="p">[</span><span class="n">r1_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">WrA</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">r1_idx</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">r1_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">r1_idx</span><span class="p">])</span>
        <span class="n">Wr</span><span class="p">[</span><span class="n">r2_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">WrB</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">r2_idx</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">r2_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">r2_idx</span><span class="p">])</span>

        <span class="c1"># Vertical distance weights</span>
        <span class="k">def</span> <span class="nf">D86</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">bd</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.321</span> <span class="o">+</span> <span class="mf">0.14249</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.96655</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.0429</span> <span class="o">+</span> <span class="n">y</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">Wd</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">d</span> <span class="o">/</span> <span class="n">D86</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="c1"># Calculate the vertical distance weights</span>
        <span class="n">Wd</span> <span class="o">=</span> <span class="n">Wd</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Combined and normalized weights</span>
        <span class="c1"># Combined and normalized weights</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">Wd</span> <span class="o">*</span> <span class="n">Wr</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">Wd</span> <span class="o">*</span> <span class="n">Wr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">weights</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.remove_incomplete_intervals" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remove_incomplete_intervals</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="p">,</span> <span class="n">integration_time</span><span class="p">,</span> <span class="n">remove_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that removes rows with incomplete integration intervals.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pandas Dataframe with data from stationary or roving CRNP devices.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamp_col</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the column with timestamps in datetime format.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>integration_time</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Duration of the neutron counting interval in seconds. Typical values are 60 seconds and 3600 seconds.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>remove_first</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Remove first row. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_incomplete_intervals</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="p">,</span> <span class="n">integration_time</span><span class="p">,</span> <span class="n">remove_first</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that removes rows with incomplete integration intervals.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pandas.DataFrame): Pandas Dataframe with data from stationary or roving CRNP devices.</span>
<span class="sd">        timestamp_col (str): Name of the column with timestamps in datetime format.</span>
<span class="sd">        integration_time (int): Duration of the neutron counting interval in seconds. Typical values are 60 seconds and 3600 seconds.</span>
<span class="sd">        remove_first (bool, optional): Remove first row. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check format of timestamp column</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;timestamp_col must be datetime64. Use `pd.to_datetime()` to fix this issue.&#39;</span><span class="p">)</span>

    <span class="c1"># Check if differences in timestamps are below or above the provided integration time</span>
    <span class="n">idx_delta</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">!=</span> <span class="n">integration_time</span>

    <span class="k">if</span> <span class="n">remove_first</span><span class="p">:</span>
        <span class="n">idx_delta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Select rows that meet the specified integration time</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">idx_delta</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Notify user about the number of rows that have been removed</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed a total of </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">idx_delta</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.rover_centered_coordinates" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">rover_centered_coordinates</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the intermediate locations between two points, assuming the measurements were taken at a constant speed.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>x coordinates.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>y coordinates.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>x_est</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Estimated x coordinates.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y_est</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Estimated y coordinates.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rover_centered_coordinates</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to estimate the intermediate locations between two points, assuming the measurements were taken at a constant speed.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (array): x coordinates.</span>
<span class="sd">        y (array): y coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        x_est (array): Estimated x coordinates.</span>
<span class="sd">        y_est (array): Estimated y coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Make it datatype agnostic</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Do the average of the two points</span>
    <span class="n">x_est</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">y_est</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Add the first point to match the length of the original array</span>
    <span class="n">x_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x_est</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y_est</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">x_est</span><span class="p">,</span> <span class="n">y_est</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.sensing_depth" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">sensing_depth</span><span class="p">(</span><span class="n">vwc</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">p_ref</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Schron_2017&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that computes the estimated sensing depth of the cosmic-ray neutron probe.
The function offers several methods to compute the depth at which 86 % of the neutrons
probe the soil profile.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vwc</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Estimated volumetric water content for each timestamp.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pressure</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric pressure in hPa for each timestamp.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>p_ref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference pressure in hPa.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bulk_density</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil bulk density.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Wlat</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Lattice water content.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Method to compute the sensing depth. Options are 'Schron_2017' or 'Franz_2012'.</p>
            </div>
          </td>
          <td>
                <code>&#39;Schron_2017&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>dist</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of radial distances at which to estimate the sensing depth. Only used for the 'Schron_2017' method.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Estimated sensing depth in m.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Franz, T.E., Zreda, M., Ferre, T.P.A., Rosolem, R., Zweck, C., Stillman, S., Zeng, X. and Shuttleworth, W.J., 2012.
Measurement depth of the cosmic ray soil moisture probe affected by hydrogen from various sources.
Water Resources Research, 48(8). doi.org/10.1029/2012WR011871</p>
<p>Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L., et al. (2017).
Improving calibration and validation of cosmic-ray neutron sensors in the light of spatial sensitivity.
Hydrol. Earth Syst. Sci. 21, 5009–5030. doi.org/10.5194/hess-21-5009-2017</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sensing_depth</span><span class="p">(</span><span class="n">vwc</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">p_ref</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Schron_2017&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that computes the estimated sensing depth of the cosmic-ray neutron probe.</span>
<span class="sd">    The function offers several methods to compute the depth at which 86 % of the neutrons</span>
<span class="sd">    probe the soil profile.</span>

<span class="sd">    Args:</span>
<span class="sd">        vwc (array or pd.Series or pd.DataFrame): Estimated volumetric water content for each timestamp.</span>
<span class="sd">        pressure (array or pd.Series or pd.DataFrame): Atmospheric pressure in hPa for each timestamp.</span>
<span class="sd">        p_ref (float): Reference pressure in hPa.</span>
<span class="sd">        bulk_density (float): Soil bulk density.</span>
<span class="sd">        Wlat (float): Lattice water content.</span>
<span class="sd">        method (str): Method to compute the sensing depth. Options are &#39;Schron_2017&#39; or &#39;Franz_2012&#39;.</span>
<span class="sd">        dist (list or array): List of radial distances at which to estimate the sensing depth. Only used for the &#39;Schron_2017&#39; method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Estimated sensing depth in m.</span>

<span class="sd">    References:</span>
<span class="sd">        Franz, T.E., Zreda, M., Ferre, T.P.A., Rosolem, R., Zweck, C., Stillman, S., Zeng, X. and Shuttleworth, W.J., 2012.</span>
<span class="sd">        Measurement depth of the cosmic ray soil moisture probe affected by hydrogen from various sources.</span>
<span class="sd">        Water Resources Research, 48(8). doi.org/10.1029/2012WR011871</span>

<span class="sd">        Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L., et al. (2017).</span>
<span class="sd">        Improving calibration and validation of cosmic-ray neutron sensors in the light of spatial sensitivity.</span>
<span class="sd">        Hydrol. Earth Syst. Sci. 21, 5009–5030. doi.org/10.5194/hess-21-5009-2017</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Determine sensing depth (D86)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Schron_2017&#39;</span><span class="p">:</span>
        <span class="c1"># See Appendix A of Schrön et al. (2017)</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="mf">0.4922</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.86</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">pressure</span> <span class="o">/</span> <span class="n">p_ref</span><span class="p">))</span>
        <span class="n">Fveg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dist</span><span class="p">:</span>
            <span class="c1"># Compute r_star</span>
            <span class="n">r_start</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="n">Fp</span>

            <span class="c1"># Compute soil depth that accounts for 86% of the neutron flux</span>
            <span class="n">D86</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">bulk_density</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.321</span> <span class="o">+</span> <span class="mf">0.14249</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.96655</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">r_start</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="p">(</span><span class="n">Wlat</span> <span class="o">+</span> <span class="n">vwc</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="mf">0.0429</span> <span class="o">+</span> <span class="p">(</span><span class="n">Wlat</span> <span class="o">+</span> <span class="n">vwc</span><span class="p">)))</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">D86</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Franz_2012&#39;</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="mf">5.8</span> <span class="o">/</span> <span class="p">(</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="n">Wlat</span> <span class="o">+</span> <span class="n">vwc</span> <span class="o">+</span> <span class="mf">0.0829</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Method not recognized. Please select either &quot;Schron_2017&quot; or &quot;Franz_2012&quot;.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.smooth_1d" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">smooth_1d</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;moving_median&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Use a Savitzky-Golay filter to smooth the signal of corrected neutron counts or another one-dimensional array (e.g. computed volumetric water content).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>values</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span> or <span title="pandas.Serie">Serie</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dataframe containing the values to smooth.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>window</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Window size for the Savitzky-Golay filter. Default is 5.</p>
            </div>
          </td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Method to use for smoothing the data. Default is 'moving_median'.
Options are 'moving_average', 'moving_median' and 'savitzky_golay'.</p>
            </div>
          </td>
          <td>
                <code>&#39;moving_median&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>order</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Order of the Savitzky-Golay filter. Default is 3.</p>
            </div>
          </td>
          <td>
                <code>3</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>DataFrame with smoothed values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.
Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.
doi.org/10.3389/frwa.2020.00009</p>
<p>Savitzky, A., &amp; Golay, M. J. (1964). Smoothing and differentiation of data by simplified least squares procedures.
Analytical chemistry, 36(8), 1627-1639.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">smooth_1d</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;moving_median&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use a Savitzky-Golay filter to smooth the signal of corrected neutron counts or another one-dimensional array (e.g. computed volumetric water content).</span>

<span class="sd">    Args:</span>
<span class="sd">        values (pd.DataFrame or pd.Serie): Dataframe containing the values to smooth.</span>
<span class="sd">        window (int): Window size for the Savitzky-Golay filter. Default is 5.</span>
<span class="sd">        method (str): Method to use for smoothing the data. Default is &#39;moving_median&#39;.</span>
<span class="sd">            Options are &#39;moving_average&#39;, &#39;moving_median&#39; and &#39;savitzky_golay&#39;.</span>
<span class="sd">        order (int): Order of the Savitzky-Golay filter. Default is 3.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pd.DataFrame): DataFrame with smoothed values.</span>

<span class="sd">    References:</span>
<span class="sd">        Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.</span>
<span class="sd">        Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.</span>
<span class="sd">        doi.org/10.3389/frwa.2020.00009</span>

<span class="sd">        Savitzky, A., &amp; Golay, M. J. (1964). Smoothing and differentiation of data by simplified least squares procedures.</span>
<span class="sd">        Analytical chemistry, 36(8), 1627-1639.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input must be a pandas Series or DataFrame&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;moving_average&#39;</span><span class="p">:</span>
        <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;moving_median&#39;</span><span class="p">:</span>
        <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;savitzky_golay&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dataframe contains NaN values. Please remove NaN values before smoothing the data.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
            <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;smoothed&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">window</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;Invalid method. Please select a valid filtering method., options are: moving_average, moving_median, savitzky_golay&#39;</span><span class="p">)</span>
    <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">corrected_counts</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">bfill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">corrected_counts</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.spatial_average" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">spatial_average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_neighbours</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">rnd</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Moving buffer filter to smooth georeferenced two-dimensional data.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM x coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM y coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Values to be smoothed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>buffer</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Radial buffer distance in meters.</p>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>min_neighbours</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Minimum number of neighbours to consider for the smoothing.</p>
            </div>
          </td>
          <td>
                <code>3</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>One of 'mean' or 'median'.</p>
            </div>
          </td>
          <td>
                <code>&#39;mean&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>rnd</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Boolean to round the final result. Useful in case of z representing neutron counts.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Smoothed version of z with the same dimension as z.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">spatial_average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_neighbours</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">rnd</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Moving buffer filter to smooth georeferenced two-dimensional data.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (list or array): UTM x coordinates in meters.</span>
<span class="sd">        y (list or array): UTM y coordinates in meters.</span>
<span class="sd">        z (list or array): Values to be smoothed.</span>
<span class="sd">        buffer (float): Radial buffer distance in meters.</span>
<span class="sd">        min_neighbours (int): Minimum number of neighbours to consider for the smoothing.</span>
<span class="sd">        method (str): One of &#39;mean&#39; or &#39;median&#39;.</span>
<span class="sd">        rnd (bool): Boolean to round the final result. Useful in case of z representing neutron counts.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array): Smoothed version of z with the same dimension as z.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert input data to Numpy arrays</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="s2">&quot;Input values cannot be converted to Numpy arrays.&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;The number of x and y must be equal. Input x has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2"> values and y has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2"> values.&quot;</span>

    <span class="c1"># Compute distances</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">z_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">px</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">distances</span> <span class="o">=</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">idx_within_buffer</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">&lt;=</span> <span class="n">buffer</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
            <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">idx_within_buffer</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">min_neighbours</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx_within_buffer</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx_within_buffer</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> does not exist. Provide either &#39;mean&#39; or &#39;median&#39;.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>  <span class="c1"># If there are not enough neighbours, keep the original value</span>

        <span class="c1"># Append smoothed value to array</span>
        <span class="n">z_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_smooth</span><span class="p">,</span> <span class="n">z_new_val</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rnd</span><span class="p">:</span>
        <span class="n">z_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">z_smooth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">z_smooth</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.total_raw_counts" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">total_raw_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the sum of uncorrected neutron counts for all detectors.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dataframe containing only the columns with neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dataframe with the sum of uncorrected neutron counts for all detectors.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">total_raw_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the sum of uncorrected neutron counts for all detectors.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (pandas.DataFrame): Dataframe containing only the columns with neutron counts.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Dataframe with the sum of uncorrected neutron counts for all detectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">counts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Compute sum of counts</span>
    <span class="n">total_raw_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Replace zeros with NaN</span>
    <span class="n">total_raw_counts</span> <span class="o">=</span> <span class="n">total_raw_counts</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">total_raw_counts</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.uncertainty_counts" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">uncertainty_counts</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the uncertainty of raw counts.</p>
<p>Measurements of proportional neutron detector systems are governed by counting statistics that follow a Poissonian probability distribution (Zreda et al., 2012).
The expected uncertainty in the neutron count rate $N$ is defined by the standard deviation $ \sqrt{N} $ (Jakobi et al., 2020).
The CV% can be expressed as $ N^{-1/2} $</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>raw_counts</code></td>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Raw neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Either 'std' or 'cv' for standard deviation or coefficient of variation.</p>
            </div>
          </td>
          <td>
                <code>&#39;std&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>fp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pressure correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>fw</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Humidity correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>fi</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Incoming neutron flux correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>uncertainty</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Uncertainty of raw counts.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Jakobi J, Huisman JA, Schrön M, Fiedler J, Brogi C, Vereecken H and Bogena HR (2020) Error Estimation for Soil Moisture Measurements With
Cosmic Ray Neutron Sensing and Implications for Rover Surveys. Front. Water 2:10. doi: 10.3389/frwa.2020.00010</p>
<p>Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., and Rosolem, R.: COSMOS: the COsmic-ray Soil Moisture Observing System,
Hydrol. Earth Syst. Sci., 16, 4079–4099, https://doi.org/10.5194/hess-16-4079-2012, 2012.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">uncertainty_counts</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to estimate the uncertainty of raw counts.</span>

<span class="sd">    Measurements of proportional neutron detector systems are governed by counting statistics that follow a Poissonian probability distribution (Zreda et al., 2012).</span>
<span class="sd">    The expected uncertainty in the neutron count rate $N$ is defined by the standard deviation $ \sqrt{N} $ (Jakobi et al., 2020).</span>
<span class="sd">    The CV% can be expressed as $ N^{-1/2} $</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_counts (array): Raw neutron counts.</span>
<span class="sd">        metric (str): Either &#39;std&#39; or &#39;cv&#39; for standard deviation or coefficient of variation.</span>
<span class="sd">        fp (float): Pressure correction factor.</span>
<span class="sd">        fw (float): Humidity correction factor.</span>
<span class="sd">        fi (float): Incoming neutron flux correction factor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        uncertainty (float): Uncertainty of raw counts.</span>

<span class="sd">    References:</span>
<span class="sd">        Jakobi J, Huisman JA, Schrön M, Fiedler J, Brogi C, Vereecken H and Bogena HR (2020) Error Estimation for Soil Moisture Measurements With</span>
<span class="sd">        Cosmic Ray Neutron Sensing and Implications for Rover Surveys. Front. Water 2:10. doi: 10.3389/frwa.2020.00010</span>

<span class="sd">        Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., and Rosolem, R.: COSMOS: the COsmic-ray Soil Moisture Observing System,</span>
<span class="sd">        Hydrol. Earth Syst. Sci., 16, 4079–4099, https://doi.org/10.5194/hess-16-4079-2012, 2012.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">fw</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">*</span> <span class="n">fi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span>
    <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;cv&quot;</span><span class="p">:</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> does not exist. Provide either &#39;std&#39; or &#39;cv&#39; for standard deviation or coefficient of variation.&quot;</span>
    <span class="k">return</span> <span class="n">uncertainty</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.crnpy.uncertainty_vwc" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">uncertainty_vwc</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the uncertainty propagated to volumetric water content.</p>
<p>The uncertainty of the volumetric water content is estimated by propagating the uncertainty of the raw counts.
Following Eq. 10 in Jakobi et al. (2020), the uncertainty of the volumetric water content can be expressed as:
$$
\sigma_{\theta_g}(N) = \sigma_N \frac{a_0 N_0}{(N_{cor} - a_1 N_0)^4} \sqrt{(N_{cor} - a_1 N_0)^4 + 8 \sigma_N^2 (N_{cor} - a_1 N_0)^2 + 15 \sigma_N^4}
$$</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>raw_counts</code></td>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Raw neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>N0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Calibration parameter N0.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bulk_density</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Bulk density in g cm-3.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pressure correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>fw</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Humidity correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>fi</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Incoming neutron flux correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>sigma_VWC</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Uncertainty in terms of volumetric water content.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Jakobi J, Huisman JA, Schrön M, Fiedler J, Brogi C, Vereecken H and Bogena HR (2020) Error Estimation for Soil Moisture Measurements With
Cosmic Ray Neutron Sensing and Implications for Rover Surveys. Front. Water 2:10. doi: 10.3389/frwa.2020.00010</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">uncertainty_vwc</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to estimate the uncertainty propagated to volumetric water content.</span>

<span class="sd">    The uncertainty of the volumetric water content is estimated by propagating the uncertainty of the raw counts.</span>
<span class="sd">    Following Eq. 10 in Jakobi et al. (2020), the uncertainty of the volumetric water content can be expressed as:</span>
<span class="sd">    $$</span>
<span class="sd">    \sigma_{\theta_g}(N) = \sigma_N \frac{a_0 N_0}{(N_{cor} - a_1 N_0)^4} \sqrt{(N_{cor} - a_1 N_0)^4 + 8 \sigma_N^2 (N_{cor} - a_1 N_0)^2 + 15 \sigma_N^4}</span>
<span class="sd">    $$</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_counts (array): Raw neutron counts.</span>
<span class="sd">        N0 (float): Calibration parameter N0.</span>
<span class="sd">        bulk_density (float): Bulk density in g cm-3.</span>
<span class="sd">        fp (float): Pressure correction factor.</span>
<span class="sd">        fw (float): Humidity correction factor.</span>
<span class="sd">        fi (float): Incoming neutron flux correction factor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sigma_VWC (float): Uncertainty in terms of volumetric water content.</span>

<span class="sd">    References:</span>
<span class="sd">        Jakobi J, Huisman JA, Schrön M, Fiedler J, Brogi C, Vereecken H and Bogena HR (2020) Error Estimation for Soil Moisture Measurements With</span>
<span class="sd">        Cosmic Ray Neutron Sensing and Implications for Rover Surveys. Front. Water 2:10. doi: 10.3389/frwa.2020.00010</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Ncorr</span> <span class="o">=</span> <span class="n">raw_counts</span> <span class="o">*</span> <span class="n">fw</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">*</span> <span class="n">fi</span><span class="p">)</span>
    <span class="n">sigma_N</span> <span class="o">=</span> <span class="n">uncertainty_counts</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="n">fi</span><span class="p">)</span>
    <span class="n">sigma_GWC</span> <span class="o">=</span> <span class="n">sigma_N</span> <span class="o">*</span> <span class="p">((</span><span class="n">a0</span> <span class="o">*</span> <span class="n">N0</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">Ncorr</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">N0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="p">(</span><span class="n">Ncorr</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">N0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">sigma_N</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ncorr</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">N0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">sigma_N</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">sigma_VWC</span> <span class="o">=</span> <span class="n">sigma_GWC</span> <span class="o">*</span> <span class="n">bulk_density</span>

    <span class="k">return</span> <span class="n">sigma_VWC</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<a id="crnpy.data"></a>
  <div class="doc doc-contents first">
  
      <p><code>crnpy</code> is a package for processing observations from cosmic ray neutron detectors.</p>
<p>Modules exported by this package:</p>
<ul>
<li><code>crnpy</code>: Provide several functions to process observations from cosmic ray neutron detectors.</li>
</ul>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">




<h2 id="crnpy.data.abs_humidity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">abs_humidity</span><span class="p">(</span><span class="n">relative_humidity</span><span class="p">,</span> <span class="n">temp</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the actual vapor pressure (e) in g m^-3 using RH (%) and current temperature (c) observations.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>relative_humidity</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>relative humidity (%)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>temp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>temperature (Celsius)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>float</code></td>          <td>
          </td>
          <td>
            <div class="doc-md-description">
              <p>actual vapor pressure (g m^-3)</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">683</span>
<span class="normal">684</span>
<span class="normal">685</span>
<span class="normal">686</span>
<span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">abs_humidity</span><span class="p">(</span><span class="n">relative_humidity</span><span class="p">,</span> <span class="n">temp</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Compute the actual vapor pressure (e) in g m^-3 using RH (%) and current temperature (c) observations.</span>

<span class="sd">    Args:</span>
<span class="sd">        relative_humidity (float): relative humidity (%)</span>
<span class="sd">        temp (float): temperature (Celsius)</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: actual vapor pressure (g m^-3)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1">### Atmospheric water vapor factor</span>
    <span class="c1"># Saturation vapor pressure</span>
    <span class="n">e_sat</span> <span class="o">=</span> <span class="mf">0.611</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="mf">17.502</span> <span class="o">*</span> <span class="n">temp</span> <span class="o">/</span> <span class="p">(</span>
            <span class="n">temp</span> <span class="o">+</span> <span class="mf">240.97</span><span class="p">))</span> <span class="o">*</span> <span class="mi">1000</span>  <span class="c1"># in Pascals Eq. 3.8 p.41 Environmental Biophysics (Campbell and Norman)</span>

    <span class="c1"># Vapor pressure Pascals</span>
    <span class="n">Pw</span> <span class="o">=</span> <span class="n">e_sat</span> <span class="o">*</span> <span class="n">relative_humidity</span> <span class="o">/</span> <span class="mi">100</span>

    <span class="c1"># Absolute humidity (g/m^3)</span>
    <span class="n">C</span> <span class="o">=</span> <span class="mf">2.16679</span>  <span class="c1"># g K/J;</span>
    <span class="n">abs_h</span> <span class="o">=</span> <span class="n">C</span> <span class="o">*</span> <span class="n">Pw</span> <span class="o">/</span> <span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="mf">273.15</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">abs_h</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.atmospheric_depth" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">atmospheric_depth</span><span class="p">(</span><span class="n">elevation</span><span class="p">,</span> <span class="n">latitude</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the atmospheric depth for any point on Earth according to McJannet and Desilets, 2023</p>
<p>This function is required in the calculation of the location-dependent reference correction proposed by McJannet and Desilets, 2023.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>elevation</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Elevation in meters above sea level.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>latitude</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Geographic latitude in decimal degrees. Value in range -90 to 90</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth in g/cm2</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Atmosphere, U. S. (1976). US standard atmosphere. National Oceanic and Atmospheric Administration.</p>
<p>McJannet, D. L., &amp; Desilets, D. (2023). Incoming Neutron Flux Corrections for Cosmic‐Ray Soil and Snow Sensors Using the Global Neutron Monitor Network. Water Resources Research, 59(4), e2022WR033889.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1070</span>
<span class="normal">1071</span>
<span class="normal">1072</span>
<span class="normal">1073</span>
<span class="normal">1074</span>
<span class="normal">1075</span>
<span class="normal">1076</span>
<span class="normal">1077</span>
<span class="normal">1078</span>
<span class="normal">1079</span>
<span class="normal">1080</span>
<span class="normal">1081</span>
<span class="normal">1082</span>
<span class="normal">1083</span>
<span class="normal">1084</span>
<span class="normal">1085</span>
<span class="normal">1086</span>
<span class="normal">1087</span>
<span class="normal">1088</span>
<span class="normal">1089</span>
<span class="normal">1090</span>
<span class="normal">1091</span>
<span class="normal">1092</span>
<span class="normal">1093</span>
<span class="normal">1094</span>
<span class="normal">1095</span>
<span class="normal">1096</span>
<span class="normal">1097</span>
<span class="normal">1098</span>
<span class="normal">1099</span>
<span class="normal">1100</span>
<span class="normal">1101</span>
<span class="normal">1102</span>
<span class="normal">1103</span>
<span class="normal">1104</span>
<span class="normal">1105</span>
<span class="normal">1106</span>
<span class="normal">1107</span>
<span class="normal">1108</span>
<span class="normal">1109</span>
<span class="normal">1110</span>
<span class="normal">1111</span>
<span class="normal">1112</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">atmospheric_depth</span><span class="p">(</span><span class="n">elevation</span><span class="p">,</span> <span class="n">latitude</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to estimate the atmospheric depth for any point on Earth according to McJannet and Desilets, 2023</span>

<span class="sd">    This function is required in the calculation of the location-dependent reference correction proposed by McJannet and Desilets, 2023.</span>

<span class="sd">    Args:</span>
<span class="sd">        elevation (float): Elevation in meters above sea level.</span>
<span class="sd">        latitude (float): Geographic latitude in decimal degrees. Value in range -90 to 90</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Atmospheric depth in g/cm2</span>

<span class="sd">    References:</span>
<span class="sd">        Atmosphere, U. S. (1976). US standard atmosphere. National Oceanic and Atmospheric Administration.</span>

<span class="sd">        McJannet, D. L., &amp; Desilets, D. (2023). Incoming Neutron Flux Corrections for Cosmic‐Ray Soil and Snow Sensors Using the Global Neutron Monitor Network. Water Resources Research, 59(4), e2022WR033889.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">density_of_rock</span> <span class="o">=</span> <span class="mi">2670</span>  <span class="c1"># Density of rock in kg/m3</span>
    <span class="n">air_pressure_sea_level</span> <span class="o">=</span> <span class="mf">1013.25</span>  <span class="c1"># Air pressure at sea level in hPa</span>
    <span class="n">air_molar_mass</span> <span class="o">=</span> <span class="mf">0.0289644</span>  <span class="c1"># Air molar mass in kg/mol</span>
    <span class="n">universal_gas_constant</span> <span class="o">=</span> <span class="mf">8.31432</span>  <span class="c1"># Universal gas constant in J/(mol*K)</span>
    <span class="n">reference_temperature</span> <span class="o">=</span> <span class="mf">288.15</span>  <span class="c1"># Reference temperature Kelvin</span>
    <span class="n">temperature_lapse_rate</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0065</span>  <span class="c1"># Temperature lapse rate in K/m</span>

    <span class="c1"># Gravity at sea-level calculation</span>
    <span class="n">gravity_sea_level</span> <span class="o">=</span> <span class="mf">9.780327</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.0053024</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">-</span> <span class="mf">0.0000058</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">radians</span><span class="p">(</span><span class="n">latitude</span><span class="p">))</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="c1"># Free air correction</span>
    <span class="n">free_air</span> <span class="o">=</span> <span class="o">-</span><span class="mf">3.086</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">6</span> <span class="o">*</span> <span class="n">elevation</span>
    <span class="c1"># Bouguer correction</span>
    <span class="n">bouguer_corr</span> <span class="o">=</span> <span class="mf">4.193</span> <span class="o">*</span> <span class="mi">10</span> <span class="o">**</span> <span class="o">-</span><span class="mi">10</span> <span class="o">*</span> <span class="n">density_of_rock</span> <span class="o">*</span> <span class="n">elevation</span>
    <span class="c1"># Total gravity</span>
    <span class="n">gravity</span> <span class="o">=</span> <span class="n">gravity_sea_level</span> <span class="o">+</span> <span class="n">free_air</span> <span class="o">+</span> <span class="n">bouguer_corr</span>

    <span class="c1"># Air pressure calculation</span>
    <span class="n">reference_air_pressure</span> <span class="o">=</span> <span class="n">air_pressure_sea_level</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mi">1</span> <span class="o">+</span> <span class="n">temperature_lapse_rate</span> <span class="o">/</span> <span class="n">reference_temperature</span> <span class="o">*</span> <span class="n">elevation</span><span class="p">)</span> <span class="o">**</span> <span class="p">((</span><span class="o">-</span><span class="n">gravity</span> <span class="o">*</span> <span class="n">air_molar_mass</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span>
                <span class="n">universal_gas_constant</span> <span class="o">*</span> <span class="n">temperature_lapse_rate</span><span class="p">))</span>

    <span class="c1"># Atmospheric depth calculation</span>
    <span class="n">atmospheric_depth</span> <span class="o">=</span> <span class="p">(</span><span class="mi">10</span> <span class="o">*</span> <span class="n">reference_air_pressure</span><span class="p">)</span> <span class="o">/</span> <span class="n">gravity</span>
    <span class="k">return</span> <span class="n">atmospheric_depth</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.biomass_to_bwe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">biomass_to_bwe</span><span class="p">(</span><span class="n">biomass_dry</span><span class="p">,</span> <span class="n">biomass_fresh</span><span class="p">,</span> <span class="n">fWE</span><span class="o">=</span><span class="mf">0.494</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to convert biomass to biomass water equivalent.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>biomass_dry</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Above ground dry biomass in kg m-2.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>biomass_fresh</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Above ground fresh biomass in kg m-2.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fWE</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Stoichiometric ratio of H2O to organic carbon molecules in the plant (assuming this is mostly cellulose)
Default is 0.494 (Wahbi &amp; Avery, 2018).</p>
            </div>
          </td>
          <td>
                <code>0.494</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Biomass water equivalent in kg m-2.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Wahbi, A., Avery, W. (2018). In Situ Destructive Sampling. In:
Cosmic Ray Neutron Sensing: Estimation of Agricultural Crop Biomass Water Equivalent.
Springer, Cham. https://doi.org/10.1007/978-3-319-69539-6_2</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span>
<span class="normal">557</span>
<span class="normal">558</span>
<span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">biomass_to_bwe</span><span class="p">(</span><span class="n">biomass_dry</span><span class="p">,</span> <span class="n">biomass_fresh</span><span class="p">,</span> <span class="n">fWE</span><span class="o">=</span><span class="mf">0.494</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to convert biomass to biomass water equivalent.</span>

<span class="sd">    Args:</span>
<span class="sd">        biomass_dry (array or pd.Series or pd.DataFrame): Above ground dry biomass in kg m-2.</span>
<span class="sd">        biomass_fresh (array or pd.Series or pd.DataFrame): Above ground fresh biomass in kg m-2.</span>
<span class="sd">        fWE (float): Stoichiometric ratio of H2O to organic carbon molecules in the plant (assuming this is mostly cellulose)</span>
<span class="sd">            Default is 0.494 (Wahbi &amp; Avery, 2018).</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Biomass water equivalent in kg m-2.</span>

<span class="sd">    References:</span>
<span class="sd">        Wahbi, A., Avery, W. (2018). In Situ Destructive Sampling. In:</span>
<span class="sd">        Cosmic Ray Neutron Sensing: Estimation of Agricultural Crop Biomass Water Equivalent.</span>
<span class="sd">        Springer, Cham. https://doi.org/10.1007/978-3-319-69539-6_2</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">biomass_fresh</span> <span class="o">-</span> <span class="n">biomass_dry</span><span class="p">)</span> <span class="o">+</span> <span class="n">fWE</span> <span class="o">*</span> <span class="n">biomass_dry</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.correction_bwe" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_bwe</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">bwe</span><span class="p">,</span> <span class="n">r2_N0</span><span class="o">=</span><span class="mf">0.05</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to correct for biomass effects in neutron counts.
following the approach described in Baatz et al., 2015.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of ephithermal neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bwe</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Biomass water equivalent kg m-2.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>r2_N0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Ratio of neutron counts with biomass to neutron counts without biomass. Default is 0.05.</p>
            </div>
          </td>
          <td>
                <code>0.05</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of corrected neutron counts for biomass effects.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Baatz, R., H. R. Bogena, H.-J. Hendricks Franssen, J. A. Huisman, C. Montzka, and H. Vereecken (2015),
An empiricalvegetation correction for soil water content quantification using cosmic ray probes,
Water Resour. Res., 51, 2030–2046, doi:10.1002/ 2014WR016443.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_bwe</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">bwe</span><span class="p">,</span> <span class="n">r2_N0</span><span class="o">=</span><span class="mf">0.05</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to correct for biomass effects in neutron counts.</span>
<span class="sd">    following the approach described in Baatz et al., 2015.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (array or pd.Series or pd.DataFrame): Array of ephithermal neutron counts.</span>
<span class="sd">        bwe (float): Biomass water equivalent kg m-2.</span>
<span class="sd">        r2_N0 (float): Ratio of neutron counts with biomass to neutron counts without biomass. Default is 0.05.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Array of corrected neutron counts for biomass effects.</span>

<span class="sd">    References:</span>
<span class="sd">        Baatz, R., H. R. Bogena, H.-J. Hendricks Franssen, J. A. Huisman, C. Montzka, and H. Vereecken (2015),</span>
<span class="sd">        An empiricalvegetation correction for soil water content quantification using cosmic ray probes,</span>
<span class="sd">        Water Resour. Res., 51, 2030–2046, doi:10.1002/ 2014WR016443.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">counts</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">bwe</span> <span class="o">*</span> <span class="n">r2_N0</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.correction_humidity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_humidity</span><span class="p">(</span><span class="n">abs_humidity</span><span class="p">,</span> <span class="n">Aref</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Correction factor for absolute humidity.</p>
<p>This function corrects neutron counts for absolute humidity using the method described in Rosolem et al. (2013) and Anderson et al. (2017). The correction is performed using the following equation:</p>
<p>$$
C_{corrected} = C_{raw} \cdot f_w
$$</p>
<p>where:</p>
<ul>
<li>Ccorrected: corrected neutron counts</li>
<li>Craw: raw neutron counts</li>
<li>fw: absolute humidity correction factor</li>
</ul>
<p>$$
f_w = 1 + 0.0054(A - A_{ref})
$$</p>
<p>where:</p>
<ul>
<li>A: absolute humidity</li>
<li>Aref: reference absolute humidity</li>
</ul>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>abs_humidity</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Relative humidity readings.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Aref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference absolute humidity (g/m^3). The day of the instrument calibration is recommended.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>fw correction factor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Rosolem, R., W. J. Shuttleworth, M. Zreda, T. E. Franz, X. Zeng, and S. A. Kurc, 2013: The Effect of Atmospheric Water Vapor on Neutron Count in the Cosmic-Ray Soil Moisture Observing System. J. Hydrometeor., 14, 1659–1671, https://doi.org/10.1175/JHM-D-12-0120.1.</p>
<p>M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_humidity</span><span class="p">(</span><span class="n">abs_humidity</span><span class="p">,</span> <span class="n">Aref</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Correction factor for absolute humidity.</span>

<span class="sd">    This function corrects neutron counts for absolute humidity using the method described in Rosolem et al. (2013) and Anderson et al. (2017). The correction is performed using the following equation:</span>

<span class="sd">    $$</span>
<span class="sd">    C_{corrected} = C_{raw} \cdot f_w</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - Ccorrected: corrected neutron counts</span>
<span class="sd">    - Craw: raw neutron counts</span>
<span class="sd">    - fw: absolute humidity correction factor</span>

<span class="sd">    $$</span>
<span class="sd">    f_w = 1 + 0.0054(A - A_{ref})</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - A: absolute humidity</span>
<span class="sd">    - Aref: reference absolute humidity</span>

<span class="sd">    Args:</span>
<span class="sd">        abs_humidity (list or array): Relative humidity readings.</span>
<span class="sd">        Aref (float): Reference absolute humidity (g/m^3). The day of the instrument calibration is recommended.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): fw correction factor.</span>

<span class="sd">    References:</span>
<span class="sd">        Rosolem, R., W. J. Shuttleworth, M. Zreda, T. E. Franz, X. Zeng, and S. A. Kurc, 2013: The Effect of Atmospheric Water Vapor on Neutron Count in the Cosmic-Ray Soil Moisture Observing System. J. Hydrometeor., 14, 1659–1671, https://doi.org/10.1175/JHM-D-12-0120.1.</span>

<span class="sd">        M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">A</span> <span class="o">=</span> <span class="n">abs_humidity</span>
    <span class="n">fw</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="mf">0.0054</span> <span class="o">*</span> <span class="p">(</span><span class="n">A</span> <span class="o">-</span> <span class="n">Aref</span><span class="p">)</span>  <span class="c1"># Zreda et al. 2017 Eq 6.</span>
    <span class="k">return</span> <span class="n">fw</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.correction_incoming_flux" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_incoming_flux</span><span class="p">(</span><span class="n">incoming_neutrons</span><span class="p">,</span> <span class="n">incoming_Ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_na</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_site</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">site_atmdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_atmdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Correction factor for incoming neutron flux.</p>
<p>This function corrects neutron counts for incoming neutron flux using the method described in Anderson et al. (2017). The correction is performed using the following equation:</p>
<p>$$
C_{corrected} = \frac{C_{raw}}{f_i}
$$</p>
<p>where:</p>
<ul>
<li>Ccorrected: corrected neutron counts</li>
<li>Craw: raw neutron counts</li>
<li>fi: incoming neutron flux correction factor</li>
</ul>
<p>$$
f_i = \frac{I}{I_{ref}}
$$</p>
<p>where:</p>
<ul>
<li>I: incoming neutron flux</li>
<li>Iref: reference incoming neutron flux</li>
</ul>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>incoming_neutrons</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Incoming neutron flux readings.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>incoming_Ref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference incoming neutron flux. Baseline incoming neutron flux.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>fill_na</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Value to fill missing data. If None, missing data remains as NaN.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>Rc_method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Optional to correct for differences in cutoff rigidity between the site and the reference station. Possible values are 'McJannetandDesilets2023' or 'Hawdonetal2014'. If None, no correction is performed.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>Rc_site</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity at the monitoring site.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>site_atmdepth</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth at the monitoring site.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>Rc_ref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity at the reference station.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>ref_atmdepth</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth at the reference station.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>fi correction factor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Hawdon, A., D. McJannet, and J. Wallace (2014), Calibration and correction procedures for cosmic-ray neutron soil moisture probes located across Australia, Water Resour. Res., 50, 5029–5043, doi:10.1002/2013WR015138.</p>
<p>M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</p>
<p>McJannet, D. L., &amp; Desilets, D. (2023). Incoming neutron flux corrections for cosmic-ray soil and snow sensors using the global neutron monitor network. Water Resources Research, 59, e2022WR033889. https://doi.org/10.1029/2022WR033889</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_incoming_flux</span><span class="p">(</span><span class="n">incoming_neutrons</span><span class="p">,</span> <span class="n">incoming_Ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">fill_na</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_method</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_site</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                             <span class="n">site_atmdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Rc_ref</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ref_atmdepth</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Correction factor for incoming neutron flux.</span>

<span class="sd">    This function corrects neutron counts for incoming neutron flux using the method described in Anderson et al. (2017). The correction is performed using the following equation:</span>

<span class="sd">    $$</span>
<span class="sd">    C_{corrected} = \frac{C_{raw}}{f_i}</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - Ccorrected: corrected neutron counts</span>
<span class="sd">    - Craw: raw neutron counts</span>
<span class="sd">    - fi: incoming neutron flux correction factor</span>

<span class="sd">    $$</span>
<span class="sd">    f_i = \frac{I}{I_{ref}}</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - I: incoming neutron flux</span>
<span class="sd">    - Iref: reference incoming neutron flux</span>

<span class="sd">    Args:</span>
<span class="sd">        incoming_neutrons (list or array): Incoming neutron flux readings.</span>
<span class="sd">        incoming_Ref (float): Reference incoming neutron flux. Baseline incoming neutron flux.</span>
<span class="sd">        fill_na (float): Value to fill missing data. If None, missing data remains as NaN.</span>
<span class="sd">        Rc_method (str): Optional to correct for differences in cutoff rigidity between the site and the reference station. Possible values are &#39;McJannetandDesilets2023&#39; or &#39;Hawdonetal2014&#39;. If None, no correction is performed.</span>
<span class="sd">        Rc_site (float): Cutoff rigidity at the monitoring site.</span>
<span class="sd">        site_atmdepth (float): Atmospheric depth at the monitoring site.</span>
<span class="sd">        Rc_ref (float): Cutoff rigidity at the reference station.</span>
<span class="sd">        ref_atmdepth (float): Atmospheric depth at the reference station.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): fi correction factor.</span>

<span class="sd">    References:</span>
<span class="sd">        Hawdon, A., D. McJannet, and J. Wallace (2014), Calibration and correction procedures for cosmic-ray neutron soil moisture probes located across Australia, Water Resour. Res., 50, 5029–5043, doi:10.1002/2013WR015138.</span>

<span class="sd">        M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</span>

<span class="sd">        McJannet, D. L., &amp; Desilets, D. (2023). Incoming neutron flux corrections for cosmic-ray soil and snow sensors using the global neutron monitor network. Water Resources Research, 59, e2022WR033889. https://doi.org/10.1029/2022WR033889</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">incoming_Ref</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">incoming_neutrons</span><span class="p">,</span> <span class="nb">type</span><span class="p">(</span><span class="kc">None</span><span class="p">)):</span>
        <span class="n">incoming_Ref</span> <span class="o">=</span> <span class="n">incoming_neutrons</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Reference incoming neutron flux not provided. Using first value of incoming neutron flux.&#39;</span><span class="p">)</span>
    <span class="n">fi</span> <span class="o">=</span> <span class="n">incoming_neutrons</span> <span class="o">/</span> <span class="n">incoming_Ref</span>

    <span class="k">if</span> <span class="n">Rc_method</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">Rc_ref</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Reference cutoff rigidity not provided.&#39;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">Rc_site</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Site cutoff rigidity not provided.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">Rc_method</span> <span class="o">==</span> <span class="s1">&#39;McJannetandDesilets2023&#39;</span><span class="p">:</span>
            <span class="n">tau</span> <span class="o">=</span> <span class="n">location_factor</span><span class="p">(</span><span class="n">site_atmdepth</span><span class="p">,</span> <span class="n">Rc_site</span><span class="p">,</span> <span class="n">ref_atmdepth</span><span class="p">,</span> <span class="n">Rc_ref</span><span class="p">)</span>
            <span class="n">fi</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">tau</span> <span class="o">*</span> <span class="n">fi</span> <span class="o">+</span> <span class="mi">1</span> <span class="o">-</span> <span class="n">tau</span><span class="p">)</span>

        <span class="k">elif</span> <span class="n">Rc_method</span> <span class="o">==</span> <span class="s1">&#39;Hawdonetal2014&#39;</span><span class="p">:</span>
            <span class="n">Rc_corr</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.075</span> <span class="o">*</span> <span class="p">(</span><span class="n">Rc_site</span> <span class="o">-</span> <span class="n">Rc_ref</span><span class="p">)</span> <span class="o">+</span> <span class="mf">1.0</span>
            <span class="n">fi</span> <span class="o">=</span> <span class="p">(</span><span class="n">fi</span> <span class="o">-</span> <span class="mf">1.0</span><span class="p">)</span> <span class="o">*</span> <span class="n">Rc_corr</span> <span class="o">+</span> <span class="mf">1.0</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="s1">&#39;Cutoff rigidity method not found. Valid options are: McJannetandDesilets2023, Hawdonetal2014.&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">fill_na</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">fi</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">fill_na</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>  <span class="c1"># Use a value of 1 for days without data</span>

    <span class="k">return</span> <span class="n">fi</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.correction_pressure" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_pressure</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="n">Pref</span><span class="p">,</span> <span class="n">L</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Correction factor for atmospheric pressure.</p>
<p>This function corrects neutron counts for atmospheric pressure using the method described in Andreasen et al. (2017).
The correction is performed using the following equation:</p>
<p>$$
C_{corrected} = \frac{C_{raw}}{fp}
$$</p>
<p>where:</p>
<ul>
<li>Ccorrected: corrected neutron counts</li>
<li>Craw: raw neutron counts</li>
<li>fp: pressure correction factor</li>
</ul>
<p>$$
fp = e^{\frac{P_{ref} - P}{L}}
$$</p>
<p>where:</p>
<ul>
<li>P: atmospheric pressure</li>
<li>Pref: reference atmospheric pressure</li>
<li>L: Atmospheric attenuation coefficient.</li>
</ul>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>pressure</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric pressure readings. Long-term average pressure is recommended.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Pref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference atmospheric pressure.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>L</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric attenuation coefficient.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>fp pressure correction factor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., and Rosolem, R.: COSMOS: the COsmic-ray Soil Moisture Observing System, Hydrol. Earth Syst. Sci., 16, 4079–4099, https://doi.org/10.5194/hess-16-4079-2012, 2012.</p>
<p>M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_pressure</span><span class="p">(</span><span class="n">pressure</span><span class="p">,</span> <span class="n">Pref</span><span class="p">,</span> <span class="n">L</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Correction factor for atmospheric pressure.</span>

<span class="sd">    This function corrects neutron counts for atmospheric pressure using the method described in Andreasen et al. (2017).</span>
<span class="sd">    The correction is performed using the following equation:</span>

<span class="sd">    $$</span>
<span class="sd">    C_{corrected} = \frac{C_{raw}}{fp}</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - Ccorrected: corrected neutron counts</span>
<span class="sd">    - Craw: raw neutron counts</span>
<span class="sd">    - fp: pressure correction factor</span>

<span class="sd">    $$</span>
<span class="sd">    fp = e^{\frac{P_{ref} - P}{L}}</span>
<span class="sd">    $$</span>

<span class="sd">    where:</span>

<span class="sd">    - P: atmospheric pressure</span>
<span class="sd">    - Pref: reference atmospheric pressure</span>
<span class="sd">    - L: Atmospheric attenuation coefficient.</span>


<span class="sd">    Args:</span>
<span class="sd">        pressure (list or array): Atmospheric pressure readings. Long-term average pressure is recommended.</span>
<span class="sd">        Pref (float): Reference atmospheric pressure.</span>
<span class="sd">        L (float): Atmospheric attenuation coefficient.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): fp pressure correction factor.</span>

<span class="sd">    References:</span>
<span class="sd">        Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., and Rosolem, R.: COSMOS: the COsmic-ray Soil Moisture Observing System, Hydrol. Earth Syst. Sci., 16, 4079–4099, https://doi.org/10.5194/hess-16-4079-2012, 2012.</span>

<span class="sd">        M. Andreasen, K.H. Jensen, D. Desilets, T.E. Franz, M. Zreda, H.R. Bogena, and M.C. Looms. 2017. Status and perspectives on the cosmic-ray neutron method for soil moisture estimation and other environmental science applications. Vadose Zone J. 16(8). doi:10.2136/vzj2017.04.0086</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Compute pressure correction factor</span>
    <span class="n">fp</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">Pref</span> <span class="o">-</span> <span class="n">pressure</span><span class="p">)</span> <span class="o">/</span> <span class="n">L</span><span class="p">)</span>  <span class="c1"># Zreda et al. 2017 Eq 5.</span>

    <span class="k">return</span> <span class="n">fp</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.correction_road" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">correction_road</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">theta_N</span><span class="p">,</span> <span class="n">road_width</span><span class="p">,</span> <span class="n">road_distance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_road</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">p2</span><span class="o">=</span><span class="mf">1.06</span><span class="p">,</span> <span class="n">p3</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span> <span class="n">p4</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span> <span class="n">p6</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">p7</span><span class="o">=</span><span class="mf">1.1</span><span class="p">,</span> <span class="n">p8</span><span class="o">=</span><span class="mf">2.7</span><span class="p">,</span> <span class="n">p9</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to correct for road effects in neutron counts.
following the approach described in Schrön et al., 2018.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of ephithermal neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>theta_N</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Volumetric water content of the soil estimated from the uncorrected neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>road_width</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Width of the road in m.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>road_distance</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Distance of the road from the sensor in m. Default is 0.0.</p>
            </div>
          </td>
          <td>
                <code>0.0</code>
          </td>
        </tr>
        <tr>
          <td><code>theta_road</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Volumetric water content of the road. Default is 0.12.</p>
            </div>
          </td>
          <td>
                <code>0.12</code>
          </td>
        </tr>
        <tr>
          <td><code>p0-p9</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameters of the correction function. Default values are from Schrön et al., 2018.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of corrected neutron counts for road effects.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Schrön,M.,Rosolem,R.,Köhli,M., Piussi,L.,Schröter,I.,Iwema,J.,etal. (2018).Cosmic-ray neutron rover surveys
of field soil moisture and the influence of roads.WaterResources Research,54,6441–6459.
https://doi. org/10.1029/2017WR021719</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span>
<span class="normal">599</span>
<span class="normal">600</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">correction_road</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">theta_N</span><span class="p">,</span> <span class="n">road_width</span><span class="p">,</span> <span class="n">road_distance</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">theta_road</span><span class="o">=</span><span class="mf">0.12</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="mf">0.42</span><span class="p">,</span> <span class="n">p1</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span> <span class="n">p2</span><span class="o">=</span><span class="mf">1.06</span><span class="p">,</span> <span class="n">p3</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                    <span class="n">p4</span><span class="o">=</span><span class="mf">0.16</span><span class="p">,</span> <span class="n">p6</span><span class="o">=</span><span class="mf">0.94</span><span class="p">,</span> <span class="n">p7</span><span class="o">=</span><span class="mf">1.10</span><span class="p">,</span> <span class="n">p8</span><span class="o">=</span><span class="mf">2.70</span><span class="p">,</span> <span class="n">p9</span><span class="o">=</span><span class="mf">0.01</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to correct for road effects in neutron counts.</span>
<span class="sd">    following the approach described in Schrön et al., 2018.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (array or pd.Series or pd.DataFrame): Array of ephithermal neutron counts.</span>
<span class="sd">        theta_N (float): Volumetric water content of the soil estimated from the uncorrected neutron counts.</span>
<span class="sd">        road_width (float): Width of the road in m.</span>
<span class="sd">        road_distance (float): Distance of the road from the sensor in m. Default is 0.0.</span>
<span class="sd">        theta_road (float): Volumetric water content of the road. Default is 0.12.</span>
<span class="sd">        p0-p9 (float): Parameters of the correction function. Default values are from Schrön et al., 2018.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Array of corrected neutron counts for road effects.</span>

<span class="sd">    References:</span>
<span class="sd">        Schrön,M.,Rosolem,R.,Köhli,M., Piussi,L.,Schröter,I.,Iwema,J.,etal. (2018).Cosmic-ray neutron rover surveys</span>
<span class="sd">        of field soil moisture and the influence of roads.WaterResources Research,54,6441–6459.</span>
<span class="sd">        https://doi. org/10.1029/2017WR021719</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">F1</span> <span class="o">=</span> <span class="n">p0</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p1</span> <span class="o">*</span> <span class="n">road_width</span><span class="p">))</span>
    <span class="n">F2</span> <span class="o">=</span> <span class="o">-</span><span class="n">p2</span> <span class="o">-</span> <span class="n">p3</span> <span class="o">*</span> <span class="n">theta_road</span> <span class="o">-</span> <span class="p">((</span><span class="n">p4</span> <span class="o">+</span> <span class="n">theta_road</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">theta_N</span><span class="p">))</span>
    <span class="n">F3</span> <span class="o">=</span> <span class="n">p6</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p7</span> <span class="o">*</span> <span class="p">(</span><span class="n">road_width</span> <span class="o">**</span> <span class="o">-</span><span class="n">p8</span><span class="p">)</span> <span class="o">*</span> <span class="n">road_distance</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p6</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p9</span> <span class="o">*</span> <span class="n">road_distance</span><span class="p">)</span>

    <span class="n">C_roads</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">F1</span> <span class="o">*</span> <span class="n">F2</span> <span class="o">*</span> <span class="n">F3</span>

    <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">counts</span> <span class="o">/</span> <span class="n">C_roads</span>

    <span class="k">return</span> <span class="n">corrected_counts</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.counts_to_vwc" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">counts_to_vwc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">Wsoc</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to convert corrected and filtered neutron counts into volumetric water content.</p>
<p>This method implements soil moisture estimation using the non-linear relationship between neutron count and soil volumetric water content following the approach described in Desilets et al., 2010.</p>
<p>$\theta(N) =\frac{a_0}{(\frac{N}{N_0}) - a_1} - a_2 $</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Array of corrected and filtered neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>N0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Device-specific neutron calibration constant.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Wlat</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Lattice water content.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Wsoc</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil organic carbon content.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bulk_density</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil bulk density.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>a0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameter given in Zreda et al., 2012. Default is 0.0808.</p>
            </div>
          </td>
          <td>
                <code>0.0808</code>
          </td>
        </tr>
        <tr>
          <td><code>a1</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameter given in Zreda et al., 2012. Default is 0.372.</p>
            </div>
          </td>
          <td>
                <code>0.372</code>
          </td>
        </tr>
        <tr>
          <td><code>a2</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Parameter given in Zreda et al., 2012. Default is 0.115.</p>
            </div>
          </td>
          <td>
                <code>0.115</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Volumetric water content in m3 m-3.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Desilets, D., M. Zreda, and T.P.A. Ferré. 2010. Nature’s neutron probe:
Land surface hydrology at an elusive scale with cosmic rays. Water Resour. Res. 46:W11505.
doi.org/10.1029/2009WR008726</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">counts_to_vwc</span><span class="p">(</span><span class="n">counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">Wsoc</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to convert corrected and filtered neutron counts into volumetric water content.</span>

<span class="sd">    This method implements soil moisture estimation using the non-linear relationship between neutron count and soil volumetric water content following the approach described in Desilets et al., 2010.</span>

<span class="sd">    $\theta(N) =\frac{a_0}{(\frac{N}{N_0}) - a_1} - a_2 $</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (array or pd.Series or pd.DataFrame): Array of corrected and filtered neutron counts.</span>
<span class="sd">        N0 (float): Device-specific neutron calibration constant.</span>
<span class="sd">        Wlat (float): Lattice water content.</span>
<span class="sd">        Wsoc (float): Soil organic carbon content.</span>
<span class="sd">        bulk_density (float): Soil bulk density.</span>
<span class="sd">        a0 (float): Parameter given in Zreda et al., 2012. Default is 0.0808.</span>
<span class="sd">        a1 (float): Parameter given in Zreda et al., 2012. Default is 0.372.</span>
<span class="sd">        a2 (float): Parameter given in Zreda et al., 2012. Default is 0.115.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Volumetric water content in m3 m-3.</span>

<span class="sd">    References:</span>
<span class="sd">        Desilets, D., M. Zreda, and T.P.A. Ferré. 2010. Nature’s neutron probe:</span>
<span class="sd">        Land surface hydrology at an elusive scale with cosmic rays. Water Resour. Res. 46:W11505.</span>
<span class="sd">        doi.org/10.1029/2009WR008726</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert neutron counts into vwc</span>
    <span class="n">vwc</span> <span class="o">=</span> <span class="p">(</span><span class="n">a0</span> <span class="o">/</span> <span class="p">(</span><span class="n">counts</span> <span class="o">/</span> <span class="n">N0</span> <span class="o">-</span> <span class="n">a1</span><span class="p">)</span> <span class="o">-</span> <span class="n">a2</span> <span class="o">-</span> <span class="n">Wlat</span> <span class="o">-</span> <span class="n">Wsoc</span><span class="p">)</span> <span class="o">*</span> <span class="n">bulk_density</span>
    <span class="k">return</span> <span class="n">vwc</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.cutoff_rigidity" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">cutoff_rigidity</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the approximate cutoff rigidity for any point on Earth according to the
tabulated data of Smart and Shea, 2019. The returned value can be used to select the appropriate
neutron monitor station to estimate the cosmic-ray neutron intensity at the location of interest.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>lat</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Geographic latitude in decimal degrees. Value in range -90 to 90</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lon</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Geographic longitude in decimal degrees. Values in range from 0 to 360.
Typical negative longitudes in the west hemisphere will fall in the range 180 to 360.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity in GV. Error is about +/- 0.3 GV</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <p>Estimate the cutoff rigidity for Newark, NJ, US</p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">zq</span> <span class="o">=</span> <span class="n">cutoff_rigidity</span><span class="p">(</span><span class="mf">39.68</span><span class="p">,</span> <span class="o">-</span><span class="mf">75.75</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">zq</span><span class="p">)</span>
<span class="go">2.52 GV (Value from NMD is 2.40 GV)</span>
</code></pre></div>

<details class="references" open>
  <summary>References</summary>
  <p>Hawdon, A., McJannet, D., &amp; Wallace, J. (2014). Calibration and correction procedures
for cosmic‐ray neutron soil moisture probes located across Australia. Water Resources Research,
50(6), 5029-5043.</p>
<p>Smart, D. &amp; Shea, Matthew. (2001). Geomagnetic Cutoff Rigidity Computer Program:
Theory, Software Description and Example. NASA STI/Recon Technical Report N.</p>
<p>Shea, M. A., &amp; Smart, D. F. (2019, July). Re-examination of the First Five Ground-Level Events.
In International Cosmic Ray Conference (ICRC2019) (Vol. 36, p. 1149).</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1023</span>
<span class="normal">1024</span>
<span class="normal">1025</span>
<span class="normal">1026</span>
<span class="normal">1027</span>
<span class="normal">1028</span>
<span class="normal">1029</span>
<span class="normal">1030</span>
<span class="normal">1031</span>
<span class="normal">1032</span>
<span class="normal">1033</span>
<span class="normal">1034</span>
<span class="normal">1035</span>
<span class="normal">1036</span>
<span class="normal">1037</span>
<span class="normal">1038</span>
<span class="normal">1039</span>
<span class="normal">1040</span>
<span class="normal">1041</span>
<span class="normal">1042</span>
<span class="normal">1043</span>
<span class="normal">1044</span>
<span class="normal">1045</span>
<span class="normal">1046</span>
<span class="normal">1047</span>
<span class="normal">1048</span>
<span class="normal">1049</span>
<span class="normal">1050</span>
<span class="normal">1051</span>
<span class="normal">1052</span>
<span class="normal">1053</span>
<span class="normal">1054</span>
<span class="normal">1055</span>
<span class="normal">1056</span>
<span class="normal">1057</span>
<span class="normal">1058</span>
<span class="normal">1059</span>
<span class="normal">1060</span>
<span class="normal">1061</span>
<span class="normal">1062</span>
<span class="normal">1063</span>
<span class="normal">1064</span>
<span class="normal">1065</span>
<span class="normal">1066</span>
<span class="normal">1067</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">cutoff_rigidity</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to estimate the approximate cutoff rigidity for any point on Earth according to the</span>
<span class="sd">    tabulated data of Smart and Shea, 2019. The returned value can be used to select the appropriate</span>
<span class="sd">    neutron monitor station to estimate the cosmic-ray neutron intensity at the location of interest.</span>

<span class="sd">    Args:</span>
<span class="sd">        lat (float): Geographic latitude in decimal degrees. Value in range -90 to 90</span>
<span class="sd">        lon (float): Geographic longitude in decimal degrees. Values in range from 0 to 360.</span>
<span class="sd">            Typical negative longitudes in the west hemisphere will fall in the range 180 to 360.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Cutoff rigidity in GV. Error is about +/- 0.3 GV</span>

<span class="sd">    Examples:</span>
<span class="sd">        Estimate the cutoff rigidity for Newark, NJ, US</span>

<span class="sd">        &gt;&gt;&gt; zq = cutoff_rigidity(39.68, -75.75)</span>
<span class="sd">        &gt;&gt;&gt; print(zq)</span>
<span class="sd">        2.52 GV (Value from NMD is 2.40 GV)</span>

<span class="sd">    References:</span>
<span class="sd">        Hawdon, A., McJannet, D., &amp; Wallace, J. (2014). Calibration and correction procedures</span>
<span class="sd">        for cosmic‐ray neutron soil moisture probes located across Australia. Water Resources Research,</span>
<span class="sd">        50(6), 5029-5043.</span>

<span class="sd">        Smart, D. &amp; Shea, Matthew. (2001). Geomagnetic Cutoff Rigidity Computer Program:</span>
<span class="sd">        Theory, Software Description and Example. NASA STI/Recon Technical Report N.</span>

<span class="sd">        Shea, M. A., &amp; Smart, D. F. (2019, July). Re-examination of the First Five Ground-Level Events.</span>
<span class="sd">        In International Cosmic Ray Conference (ICRC2019) (Vol. 36, p. 1149).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">xq</span> <span class="o">=</span> <span class="n">lon</span>
    <span class="n">yq</span> <span class="o">=</span> <span class="n">lat</span>

    <span class="k">if</span> <span class="n">xq</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">xq</span> <span class="o">=</span> <span class="n">xq</span> <span class="o">*</span> <span class="o">-</span><span class="mi">1</span> <span class="o">+</span> <span class="mi">180</span>
    <span class="n">Z</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">cutoff_rigidity</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">360</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="o">-</span><span class="mi">90</span><span class="p">,</span> <span class="n">Z</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">X</span><span class="p">,</span> <span class="n">Y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
    <span class="n">points</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">((</span><span class="n">X</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">Y</span><span class="o">.</span><span class="n">flatten</span><span class="p">()))</span><span class="o">.</span><span class="n">T</span>
    <span class="n">values</span> <span class="o">=</span> <span class="n">Z</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">zq</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">values</span><span class="p">,</span> <span class="p">(</span><span class="n">xq</span><span class="p">,</span> <span class="n">yq</span><span class="p">))</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">zq</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.euclidean_distance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">euclidean_distance</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that computes the Euclidean distance between one point
in space and one or more points.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>px</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>x projected coordinate of the point.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>py</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>y projected coordinate of the point.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>(list, ndarray, <span title="pandas.series">series</span>)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>vector of x projected coordinates.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>(list, ndarray, <span title="pandas.series">series</span>)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>vector of y projected coordinates.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>ndarray</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Numpy array of distances from the point (px,py) to all the points in x and y vectors.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1318</span>
<span class="normal">1319</span>
<span class="normal">1320</span>
<span class="normal">1321</span>
<span class="normal">1322</span>
<span class="normal">1323</span>
<span class="normal">1324</span>
<span class="normal">1325</span>
<span class="normal">1326</span>
<span class="normal">1327</span>
<span class="normal">1328</span>
<span class="normal">1329</span>
<span class="normal">1330</span>
<span class="normal">1331</span>
<span class="normal">1332</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">euclidean_distance</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that computes the Euclidean distance between one point</span>
<span class="sd">    in space and one or more points.</span>

<span class="sd">    Args:</span>
<span class="sd">        px (float): x projected coordinate of the point.</span>
<span class="sd">        py (float): y projected coordinate of the point.</span>
<span class="sd">        x (list, ndarray, pandas.series): vector of x projected coordinates.</span>
<span class="sd">        y (list, ndarray, pandas.series): vector of y projected coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (ndarray): Numpy array of distances from the point (px,py) to all the points in x and y vectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">d</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">((</span><span class="n">px</span> <span class="o">-</span> <span class="n">x</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="p">(</span><span class="n">py</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">d</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.exp_filter" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">exp_filter</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Exponential filter to estimate soil moisture in the rootzone from surface observtions.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>sm</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil moisture in mm of water for the top layer of the soil profile.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>T</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Characteristic time length in the same units as the measurement interval.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>sm_subsurface</code></td>          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Subsurface soil moisture in the same units as the input.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Albergel, C., Rüdiger, C., Pellarin, T., Calvet, J.C., Fritz, N., Froissard, F., Suquia, D., Petitpa, A., Piguet, B. and Martin, E., 2008.
From near-surface to root-zone soil moisture using an exponential filter: an assessment of the method based on in-situ observations and model
simulations. Hydrology and Earth System Sciences, 12(6), pp.1323-1337.</p>
<p>Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.
Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.</p>
<p>Rossini, P. and Patrignani, A., 2021. Predicting rootzone soil moisture from surface observations in cropland using an exponential filter.
Soil Science Society of America Journal.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 973</span>
<span class="normal"> 974</span>
<span class="normal"> 975</span>
<span class="normal"> 976</span>
<span class="normal"> 977</span>
<span class="normal"> 978</span>
<span class="normal"> 979</span>
<span class="normal"> 980</span>
<span class="normal"> 981</span>
<span class="normal"> 982</span>
<span class="normal"> 983</span>
<span class="normal"> 984</span>
<span class="normal"> 985</span>
<span class="normal"> 986</span>
<span class="normal"> 987</span>
<span class="normal"> 988</span>
<span class="normal"> 989</span>
<span class="normal"> 990</span>
<span class="normal"> 991</span>
<span class="normal"> 992</span>
<span class="normal"> 993</span>
<span class="normal"> 994</span>
<span class="normal"> 995</span>
<span class="normal"> 996</span>
<span class="normal"> 997</span>
<span class="normal"> 998</span>
<span class="normal"> 999</span>
<span class="normal">1000</span>
<span class="normal">1001</span>
<span class="normal">1002</span>
<span class="normal">1003</span>
<span class="normal">1004</span>
<span class="normal">1005</span>
<span class="normal">1006</span>
<span class="normal">1007</span>
<span class="normal">1008</span>
<span class="normal">1009</span>
<span class="normal">1010</span>
<span class="normal">1011</span>
<span class="normal">1012</span>
<span class="normal">1013</span>
<span class="normal">1014</span>
<span class="normal">1015</span>
<span class="normal">1016</span>
<span class="normal">1017</span>
<span class="normal">1018</span>
<span class="normal">1019</span>
<span class="normal">1020</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">exp_filter</span><span class="p">(</span><span class="n">sm</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Exponential filter to estimate soil moisture in the rootzone from surface observtions.</span>

<span class="sd">    Args:</span>
<span class="sd">        sm (list or array): Soil moisture in mm of water for the top layer of the soil profile.</span>
<span class="sd">        T (float): Characteristic time length in the same units as the measurement interval.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sm_subsurface (list or array): Subsurface soil moisture in the same units as the input.</span>

<span class="sd">    References:</span>
<span class="sd">        Albergel, C., Rüdiger, C., Pellarin, T., Calvet, J.C., Fritz, N., Froissard, F., Suquia, D., Petitpa, A., Piguet, B. and Martin, E., 2008.</span>
<span class="sd">        From near-surface to root-zone soil moisture using an exponential filter: an assessment of the method based on in-situ observations and model</span>
<span class="sd">        simulations. Hydrology and Earth System Sciences, 12(6), pp.1323-1337.</span>

<span class="sd">        Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.</span>
<span class="sd">        Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.</span>

<span class="sd">        Rossini, P. and Patrignani, A., 2021. Predicting rootzone soil moisture from surface observations in cropland using an exponential filter.</span>
<span class="sd">        Soil Science Society of America Journal.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Parameters</span>
    <span class="n">t_delta</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">sm_min</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
    <span class="n">sm_max</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">sm</span><span class="p">)</span>
    <span class="n">ms</span> <span class="o">=</span> <span class="p">(</span><span class="n">sm</span> <span class="o">-</span> <span class="n">sm_min</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">sm_max</span> <span class="o">-</span> <span class="n">sm_min</span><span class="p">)</span>

    <span class="c1"># Pre-allocate soil water index array and recursive constant K</span>
    <span class="n">SWI</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
    <span class="n">K</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">ms</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>

    <span class="c1"># Initial conditions</span>
    <span class="n">SWI</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">K</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

    <span class="c1"># Values from 2 to N</span>
    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">SWI</span><span class="p">)):</span>
        <span class="k">if</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="n">n</span><span class="p">])</span> <span class="o">&amp;</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]):</span>
            <span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">K</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">K</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">t_delta</span> <span class="o">/</span> <span class="n">T</span><span class="p">))</span>
            <span class="n">SWI</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">SWI</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="n">K</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">ms</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">-</span> <span class="n">SWI</span><span class="p">[</span><span class="n">n</span> <span class="o">-</span> <span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">continue</span>

    <span class="c1"># Rootzone storage</span>
    <span class="n">sm_subsurface</span> <span class="o">=</span> <span class="n">SWI</span> <span class="o">*</span> <span class="p">(</span><span class="n">sm_max</span> <span class="o">-</span> <span class="n">sm_min</span><span class="p">)</span> <span class="o">+</span> <span class="n">sm_min</span>

    <span class="k">return</span> <span class="n">sm_subsurface</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.fill_missing_timestamps" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">fill_missing_timestamps</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">round_timestamp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Helper function to fill rows with missing timestamps in datetime record. Rows are filled with NaN values.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pandas DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamp_col</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Column with the timestamp. Must be in datetime format. Default column name is 'timestamp'.</p>
            </div>
          </td>
          <td>
                <code>&#39;timestamp&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>freq</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Timestamp frequency. 'H' for hourly, 'M' for minute, or None. Can also use '3H' for a 3 hour frequency. Default is 'H'.</p>
            </div>
          </td>
          <td>
                <code>&#39;H&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>round_timestamp</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to round timestamps to the nearest frequency. Default is True.</p>
            </div>
          </td>
          <td>
                <code>True</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Prints the missing timestamps added to the DatFrame.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>DataFrame with filled missing timestamps.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">fill_missing_timestamps</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="o">=</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;H&#39;</span><span class="p">,</span> <span class="n">round_timestamp</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Helper function to fill rows with missing timestamps in datetime record. Rows are filled with NaN values.</span>

<span class="sd">     Args:</span>
<span class="sd">         df (pandas.DataFrame): Pandas DataFrame.</span>
<span class="sd">         timestamp_col (str, optional): Column with the timestamp. Must be in datetime format. Default column name is &#39;timestamp&#39;.</span>
<span class="sd">         freq (str, optional): Timestamp frequency. &#39;H&#39; for hourly, &#39;M&#39; for minute, or None. Can also use &#39;3H&#39; for a 3 hour frequency. Default is &#39;H&#39;.</span>
<span class="sd">         round_timestamp (bool, optional): Whether to round timestamps to the nearest frequency. Default is True.</span>
<span class="sd">         verbose (bool, optional): Prints the missing timestamps added to the DatFrame.</span>

<span class="sd">     Returns:</span>
<span class="sd">         (pandas.DataFrame): DataFrame with filled missing timestamps.</span>

<span class="sd">     &quot;&quot;&quot;</span>

    <span class="c1"># Check format of timestamp column</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;timestamp_col must be datetime64. Use `pd.to_datetime()` to fix this issue.&#39;</span><span class="p">)</span>

    <span class="c1"># Round timestamps to nearest frequency. This steps must preced the filling of rows.</span>
    <span class="k">if</span> <span class="n">round_timestamp</span><span class="p">:</span>
        <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">freq</span><span class="p">)</span>

    <span class="c1"># Fill in rows with missing timestamps</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">date_range</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">freq</span><span class="o">=</span><span class="n">freq</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">date</span> <span class="ow">in</span> <span class="n">date_range</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">date</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
                <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Adding missing date:&#39;</span><span class="p">,</span> <span class="n">date</span><span class="p">)</span>
            <span class="n">new_line</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="n">timestamp_col</span><span class="p">:</span> <span class="n">date</span><span class="p">},</span> <span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span>  <span class="c1"># By default fills columns with np.nan</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">df</span><span class="p">,</span> <span class="n">new_line</span><span class="p">])</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="n">df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="n">timestamp_col</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Notify user about the number of rows that have been removed</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Added a total of </span><span class="si">{</span><span class="n">counter</span><span class="si">}</span><span class="s2"> missing timestamps.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.find_neutron_monitor" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">find_neutron_monitor</span><span class="p">(</span><span class="n">Rc</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Search for potential reference neutron monitoring stations based on cutoff rigidity.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>Rc</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity in GV. Values in range 1.0 to 3.0 GV.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>start_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Start date for the period of interest.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>end_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>End date for the period of interest.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If True, print a expanded output of the incoming neutron flux data.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of top five stations with closes cutoff rigidity.
User needs to select station according to site altitude.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">crnpy</span> <span class="kn">import</span> <span class="n">crnpy</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">Rc</span> <span class="o">=</span> <span class="mf">2.40</span> <span class="c1"># 2.40 Newark, NJ, US</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">crnpy</span><span class="o">.</span><span class="n">find_neutron_monitor</span><span class="p">(</span><span class="n">Rc</span><span class="p">)</span>
<span class="go">Select a station with an altitude similar to that of your location. For more information go to: &#39;https://www.nmdb.eu/nest/help.php#helpstations</span>
</code></pre></div>
    <p>Your cutoff rigidity is 2.4 GV
        STID                          NAME     R  Altitude_m
40   NEWK                        Newark  2.40          50
33   MOSC                        Moscow  2.43         200
27   KIEL                          Kiel  2.36          54
28  KIEL2                        KielRT  2.36          54
31   MCRL  Mobile Cosmic Ray Laboratory  2.46         200
32   MGDN                       Magadan  2.10         220
42   NVBK                   Novosibirsk  2.91         163
26   KGSN                      Kingston  1.88          65
9    CLMX                        Climax  3.00        3400
57   YKTK                       Yakutsk  1.65         105</p>

<details class="references" open>
  <summary>References</summary>
  <p>https://www.nmdb.eu/nest/help.php#helpstations</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1156</span>
<span class="normal">1157</span>
<span class="normal">1158</span>
<span class="normal">1159</span>
<span class="normal">1160</span>
<span class="normal">1161</span>
<span class="normal">1162</span>
<span class="normal">1163</span>
<span class="normal">1164</span>
<span class="normal">1165</span>
<span class="normal">1166</span>
<span class="normal">1167</span>
<span class="normal">1168</span>
<span class="normal">1169</span>
<span class="normal">1170</span>
<span class="normal">1171</span>
<span class="normal">1172</span>
<span class="normal">1173</span>
<span class="normal">1174</span>
<span class="normal">1175</span>
<span class="normal">1176</span>
<span class="normal">1177</span>
<span class="normal">1178</span>
<span class="normal">1179</span>
<span class="normal">1180</span>
<span class="normal">1181</span>
<span class="normal">1182</span>
<span class="normal">1183</span>
<span class="normal">1184</span>
<span class="normal">1185</span>
<span class="normal">1186</span>
<span class="normal">1187</span>
<span class="normal">1188</span>
<span class="normal">1189</span>
<span class="normal">1190</span>
<span class="normal">1191</span>
<span class="normal">1192</span>
<span class="normal">1193</span>
<span class="normal">1194</span>
<span class="normal">1195</span>
<span class="normal">1196</span>
<span class="normal">1197</span>
<span class="normal">1198</span>
<span class="normal">1199</span>
<span class="normal">1200</span>
<span class="normal">1201</span>
<span class="normal">1202</span>
<span class="normal">1203</span>
<span class="normal">1204</span>
<span class="normal">1205</span>
<span class="normal">1206</span>
<span class="normal">1207</span>
<span class="normal">1208</span>
<span class="normal">1209</span>
<span class="normal">1210</span>
<span class="normal">1211</span>
<span class="normal">1212</span>
<span class="normal">1213</span>
<span class="normal">1214</span>
<span class="normal">1215</span>
<span class="normal">1216</span>
<span class="normal">1217</span>
<span class="normal">1218</span>
<span class="normal">1219</span>
<span class="normal">1220</span>
<span class="normal">1221</span>
<span class="normal">1222</span>
<span class="normal">1223</span>
<span class="normal">1224</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">find_neutron_monitor</span><span class="p">(</span><span class="n">Rc</span><span class="p">,</span> <span class="n">start_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">end_date</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Search for potential reference neutron monitoring stations based on cutoff rigidity.</span>

<span class="sd">    Args:</span>
<span class="sd">        Rc (float): Cutoff rigidity in GV. Values in range 1.0 to 3.0 GV.</span>
<span class="sd">        start_date (datetime): Start date for the period of interest.</span>
<span class="sd">        end_date (datetime): End date for the period of interest.</span>
<span class="sd">        verbose (bool): If True, print a expanded output of the incoming neutron flux data.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (list): List of top five stations with closes cutoff rigidity.</span>
<span class="sd">            User needs to select station according to site altitude.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; from crnpy import crnpy</span>
<span class="sd">        &gt;&gt;&gt; Rc = 2.40 # 2.40 Newark, NJ, US</span>
<span class="sd">        &gt;&gt;&gt; crnpy.find_neutron_monitor(Rc)</span>
<span class="sd">        Select a station with an altitude similar to that of your location. For more information go to: &#39;https://www.nmdb.eu/nest/help.php#helpstations</span>

<span class="sd">        Your cutoff rigidity is 2.4 GV</span>
<span class="sd">                STID                          NAME     R  Altitude_m</span>
<span class="sd">        40   NEWK                        Newark  2.40          50</span>
<span class="sd">        33   MOSC                        Moscow  2.43         200</span>
<span class="sd">        27   KIEL                          Kiel  2.36          54</span>
<span class="sd">        28  KIEL2                        KielRT  2.36          54</span>
<span class="sd">        31   MCRL  Mobile Cosmic Ray Laboratory  2.46         200</span>
<span class="sd">        32   MGDN                       Magadan  2.10         220</span>
<span class="sd">        42   NVBK                   Novosibirsk  2.91         163</span>
<span class="sd">        26   KGSN                      Kingston  1.88          65</span>
<span class="sd">        9    CLMX                        Climax  3.00        3400</span>
<span class="sd">        57   YKTK                       Yakutsk  1.65         105</span>

<span class="sd">    References:</span>
<span class="sd">        https://www.nmdb.eu/nest/help.php#helpstations</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Load file with list of neutron monitoring stations</span>
    <span class="n">stations</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">neutron_detectors</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;STID&quot;</span><span class="p">,</span> <span class="s2">&quot;NAME&quot;</span><span class="p">,</span> <span class="s2">&quot;R&quot;</span><span class="p">,</span> <span class="s2">&quot;Altitude_m&quot;</span><span class="p">])</span>

    <span class="c1"># Sort stations by closest cutoff rigidity</span>
    <span class="n">idx_R</span> <span class="o">=</span> <span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Rc</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">start_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">end_date</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">stations</span><span class="p">[</span><span class="s2">&quot;Period available&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">station</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_R</span><span class="p">[</span><span class="n">i</span><span class="p">]][</span><span class="s2">&quot;STID&quot;</span><span class="p">]</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="n">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="n">verbose</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">stations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_R</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="k">pass</span>

        <span class="k">if</span> <span class="nb">sum</span><span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="s2">&quot;Period available&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;No stations available for the selected period!&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">stations</span> <span class="o">=</span> <span class="n">stations</span><span class="p">[</span><span class="n">stations</span><span class="p">[</span><span class="s2">&quot;Period available&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="kc">True</span><span class="p">]</span>
            <span class="n">idx_R</span> <span class="o">=</span> <span class="p">(</span><span class="n">stations</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">Rc</span><span class="p">)</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">argsort</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">idx_R</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">10</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">result</span> <span class="o">=</span> <span class="n">stations</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">idx_R</span><span class="p">)</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># Print results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Select a station with an altitude similar to that of your location. For more information go to: &#39;https://www.nmdb.eu/nest/help.php#helpstations&quot;&quot;&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Your cutoff rigidity is </span><span class="si">{</span><span class="n">Rc</span><span class="si">}</span><span class="s2"> GV&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">result</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.get_incoming_neutron_flux" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">utc_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">expand_window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to retrieve neutron flux from the Neutron Monitor Database.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>start_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Start date of the time series.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>end_date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>End date of the time series.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>station</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Neutron Monitor station to retrieve data from.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>utc_offset</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTC offset in hours. Default is 0.</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>expand_window</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Number of hours to expand the time window to retrieve extra data. Default is 0.</p>
            </div>
          </td>
          <td>
                <code>0</code>
          </td>
        </tr>
        <tr>
          <td><code>verbose</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Print information about the request. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Neutron flux in counts per hour and timestamps.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Documentation available:https://www.nmdb.eu/nest/help.php#howto</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span>
<span class="normal">421</span>
<span class="normal">422</span>
<span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">start_date</span><span class="p">,</span> <span class="n">end_date</span><span class="p">,</span> <span class="n">station</span><span class="p">,</span> <span class="n">utc_offset</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">expand_window</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to retrieve neutron flux from the Neutron Monitor Database.</span>

<span class="sd">    Args:</span>
<span class="sd">        start_date (datetime): Start date of the time series.</span>
<span class="sd">        end_date (datetime): End date of the time series.</span>
<span class="sd">        station (str): Neutron Monitor station to retrieve data from.</span>
<span class="sd">        utc_offset (int): UTC offset in hours. Default is 0.</span>
<span class="sd">        expand_window (int): Number of hours to expand the time window to retrieve extra data. Default is 0.</span>
<span class="sd">        verbose (bool): Print information about the request. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Neutron flux in counts per hour and timestamps.</span>

<span class="sd">    References:</span>
<span class="sd">        Documentation available:https://www.nmdb.eu/nest/help.php#howto</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Example: get_incoming_neutron_flux(station=&#39;IRKT&#39;,start_date=&#39;2020-04-10 11:00:00&#39;,end_date=&#39;2020-06-18 17:00:00&#39;)</span>
    <span class="c1"># Template url = &#39;http://nest.nmdb.eu/draw_graph.php?formchk=1&amp;stations[]=KERG&amp;output=ascii&amp;tabchoice=revori&amp;dtype=corr_for_efficiency&amp;date_choice=bydate&amp;start_year=2009&amp;start_month=09&amp;start_day=01&amp;start_hour=00&amp;start_min=00&amp;end_year=2009&amp;end_month=09&amp;end_day=05&amp;end_hour=23&amp;end_min=59&amp;yunits=0&#39;</span>

    <span class="c1"># Expand the time window by 1 hour to ensure an extra observation is included in the request.</span>
    <span class="n">start_date</span> <span class="o">-=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">expand_window</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">+=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">expand_window</span><span class="p">)</span>

    <span class="c1"># Convert local time to UTC</span>
    <span class="n">start_date</span> <span class="o">=</span> <span class="n">start_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">utc_offset</span><span class="p">)</span>
    <span class="n">end_date</span> <span class="o">=</span> <span class="n">end_date</span> <span class="o">-</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">utc_offset</span><span class="p">)</span>
    <span class="n">root</span> <span class="o">=</span> <span class="s1">&#39;http://www.nmdb.eu/nest/draw_graph.php?&#39;</span>
    <span class="n">url_par</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;formchk=1&#39;</span><span class="p">,</span>
               <span class="s1">&#39;stations[]=&#39;</span> <span class="o">+</span> <span class="n">station</span><span class="p">,</span>
               <span class="s1">&#39;output=ascii&#39;</span><span class="p">,</span>
               <span class="s1">&#39;tabchoice=revori&#39;</span><span class="p">,</span>
               <span class="s1">&#39;dtype=corr_for_efficiency&#39;</span><span class="p">,</span>
               <span class="s1">&#39;tresolution=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="mi">60</span><span class="p">),</span>
               <span class="s1">&#39;date_choice=bydate&#39;</span><span class="p">,</span>
               <span class="s1">&#39;start_year=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
               <span class="s1">&#39;start_month=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">month</span><span class="p">),</span>
               <span class="s1">&#39;start_day=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">day</span><span class="p">),</span>
               <span class="s1">&#39;start_hour=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">hour</span><span class="p">),</span>
               <span class="s1">&#39;start_min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">start_date</span><span class="o">.</span><span class="n">minute</span><span class="p">),</span>
               <span class="s1">&#39;end_year=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">year</span><span class="p">),</span>
               <span class="s1">&#39;end_month=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">month</span><span class="p">),</span>
               <span class="s1">&#39;end_day=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">day</span><span class="p">),</span>
               <span class="s1">&#39;end_hour=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">hour</span><span class="p">),</span>
               <span class="s1">&#39;end_min=&#39;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">end_date</span><span class="o">.</span><span class="n">minute</span><span class="p">),</span>
               <span class="s1">&#39;yunits=0&#39;</span><span class="p">]</span>

    <span class="n">url</span> <span class="o">=</span> <span class="n">root</span> <span class="o">+</span> <span class="s1">&#39;&amp;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">url_par</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Retrieving data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">r</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="p">)</span><span class="o">.</span><span class="n">content</span><span class="o">.</span><span class="n">decode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">)</span>

    <span class="c1"># Subtract 1 hour to restore the last date included in the request.</span>
    <span class="n">end_date</span> <span class="o">-=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="s1">&#39;1H&#39;</span><span class="p">)</span>
    <span class="n">start</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;RCORR_E</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span> <span class="o">+</span> <span class="mi">8</span>
    <span class="n">end</span> <span class="o">=</span> <span class="n">r</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&lt;/code&gt;&lt;/pre&gt;&lt;br&gt;Total&#39;</span><span class="p">)</span> <span class="o">-</span> <span class="mi">1</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">r</span><span class="p">[</span><span class="n">start</span><span class="p">:</span><span class="n">end</span><span class="p">]</span>
    <span class="n">s2</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">row</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s1">&#39;;&#39;</span><span class="p">,</span> <span class="s1">&#39;,&#39;</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">s</span><span class="p">])</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">df_flux</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">io</span><span class="o">.</span><span class="n">StringIO</span><span class="p">(</span><span class="n">s2</span><span class="p">),</span> <span class="n">names</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="s1">&#39;counts&#39;</span><span class="p">])</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">verbose</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error retrieving data from </span><span class="si">{</span><span class="n">url</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="c1"># Check if all values from selected detector are NaN. If yes, warn the user</span>
    <span class="k">if</span> <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">all</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s1">&#39;Data for selected neutron detectors appears to be unavailable for the selected period&#39;</span><span class="p">)</span>

    <span class="c1"># Convert timestamp to datetime and apply UTC offset</span>
    <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">])</span>
    <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;timestamp&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="n">utc_offset</span><span class="p">)</span>

    <span class="c1"># Print acknowledgement to inform users about restrictions and to acknowledge the NMDB database</span>
    <span class="n">acknowledgement</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;Data retrieved via NMDB are the property of the individual data providers. These data are free for non commercial</span>
<span class="s2">use to within the restriction imposed by the providers. If you use such data for your research or applications, please acknowledge</span>
<span class="s2">the origin by a sentence like &#39;We acknowledge the NMDB database (www.nmdb.eu) founded under the European Union&#39;s FP7 programme </span>
<span class="s2">(contract no. 213007), and the PIs of individual neutron monitors at: IGY Jungfraujoch </span>
<span class="s2">(Physikalisches Institut, University of Bern, Switzerland)&quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">df_flux</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.get_reference_neutron_flux" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_reference_neutron_flux</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;2011-05-01&#39;</span><span class="p">))</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to retrieve reference neutron flux from the Neutron Monitor Database. Default date is 2011-05-01, following previous studies (Zreda et a., 2012, Hawdon et al., 2014, Bogena et al., 2022).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>station</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Neutron Monitor station to retrieve data from.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>date</code></td>
          <td>
                <code>datetime</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Date of the reference neutron flux. Default is 2011-05-01.</p>
            </div>
          </td>
          <td>
                <code><span title="pandas.to_datetime">to_datetime</span>(&#39;2011-05-01&#39;)</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference neutron flux in counts per hour.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., &amp; Rosolem, R. (2012). COSMOS: The cosmic-ray soil moisture observing system. Hydrology and Earth System Sciences, 16(11), 4079-4099.</p>
<p>Hawdon, A., McJannet, D., &amp; Wallace, J. (2014). Calibration and correction procedures for cosmic‐ray neutron soil moisture probes located across Australia. Water Resources Research, 50(6), 5029-5043.</p>
<p>Bogena, H. R., Schrön, M., Jakobi, J., Ney, P., Zacharias, S., Andreasen, M., ... &amp; Vereecken, H. (2022). COSMOS-Europe: a European network of cosmic-ray neutron soil moisture sensors. Earth System Science Data, 14(3), 1125-1151.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span>
<span class="normal">462</span>
<span class="normal">463</span>
<span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_reference_neutron_flux</span><span class="p">(</span><span class="n">station</span><span class="p">,</span> <span class="n">date</span><span class="o">=</span><span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s2">&quot;2011-05-01&quot;</span><span class="p">)):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to retrieve reference neutron flux from the Neutron Monitor Database. Default date is 2011-05-01, following previous studies (Zreda et a., 2012, Hawdon et al., 2014, Bogena et al., 2022).</span>

<span class="sd">    Args:</span>
<span class="sd">        station (str): Neutron Monitor station to retrieve data from.</span>
<span class="sd">        date (datetime): Date of the reference neutron flux. Default is 2011-05-01.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Reference neutron flux in counts per hour.</span>

<span class="sd">    References:</span>
<span class="sd">        Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., &amp; Rosolem, R. (2012). COSMOS: The cosmic-ray soil moisture observing system. Hydrology and Earth System Sciences, 16(11), 4079-4099.</span>

<span class="sd">        Hawdon, A., McJannet, D., &amp; Wallace, J. (2014). Calibration and correction procedures for cosmic‐ray neutron soil moisture probes located across Australia. Water Resources Research, 50(6), 5029-5043.</span>

<span class="sd">        Bogena, H. R., Schrön, M., Jakobi, J., Ney, P., Zacharias, S., Andreasen, M., ... &amp; Vereecken, H. (2022). COSMOS-Europe: a European network of cosmic-ray neutron soil moisture sensors. Earth System Science Data, 14(3), 1125-1151.</span>

<span class="sd">&quot;&quot;&quot;</span>

    <span class="c1"># Get flux for 2011-05-01</span>
    <span class="n">df_flux</span> <span class="o">=</span> <span class="n">get_incoming_neutron_flux</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">date</span> <span class="o">+</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timedelta</span><span class="p">(</span><span class="n">hours</span><span class="o">=</span><span class="mi">24</span><span class="p">),</span> <span class="n">station</span><span class="o">=</span><span class="n">station</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">df_flux</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Reference neutron flux for </span><span class="si">{</span><span class="n">station</span><span class="si">}</span><span class="s2"> not available. Returning NaN.&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">df_flux</span><span class="p">[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.idw" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">idw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to interpolate data using inverse distance weight.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM x coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM y coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Values to be interpolated.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>X_pred</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM x coordinates where z values need to be predicted.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Y_pred</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM y coordinates where z values need to be predicted.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>neighborhood</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Only points within this radius in meters are considered for the interpolation.</p>
            </div>
          </td>
          <td>
                <code>1000</code>
          </td>
        </tr>
        <tr>
          <td><code>p</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Exponent of the inverse distance weight formula. Typically, p=1 or p=2.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Interpolated values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p><a href="https://en.wikipedia.org/wiki/Inverse_distance_weighting">https://en.wikipedia.org/wiki/Inverse_distance_weighting</a></p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1393</span>
<span class="normal">1394</span>
<span class="normal">1395</span>
<span class="normal">1396</span>
<span class="normal">1397</span>
<span class="normal">1398</span>
<span class="normal">1399</span>
<span class="normal">1400</span>
<span class="normal">1401</span>
<span class="normal">1402</span>
<span class="normal">1403</span>
<span class="normal">1404</span>
<span class="normal">1405</span>
<span class="normal">1406</span>
<span class="normal">1407</span>
<span class="normal">1408</span>
<span class="normal">1409</span>
<span class="normal">1410</span>
<span class="normal">1411</span>
<span class="normal">1412</span>
<span class="normal">1413</span>
<span class="normal">1414</span>
<span class="normal">1415</span>
<span class="normal">1416</span>
<span class="normal">1417</span>
<span class="normal">1418</span>
<span class="normal">1419</span>
<span class="normal">1420</span>
<span class="normal">1421</span>
<span class="normal">1422</span>
<span class="normal">1423</span>
<span class="normal">1424</span>
<span class="normal">1425</span>
<span class="normal">1426</span>
<span class="normal">1427</span>
<span class="normal">1428</span>
<span class="normal">1429</span>
<span class="normal">1430</span>
<span class="normal">1431</span>
<span class="normal">1432</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">idw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to interpolate data using inverse distance weight.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (list or array): UTM x coordinates in meters.</span>
<span class="sd">        y (list or array): UTM y coordinates in meters.</span>
<span class="sd">        z (list or array): Values to be interpolated.</span>
<span class="sd">        X_pred (list or array): UTM x coordinates where z values need to be predicted.</span>
<span class="sd">        Y_pred (list or array): UTM y coordinates where z values need to be predicted.</span>
<span class="sd">        neighborhood (float): Only points within this radius in meters are considered for the interpolation.</span>
<span class="sd">        p (int): Exponent of the inverse distance weight formula. Typically, p=1 or p=2.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array): Interpolated values.</span>

<span class="sd">    References:</span>
<span class="sd">        [https://en.wikipedia.org/wiki/Inverse_distance_weighting](https://en.wikipedia.org/wiki/Inverse_distance_weighting)</span>


<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Flatten arrays to handle 1D and 2D arrays with the same code</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">X_pred</span><span class="o">.</span><span class="n">shape</span>  <span class="c1"># Save shape</span>
    <span class="n">X_pred</span> <span class="o">=</span> <span class="n">X_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>
    <span class="n">Y_pred</span> <span class="o">=</span> <span class="n">Y_pred</span><span class="o">.</span><span class="n">flatten</span><span class="p">()</span>

    <span class="c1"># Pre-allocate output array</span>
    <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">X_pred</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">X_pred</span><span class="o">.</span><span class="n">size</span><span class="p">):</span>
        <span class="c1"># Distance between current and observed points</span>
        <span class="n">d</span> <span class="o">=</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">X_pred</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">Y_pred</span><span class="p">[</span><span class="n">n</span><span class="p">],</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Select points within neighborhood only for interpolation</span>
        <span class="n">idx_neighbors</span> <span class="o">=</span> <span class="n">d</span> <span class="o">&lt;</span> <span class="n">neighborhood</span>

        <span class="c1"># Compute interpolated value at point of interest</span>
        <span class="n">Z_pred</span><span class="p">[</span><span class="n">n</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx_neighbors</span><span class="p">]</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">idx_neighbors</span><span class="p">]</span> <span class="o">**</span> <span class="n">p</span><span class="p">)</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">d</span><span class="p">[</span><span class="n">idx_neighbors</span><span class="p">]</span> <span class="o">**</span> <span class="n">p</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">reshape</span><span class="p">(</span><span class="n">Z_pred</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.interpolate_2d" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">interpolate_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function for interpolating irregular spatial data into a regular grid.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM x coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM y coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Values to be interpolated.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>dx</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pixel width in meters.</p>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>dy</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pixel height in meters.</p>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Interpolation method. One of 'cubic', 'linear', 'nearest', or 'idw'.</p>
            </div>
          </td>
          <td>
                <code>&#39;cubic&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>neighborhood</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Only points within this radius in meters are considered for the interpolation.</p>
            </div>
          </td>
          <td>
                <code>1000</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>x_pred</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>2D array with x coordinates.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y_pred</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>2D array with y coordinates.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>z_pred</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>2D array with interpolated values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p><a href="https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html">https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html</a></p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1435</span>
<span class="normal">1436</span>
<span class="normal">1437</span>
<span class="normal">1438</span>
<span class="normal">1439</span>
<span class="normal">1440</span>
<span class="normal">1441</span>
<span class="normal">1442</span>
<span class="normal">1443</span>
<span class="normal">1444</span>
<span class="normal">1445</span>
<span class="normal">1446</span>
<span class="normal">1447</span>
<span class="normal">1448</span>
<span class="normal">1449</span>
<span class="normal">1450</span>
<span class="normal">1451</span>
<span class="normal">1452</span>
<span class="normal">1453</span>
<span class="normal">1454</span>
<span class="normal">1455</span>
<span class="normal">1456</span>
<span class="normal">1457</span>
<span class="normal">1458</span>
<span class="normal">1459</span>
<span class="normal">1460</span>
<span class="normal">1461</span>
<span class="normal">1462</span>
<span class="normal">1463</span>
<span class="normal">1464</span>
<span class="normal">1465</span>
<span class="normal">1466</span>
<span class="normal">1467</span>
<span class="normal">1468</span>
<span class="normal">1469</span>
<span class="normal">1470</span>
<span class="normal">1471</span>
<span class="normal">1472</span>
<span class="normal">1473</span>
<span class="normal">1474</span>
<span class="normal">1475</span>
<span class="normal">1476</span>
<span class="normal">1477</span>
<span class="normal">1478</span>
<span class="normal">1479</span>
<span class="normal">1480</span>
<span class="normal">1481</span>
<span class="normal">1482</span>
<span class="normal">1483</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_2d</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">dx</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">dy</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;cubic&#39;</span><span class="p">,</span> <span class="n">neighborhood</span><span class="o">=</span><span class="mi">1000</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function for interpolating irregular spatial data into a regular grid.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (list or array): UTM x coordinates in meters.</span>
<span class="sd">        y (list or array): UTM y coordinates in meters.</span>
<span class="sd">        z (list or array): Values to be interpolated.</span>
<span class="sd">        dx (float): Pixel width in meters.</span>
<span class="sd">        dy (float): Pixel height in meters.</span>
<span class="sd">        method (str): Interpolation method. One of &#39;cubic&#39;, &#39;linear&#39;, &#39;nearest&#39;, or &#39;idw&#39;.</span>
<span class="sd">        neighborhood (float): Only points within this radius in meters are considered for the interpolation.</span>

<span class="sd">    Returns:</span>
<span class="sd">        x_pred (array): 2D array with x coordinates.</span>
<span class="sd">        y_pred (array): 2D array with y coordinates.</span>
<span class="sd">        z_pred (array): 2D array with interpolated values.</span>

<span class="sd">    References:</span>
<span class="sd">        [https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html](https://soilwater.github.io/pynotes-agriscience/notebooks/interpolation.html)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Drop NaN values in x y and z</span>
    <span class="n">idx_nan</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">|</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="o">~</span><span class="n">idx_nan</span><span class="p">]</span>
    <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="o">~</span><span class="n">idx_nan</span><span class="p">]</span>
    <span class="n">z</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="o">~</span><span class="n">idx_nan</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">idx_nan</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;WARNING: </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">, </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2">, and </span><span class="si">{</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span><span class="si">}</span><span class="s2"> NaN values were dropped from x, y, and z.&quot;</span><span class="p">)</span>

    <span class="c1"># Create 2D grid for interpolation</span>
    <span class="n">Nx</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">))</span> <span class="o">/</span> <span class="n">dx</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">Ny</span> <span class="o">=</span> <span class="nb">round</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">))</span> <span class="o">/</span> <span class="n">dy</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
    <span class="n">X_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">Nx</span><span class="p">)</span>
    <span class="n">Y_vec</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">np</span><span class="o">.</span><span class="n">max</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">Ny</span><span class="p">)</span>
    <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">X_vec</span><span class="p">,</span> <span class="n">Y_vec</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="s1">&#39;nearest&#39;</span><span class="p">,</span> <span class="s1">&#39;cubic&#39;</span><span class="p">]:</span>
        <span class="n">points</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>
        <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">griddata</span><span class="p">(</span><span class="n">points</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="p">(</span><span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">),</span> <span class="n">method</span><span class="o">=</span><span class="n">method</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;idw&#39;</span><span class="p">:</span>
        <span class="n">Z_pred</span> <span class="o">=</span> <span class="n">idw</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">neighborhood</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> does not exist. Provide either &#39;cubic&#39;, &#39;linear&#39;, &#39;nearest&#39;, or &#39;idw&#39;.&quot;</span>

    <span class="k">return</span> <span class="n">X_pred</span><span class="p">,</span> <span class="n">Y_pred</span><span class="p">,</span> <span class="n">Z_pred</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.interpolate_incoming_flux" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">interpolate_incoming_flux</span><span class="p">(</span><span class="n">nmdb_timestamps</span><span class="p">,</span> <span class="n">nmdb_counts</span><span class="p">,</span> <span class="n">crnp_timestamps</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to interpolate incoming neutron flux to match the timestamps of the observations.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>nmdb_timestamps</code></td>
          <td>
                <code><span title="pandas.Series">Series</span> or <span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Series or array of timestamps in datetime format from the NMDB</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>nmdb_counts</code></td>
          <td>
                <code><span title="pandas.Series">Series</span> or <span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Series or array of incoming neutron flux counts from the NMDB</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>crnp_timestamps</code></td>
          <td>
                <code><span title="pandas.Series">Series</span> or <span title="numpy.array">array</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Series or array of timestamps in datetime format from the CRNP device</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Series containing interpolated incoming neutron flux. Length of Series is the same as crnp_timestamps</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1227</span>
<span class="normal">1228</span>
<span class="normal">1229</span>
<span class="normal">1230</span>
<span class="normal">1231</span>
<span class="normal">1232</span>
<span class="normal">1233</span>
<span class="normal">1234</span>
<span class="normal">1235</span>
<span class="normal">1236</span>
<span class="normal">1237</span>
<span class="normal">1238</span>
<span class="normal">1239</span>
<span class="normal">1240</span>
<span class="normal">1241</span>
<span class="normal">1242</span>
<span class="normal">1243</span>
<span class="normal">1244</span>
<span class="normal">1245</span>
<span class="normal">1246</span>
<span class="normal">1247</span>
<span class="normal">1248</span>
<span class="normal">1249</span>
<span class="normal">1250</span>
<span class="normal">1251</span>
<span class="normal">1252</span>
<span class="normal">1253</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">interpolate_incoming_flux</span><span class="p">(</span><span class="n">nmdb_timestamps</span><span class="p">,</span> <span class="n">nmdb_counts</span><span class="p">,</span> <span class="n">crnp_timestamps</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to interpolate incoming neutron flux to match the timestamps of the observations.</span>

<span class="sd">    Args:</span>
<span class="sd">        nmdb_timestamps (pd.Series or np.array): Series or array of timestamps in datetime format from the NMDB</span>
<span class="sd">        nmdb_counts (pd.Series or np.array): Series or array of incoming neutron flux counts from the NMDB</span>
<span class="sd">        crnp_timestamps (pd.Series or np.array): Series or array of timestamps in datetime format from the CRNP device</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pd.Series): Series containing interpolated incoming neutron flux. Length of Series is the same as crnp_timestamps</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Create a DataFrame from nmdb timestamps and counts</span>
    <span class="n">df_nmdb</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;timestamp&#39;</span><span class="p">:</span> <span class="n">nmdb_timestamps</span><span class="p">,</span> <span class="s1">&#39;counts&#39;</span><span class="p">:</span> <span class="n">nmdb_counts</span><span class="p">})</span>

    <span class="c1"># Set the Timestamp column as the index</span>
    <span class="n">df_nmdb</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;timestamp&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Reindex the DataFrame to the timestamps from the CRNP device using the nearest method</span>
    <span class="c1"># This will match each CRNP timestamp with the nearest NMDB timestamp</span>
    <span class="n">interpolated_flux</span> <span class="o">=</span> <span class="n">df_nmdb</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">crnp_timestamps</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;nearest&#39;</span><span class="p">)[</span><span class="s1">&#39;counts&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>

    <span class="c1">#drop NaN values</span>
    <span class="n">interpolated_flux</span> <span class="o">=</span> <span class="n">interpolated_flux</span><span class="p">[</span><span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">interpolated_flux</span><span class="p">)]</span>

    <span class="k">assert</span> <span class="nb">len</span><span class="p">(</span><span class="n">interpolated_flux</span><span class="p">)</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">crnp_timestamps</span><span class="p">),</span> <span class="s2">&quot;Length of interpolated flux does not match length of CRNP timestamps&quot;</span>

    <span class="k">return</span> <span class="n">interpolated_flux</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.is_outlier" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">is_outlier</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that tests whether values are outliers using a modified moving z-score based on the median absolute difference.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Variable containing only the columns with neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Outlier detection method. One of: range, iqr, moviqr, zscore, movzscore, modified_zscore, and scaled_mad</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>window</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Window size for the moving central tendency. Default is 11.</p>
            </div>
          </td>
          <td>
                <code>11</code>
          </td>
        </tr>
        <tr>
          <td><code>min_val</code></td>
          <td>
                <code>int or float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Minimum value for a reading to be considered valid. Default is None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>max_val(int</code></td>
          <td>
                <code>or float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Maximum value for a reading to be considered valid. Default is None.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Boolean indicating outliers.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Iglewicz, B. and Hoaglin, D.C., 1993. How to detect and handle outliers (Vol. 16). Asq Press.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">is_outlier</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">method</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">11</span><span class="p">,</span> <span class="n">min_val</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that tests whether values are outliers using a modified moving z-score based on the median absolute difference.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (pd.DataFrame or pd.Series): Variable containing only the columns with neutron counts.</span>
<span class="sd">        method (str): Outlier detection method. One of: range, iqr, moviqr, zscore, movzscore, modified_zscore, and scaled_mad</span>
<span class="sd">        window (int, optional): Window size for the moving central tendency. Default is 11.</span>
<span class="sd">        min_val (int or float): Minimum value for a reading to be considered valid. Default is None.</span>
<span class="sd">        max_val(int or float): Maximum value for a reading to be considered valid. Default is None.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Boolean indicating outliers.</span>

<span class="sd">    References:</span>
<span class="sd">        Iglewicz, B. and Hoaglin, D.C., 1993. How to detect and handle outliers (Vol. 16). Asq Press.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;x must of type pandas.Series&#39;</span><span class="p">)</span>

    <span class="c1"># Separate this method to allow usage together with other methods below</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">min_val</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">max_val</span><span class="p">,</span> <span class="n">numbers</span><span class="o">.</span><span class="n">Number</span><span class="p">):</span>
        <span class="n">idx_range_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">min_val</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">max_val</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">idx_range_outliers</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">full_like</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

    <span class="c1"># Apply other methods in addition to a range check</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;iqr&#39;</span><span class="p">:</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
        <span class="n">high_fence</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span><span class="p">)</span>
        <span class="n">low_fence</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span><span class="p">)</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">low_fence</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">high_fence</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;moviqr&#39;</span><span class="p">:</span>
        <span class="n">q1</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.25</span><span class="p">)</span>
        <span class="n">q3</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">quantile</span><span class="p">(</span><span class="mf">0.75</span><span class="p">)</span>
        <span class="n">iqr</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">-</span> <span class="n">q1</span>
        <span class="n">ub</span> <span class="o">=</span> <span class="n">q3</span> <span class="o">+</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span><span class="p">)</span>  <span class="c1"># Upper boundary</span>
        <span class="n">lb</span> <span class="o">=</span> <span class="n">q1</span> <span class="o">-</span> <span class="p">(</span><span class="mf">1.5</span> <span class="o">*</span> <span class="n">iqr</span><span class="p">)</span>  <span class="c1"># Lower boundary</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">&lt;</span> <span class="n">lb</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">x</span> <span class="o">&gt;</span> <span class="n">ub</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;zscore&#39;</span><span class="p">:</span>
        <span class="n">zscore</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">x</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span> <span class="o">/</span> <span class="n">x</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">zscore</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">zscore</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;movzscore&#39;</span><span class="p">:</span>
        <span class="n">movmean</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">movstd</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">std</span><span class="p">()</span>
        <span class="n">movzscore</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">movmean</span><span class="p">)</span> <span class="o">/</span> <span class="n">movstd</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">movzscore</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mi">3</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">movzscore</span> <span class="o">&gt;</span> <span class="mi">3</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;modified_zscore&#39;</span><span class="p">:</span>
        <span class="c1"># Compute median absolute difference</span>
        <span class="n">movmedian</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>
        <span class="n">abs_diff</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">movmedian</span><span class="p">)</span>
        <span class="n">mad</span> <span class="o">=</span> <span class="n">abs_diff</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

        <span class="c1"># Compute modified z-score</span>
        <span class="n">modified_z_score</span> <span class="o">=</span> <span class="mf">0.6745</span> <span class="o">*</span> <span class="n">abs_diff</span> <span class="o">/</span> <span class="n">mad</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="p">(</span><span class="n">modified_z_score</span> <span class="o">&lt;</span> <span class="o">-</span><span class="mf">3.5</span><span class="p">)</span> <span class="o">|</span> <span class="p">(</span><span class="n">modified_z_score</span> <span class="o">&gt;</span> <span class="mf">3.5</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;scaled_mad&#39;</span><span class="p">:</span>
        <span class="c1"># Returns true for elements more than three scaled MAD from the median. </span>
        <span class="n">c</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span> <span class="o">*</span> <span class="n">erfcinv</span><span class="p">(</span><span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span><span class="p">))</span>
        <span class="n">median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
        <span class="n">mad</span> <span class="o">=</span> <span class="n">c</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">x</span> <span class="o">-</span> <span class="n">median</span><span class="p">))</span>
        <span class="n">idx_outliers</span> <span class="o">=</span> <span class="n">x</span> <span class="o">&gt;</span> <span class="p">(</span><span class="n">median</span> <span class="o">+</span> <span class="mi">3</span> <span class="o">*</span> <span class="n">mad</span><span class="p">)</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;Outlier detection method not found.&#39;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">idx_outliers</span> <span class="o">|</span> <span class="n">idx_range_outliers</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.latlon_to_utm" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">latlon_to_utm</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">utm_zone_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">utm_zone_letter</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Convert geographic coordinates (lat, lon) to projected coordinates (utm) using the Military Grid Reference System.</p>
<p>Function only applies to non-polar coordinates.
If further functionality is required, consider using the utm module. See references for more information.</p>
<p><a class="glightbox" href="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Universal_Transverse_Mercator_zones.svg/1920px-Universal_Transverse_Mercator_zones.svg.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="UTM zones" src="https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Universal_Transverse_Mercator_zones.svg/1920px-Universal_Transverse_Mercator_zones.svg.png" /></a>
UTM zones on an equirectangular world map with irregular zones in red and New York City's zone highlighted. See <a href="https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system#UTM_zones">UTM zones</a> for a full description.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>lat</code></td>
          <td>
                <code>(float, array)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Latitude in decimal degrees.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>lon</code></td>
          <td>
                <code>(float, array)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Longitude in decimal degrees.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>utm_zone_number</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM zone number. If None, the zone number is automatically calculated.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>utm_zone_letter</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM zone letter. If None, the zone letter is automatically calculated.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>(float, float, int, str)</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Tuple of easting, northing, zone number and zone letter. First element is easting, second is northing, third is zone number and fourth is zone letter.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Code adapted from utm module created by Tobias Bieniek (Github username: Turbo87)
<a href="https://github.com/Turbo87/utm">https://github.com/Turbo87/utm</a></p>
<p><a href="https://www.maptools.com/tutorials/grid_zone_details#">https://www.maptools.com/tutorials/grid_zone_details#</a></p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1279</span>
<span class="normal">1280</span>
<span class="normal">1281</span>
<span class="normal">1282</span>
<span class="normal">1283</span>
<span class="normal">1284</span>
<span class="normal">1285</span>
<span class="normal">1286</span>
<span class="normal">1287</span>
<span class="normal">1288</span>
<span class="normal">1289</span>
<span class="normal">1290</span>
<span class="normal">1291</span>
<span class="normal">1292</span>
<span class="normal">1293</span>
<span class="normal">1294</span>
<span class="normal">1295</span>
<span class="normal">1296</span>
<span class="normal">1297</span>
<span class="normal">1298</span>
<span class="normal">1299</span>
<span class="normal">1300</span>
<span class="normal">1301</span>
<span class="normal">1302</span>
<span class="normal">1303</span>
<span class="normal">1304</span>
<span class="normal">1305</span>
<span class="normal">1306</span>
<span class="normal">1307</span>
<span class="normal">1308</span>
<span class="normal">1309</span>
<span class="normal">1310</span>
<span class="normal">1311</span>
<span class="normal">1312</span>
<span class="normal">1313</span>
<span class="normal">1314</span>
<span class="normal">1315</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">latlon_to_utm</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">utm_zone_number</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">utm_zone_letter</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Convert geographic coordinates (lat, lon) to projected coordinates (utm) using the Military Grid Reference System.</span>

<span class="sd">    Function only applies to non-polar coordinates.</span>
<span class="sd">    If further functionality is required, consider using the utm module. See references for more information.</span>

<span class="sd">    ![UTM zones](https://upload.wikimedia.org/wikipedia/commons/thumb/b/b7/Universal_Transverse_Mercator_zones.svg/1920px-Universal_Transverse_Mercator_zones.svg.png)</span>
<span class="sd">    UTM zones on an equirectangular world map with irregular zones in red and New York City&#39;s zone highlighted. See [UTM zones](https://en.wikipedia.org/wiki/Universal_Transverse_Mercator_coordinate_system#UTM_zones) for a full description.</span>


<span class="sd">    Args:</span>
<span class="sd">        lat (float, array): Latitude in decimal degrees.</span>
<span class="sd">        lon (float, array): Longitude in decimal degrees.</span>
<span class="sd">        utm_zone_number (int): UTM zone number. If None, the zone number is automatically calculated.</span>
<span class="sd">        utm_zone_letter (str): UTM zone letter. If None, the zone letter is automatically calculated.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float, float, int, str): Tuple of easting, northing, zone number and zone letter. First element is easting, second is northing, third is zone number and fourth is zone letter.</span>

<span class="sd">    References:</span>
<span class="sd">         Code adapted from utm module created by Tobias Bieniek (Github username: Turbo87)</span>
<span class="sd">         [https://github.com/Turbo87/utm](https://github.com/Turbo87/utm)</span>

<span class="sd">         [https://www.maptools.com/tutorials/grid_zone_details#](https://www.maptools.com/tutorials/grid_zone_details#)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># utm module requires numpy arrays</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">lat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lat</span><span class="p">)</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">lon</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="n">lon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lon</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">utm_zone_number</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="n">utm_zone_letter</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">zone_number</span><span class="p">,</span> <span class="n">zone_letter</span> <span class="o">=</span> <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">zone_number</span><span class="p">,</span> <span class="n">zone_letter</span> <span class="o">=</span> <span class="n">utm</span><span class="o">.</span><span class="n">from_latlon</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">utm_zone_number</span><span class="p">,</span> <span class="n">utm_zone_letter</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">easting</span><span class="p">,</span> <span class="n">northing</span><span class="p">,</span> <span class="n">zone_number</span><span class="p">,</span> <span class="n">zone_letter</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.lattice_water" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">lattice_water</span><span class="p">(</span><span class="n">clay_content</span><span class="p">,</span> <span class="n">total_carbon</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Estimate the amount of water in the lattice of clay minerals.</p>
<table>
<thead>
<tr>
<th style="text-align: center;"><a class="glightbox" href="../img/lattice_water_simple.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="img1" src="../img/lattice_water_simple.png" /></a></th>
<th style="text-align: center;"><a class="glightbox" href="../img/lattice_water_multiple.png" data-type="image" data-width="auto" data-height="auto" data-desc-position="bottom"><img alt="img2" src="../img/lattice_water_multiple.png" /></a></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">$\omega_{lat} = 0.097 * clay(\%)$</td>
<td style="text-align: center;">$\omega_{lat} = -0.028 + 0.077 * clay(\%) + 0.459 * carbon(\%)$</td>
</tr>
<tr>
<td style="text-align: center;">Linear regression [lattice water (%) as a function of clay (%)] done with data from Kansas Sate University - Soil Water Processes Lab.</td>
<td style="text-align: center;">Multiple linear regression [lattice water (%) as a function of clay (%) and soil carbon (%)] done with data from Soil Water Processes Lab.</td>
</tr>
</tbody>
</table>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>clay_content</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Clay content in the soil in percent.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>total_carbon</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Total carbon content in the soil in percent.
If None, the amount of water is estimated based on clay content only.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Amount of water in the lattice of clay minerals in percent</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1256</span>
<span class="normal">1257</span>
<span class="normal">1258</span>
<span class="normal">1259</span>
<span class="normal">1260</span>
<span class="normal">1261</span>
<span class="normal">1262</span>
<span class="normal">1263</span>
<span class="normal">1264</span>
<span class="normal">1265</span>
<span class="normal">1266</span>
<span class="normal">1267</span>
<span class="normal">1268</span>
<span class="normal">1269</span>
<span class="normal">1270</span>
<span class="normal">1271</span>
<span class="normal">1272</span>
<span class="normal">1273</span>
<span class="normal">1274</span>
<span class="normal">1275</span>
<span class="normal">1276</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">lattice_water</span><span class="p">(</span><span class="n">clay_content</span><span class="p">,</span> <span class="n">total_carbon</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Estimate the amount of water in the lattice of clay minerals.</span>

<span class="sd">    ![img1](img/lattice_water_simple.png) | ![img2](img/lattice_water_multiple.png)</span>
<span class="sd">    :-------------------------:|:-------------------------:</span>
<span class="sd">    $\omega_{lat} = 0.097 * clay(\%)$ | $\omega_{lat} = -0.028 + 0.077 * clay(\%) + 0.459 * carbon(\%)$</span>
<span class="sd">    Linear regression [lattice water (%) as a function of clay (%)] done with data from Kansas Sate University - Soil Water Processes Lab. |  Multiple linear regression [lattice water (%) as a function of clay (%) and soil carbon (%)] done with data from Soil Water Processes Lab.</span>

<span class="sd">    Args:</span>
<span class="sd">        clay_content (float): Clay content in the soil in percent.</span>
<span class="sd">        total_carbon (float, optional): Total carbon content in the soil in percent.</span>
<span class="sd">            If None, the amount of water is estimated based on clay content only.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Amount of water in the lattice of clay minerals in percent</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">total_carbon</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">lattice_water</span> <span class="o">=</span> <span class="mf">0.097</span> <span class="o">*</span> <span class="n">clay_content</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">lattice_water</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.028</span> <span class="o">+</span> <span class="mf">0.077</span> <span class="o">*</span> <span class="n">clay_content</span> <span class="o">+</span> <span class="mf">0.459</span> <span class="o">*</span> <span class="n">total_carbon</span>
    <span class="k">return</span> <span class="n">lattice_water</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.location_factor" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">location_factor</span><span class="p">(</span><span class="n">site_atmospheric_depth</span><span class="p">,</span> <span class="n">site_Rc</span><span class="p">,</span> <span class="n">reference_atmospheric_depth</span><span class="p">,</span> <span class="n">reference_Rc</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the location factor between two sites according to McJannet and Desilets, 2023.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>site_atmospheric_depth</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth at the site in g/cm2. Can be estimated using the function <code>atmospheric_depth()</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>site_Rc</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity at the site in GV. Can be estimated using the function <code>cutoff_rigidity()</code></p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference_atmospheric_depth</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric depth at the reference location in g/cm2.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>reference_Rc</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Cutoff rigidity at the reference location in GV.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Location-dependent correction factor.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>McJannet, D. L., &amp; Desilets, D. (2023). Incoming Neutron Flux Corrections for Cosmic‐Ray Soil and Snow Sensors Using the Global Neutron Monitor Network. Water Resources Research, 59(4), e2022WR033889.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1115</span>
<span class="normal">1116</span>
<span class="normal">1117</span>
<span class="normal">1118</span>
<span class="normal">1119</span>
<span class="normal">1120</span>
<span class="normal">1121</span>
<span class="normal">1122</span>
<span class="normal">1123</span>
<span class="normal">1124</span>
<span class="normal">1125</span>
<span class="normal">1126</span>
<span class="normal">1127</span>
<span class="normal">1128</span>
<span class="normal">1129</span>
<span class="normal">1130</span>
<span class="normal">1131</span>
<span class="normal">1132</span>
<span class="normal">1133</span>
<span class="normal">1134</span>
<span class="normal">1135</span>
<span class="normal">1136</span>
<span class="normal">1137</span>
<span class="normal">1138</span>
<span class="normal">1139</span>
<span class="normal">1140</span>
<span class="normal">1141</span>
<span class="normal">1142</span>
<span class="normal">1143</span>
<span class="normal">1144</span>
<span class="normal">1145</span>
<span class="normal">1146</span>
<span class="normal">1147</span>
<span class="normal">1148</span>
<span class="normal">1149</span>
<span class="normal">1150</span>
<span class="normal">1151</span>
<span class="normal">1152</span>
<span class="normal">1153</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">location_factor</span><span class="p">(</span><span class="n">site_atmospheric_depth</span><span class="p">,</span> <span class="n">site_Rc</span><span class="p">,</span> <span class="n">reference_atmospheric_depth</span><span class="p">,</span> <span class="n">reference_Rc</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Function to estimate the location factor between two sites according to McJannet and Desilets, 2023.</span>


<span class="sd">    Args:</span>
<span class="sd">        site_atmospheric_depth (float): Atmospheric depth at the site in g/cm2. Can be estimated using the function `atmospheric_depth()`</span>
<span class="sd">        site_Rc (float): Cutoff rigidity at the site in GV. Can be estimated using the function `cutoff_rigidity()`</span>
<span class="sd">        reference_atmospheric_depth (float): Atmospheric depth at the reference location in g/cm2.</span>
<span class="sd">        reference_Rc (float): Cutoff rigidity at the reference location in GV.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (float): Location-dependent correction factor.</span>

<span class="sd">    References:</span>
<span class="sd">        McJannet, D. L., &amp; Desilets, D. (2023). Incoming Neutron Flux Corrections for Cosmic‐Ray Soil and Snow Sensors Using the Global Neutron Monitor Network. Water Resources Research, 59(4), e2022WR033889.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Renamed variables based on the provided table</span>
    <span class="n">c0</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.0009</span>  <span class="c1"># from C39</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="mf">1.7699</span>  <span class="c1"># from C40</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="mf">0.0064</span>  <span class="c1"># from C41</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="mf">1.8855</span>  <span class="c1"># from C42</span>
    <span class="n">c4</span> <span class="o">=</span> <span class="mf">0.000013</span>  <span class="c1"># from C43</span>
    <span class="n">c5</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.2237</span>  <span class="c1"># from C44</span>
    <span class="n">epsilon</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># from C45</span>

    <span class="c1"># Translated formula with renamed variables from McJannet and Desilets, 2023</span>
    <span class="n">tau_new</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="p">(</span><span class="n">c0</span> <span class="o">*</span> <span class="n">reference_atmospheric_depth</span> <span class="o">+</span> <span class="n">c1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
            <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
        <span class="o">-</span><span class="p">(</span><span class="n">c2</span> <span class="o">*</span> <span class="n">reference_atmospheric_depth</span> <span class="o">+</span> <span class="n">c3</span><span class="p">)</span> <span class="o">*</span> <span class="n">reference_Rc</span> <span class="o">**</span> <span class="p">(</span><span class="n">c4</span> <span class="o">*</span> <span class="n">reference_atmospheric_depth</span> <span class="o">+</span> <span class="n">c5</span><span class="p">)))</span>

    <span class="n">norm_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">tau_new</span>

    <span class="c1"># Calculate the result using the provided parameters</span>
    <span class="n">tau</span> <span class="o">=</span> <span class="n">epsilon</span> <span class="o">*</span> <span class="n">norm_factor</span> <span class="o">*</span> <span class="p">(</span><span class="n">c0</span> <span class="o">*</span> <span class="n">site_atmospheric_depth</span> <span class="o">+</span> <span class="n">c1</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span>
                <span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="p">(</span><span class="n">c2</span> <span class="o">*</span> <span class="n">site_atmospheric_depth</span> <span class="o">+</span> <span class="n">c3</span><span class="p">)</span> <span class="o">*</span> <span class="n">site_Rc</span> <span class="o">**</span> <span class="p">(</span><span class="n">c4</span> <span class="o">*</span> <span class="n">site_atmospheric_depth</span> <span class="o">+</span> <span class="n">c5</span><span class="p">)))</span>
    <span class="k">return</span> <span class="n">tau</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.nrad_weight" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">nrad_weight</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">rhob</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Kohli_2015&#39;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Hveg</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to compute distance weights corresponding to each soil sample.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>h</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Air Humidity  from 0.1  to 50 in g/m^3. When h=0, the function will skip the distance weighting.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>theta</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil Moisture for each sample (0.02 - 0.50 m^3/m^3)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>distances</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Distances from the location of each sample to the origin (0.5 - 600 m)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>depth</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Depths for each sample (m)</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>rhob</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Bulk density in g/cm^3</p>
            </div>
          </td>
          <td>
                <code>1.4</code>
          </td>
        </tr>
        <tr>
          <td><code>p</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric pressure in hPa. Required for the 'Schron_2017' method.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>Hveg</code></td>
          <td>
                <code><span title="numpy.array">array</span> or <span title="pandas.Series">Series</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Vegetation height in m. Required for the 'Schron_2017' method.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Method to compute the distance weights. Options are 'Kohli_2015' or 'Schron_2017'.</p>
            </div>
          </td>
          <td>
                <code>&#39;Kohli_2015&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Distance weights for each sample.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Köhli, M., Schrön, M., Zreda, M., Schmidt, U., Dietrich, P., and Zacharias, S. (2015).
Footprint characteristics revised for field-scale soil moisture monitoring with cosmic-ray
neutrons. Water Resour. Res. 51, 5772–5790. doi:10.1002/2015WR017169</p>
<p>Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L.,
Martini, E., Baroni, G., Rosolem, R., Weimar, J., Mai, J., Cuntz, M., Rebmann, C.,
Oswald, S. E., Dietrich, P., Schmidt, U., and Zacharias, S.: Improving calibration and
validation of cosmic-ray neutron sensors in the light of spatial sensitivity,
Hydrol. Earth Syst. Sci., 21, 5009–5030, https://doi.org/10.5194/hess-21-5009-2017, 2017.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span>
<span class="normal">728</span>
<span class="normal">729</span>
<span class="normal">730</span>
<span class="normal">731</span>
<span class="normal">732</span>
<span class="normal">733</span>
<span class="normal">734</span>
<span class="normal">735</span>
<span class="normal">736</span>
<span class="normal">737</span>
<span class="normal">738</span>
<span class="normal">739</span>
<span class="normal">740</span>
<span class="normal">741</span>
<span class="normal">742</span>
<span class="normal">743</span>
<span class="normal">744</span>
<span class="normal">745</span>
<span class="normal">746</span>
<span class="normal">747</span>
<span class="normal">748</span>
<span class="normal">749</span>
<span class="normal">750</span>
<span class="normal">751</span>
<span class="normal">752</span>
<span class="normal">753</span>
<span class="normal">754</span>
<span class="normal">755</span>
<span class="normal">756</span>
<span class="normal">757</span>
<span class="normal">758</span>
<span class="normal">759</span>
<span class="normal">760</span>
<span class="normal">761</span>
<span class="normal">762</span>
<span class="normal">763</span>
<span class="normal">764</span>
<span class="normal">765</span>
<span class="normal">766</span>
<span class="normal">767</span>
<span class="normal">768</span>
<span class="normal">769</span>
<span class="normal">770</span>
<span class="normal">771</span>
<span class="normal">772</span>
<span class="normal">773</span>
<span class="normal">774</span>
<span class="normal">775</span>
<span class="normal">776</span>
<span class="normal">777</span>
<span class="normal">778</span>
<span class="normal">779</span>
<span class="normal">780</span>
<span class="normal">781</span>
<span class="normal">782</span>
<span class="normal">783</span>
<span class="normal">784</span>
<span class="normal">785</span>
<span class="normal">786</span>
<span class="normal">787</span>
<span class="normal">788</span>
<span class="normal">789</span>
<span class="normal">790</span>
<span class="normal">791</span>
<span class="normal">792</span>
<span class="normal">793</span>
<span class="normal">794</span>
<span class="normal">795</span>
<span class="normal">796</span>
<span class="normal">797</span>
<span class="normal">798</span>
<span class="normal">799</span>
<span class="normal">800</span>
<span class="normal">801</span>
<span class="normal">802</span>
<span class="normal">803</span>
<span class="normal">804</span>
<span class="normal">805</span>
<span class="normal">806</span>
<span class="normal">807</span>
<span class="normal">808</span>
<span class="normal">809</span>
<span class="normal">810</span>
<span class="normal">811</span>
<span class="normal">812</span>
<span class="normal">813</span>
<span class="normal">814</span>
<span class="normal">815</span>
<span class="normal">816</span>
<span class="normal">817</span>
<span class="normal">818</span>
<span class="normal">819</span>
<span class="normal">820</span>
<span class="normal">821</span>
<span class="normal">822</span>
<span class="normal">823</span>
<span class="normal">824</span>
<span class="normal">825</span>
<span class="normal">826</span>
<span class="normal">827</span>
<span class="normal">828</span>
<span class="normal">829</span>
<span class="normal">830</span>
<span class="normal">831</span>
<span class="normal">832</span>
<span class="normal">833</span>
<span class="normal">834</span>
<span class="normal">835</span>
<span class="normal">836</span>
<span class="normal">837</span>
<span class="normal">838</span>
<span class="normal">839</span>
<span class="normal">840</span>
<span class="normal">841</span>
<span class="normal">842</span>
<span class="normal">843</span>
<span class="normal">844</span>
<span class="normal">845</span>
<span class="normal">846</span>
<span class="normal">847</span>
<span class="normal">848</span>
<span class="normal">849</span>
<span class="normal">850</span>
<span class="normal">851</span>
<span class="normal">852</span>
<span class="normal">853</span>
<span class="normal">854</span>
<span class="normal">855</span>
<span class="normal">856</span>
<span class="normal">857</span>
<span class="normal">858</span>
<span class="normal">859</span>
<span class="normal">860</span>
<span class="normal">861</span>
<span class="normal">862</span>
<span class="normal">863</span>
<span class="normal">864</span>
<span class="normal">865</span>
<span class="normal">866</span>
<span class="normal">867</span>
<span class="normal">868</span>
<span class="normal">869</span>
<span class="normal">870</span>
<span class="normal">871</span>
<span class="normal">872</span>
<span class="normal">873</span>
<span class="normal">874</span>
<span class="normal">875</span>
<span class="normal">876</span>
<span class="normal">877</span>
<span class="normal">878</span>
<span class="normal">879</span>
<span class="normal">880</span>
<span class="normal">881</span>
<span class="normal">882</span>
<span class="normal">883</span>
<span class="normal">884</span>
<span class="normal">885</span>
<span class="normal">886</span>
<span class="normal">887</span>
<span class="normal">888</span>
<span class="normal">889</span>
<span class="normal">890</span>
<span class="normal">891</span>
<span class="normal">892</span>
<span class="normal">893</span>
<span class="normal">894</span>
<span class="normal">895</span>
<span class="normal">896</span>
<span class="normal">897</span>
<span class="normal">898</span>
<span class="normal">899</span>
<span class="normal">900</span>
<span class="normal">901</span>
<span class="normal">902</span>
<span class="normal">903</span>
<span class="normal">904</span>
<span class="normal">905</span>
<span class="normal">906</span>
<span class="normal">907</span>
<span class="normal">908</span>
<span class="normal">909</span>
<span class="normal">910</span>
<span class="normal">911</span>
<span class="normal">912</span>
<span class="normal">913</span>
<span class="normal">914</span>
<span class="normal">915</span>
<span class="normal">916</span>
<span class="normal">917</span>
<span class="normal">918</span>
<span class="normal">919</span>
<span class="normal">920</span>
<span class="normal">921</span>
<span class="normal">922</span>
<span class="normal">923</span>
<span class="normal">924</span>
<span class="normal">925</span>
<span class="normal">926</span>
<span class="normal">927</span>
<span class="normal">928</span>
<span class="normal">929</span>
<span class="normal">930</span>
<span class="normal">931</span>
<span class="normal">932</span>
<span class="normal">933</span>
<span class="normal">934</span>
<span class="normal">935</span>
<span class="normal">936</span>
<span class="normal">937</span>
<span class="normal">938</span>
<span class="normal">939</span>
<span class="normal">940</span>
<span class="normal">941</span>
<span class="normal">942</span>
<span class="normal">943</span>
<span class="normal">944</span>
<span class="normal">945</span>
<span class="normal">946</span>
<span class="normal">947</span>
<span class="normal">948</span>
<span class="normal">949</span>
<span class="normal">950</span>
<span class="normal">951</span>
<span class="normal">952</span>
<span class="normal">953</span>
<span class="normal">954</span>
<span class="normal">955</span>
<span class="normal">956</span>
<span class="normal">957</span>
<span class="normal">958</span>
<span class="normal">959</span>
<span class="normal">960</span>
<span class="normal">961</span>
<span class="normal">962</span>
<span class="normal">963</span>
<span class="normal">964</span>
<span class="normal">965</span>
<span class="normal">966</span>
<span class="normal">967</span>
<span class="normal">968</span>
<span class="normal">969</span>
<span class="normal">970</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">nrad_weight</span><span class="p">(</span><span class="n">h</span><span class="p">,</span> <span class="n">theta</span><span class="p">,</span> <span class="n">distances</span><span class="p">,</span> <span class="n">depth</span><span class="p">,</span> <span class="n">rhob</span><span class="o">=</span><span class="mf">1.4</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;Kohli_2015&quot;</span><span class="p">,</span> <span class="n">p</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">Hveg</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to compute distance weights corresponding to each soil sample.</span>

<span class="sd">    Args:</span>
<span class="sd">        h (np.array or pd.Series): Air Humidity  from 0.1  to 50 in g/m^3. When h=0, the function will skip the distance weighting.</span>
<span class="sd">        theta (np.array or pd.Series): Soil Moisture for each sample (0.02 - 0.50 m^3/m^3)</span>
<span class="sd">        distances (np.array or pd.Series): Distances from the location of each sample to the origin (0.5 - 600 m)</span>
<span class="sd">        depth (np.array or pd.Series): Depths for each sample (m)</span>
<span class="sd">        rhob (np.array or pd.Series): Bulk density in g/cm^3</span>
<span class="sd">        p (np.array or pd.Series): Atmospheric pressure in hPa. Required for the &#39;Schron_2017&#39; method.</span>
<span class="sd">        Hveg (np.array or pd.Series): Vegetation height in m. Required for the &#39;Schron_2017&#39; method.</span>
<span class="sd">        method (str): Method to compute the distance weights. Options are &#39;Kohli_2015&#39; or &#39;Schron_2017&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Distance weights for each sample.</span>

<span class="sd">    References:</span>
<span class="sd">        Köhli, M., Schrön, M., Zreda, M., Schmidt, U., Dietrich, P., and Zacharias, S. (2015).</span>
<span class="sd">        Footprint characteristics revised for field-scale soil moisture monitoring with cosmic-ray</span>
<span class="sd">        neutrons. Water Resour. Res. 51, 5772–5790. doi:10.1002/2015WR017169</span>

<span class="sd">        Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L.,</span>
<span class="sd">        Martini, E., Baroni, G., Rosolem, R., Weimar, J., Mai, J., Cuntz, M., Rebmann, C.,</span>
<span class="sd">        Oswald, S. E., Dietrich, P., Schmidt, U., and Zacharias, S.: Improving calibration and</span>
<span class="sd">        validation of cosmic-ray neutron sensors in the light of spatial sensitivity,</span>
<span class="sd">        Hydrol. Earth Syst. Sci., 21, 5009–5030, https://doi.org/10.5194/hess-21-5009-2017, 2017.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Kohli_2015&#39;</span><span class="p">:</span>
        <span class="c1"># Table A1. Parameters for Fi and D86</span>
        <span class="n">p10</span> <span class="o">=</span> <span class="mi">8735</span><span class="p">;</span>
        <span class="n">p11</span> <span class="o">=</span> <span class="mf">17.1758</span><span class="p">;</span>
        <span class="n">p12</span> <span class="o">=</span> <span class="mi">11720</span><span class="p">;</span>
        <span class="n">p13</span> <span class="o">=</span> <span class="mf">0.00978</span><span class="p">;</span>
        <span class="n">p14</span> <span class="o">=</span> <span class="mi">7045</span><span class="p">;</span>
        <span class="n">p15</span> <span class="o">=</span> <span class="mf">0.003632</span><span class="p">;</span>
        <span class="n">p20</span> <span class="o">=</span> <span class="mf">2.7925e-2</span><span class="p">;</span>
        <span class="n">p21</span> <span class="o">=</span> <span class="mf">5.0399</span><span class="p">;</span>
        <span class="n">p22</span> <span class="o">=</span> <span class="mf">2.8544e-2</span><span class="p">;</span>
        <span class="n">p23</span> <span class="o">=</span> <span class="mf">0.002455</span><span class="p">;</span>
        <span class="n">p24</span> <span class="o">=</span> <span class="mf">6.851e-5</span><span class="p">;</span>
        <span class="n">p25</span> <span class="o">=</span> <span class="mf">9.2926</span><span class="p">;</span>
        <span class="n">p30</span> <span class="o">=</span> <span class="mi">247970</span><span class="p">;</span>
        <span class="n">p31</span> <span class="o">=</span> <span class="mf">17.63</span><span class="p">;</span>
        <span class="n">p32</span> <span class="o">=</span> <span class="mi">374655</span><span class="p">;</span>
        <span class="n">p33</span> <span class="o">=</span> <span class="mf">0.00191</span><span class="p">;</span>
        <span class="n">p34</span> <span class="o">=</span> <span class="mi">195725</span><span class="p">;</span>
        <span class="n">p40</span> <span class="o">=</span> <span class="mf">5.4818e-2</span><span class="p">;</span>
        <span class="n">p41</span> <span class="o">=</span> <span class="mf">15.921</span><span class="p">;</span>
        <span class="n">p42</span> <span class="o">=</span> <span class="mf">0.6373</span><span class="p">;</span>
        <span class="n">p43</span> <span class="o">=</span> <span class="mf">5.99e-2</span><span class="p">;</span>
        <span class="n">p44</span> <span class="o">=</span> <span class="mf">5.425e-4</span><span class="p">;</span>
        <span class="n">p50</span> <span class="o">=</span> <span class="mi">1383702</span><span class="p">;</span>
        <span class="n">p51</span> <span class="o">=</span> <span class="mf">4.156</span><span class="p">;</span>
        <span class="n">p52</span> <span class="o">=</span> <span class="mi">5325</span><span class="p">;</span>
        <span class="n">p53</span> <span class="o">=</span> <span class="mf">0.00238</span><span class="p">;</span>
        <span class="n">p54</span> <span class="o">=</span> <span class="mf">0.0156</span><span class="p">;</span>
        <span class="n">p55</span> <span class="o">=</span> <span class="mf">0.130</span><span class="p">;</span>
        <span class="n">p56</span> <span class="o">=</span> <span class="mi">1521</span><span class="p">;</span>
        <span class="n">p60</span> <span class="o">=</span> <span class="mf">6.031e-5</span><span class="p">;</span>
        <span class="n">p61</span> <span class="o">=</span> <span class="mf">98.5</span><span class="p">;</span>
        <span class="n">p62</span> <span class="o">=</span> <span class="mf">1.0466e-3</span><span class="p">;</span>
        <span class="n">p70</span> <span class="o">=</span> <span class="mi">11747</span><span class="p">;</span>
        <span class="n">p71</span> <span class="o">=</span> <span class="mf">41.66</span><span class="p">;</span>
        <span class="n">p72</span> <span class="o">=</span> <span class="mi">4521</span><span class="p">;</span>
        <span class="n">p73</span> <span class="o">=</span> <span class="mf">0.01998</span><span class="p">;</span>
        <span class="n">p74</span> <span class="o">=</span> <span class="mf">0.00604</span><span class="p">;</span>
        <span class="n">p75</span> <span class="o">=</span> <span class="mi">2534</span><span class="p">;</span>
        <span class="n">p76</span> <span class="o">=</span> <span class="mf">0.00475</span><span class="p">;</span>
        <span class="n">p80</span> <span class="o">=</span> <span class="mf">1.543e-2</span><span class="p">;</span>
        <span class="n">p81</span> <span class="o">=</span> <span class="mf">10.06</span><span class="p">;</span>
        <span class="n">p82</span> <span class="o">=</span> <span class="mf">1.807e-2</span><span class="p">;</span>
        <span class="n">p83</span> <span class="o">=</span> <span class="mf">0.0011</span><span class="p">;</span>
        <span class="n">p84</span> <span class="o">=</span> <span class="mf">8.81e-5</span><span class="p">;</span>
        <span class="n">p85</span> <span class="o">=</span> <span class="mf">0.0405</span><span class="p">;</span>
        <span class="n">p86</span> <span class="o">=</span> <span class="mf">20.24</span><span class="p">;</span>
        <span class="n">p90</span> <span class="o">=</span> <span class="mf">8.321</span><span class="p">;</span>
        <span class="n">p91</span> <span class="o">=</span> <span class="mf">0.14249</span><span class="p">;</span>
        <span class="n">p92</span> <span class="o">=</span> <span class="mf">0.96655</span><span class="p">;</span>
        <span class="n">p93</span> <span class="o">=</span> <span class="mf">26.42</span><span class="p">;</span>
        <span class="n">p94</span> <span class="o">=</span> <span class="mf">0.0567</span><span class="p">;</span>

        <span class="c1"># Numerical determination of the penetration depth (86%) (Eq. 8)</span>
        <span class="n">D86</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">rhob</span> <span class="o">*</span> <span class="p">(</span><span class="n">p90</span> <span class="o">+</span> <span class="n">p91</span> <span class="o">*</span> <span class="p">(</span><span class="n">p92</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">distances</span> <span class="o">/</span> <span class="mi">100</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">p93</span> <span class="o">+</span> <span class="n">theta</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">p94</span> <span class="o">+</span> <span class="n">theta</span><span class="p">))</span>

        <span class="c1"># Depth weights (Eq. 7)</span>
        <span class="n">Wd</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">depth</span> <span class="o">/</span> <span class="n">D86</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">h</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">W</span> <span class="o">=</span> <span class="mi">1</span>  <span class="c1"># skip distance weighting</span>

        <span class="k">elif</span> <span class="p">(</span><span class="n">h</span> <span class="o">&gt;=</span> <span class="mf">0.1</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">h</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">):</span>
            <span class="c1"># Functions for Fi (Appendix A in Köhli et al., 2015)</span>
            <span class="n">F1</span> <span class="o">=</span> <span class="n">p10</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p13</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p11</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">p12</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p15</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">-</span> <span class="n">p14</span> <span class="o">*</span> <span class="n">theta</span>
            <span class="n">F2</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">p20</span> <span class="o">+</span> <span class="n">p24</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p21</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p25</span> <span class="o">*</span> <span class="n">theta</span><span class="p">))</span> <span class="o">+</span> <span class="n">p22</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p23</span><span class="p">)</span>
            <span class="n">F3</span> <span class="o">=</span> <span class="p">(</span><span class="n">p30</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p33</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p31</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">p32</span> <span class="o">-</span> <span class="n">p34</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span>
            <span class="n">F4</span> <span class="o">=</span> <span class="n">p40</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p41</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">+</span> <span class="n">p42</span> <span class="o">-</span> <span class="n">p43</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">+</span> <span class="n">p44</span> <span class="o">*</span> <span class="n">h</span>
            <span class="n">F5</span> <span class="o">=</span> <span class="n">p50</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.02</span> <span class="o">-</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">p55</span> <span class="o">/</span> <span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">p55</span> <span class="o">+</span> <span class="n">p56</span> <span class="o">*</span> <span class="n">theta</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">p54</span> <span class="o">-</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
                <span class="o">-</span><span class="n">p51</span> <span class="o">*</span> <span class="p">(</span><span class="n">theta</span> <span class="o">-</span> <span class="n">p54</span><span class="p">))</span> <span class="o">+</span> <span class="n">p52</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.7</span> <span class="o">-</span> <span class="n">h</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">*</span> <span class="n">p53</span><span class="p">)</span>
            <span class="n">F6</span> <span class="o">=</span> <span class="n">p60</span> <span class="o">*</span> <span class="p">(</span><span class="n">h</span> <span class="o">+</span> <span class="n">p61</span><span class="p">)</span> <span class="o">+</span> <span class="n">p62</span> <span class="o">*</span> <span class="n">theta</span>
            <span class="n">F7</span> <span class="o">=</span> <span class="p">(</span><span class="n">p70</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">p76</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p71</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p74</span><span class="p">))</span> <span class="o">+</span> <span class="n">p72</span> <span class="o">-</span> <span class="n">p75</span> <span class="o">*</span> <span class="n">theta</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p73</span><span class="p">)</span>
            <span class="n">F8</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">p80</span> <span class="o">+</span> <span class="n">p84</span> <span class="o">*</span> <span class="n">h</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p81</span> <span class="o">*</span> <span class="n">theta</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">p85</span> <span class="o">*</span> <span class="n">h</span> <span class="o">+</span> <span class="n">p86</span> <span class="o">*</span> <span class="n">theta</span><span class="p">))</span> <span class="o">+</span> <span class="n">p82</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">h</span> <span class="o">*</span> <span class="n">p83</span><span class="p">)</span>

            <span class="c1"># Distance weights (Eq. 3)</span>
            <span class="n">W</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ones_like</span><span class="p">(</span><span class="n">distances</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">)):</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">):</span>
                    <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">F1</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F2</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">F3</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F4</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="k">elif</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="ow">and</span> <span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">):</span>
                    <span class="n">W</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="n">F5</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F6</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">+</span> <span class="n">F7</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">F8</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">*</span> <span class="n">distances</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>

                <span class="k">else</span><span class="p">:</span>
                    <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input distances are not valid.&#39;</span><span class="p">)</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Air humidity values are out of range.&#39;</span><span class="p">)</span>

        <span class="c1"># Combined and normalized weights</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">Wd</span> <span class="o">*</span> <span class="n">W</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">Wd</span> <span class="o">*</span> <span class="n">W</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">weights</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Schron_2017&#39;</span><span class="p">:</span>
        <span class="c1"># Horizontal distance weights According to Eq. 6 and Table A1 in Schrön et al. (2017)</span>
        <span class="c1"># Method for calculating the horizontal distance weights from 0 to 1m</span>
        <span class="k">def</span> <span class="nf">WrX</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">x00</span> <span class="o">=</span> <span class="mf">3.7</span>
            <span class="n">a00</span> <span class="o">=</span> <span class="mi">8735</span><span class="p">;</span>
            <span class="n">a01</span> <span class="o">=</span> <span class="mf">22.689</span><span class="p">;</span>
            <span class="n">a02</span> <span class="o">=</span> <span class="mi">11720</span><span class="p">;</span>
            <span class="n">a03</span> <span class="o">=</span> <span class="mf">0.00978</span><span class="p">;</span>
            <span class="n">a04</span> <span class="o">=</span> <span class="mi">9306</span><span class="p">;</span>
            <span class="n">a05</span> <span class="o">=</span> <span class="mf">0.003632</span>
            <span class="n">a10</span> <span class="o">=</span> <span class="mf">2.7925e-2</span><span class="p">;</span>
            <span class="n">a11</span> <span class="o">=</span> <span class="mf">6.6577</span><span class="p">;</span>
            <span class="n">a12</span> <span class="o">=</span> <span class="mf">0.028544</span><span class="p">;</span>
            <span class="n">a13</span> <span class="o">=</span> <span class="mf">0.002455</span><span class="p">;</span>
            <span class="n">a14</span> <span class="o">=</span> <span class="mf">6.851e-5</span><span class="p">;</span>
            <span class="n">a15</span> <span class="o">=</span> <span class="mf">12.2755</span>
            <span class="n">a20</span> <span class="o">=</span> <span class="mi">247970</span><span class="p">;</span>
            <span class="n">a21</span> <span class="o">=</span> <span class="mf">23.289</span><span class="p">;</span>
            <span class="n">a22</span> <span class="o">=</span> <span class="mi">374655</span><span class="p">;</span>
            <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.00191</span><span class="p">;</span>
            <span class="n">a24</span> <span class="o">=</span> <span class="mi">258552</span>
            <span class="n">a30</span> <span class="o">=</span> <span class="mf">5.4818e-2</span><span class="p">;</span>
            <span class="n">a31</span> <span class="o">=</span> <span class="mf">21.032</span><span class="p">;</span>
            <span class="n">a32</span> <span class="o">=</span> <span class="mf">0.6373</span><span class="p">;</span>
            <span class="n">a33</span> <span class="o">=</span> <span class="mf">0.0791</span><span class="p">;</span>
            <span class="n">a34</span> <span class="o">=</span> <span class="mf">5.425e-4</span>

            <span class="n">x0</span> <span class="o">=</span> <span class="n">x00</span>
            <span class="n">A0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a00</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a03</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a01</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a02</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">a04</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">A1</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">a10</span> <span class="o">+</span> <span class="n">a14</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a11</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a15</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="n">a12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">a13</span><span class="p">)</span>
            <span class="n">A2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a20</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a23</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a21</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a22</span> <span class="o">-</span> <span class="n">a24</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="n">a30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a31</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a32</span> <span class="o">-</span> <span class="n">a33</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a34</span> <span class="o">*</span> <span class="n">x</span>

            <span class="k">return</span> <span class="p">((</span><span class="n">A0</span> <span class="o">*</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">A1</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">A3</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">x0</span> <span class="o">*</span> <span class="n">r</span><span class="p">)))</span>

        <span class="c1"># Method for calculating the horizontal distance weights from 1 to 50m</span>
        <span class="k">def</span> <span class="nf">WrA</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">a00</span> <span class="o">=</span> <span class="mi">8735</span><span class="p">;</span>
            <span class="n">a01</span> <span class="o">=</span> <span class="mf">22.689</span><span class="p">;</span>
            <span class="n">a02</span> <span class="o">=</span> <span class="mi">11720</span><span class="p">;</span>
            <span class="n">a03</span> <span class="o">=</span> <span class="mf">0.00978</span><span class="p">;</span>
            <span class="n">a04</span> <span class="o">=</span> <span class="mi">9306</span><span class="p">;</span>
            <span class="n">a05</span> <span class="o">=</span> <span class="mf">0.003632</span>
            <span class="n">a10</span> <span class="o">=</span> <span class="mf">2.7925e-2</span><span class="p">;</span>
            <span class="n">a11</span> <span class="o">=</span> <span class="mf">6.6577</span><span class="p">;</span>
            <span class="n">a12</span> <span class="o">=</span> <span class="mf">0.028544</span><span class="p">;</span>
            <span class="n">a13</span> <span class="o">=</span> <span class="mf">0.002455</span><span class="p">;</span>
            <span class="n">a14</span> <span class="o">=</span> <span class="mf">6.851e-5</span><span class="p">;</span>
            <span class="n">a15</span> <span class="o">=</span> <span class="mf">12.2755</span>
            <span class="n">a20</span> <span class="o">=</span> <span class="mi">247970</span><span class="p">;</span>
            <span class="n">a21</span> <span class="o">=</span> <span class="mf">23.289</span><span class="p">;</span>
            <span class="n">a22</span> <span class="o">=</span> <span class="mi">374655</span><span class="p">;</span>
            <span class="n">a23</span> <span class="o">=</span> <span class="mf">0.00191</span><span class="p">;</span>
            <span class="n">a24</span> <span class="o">=</span> <span class="mi">258552</span>
            <span class="n">a30</span> <span class="o">=</span> <span class="mf">5.4818e-2</span><span class="p">;</span>
            <span class="n">a31</span> <span class="o">=</span> <span class="mf">21.032</span><span class="p">;</span>
            <span class="n">a32</span> <span class="o">=</span> <span class="mf">0.6373</span><span class="p">;</span>
            <span class="n">a33</span> <span class="o">=</span> <span class="mf">0.0791</span><span class="p">;</span>
            <span class="n">a34</span> <span class="o">=</span> <span class="mf">5.425e-4</span>

            <span class="n">A0</span> <span class="o">=</span> <span class="p">(</span><span class="n">a00</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a03</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a01</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a02</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a05</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">-</span> <span class="n">a04</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">A1</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">a10</span> <span class="o">+</span> <span class="n">a14</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a11</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a15</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="n">a12</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">a13</span><span class="p">)</span>
            <span class="n">A2</span> <span class="o">=</span> <span class="p">(</span><span class="n">a20</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">a23</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a21</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a22</span> <span class="o">-</span> <span class="n">a24</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span>
            <span class="n">A3</span> <span class="o">=</span> <span class="n">a30</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">a31</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">+</span> <span class="n">a32</span> <span class="o">-</span> <span class="n">a33</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">a34</span> <span class="o">*</span> <span class="n">x</span>

            <span class="k">return</span> <span class="n">A0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">A1</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">A2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">A3</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

        <span class="c1"># Method for calculating the horizontal distance weights from 50 to 600m</span>
        <span class="k">def</span> <span class="nf">WrB</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">b00</span> <span class="o">=</span> <span class="mi">39006</span><span class="p">;</span>
            <span class="n">b01</span> <span class="o">=</span> <span class="mi">15002337</span><span class="p">;</span>
            <span class="n">b02</span> <span class="o">=</span> <span class="mf">2009.24</span><span class="p">;</span>
            <span class="n">b03</span> <span class="o">=</span> <span class="mf">0.01181</span><span class="p">;</span>
            <span class="n">b04</span> <span class="o">=</span> <span class="mf">3.146</span><span class="p">;</span>
            <span class="n">b05</span> <span class="o">=</span> <span class="mf">16.7417</span><span class="p">;</span>
            <span class="n">b06</span> <span class="o">=</span> <span class="mi">3727</span>
            <span class="n">b10</span> <span class="o">=</span> <span class="mf">6.031e-5</span><span class="p">;</span>
            <span class="n">b11</span> <span class="o">=</span> <span class="mf">98.5</span><span class="p">;</span>
            <span class="n">b12</span> <span class="o">=</span> <span class="mf">0.0013826</span>
            <span class="n">b20</span> <span class="o">=</span> <span class="mi">11747</span><span class="p">;</span>
            <span class="n">b21</span> <span class="o">=</span> <span class="mf">55.033</span><span class="p">;</span>
            <span class="n">b22</span> <span class="o">=</span> <span class="mi">4521</span><span class="p">;</span>
            <span class="n">b23</span> <span class="o">=</span> <span class="mf">0.01998</span><span class="p">;</span>
            <span class="n">b24</span> <span class="o">=</span> <span class="mf">0.00604</span><span class="p">;</span>
            <span class="n">b25</span> <span class="o">=</span> <span class="mf">3347.4</span><span class="p">;</span>
            <span class="n">b26</span> <span class="o">=</span> <span class="mf">0.00475</span>
            <span class="n">b30</span> <span class="o">=</span> <span class="mf">1.543e-2</span><span class="p">;</span>
            <span class="n">b31</span> <span class="o">=</span> <span class="mf">13.29</span><span class="p">;</span>
            <span class="n">b32</span> <span class="o">=</span> <span class="mf">1.807e-2</span><span class="p">;</span>
            <span class="n">b33</span> <span class="o">=</span> <span class="mf">0.0011</span><span class="p">;</span>
            <span class="n">b34</span> <span class="o">=</span> <span class="mf">8.81e-5</span><span class="p">;</span>
            <span class="n">b35</span> <span class="o">=</span> <span class="mf">0.0405</span><span class="p">;</span>
            <span class="n">b36</span> <span class="o">=</span> <span class="mf">26.74</span>

            <span class="n">B0</span> <span class="o">=</span> <span class="p">(</span><span class="n">b00</span> <span class="o">-</span> <span class="n">b01</span> <span class="o">/</span> <span class="p">(</span><span class="n">b02</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">x</span> <span class="o">-</span> <span class="mf">0.13</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="n">b03</span> <span class="o">-</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b04</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">-</span> <span class="n">b05</span> <span class="o">*</span> <span class="n">x</span> <span class="o">*</span> <span class="n">y</span> <span class="o">+</span> <span class="n">b06</span>
            <span class="n">B1</span> <span class="o">=</span> <span class="n">b10</span> <span class="o">*</span> <span class="p">(</span><span class="n">x</span> <span class="o">+</span> <span class="n">b11</span><span class="p">)</span> <span class="o">+</span> <span class="n">b12</span> <span class="o">*</span> <span class="n">y</span>
            <span class="n">B2</span> <span class="o">=</span> <span class="p">(</span><span class="n">b20</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">b26</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b21</span> <span class="o">*</span> <span class="n">y</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">x</span> <span class="o">*</span> <span class="n">b24</span><span class="p">))</span> <span class="o">+</span> <span class="n">b22</span> <span class="o">-</span> <span class="n">b25</span> <span class="o">*</span> <span class="n">y</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">b23</span><span class="p">)</span>
            <span class="n">B3</span> <span class="o">=</span> <span class="p">((</span><span class="o">-</span><span class="n">b30</span> <span class="o">+</span> <span class="n">b34</span> <span class="o">*</span> <span class="n">x</span><span class="p">)</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">b31</span> <span class="o">*</span> <span class="n">y</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">b35</span> <span class="o">*</span> <span class="n">x</span> <span class="o">+</span> <span class="n">b36</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span> <span class="o">+</span> <span class="n">b32</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="mi">2</span> <span class="o">+</span> <span class="n">x</span> <span class="o">*</span> <span class="n">b33</span><span class="p">)</span>

            <span class="k">return</span> <span class="n">B0</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B1</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span> <span class="o">+</span> <span class="n">B2</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">B3</span> <span class="o">*</span> <span class="n">r</span><span class="p">)</span>

        <span class="k">def</span> <span class="nf">rscaled</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">Hveg</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="n">Fp</span> <span class="o">=</span> <span class="mf">0.4922</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.86</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">p</span> <span class="o">/</span> <span class="mf">1013.25</span><span class="p">))</span>
            <span class="n">Fveg</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">-</span> <span class="mf">0.17</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.41</span> <span class="o">*</span> <span class="n">Hveg</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">9.25</span> <span class="o">*</span> <span class="n">y</span><span class="p">))</span>
            <span class="k">return</span> <span class="n">r</span> <span class="o">/</span> <span class="n">Fp</span> <span class="o">/</span> <span class="n">Fveg</span>

        <span class="c1"># Rename variables to be consistent with the revised paper</span>
        <span class="n">r</span> <span class="o">=</span> <span class="n">distances</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">h</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">theta</span>
        <span class="n">bd</span> <span class="o">=</span> <span class="n">rhob</span>

        <span class="k">if</span> <span class="n">Hveg</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">p</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">r</span> <span class="o">=</span> <span class="n">rscaled</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">p</span><span class="p">,</span> <span class="n">Hveg</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="n">Wr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">r</span><span class="p">))</span>

        <span class="c1"># See Eq. 6 in Schron et al. (2017)</span>
        <span class="n">r0_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">1</span><span class="p">)</span>
        <span class="n">r1_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;=</span> <span class="mi">50</span><span class="p">)</span>
        <span class="n">r2_idx</span> <span class="o">=</span> <span class="p">(</span><span class="n">r</span> <span class="o">&gt;</span> <span class="mi">50</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">r</span> <span class="o">&lt;</span> <span class="mi">600</span><span class="p">)</span>
        <span class="n">Wr</span><span class="p">[</span><span class="n">r0_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">WrX</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">r0_idx</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">r0_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">r0_idx</span><span class="p">])</span>
        <span class="n">Wr</span><span class="p">[</span><span class="n">r1_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">WrA</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">r1_idx</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">r1_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">r1_idx</span><span class="p">])</span>
        <span class="n">Wr</span><span class="p">[</span><span class="n">r2_idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">WrB</span><span class="p">(</span><span class="n">r</span><span class="p">[</span><span class="n">r2_idx</span><span class="p">],</span> <span class="n">x</span><span class="p">[</span><span class="n">r2_idx</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">r2_idx</span><span class="p">])</span>

        <span class="c1"># Vertical distance weights</span>
        <span class="k">def</span> <span class="nf">D86</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">bd</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.321</span> <span class="o">+</span> <span class="mf">0.14249</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.96655</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">r</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="n">y</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.0429</span> <span class="o">+</span> <span class="n">y</span><span class="p">))</span>

        <span class="k">def</span> <span class="nf">Wd</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">2</span> <span class="o">*</span> <span class="n">d</span> <span class="o">/</span> <span class="n">D86</span><span class="p">(</span><span class="n">r</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">y</span><span class="p">))</span>

        <span class="c1"># Calculate the vertical distance weights</span>
        <span class="n">Wd</span> <span class="o">=</span> <span class="n">Wd</span><span class="p">(</span><span class="n">depth</span><span class="p">,</span> <span class="n">r</span><span class="p">,</span> <span class="n">bd</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>

        <span class="c1"># Combined and normalized weights</span>
        <span class="c1"># Combined and normalized weights</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="n">Wd</span> <span class="o">*</span> <span class="n">Wr</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">nansum</span><span class="p">(</span><span class="n">Wd</span> <span class="o">*</span> <span class="n">Wr</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">weights</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.remove_incomplete_intervals" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">remove_incomplete_intervals</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="p">,</span> <span class="n">integration_time</span><span class="p">,</span> <span class="n">remove_first</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that removes rows with incomplete integration intervals.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>df</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pandas Dataframe with data from stationary or roving CRNP devices.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>timestamp_col</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Name of the column with timestamps in datetime format.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>integration_time</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Duration of the neutron counting interval in seconds. Typical values are 60 seconds and 3600 seconds.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>remove_first</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Remove first row. Default is False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">remove_incomplete_intervals</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">timestamp_col</span><span class="p">,</span> <span class="n">integration_time</span><span class="p">,</span> <span class="n">remove_first</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that removes rows with incomplete integration intervals.</span>

<span class="sd">    Args:</span>
<span class="sd">        df (pandas.DataFrame): Pandas Dataframe with data from stationary or roving CRNP devices.</span>
<span class="sd">        timestamp_col (str): Name of the column with timestamps in datetime format.</span>
<span class="sd">        integration_time (int): Duration of the neutron counting interval in seconds. Typical values are 60 seconds and 3600 seconds.</span>
<span class="sd">        remove_first (bool, optional): Remove first row. Default is False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): </span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Check format of timestamp column</span>
    <span class="k">if</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">dtype</span> <span class="o">!=</span> <span class="s1">&#39;datetime64[ns]&#39;</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">TypeError</span><span class="p">(</span><span class="s1">&#39;timestamp_col must be datetime64. Use `pd.to_datetime()` to fix this issue.&#39;</span><span class="p">)</span>

    <span class="c1"># Check if differences in timestamps are below or above the provided integration time</span>
    <span class="n">idx_delta</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">timestamp_col</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span><span class="o">.</span><span class="n">dt</span><span class="o">.</span><span class="n">total_seconds</span><span class="p">()</span> <span class="o">!=</span> <span class="n">integration_time</span>

    <span class="k">if</span> <span class="n">remove_first</span><span class="p">:</span>
        <span class="n">idx_delta</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="c1"># Select rows that meet the specified integration time</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="o">~</span><span class="n">idx_delta</span><span class="p">]</span>
    <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Notify user about the number of rows that have been removed</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Removed a total of </span><span class="si">{</span><span class="nb">sum</span><span class="p">(</span><span class="n">idx_delta</span><span class="p">)</span><span class="si">}</span><span class="s2"> rows.&quot;</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">df</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.rover_centered_coordinates" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">rover_centered_coordinates</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the intermediate locations between two points, assuming the measurements were taken at a constant speed.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>x coordinates.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>y coordinates.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>x_est</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Estimated x coordinates.</p>
            </div>
          </td>
        </tr>
        <tr>
<td><code>y_est</code></td>          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Estimated y coordinates.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1486</span>
<span class="normal">1487</span>
<span class="normal">1488</span>
<span class="normal">1489</span>
<span class="normal">1490</span>
<span class="normal">1491</span>
<span class="normal">1492</span>
<span class="normal">1493</span>
<span class="normal">1494</span>
<span class="normal">1495</span>
<span class="normal">1496</span>
<span class="normal">1497</span>
<span class="normal">1498</span>
<span class="normal">1499</span>
<span class="normal">1500</span>
<span class="normal">1501</span>
<span class="normal">1502</span>
<span class="normal">1503</span>
<span class="normal">1504</span>
<span class="normal">1505</span>
<span class="normal">1506</span>
<span class="normal">1507</span>
<span class="normal">1508</span>
<span class="normal">1509</span>
<span class="normal">1510</span>
<span class="normal">1511</span>
<span class="normal">1512</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">rover_centered_coordinates</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to estimate the intermediate locations between two points, assuming the measurements were taken at a constant speed.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (array): x coordinates.</span>
<span class="sd">        y (array): y coordinates.</span>

<span class="sd">    Returns:</span>
<span class="sd">        x_est (array): Estimated x coordinates.</span>
<span class="sd">        y_est (array): Estimated y coordinates.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Make it datatype agnostic</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">x</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">values</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">isinstance</span><span class="p">(</span><span class="n">y</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
        <span class="n">y</span> <span class="o">=</span> <span class="n">y</span><span class="o">.</span><span class="n">values</span>

    <span class="c1"># Do the average of the two points</span>
    <span class="n">x_est</span> <span class="o">=</span> <span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">x</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">y_est</span> <span class="o">=</span> <span class="p">(</span><span class="n">y</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span> <span class="o">+</span> <span class="n">y</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">/</span> <span class="mi">2</span>

    <span class="c1"># Add the first point to match the length of the original array</span>
    <span class="n">x_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">x_est</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">y_est</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">insert</span><span class="p">(</span><span class="n">y_est</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">y</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

    <span class="k">return</span> <span class="n">x_est</span><span class="p">,</span> <span class="n">y_est</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.sensing_depth" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">sensing_depth</span><span class="p">(</span><span class="n">vwc</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">p_ref</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Schron_2017&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function that computes the estimated sensing depth of the cosmic-ray neutron probe.
The function offers several methods to compute the depth at which 86 % of the neutrons
probe the soil profile.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>vwc</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Estimated volumetric water content for each timestamp.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>pressure</code></td>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Atmospheric pressure in hPa for each timestamp.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>p_ref</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Reference pressure in hPa.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bulk_density</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Soil bulk density.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>Wlat</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Lattice water content.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Method to compute the sensing depth. Options are 'Schron_2017' or 'Franz_2012'.</p>
            </div>
          </td>
          <td>
                <code>&#39;Schron_2017&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>dist</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List of radial distances at which to estimate the sensing depth. Only used for the 'Schron_2017' method.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array or <span title="pandas.Series">Series</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Estimated sensing depth in m.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Franz, T.E., Zreda, M., Ferre, T.P.A., Rosolem, R., Zweck, C., Stillman, S., Zeng, X. and Shuttleworth, W.J., 2012.
Measurement depth of the cosmic ray soil moisture probe affected by hydrogen from various sources.
Water Resources Research, 48(8). doi.org/10.1029/2012WR011871</p>
<p>Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L., et al. (2017).
Improving calibration and validation of cosmic-ray neutron sensors in the light of spatial sensitivity.
Hydrol. Earth Syst. Sci. 21, 5009–5030. doi.org/10.5194/hess-21-5009-2017</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">sensing_depth</span><span class="p">(</span><span class="n">vwc</span><span class="p">,</span> <span class="n">pressure</span><span class="p">,</span> <span class="n">p_ref</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">Wlat</span><span class="p">,</span> <span class="n">dist</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;Schron_2017&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function that computes the estimated sensing depth of the cosmic-ray neutron probe.</span>
<span class="sd">    The function offers several methods to compute the depth at which 86 % of the neutrons</span>
<span class="sd">    probe the soil profile.</span>

<span class="sd">    Args:</span>
<span class="sd">        vwc (array or pd.Series or pd.DataFrame): Estimated volumetric water content for each timestamp.</span>
<span class="sd">        pressure (array or pd.Series or pd.DataFrame): Atmospheric pressure in hPa for each timestamp.</span>
<span class="sd">        p_ref (float): Reference pressure in hPa.</span>
<span class="sd">        bulk_density (float): Soil bulk density.</span>
<span class="sd">        Wlat (float): Lattice water content.</span>
<span class="sd">        method (str): Method to compute the sensing depth. Options are &#39;Schron_2017&#39; or &#39;Franz_2012&#39;.</span>
<span class="sd">        dist (list or array): List of radial distances at which to estimate the sensing depth. Only used for the &#39;Schron_2017&#39; method.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array or pd.Series or pd.DataFrame): Estimated sensing depth in m.</span>

<span class="sd">    References:</span>
<span class="sd">        Franz, T.E., Zreda, M., Ferre, T.P.A., Rosolem, R., Zweck, C., Stillman, S., Zeng, X. and Shuttleworth, W.J., 2012.</span>
<span class="sd">        Measurement depth of the cosmic ray soil moisture probe affected by hydrogen from various sources.</span>
<span class="sd">        Water Resources Research, 48(8). doi.org/10.1029/2012WR011871</span>

<span class="sd">        Schrön, M., Köhli, M., Scheiffele, L., Iwema, J., Bogena, H. R., Lv, L., et al. (2017).</span>
<span class="sd">        Improving calibration and validation of cosmic-ray neutron sensors in the light of spatial sensitivity.</span>
<span class="sd">        Hydrol. Earth Syst. Sci. 21, 5009–5030. doi.org/10.5194/hess-21-5009-2017</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Determine sensing depth (D86)</span>
    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Schron_2017&#39;</span><span class="p">:</span>
        <span class="c1"># See Appendix A of Schrön et al. (2017)</span>
        <span class="n">Fp</span> <span class="o">=</span> <span class="mf">0.4922</span> <span class="o">/</span> <span class="p">(</span><span class="mf">0.86</span> <span class="o">-</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mi">1</span> <span class="o">*</span> <span class="n">pressure</span> <span class="o">/</span> <span class="n">p_ref</span><span class="p">))</span>
        <span class="n">Fveg</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">dist</span><span class="p">:</span>
            <span class="c1"># Compute r_star</span>
            <span class="n">r_start</span> <span class="o">=</span> <span class="n">d</span> <span class="o">/</span> <span class="n">Fp</span>

            <span class="c1"># Compute soil depth that accounts for 86% of the neutron flux</span>
            <span class="n">D86</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">bulk_density</span> <span class="o">*</span> <span class="p">(</span><span class="mf">8.321</span> <span class="o">+</span> <span class="mf">0.14249</span> <span class="o">*</span> <span class="p">(</span><span class="mf">0.96655</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="mf">0.01</span> <span class="o">*</span> <span class="n">r_start</span><span class="p">))</span> <span class="o">*</span> <span class="p">(</span><span class="mi">20</span> <span class="o">+</span> <span class="p">(</span><span class="n">Wlat</span> <span class="o">+</span> <span class="n">vwc</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span>
                        <span class="mf">0.0429</span> <span class="o">+</span> <span class="p">(</span><span class="n">Wlat</span> <span class="o">+</span> <span class="n">vwc</span><span class="p">)))</span>
            <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">D86</span><span class="p">)</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;Franz_2012&#39;</span><span class="p">:</span>
        <span class="n">results</span> <span class="o">=</span> <span class="mf">5.8</span> <span class="o">/</span> <span class="p">(</span><span class="n">bulk_density</span> <span class="o">*</span> <span class="n">Wlat</span> <span class="o">+</span> <span class="n">vwc</span> <span class="o">+</span> <span class="mf">0.0829</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Method not recognized. Please select either &quot;Schron_2017&quot; or &quot;Franz_2012&quot;.&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">results</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.smooth_1d" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">smooth_1d</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;moving_median&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Use a Savitzky-Golay filter to smooth the signal of corrected neutron counts or another one-dimensional array (e.g. computed volumetric water content).</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>values</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span> or <span title="pandas.Serie">Serie</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dataframe containing the values to smooth.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>window</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Window size for the Savitzky-Golay filter. Default is 5.</p>
            </div>
          </td>
          <td>
                <code>5</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Method to use for smoothing the data. Default is 'moving_median'.
Options are 'moving_average', 'moving_median' and 'savitzky_golay'.</p>
            </div>
          </td>
          <td>
                <code>&#39;moving_median&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>order</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Order of the Savitzky-Golay filter. Default is 3.</p>
            </div>
          </td>
          <td>
                <code>3</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>DataFrame with smoothed values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.
Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.
doi.org/10.3389/frwa.2020.00009</p>
<p>Savitzky, A., &amp; Golay, M. J. (1964). Smoothing and differentiation of data by simplified least squares procedures.
Analytical chemistry, 36(8), 1627-1639.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">smooth_1d</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">order</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;moving_median&#39;</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Use a Savitzky-Golay filter to smooth the signal of corrected neutron counts or another one-dimensional array (e.g. computed volumetric water content).</span>

<span class="sd">    Args:</span>
<span class="sd">        values (pd.DataFrame or pd.Serie): Dataframe containing the values to smooth.</span>
<span class="sd">        window (int): Window size for the Savitzky-Golay filter. Default is 5.</span>
<span class="sd">        method (str): Method to use for smoothing the data. Default is &#39;moving_median&#39;.</span>
<span class="sd">            Options are &#39;moving_average&#39;, &#39;moving_median&#39; and &#39;savitzky_golay&#39;.</span>
<span class="sd">        order (int): Order of the Savitzky-Golay filter. Default is 3.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pd.DataFrame): DataFrame with smoothed values.</span>

<span class="sd">    References:</span>
<span class="sd">        Franz, T.E., Wahbi, A., Zhang, J., Vreugdenhil, M., Heng, L., Dercon, G., Strauss, P., Brocca, L. and Wagner, W., 2020.</span>
<span class="sd">        Practical data products from cosmic-ray neutron sensing for hydrological applications. Frontiers in Water, 2, p.9.</span>
<span class="sd">        doi.org/10.3389/frwa.2020.00009</span>

<span class="sd">        Savitzky, A., &amp; Golay, M. J. (1964). Smoothing and differentiation of data by simplified least squares procedures.</span>
<span class="sd">        Analytical chemistry, 36(8), 1627-1639.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)</span> <span class="ow">and</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s1">&#39;Input must be a pandas Series or DataFrame&#39;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;moving_average&#39;</span><span class="p">:</span>
        <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;moving_median&#39;</span><span class="p">:</span>
        <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">values</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span><span class="o">=</span><span class="n">window</span><span class="p">,</span> <span class="n">center</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">min_periods</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">median</span><span class="p">()</span>

    <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;savitzky_golay&#39;</span><span class="p">:</span>
        <span class="k">if</span> <span class="n">values</span><span class="o">.</span><span class="n">isna</span><span class="p">()</span><span class="o">.</span><span class="n">any</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Dataframe contains NaN values. Please remove NaN values before smoothing the data.&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">series</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
            <span class="n">filtered</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">values</span><span class="p">,</span> <span class="n">window</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
            <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">filtered</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;smoothed&#39;</span><span class="p">],</span> <span class="n">index</span><span class="o">=</span><span class="n">values</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">values</span><span class="p">)</span> <span class="o">==</span> <span class="n">pd</span><span class="o">.</span><span class="n">core</span><span class="o">.</span><span class="n">frame</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">values</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
                <span class="n">values</span><span class="p">[</span><span class="n">col</span><span class="p">]</span> <span class="o">=</span> <span class="n">savgol_filter</span><span class="p">(</span><span class="n">values</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">window</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
            <span class="s1">&#39;Invalid method. Please select a valid filtering method., options are: moving_average, moving_median, savitzky_golay&#39;</span><span class="p">)</span>
    <span class="n">corrected_counts</span> <span class="o">=</span> <span class="n">corrected_counts</span><span class="o">.</span><span class="n">ffill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">bfill</span><span class="p">(</span><span class="n">limit</span><span class="o">=</span><span class="n">window</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">corrected_counts</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.spatial_average" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">spatial_average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_neighbours</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">rnd</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Moving buffer filter to smooth georeferenced two-dimensional data.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM x coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>y</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>UTM y coordinates in meters.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>z</code></td>
          <td>
                <code>list or array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Values to be smoothed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>buffer</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Radial buffer distance in meters.</p>
            </div>
          </td>
          <td>
                <code>100</code>
          </td>
        </tr>
        <tr>
          <td><code>min_neighbours</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Minimum number of neighbours to consider for the smoothing.</p>
            </div>
          </td>
          <td>
                <code>3</code>
          </td>
        </tr>
        <tr>
          <td><code>method</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>One of 'mean' or 'median'.</p>
            </div>
          </td>
          <td>
                <code>&#39;mean&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>rnd</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Boolean to round the final result. Useful in case of z representing neutron counts.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Smoothed version of z with the same dimension as z.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1335</span>
<span class="normal">1336</span>
<span class="normal">1337</span>
<span class="normal">1338</span>
<span class="normal">1339</span>
<span class="normal">1340</span>
<span class="normal">1341</span>
<span class="normal">1342</span>
<span class="normal">1343</span>
<span class="normal">1344</span>
<span class="normal">1345</span>
<span class="normal">1346</span>
<span class="normal">1347</span>
<span class="normal">1348</span>
<span class="normal">1349</span>
<span class="normal">1350</span>
<span class="normal">1351</span>
<span class="normal">1352</span>
<span class="normal">1353</span>
<span class="normal">1354</span>
<span class="normal">1355</span>
<span class="normal">1356</span>
<span class="normal">1357</span>
<span class="normal">1358</span>
<span class="normal">1359</span>
<span class="normal">1360</span>
<span class="normal">1361</span>
<span class="normal">1362</span>
<span class="normal">1363</span>
<span class="normal">1364</span>
<span class="normal">1365</span>
<span class="normal">1366</span>
<span class="normal">1367</span>
<span class="normal">1368</span>
<span class="normal">1369</span>
<span class="normal">1370</span>
<span class="normal">1371</span>
<span class="normal">1372</span>
<span class="normal">1373</span>
<span class="normal">1374</span>
<span class="normal">1375</span>
<span class="normal">1376</span>
<span class="normal">1377</span>
<span class="normal">1378</span>
<span class="normal">1379</span>
<span class="normal">1380</span>
<span class="normal">1381</span>
<span class="normal">1382</span>
<span class="normal">1383</span>
<span class="normal">1384</span>
<span class="normal">1385</span>
<span class="normal">1386</span>
<span class="normal">1387</span>
<span class="normal">1388</span>
<span class="normal">1389</span>
<span class="normal">1390</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">spatial_average</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">buffer</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">min_neighbours</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s1">&#39;mean&#39;</span><span class="p">,</span> <span class="n">rnd</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Moving buffer filter to smooth georeferenced two-dimensional data.</span>

<span class="sd">    Args:</span>
<span class="sd">        x (list or array): UTM x coordinates in meters.</span>
<span class="sd">        y (list or array): UTM y coordinates in meters.</span>
<span class="sd">        z (list or array): Values to be smoothed.</span>
<span class="sd">        buffer (float): Radial buffer distance in meters.</span>
<span class="sd">        min_neighbours (int): Minimum number of neighbours to consider for the smoothing.</span>
<span class="sd">        method (str): One of &#39;mean&#39; or &#39;median&#39;.</span>
<span class="sd">        rnd (bool): Boolean to round the final result. Useful in case of z representing neutron counts.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (array): Smoothed version of z with the same dimension as z.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># Convert input data to Numpy arrays</span>
    <span class="k">if</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span> <span class="ow">or</span> <span class="p">(</span><span class="nb">type</span><span class="p">(</span><span class="n">y</span><span class="p">)</span> <span class="ow">is</span> <span class="ow">not</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
            <span class="n">y</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">raise</span> <span class="s2">&quot;Input values cannot be converted to Numpy arrays.&quot;</span>

    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="o">!=</span> <span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">):</span>
        <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;The number of x and y must be equal. Input x has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="si">}</span><span class="s2"> values and y has </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2"> values.&quot;</span>

    <span class="c1"># Compute distances</span>
    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="n">z_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([])</span>
    <span class="k">for</span> <span class="n">k</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">N</span><span class="p">):</span>
        <span class="n">px</span> <span class="o">=</span> <span class="n">x</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>
        <span class="n">py</span> <span class="o">=</span> <span class="n">y</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>

        <span class="n">distances</span> <span class="o">=</span> <span class="n">euclidean_distance</span><span class="p">(</span><span class="n">px</span><span class="p">,</span> <span class="n">py</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">)</span>
        <span class="n">idx_within_buffer</span> <span class="o">=</span> <span class="n">distances</span> <span class="o">&lt;=</span> <span class="n">buffer</span>

        <span class="k">if</span> <span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">k</span><span class="p">]):</span>
            <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span>
        <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">distances</span><span class="p">[</span><span class="n">idx_within_buffer</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">min_neighbours</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;mean&#39;</span><span class="p">:</span>
                <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmean</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx_within_buffer</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">method</span> <span class="o">==</span> <span class="s1">&#39;median&#39;</span><span class="p">:</span>
                <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">nanmedian</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">idx_within_buffer</span><span class="p">])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Method </span><span class="si">{</span><span class="n">method</span><span class="si">}</span><span class="s2"> does not exist. Provide either &#39;mean&#39; or &#39;median&#39;.&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">z_new_val</span> <span class="o">=</span> <span class="n">z</span><span class="p">[</span><span class="n">k</span><span class="p">]</span>  <span class="c1"># If there are not enough neighbours, keep the original value</span>

        <span class="c1"># Append smoothed value to array</span>
        <span class="n">z_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z_smooth</span><span class="p">,</span> <span class="n">z_new_val</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">rnd</span><span class="p">:</span>
        <span class="n">z_smooth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">z_smooth</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">z_smooth</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.total_raw_counts" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">total_raw_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Compute the sum of uncorrected neutron counts for all detectors.</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>counts</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dataframe containing only the columns with neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Dataframe with the sum of uncorrected neutron counts for all detectors.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">total_raw_counts</span><span class="p">(</span><span class="n">counts</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Compute the sum of uncorrected neutron counts for all detectors.</span>

<span class="sd">    Args:</span>
<span class="sd">        counts (pandas.DataFrame): Dataframe containing only the columns with neutron counts.</span>

<span class="sd">    Returns:</span>
<span class="sd">        (pandas.DataFrame): Dataframe with the sum of uncorrected neutron counts for all detectors.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">counts</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
        <span class="n">counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="n">counts</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

    <span class="c1"># Compute sum of counts</span>
    <span class="n">total_raw_counts</span> <span class="o">=</span> <span class="n">counts</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="c1"># Replace zeros with NaN</span>
    <span class="n">total_raw_counts</span> <span class="o">=</span> <span class="n">total_raw_counts</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">nan</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">total_raw_counts</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.uncertainty_counts" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">uncertainty_counts</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s1">&#39;std&#39;</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the uncertainty of raw counts.</p>
<p>Measurements of proportional neutron detector systems are governed by counting statistics that follow a Poissonian probability distribution (Zreda et al., 2012).
The expected uncertainty in the neutron count rate $N$ is defined by the standard deviation $ \sqrt{N} $ (Jakobi et al., 2020).
The CV% can be expressed as $ N^{-1/2} $</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>raw_counts</code></td>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Raw neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>metric</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Either 'std' or 'cv' for standard deviation or coefficient of variation.</p>
            </div>
          </td>
          <td>
                <code>&#39;std&#39;</code>
          </td>
        </tr>
        <tr>
          <td><code>fp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pressure correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>fw</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Humidity correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>fi</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Incoming neutron flux correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>uncertainty</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Uncertainty of raw counts.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Jakobi J, Huisman JA, Schrön M, Fiedler J, Brogi C, Vereecken H and Bogena HR (2020) Error Estimation for Soil Moisture Measurements With
Cosmic Ray Neutron Sensing and Implications for Rover Surveys. Front. Water 2:10. doi: 10.3389/frwa.2020.00010</p>
<p>Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., and Rosolem, R.: COSMOS: the COsmic-ray Soil Moisture Observing System,
Hydrol. Earth Syst. Sci., 16, 4079–4099, https://doi.org/10.5194/hess-16-4079-2012, 2012.</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1515</span>
<span class="normal">1516</span>
<span class="normal">1517</span>
<span class="normal">1518</span>
<span class="normal">1519</span>
<span class="normal">1520</span>
<span class="normal">1521</span>
<span class="normal">1522</span>
<span class="normal">1523</span>
<span class="normal">1524</span>
<span class="normal">1525</span>
<span class="normal">1526</span>
<span class="normal">1527</span>
<span class="normal">1528</span>
<span class="normal">1529</span>
<span class="normal">1530</span>
<span class="normal">1531</span>
<span class="normal">1532</span>
<span class="normal">1533</span>
<span class="normal">1534</span>
<span class="normal">1535</span>
<span class="normal">1536</span>
<span class="normal">1537</span>
<span class="normal">1538</span>
<span class="normal">1539</span>
<span class="normal">1540</span>
<span class="normal">1541</span>
<span class="normal">1542</span>
<span class="normal">1543</span>
<span class="normal">1544</span>
<span class="normal">1545</span>
<span class="normal">1546</span>
<span class="normal">1547</span>
<span class="normal">1548</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">uncertainty_counts</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Function to estimate the uncertainty of raw counts.</span>

<span class="sd">    Measurements of proportional neutron detector systems are governed by counting statistics that follow a Poissonian probability distribution (Zreda et al., 2012).</span>
<span class="sd">    The expected uncertainty in the neutron count rate $N$ is defined by the standard deviation $ \sqrt{N} $ (Jakobi et al., 2020).</span>
<span class="sd">    The CV% can be expressed as $ N^{-1/2} $</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_counts (array): Raw neutron counts.</span>
<span class="sd">        metric (str): Either &#39;std&#39; or &#39;cv&#39; for standard deviation or coefficient of variation.</span>
<span class="sd">        fp (float): Pressure correction factor.</span>
<span class="sd">        fw (float): Humidity correction factor.</span>
<span class="sd">        fi (float): Incoming neutron flux correction factor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        uncertainty (float): Uncertainty of raw counts.</span>

<span class="sd">    References:</span>
<span class="sd">        Jakobi J, Huisman JA, Schrön M, Fiedler J, Brogi C, Vereecken H and Bogena HR (2020) Error Estimation for Soil Moisture Measurements With</span>
<span class="sd">        Cosmic Ray Neutron Sensing and Implications for Rover Surveys. Front. Water 2:10. doi: 10.3389/frwa.2020.00010</span>

<span class="sd">        Zreda, M., Shuttleworth, W. J., Zeng, X., Zweck, C., Desilets, D., Franz, T., and Rosolem, R.: COSMOS: the COsmic-ray Soil Moisture Observing System,</span>
<span class="sd">        Hydrol. Earth Syst. Sci., 16, 4079–4099, https://doi.org/10.5194/hess-16-4079-2012, 2012.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">s</span> <span class="o">=</span> <span class="n">fw</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">*</span> <span class="n">fi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;std&quot;</span><span class="p">:</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span>
    <span class="k">elif</span> <span class="n">metric</span> <span class="o">==</span> <span class="s2">&quot;cv&quot;</span><span class="p">:</span>
        <span class="n">uncertainty</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">)</span> <span class="o">*</span> <span class="n">s</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">raise</span> <span class="sa">f</span><span class="s2">&quot;Metric </span><span class="si">{</span><span class="n">metric</span><span class="si">}</span><span class="s2"> does not exist. Provide either &#39;std&#39; or &#39;cv&#39; for standard deviation or coefficient of variation.&quot;</span>
    <span class="k">return</span> <span class="n">uncertainty</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">




<h2 id="crnpy.data.uncertainty_vwc" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">uncertainty_vwc</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Function to estimate the uncertainty propagated to volumetric water content.</p>
<p>The uncertainty of the volumetric water content is estimated by propagating the uncertainty of the raw counts.
Following Eq. 10 in Jakobi et al. (2020), the uncertainty of the volumetric water content can be expressed as:
$$
\sigma_{\theta_g}(N) = \sigma_N \frac{a_0 N_0}{(N_{cor} - a_1 N_0)^4} \sqrt{(N_{cor} - a_1 N_0)^4 + 8 \sigma_N^2 (N_{cor} - a_1 N_0)^2 + 15 \sigma_N^4}
$$</p>



  <p><strong>Parameters:</strong></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>raw_counts</code></td>
          <td>
                <code>array</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Raw neutron counts.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>N0</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Calibration parameter N0.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>bulk_density</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Bulk density in g cm-3.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr>
          <td><code>fp</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Pressure correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>fw</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Humidity correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
        <tr>
          <td><code>fi</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Incoming neutron flux correction factor.</p>
            </div>
          </td>
          <td>
                <code>1</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><strong>Returns:</strong></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr>
<td><code>sigma_VWC</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Uncertainty in terms of volumetric water content.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

<details class="references" open>
  <summary>References</summary>
  <p>Jakobi J, Huisman JA, Schrön M, Fiedler J, Brogi C, Vereecken H and Bogena HR (2020) Error Estimation for Soil Moisture Measurements With
Cosmic Ray Neutron Sensing and Implications for Rover Surveys. Front. Water 2:10. doi: 10.3389/frwa.2020.00010</p>
</details>
          <details class="quote">
            <summary>Source code in <code>crnpy/crnpy.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">1551</span>
<span class="normal">1552</span>
<span class="normal">1553</span>
<span class="normal">1554</span>
<span class="normal">1555</span>
<span class="normal">1556</span>
<span class="normal">1557</span>
<span class="normal">1558</span>
<span class="normal">1559</span>
<span class="normal">1560</span>
<span class="normal">1561</span>
<span class="normal">1562</span>
<span class="normal">1563</span>
<span class="normal">1564</span>
<span class="normal">1565</span>
<span class="normal">1566</span>
<span class="normal">1567</span>
<span class="normal">1568</span>
<span class="normal">1569</span>
<span class="normal">1570</span>
<span class="normal">1571</span>
<span class="normal">1572</span>
<span class="normal">1573</span>
<span class="normal">1574</span>
<span class="normal">1575</span>
<span class="normal">1576</span>
<span class="normal">1577</span>
<span class="normal">1578</span>
<span class="normal">1579</span>
<span class="normal">1580</span>
<span class="normal">1581</span>
<span class="normal">1582</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">uncertainty_vwc</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">N0</span><span class="p">,</span> <span class="n">bulk_density</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">a0</span><span class="o">=</span><span class="mf">0.0808</span><span class="p">,</span> <span class="n">a1</span><span class="o">=</span><span class="mf">0.372</span><span class="p">,</span> <span class="n">a2</span><span class="o">=</span><span class="mf">0.115</span><span class="p">):</span>
<span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Function to estimate the uncertainty propagated to volumetric water content.</span>

<span class="sd">    The uncertainty of the volumetric water content is estimated by propagating the uncertainty of the raw counts.</span>
<span class="sd">    Following Eq. 10 in Jakobi et al. (2020), the uncertainty of the volumetric water content can be expressed as:</span>
<span class="sd">    $$</span>
<span class="sd">    \sigma_{\theta_g}(N) = \sigma_N \frac{a_0 N_0}{(N_{cor} - a_1 N_0)^4} \sqrt{(N_{cor} - a_1 N_0)^4 + 8 \sigma_N^2 (N_{cor} - a_1 N_0)^2 + 15 \sigma_N^4}</span>
<span class="sd">    $$</span>

<span class="sd">    Args:</span>
<span class="sd">        raw_counts (array): Raw neutron counts.</span>
<span class="sd">        N0 (float): Calibration parameter N0.</span>
<span class="sd">        bulk_density (float): Bulk density in g cm-3.</span>
<span class="sd">        fp (float): Pressure correction factor.</span>
<span class="sd">        fw (float): Humidity correction factor.</span>
<span class="sd">        fi (float): Incoming neutron flux correction factor.</span>

<span class="sd">    Returns:</span>
<span class="sd">        sigma_VWC (float): Uncertainty in terms of volumetric water content.</span>

<span class="sd">    References:</span>
<span class="sd">        Jakobi J, Huisman JA, Schrön M, Fiedler J, Brogi C, Vereecken H and Bogena HR (2020) Error Estimation for Soil Moisture Measurements With</span>
<span class="sd">        Cosmic Ray Neutron Sensing and Implications for Rover Surveys. Front. Water 2:10. doi: 10.3389/frwa.2020.00010</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">Ncorr</span> <span class="o">=</span> <span class="n">raw_counts</span> <span class="o">*</span> <span class="n">fw</span> <span class="o">/</span> <span class="p">(</span><span class="n">fp</span> <span class="o">*</span> <span class="n">fi</span><span class="p">)</span>
    <span class="n">sigma_N</span> <span class="o">=</span> <span class="n">uncertainty_counts</span><span class="p">(</span><span class="n">raw_counts</span><span class="p">,</span> <span class="n">metric</span><span class="o">=</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="o">=</span><span class="n">fp</span><span class="p">,</span> <span class="n">fw</span><span class="o">=</span><span class="n">fw</span><span class="p">,</span> <span class="n">fi</span><span class="o">=</span><span class="n">fi</span><span class="p">)</span>
    <span class="n">sigma_GWC</span> <span class="o">=</span> <span class="n">sigma_N</span> <span class="o">*</span> <span class="p">((</span><span class="n">a0</span> <span class="o">*</span> <span class="n">N0</span><span class="p">)</span> <span class="o">/</span> <span class="p">((</span><span class="n">Ncorr</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">N0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span><span class="p">))</span> <span class="o">*</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span>
        <span class="p">(</span><span class="n">Ncorr</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">N0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">4</span> <span class="o">+</span> <span class="mi">8</span> <span class="o">*</span> <span class="n">sigma_N</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">*</span> <span class="p">(</span><span class="n">Ncorr</span> <span class="o">-</span> <span class="n">a1</span> <span class="o">*</span> <span class="n">N0</span><span class="p">)</span> <span class="o">**</span> <span class="mi">2</span> <span class="o">+</span> <span class="mi">15</span> <span class="o">*</span> <span class="n">sigma_N</span> <span class="o">**</span> <span class="mi">4</span><span class="p">)</span>
    <span class="n">sigma_VWC</span> <span class="o">=</span> <span class="n">sigma_GWC</span> <span class="o">*</span> <span class="n">bulk_density</span>

    <span class="k">return</span> <span class="n">sigma_VWC</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>







  
  






                

              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="../javascripts/katex.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/katex.min.js"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.7/contrib/auto-render.min.js"></script>
      
    
  <script>document$.subscribe(() => {const lightbox = GLightbox({"touchNavigation": true, "loop": false, "zoomable": true, "draggable": true, "openEffect": "zoom", "closeEffect": "zoom", "slideEffect": "slide"});})</script></body>
</html>